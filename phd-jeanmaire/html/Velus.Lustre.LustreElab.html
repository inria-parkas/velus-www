
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module LustreElab</title>
<meta name="description" content="Documentation of Coq module LustreElab" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module LustreElab</h1>
<div class="coq">
<span class="kwd">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html">String</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Sorting.Mergesort.html">Sorting.Mergesort</a></span>.<br/>
<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Common.CompCertLib.html">Common.CompCertLib</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="id"><a href="Velus.Instantiator.html">Instantiator</a></span>.<br/>
<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html">Lustre.Parser.LustreAst</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Common.Common.html">Common</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Ident.html">Ident</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Environment.html">Environment</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Operators.html">Operators</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Clocks.html">Clocks</a></span>.<br/>
<br/>
<span class="kwd">Module</span> <span class="kwd">Import</span> <span class="id"><a name="Syn">Syn</a></span> := <span class="id"><a href="Velus.Instantiator.html#L.Syn">Instantiator.L.Syn</a></span>.<br/>
<br/>
<span class="kwd">Import</span> <span class="id"><a href="Velus.ObcToClight.Interface.html">Interface</a></span>.<br/>
<span class="kwd">Import</span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Op">Interface.Op</a></span>.<br/>
<span class="kwd">Import</span> <span class="id"><a href="Velus.ObcToClight.Interface.html#OpAux">Interface.OpAux</a></span>.<br/>
<span class="kwd">Import</span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks">Interface.Cks</a></span>.<br/>
<span class="kwd">Import</span> <span class="id"><a href="Velus.Instantiator.html#L.Senv">Instantiator.L.Senv</a></span>.<br/>
<span class="kwd">Import</span> <span class="id"><a href="Velus.Instantiator.html#L.Typ">Instantiator.L.Typ</a></span>.<br/>
<span class="kwd">Import</span> <span class="id"><a href="Velus.Instantiator.html#L.Clo">Instantiator.L.Clo</a></span>.<br/>
<br/>
<span class="kwd">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html">List</a></span>.<br/>
<span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#ListNotations">List.ListNotations</a></span>.<br/>
<span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">list_scope</span>.<br/>
<br/>
<span class="kwd">From</span> <span class="id">compcert</span> <span class="kwd">Require</span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Cop.html">cfrontend.Cop</a></span>.<br/>
<span class="kwd">From</span> <span class="id">compcert</span> <span class="kwd">Require</span> <span class="id"><a href="../../CompCert/doc/html/compcert.cparser.Cabs.html">cparser.Cabs</a></span>.<br/>
<br/>
<span class="kwd">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Sorting.Permutation.html">Permutation</a></span>.<br/>
<br/>
<span class="kwd">From</span> <span class="id">compcert</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html">common.Errors</a></span>.<br/>
<br/>
<br/>
<br/>
<h1>)
(*   Lexing and parsing gives a list of LustreAst declarations. Elaboration </h1>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<span class="kwd">Parameter</span> <span class="id"><a name="elab_const_int">elab_const_int</a></span> : <span class="id"><a href="../../CompCert/doc/html/compcert.cparser.Cabs.html#loc">Cabs.loc</a></span> -&gt; <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#string">string</a></span> -&gt; <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.constant">constant</a></span>.<br/>
<span class="kwd">Parameter</span> <span class="id"><a name="elab_const_float">elab_const_float</a></span> : <span class="id"><a href="../../CompCert/doc/html/compcert.cparser.Cabs.html#floatInfo">Cabs.floatInfo</a></span> -&gt; <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.constant">constant</a></span>.<br/>
<span class="kwd">Parameter</span> <span class="id"><a name="elab_const_char">elab_const_char</a></span> : <span class="id"><a href="../../CompCert/doc/html/compcert.cparser.Cabs.html#loc">Cabs.loc</a></span> -&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.cparser.Cabs.html#encoding">Cabs.encoding</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#char_code">char_code</a></span> -&gt; <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.constant">constant</a></span>.<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<span class="kwd">Parameter</span> <span class="id"><a name="string_of_astloc">string_of_astloc</a></span> : <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#string">String.string</a></span>.<br/>
<span class="kwd">Parameter</span> <span class="id"><a name="cabsloc_of_astloc">cabsloc_of_astloc</a></span> : <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span> -&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.cparser.Cabs.html#loc">Cabs.loc</a></span>.<br/>
<span class="kwd">Parameter</span> <span class="id"><a name="cabs_floatinfo">cabs_floatinfo</a></span> : <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#floatInfo">floatInfo</a></span> -&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.cparser.Cabs.html#floatInfo">Cabs.floatInfo</a></span>.<br/>
<br/>
<span class="id">Local</span> <span class="kwd">Ltac</span> <span class="id">NamedDestructCases</span> :=<br/>
&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">progress</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>:<span class="kwd">match</span> ?<span class="id">e</span> <span class="kwd">with</span> <span class="id">_</span> =&gt; <span class="id">_</span> <span class="kwd">end</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Heq</span> := <span class="id">fresh</span> "<span class="id">Heq</span>" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">e</span> <span class="id">eqn</span>:<span class="id">Heq</span>; <span class="id">try</span> <span class="id">discriminate</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>:<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> <span class="id">_</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="id">injection</span> <span class="id">H</span>; <span class="id">clear</span> <span class="id">H</span>; <span class="id">intro</span>; <span class="id">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="msg_of_types">msg_of_types</a></span> (<span class="id">ty</span> <span class="id">ty</span>': <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span>) : <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#errmsg">errmsg</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "<span class="id">expected</span> '" :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#string_of_type">string_of_type</a></span> <span class="id">ty</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "' <span class="id">but</span> <span class="id">got</span> '" :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#string_of_type">string_of_type</a></span> <span class="id">ty</span>') :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "'".<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="msg_of_list_types">msg_of_list_types</a></span> (<span class="id">tys</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span>) : <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#errmsg">errmsg</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">tys</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [] =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> ""<br/>
&nbsp;&nbsp;| [<span class="id">ty</span>] =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#string_of_type">string_of_type</a></span> <span class="id">ty</span>)<br/>
&nbsp;&nbsp;| <span class="id">ty</span>::<span class="id">tys</span> =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#string_of_type">string_of_type</a></span> <span class="id">ty</span>) :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> ", " :: <span class="id">msg_of_list_types</span> <span class="id">tys</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="msg_of_enum_type">msg_of_enum_type</a></span> (<span class="id">ty</span>: <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span>) : <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#errmsg">errmsg</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "<span class="id">enumerated</span> <span class="id">type</span> <span class="id">expected</span> <span class="id">but</span> <span class="id">got</span> '" :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#string_of_type">string_of_type</a></span> <span class="id">ty</span>) :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "'".<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="msg_of_primitive_type">msg_of_primitive_type</a></span> (<span class="id">ty</span>: <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span>) : <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#errmsg">errmsg</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "<span class="id">primitive</span> <span class="id">type</span> <span class="id">expected</span> <span class="id">but</span> <span class="id">got</span> '" :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#string_of_type">string_of_type</a></span> <span class="id">ty</span>) :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "'".<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="sclock">sclock</a></span> :=<br/>
| <span class="id"><a name="Sbase">Sbase</a></span> : <span class="id">sclock</span><br/>
| <span class="id"><a name="Svar">Svar</a></span> : <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> -&gt; <span class="id">sclock</span><br/>
| <span class="id"><a name="Son">Son</a></span> : <span class="id">sclock</span> -&gt; <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> -&gt; (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.enumtag">enumtag</a></span>) -&gt; <span class="id">sclock</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="sclock_eq">sclock_eq</a></span> (<span class="id">ck1</span> <span class="id">ck2</span>: <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ck1</span>, <span class="id">ck2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Sbase">Sbase</a></span>, <span class="id"><a href="Velus.Lustre.LustreElab.html#Sbase">Sbase</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Svar">Svar</a></span> <span class="id">id1</span>, <span class="id"><a href="Velus.Lustre.LustreElab.html#Svar">Svar</a></span> <span class="id">id2</span> =&gt; <span class="id"><a href="Velus.Common.Common.html#ident_eqb">ident_eqb</a></span> <span class="id">id1</span> <span class="id">id2</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Son">Son</a></span> <span class="id">ck1</span>' <span class="id">x1</span> <span class="id">b1</span>, <span class="id"><a href="Velus.Lustre.LustreElab.html#Son">Son</a></span> <span class="id">ck2</span>' <span class="id">x2</span> <span class="id">b2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id">x1</span> ==<span class="id">b</span> <span class="id">x2</span>) &amp;&amp; (<span class="id">b1</span> ==<span class="id">b</span> <span class="id">b2</span>)) &amp;&amp; <span class="id">sclock_eq</span> <span class="id">ck1</span>' <span class="id">ck2</span>'<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sclock_eq_spec">sclock_eq_spec</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ck1</span> <span class="id">ck2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#sclock_eq">sclock_eq</a></span> <span class="id">ck1</span> <span class="id">ck2</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> &lt;-&gt; <span class="id">ck1</span> = <span class="id">ck2</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof1')">Proof.</span></div>
<div class="proofscript" id="proof1">
<br/>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">ck1</span>, <span class="id">ck2</span>; <span class="id">split</span>; <span class="id">intro</span> <span class="id">HH</span>; <span class="id">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">try</span> <span class="id">now</span> <span class="id">inversion</span> <span class="id">HH</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#ident_eqb_eq">ident_eqb_eq</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">HH</span>. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.Common.html#ident_eqb_refl">ident_eqb_refl</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">HH</span> <span class="kwd">as</span> [<span class="id">Heq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#andb_prop">andb_prop</a></span> <span class="kwd">in</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Heq</span> <span class="kwd">as</span> (<span class="id">Heq</span> &amp; <span class="id">Hc</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#andb_prop">andb_prop</a></span> <span class="kwd">in</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Heq</span> <span class="kwd">as</span> (<span class="id">Hi</span> &amp; <span class="id">Hb</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#equiv_decb_equiv">equiv_decb_equiv</a></span> <span class="kwd">in</span> <span class="id">Hi</span>. <span class="id">inv</span> <span class="id">Hi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#equiv_decb_equiv">equiv_decb_equiv</a></span> <span class="kwd">in</span> <span class="id">Hb</span>. <span class="id">inv</span> <span class="id">Hb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">IHck1</span> <span class="kwd">in</span> <span class="id">Hc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subst</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">HH</span> <span class="kwd">as</span> [<span class="id">Heq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subst</span>. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">Bool.andb_true_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>. 2:<span class="id">now</span> <span class="id">apply</span> <span class="id">IHck1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">Bool.andb_true_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>. <span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="Velus.Common.Common.html#equiv_decb_equiv">equiv_decb_equiv</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="Velus.Common.Common.html#equiv_decb_equiv">equiv_decb_equiv</a></span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="id">Local</span> <span class="kwd">Instance</span> <span class="id"><a name="sclock_EqDec">sclock_EqDec</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Classes.EquivDec.html#EqDec">EqDec</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof2')">Proof.</span></div>
<div class="proofscript" id="proof2">
<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">ck1</span> <span class="id">ck2</span>. <span class="id">compute</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#sclock_eq_spec">sclock_eq_spec</a></span> <span class="id">ck1</span> <span class="id">ck2</span>) <span class="kwd">as</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#sclock_eq">sclock_eq</a></span> <span class="id">ck1</span> <span class="id">ck2</span>); [<span class="id">left</span>|<span class="id">right</span>].<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="id">apply</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;<span class="id">intro</span> <span class="id">HH</span>. <span class="id">apply</span> <span class="id">Heq</span> <span class="kwd">in</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;<span class="id">discriminate</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sclock_eqb_eq">sclock_eqb_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">x</span> <span class="id">y</span>: <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>), <span class="id">x</span> ==<span class="id">b</span> <span class="id">y</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> &lt;-&gt; <span class="id">x</span> = <span class="id">y</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof3')">Proof.</span></div>
<div class="proofscript" id="proof3">
<br/>
&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id"><a href="Velus.Common.Common.html#equiv_decb_equiv">equiv_decb_equiv</a></span>; <span class="id">reflexivity</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="sclk">sclk</a></span> (<span class="id">ck</span> : <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.clock">clock</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ck</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.Cbase">Cbase</a></span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#Sbase">Sbase</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.Con">Con</a></span> <span class="id">ck</span>' <span class="id">x</span> <span class="id">b</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#Son">Son</a></span> (<span class="id">sclk</span> <span class="id">ck</span>') <span class="id">x</span> <span class="id">b</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id">sclk</span>' (<span class="id">ck</span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>) : <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.clock">clock</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ck</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Sbase">Sbase</a></span> | <span class="id"><a href="Velus.Lustre.LustreElab.html#Svar">Svar</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.Cbase">Cbase</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Son">Son</a></span> <span class="id">ck</span>' <span class="id">x</span> <span class="id">b</span> =&gt; <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.Con">Con</a></span> (<span class="id">sclk</span>' <span class="id">ck</span>') <span class="id">x</span> <span class="id">b</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="nsclock">nsclock</a></span> := (<span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>)%<span class="id">type</span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="stripname">stripname</a></span> (<span class="id">nck</span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#nsclock">nsclock</a></span>) := (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">nck</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="ann">ann</a></span> : <span class="kwd">Type</span> := (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>)%<span class="id">type</span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="lann">lann</a></span> : <span class="kwd">Type</span> := (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>)%<span class="id">type</span>.<br/>
<br/>
<div class="doc">elaboration exp : annotations use sclock </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="eexp">eexp</a></span> : <span class="kwd">Type</span> :=<br/>
<br/>
| <span class="id"><a name="Econst">Econst</a></span> : <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.cconst">cconst</a></span> -&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span> -&gt; <span class="id">eexp</span><br/>
| <span class="id"><a name="Eenum">Eenum</a></span> : <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.enumtag">enumtag</a></span> -&gt; <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> -&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span> -&gt; <span class="id">eexp</span><br/>
| <span class="id"><a name="Evar">Evar</a></span>   : <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> -&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ann">ann</a></span> -&gt; <span class="id">eexp</span><br/>
| <span class="id"><a name="Elast">Elast</a></span>  : <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> -&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ann">ann</a></span> -&gt; <span class="id">eexp</span><br/>
| <span class="id"><a name="Eunop">Eunop</a></span>  : <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.unop">unop</a></span> -&gt; <span class="id">eexp</span> -&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ann">ann</a></span> -&gt; <span class="id">eexp</span><br/>
| <span class="id"><a name="Ebinop">Ebinop</a></span> : <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.binop">binop</a></span> -&gt; <span class="id">eexp</span> -&gt; <span class="id">eexp</span> -&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ann">ann</a></span> -&gt; <span class="id">eexp</span><br/>
| <span class="id"><a name="Eextcall">Eextcall</a></span> : <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">eexp</span> -&gt; (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.ctype">ctype</a></span> * <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>) -&gt; <span class="id">eexp</span><br/>
<br/>
| <span class="id"><a name="Efby">Efby</a></span>   : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">eexp</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">eexp</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ann">ann</a></span> -&gt; <span class="id">eexp</span><br/>
| <span class="id"><a name="Earrow">Earrow</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">eexp</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">eexp</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ann">ann</a></span> -&gt; <span class="id">eexp</span><br/>
<br/>
| <span class="id"><a name="Ewhen">Ewhen</a></span>  : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">eexp</span> -&gt; (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span>) -&gt; <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.enumtag">enumtag</a></span> -&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#lann">lann</a></span> -&gt; <span class="id">eexp</span><br/>
| <span class="id"><a name="Emerge">Emerge</a></span> : (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span>) -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.enumtag">enumtag</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">eexp</span>) -&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#lann">lann</a></span> -&gt; <span class="id">eexp</span><br/>
| <span class="id"><a name="Ecase">Ecase</a></span>  : <span class="id">eexp</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.enumtag">enumtag</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">eexp</span>) -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">eexp</span>) -&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#lann">lann</a></span> -&gt; <span class="id">eexp</span><br/>
<br/>
| <span class="id"><a name="Eapp">Eapp</a></span>   : <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">eexp</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">eexp</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ann">ann</a></span> -&gt; <span class="id">eexp</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="const_annot">const_annot</a></span> :=<br/>
| <span class="id"><a name="ConstA">ConstA</a></span>: <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.cconst">cconst</a></span> -&gt; <span class="id">const_annot</span><br/>
| <span class="id"><a name="EnumA">EnumA</a></span>: <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.enumtag">enumtag</a></span> -&gt; (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) -&gt; <span class="id">const_annot</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="msg_ident_list">msg_ident_list</a></span> (<span class="id">xs</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">xs</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [] =&gt; []<br/>
&nbsp;&nbsp;| [<span class="id">x</span>] =&gt; [<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">x</span>]<br/>
&nbsp;&nbsp;| <span class="id">x</span>::<span class="id">xs</span> =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">x</span> :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> ", " :: <span class="id">msg_ident_list</span> <span class="id">xs</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">A completely ad-hoc monad, used only for elaboration :) </div>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="ElabMonad">ElabMonad</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">A</span> : <span class="kwd">Type</span>}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="elab_state">elab_state</a></span> : <span class="kwd">Type</span> := (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>).<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Elab">Elab</a></span> <span class="id">A</span> := <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_state">elab_state</a></span> -&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#res">res</a></span> (<span class="id">A</span> * <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_state">elab_state</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="init_state">init_state</a></span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_state">elab_state</a></span> := (<span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>, <span class="id"><a href="Velus.Environment.html#Env.empty">Env.empty</a></span> <span class="id">_</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="ret">ret</a></span> (<span class="id">x</span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabMonad.A">A</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabMonad.A">A</a></span> := <span class="kwd">fun</span> <span class="id">st</span> =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id">x</span>, <span class="id">st</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="bind">bind</a></span> {<span class="id">B</span> : <span class="kwd">Type</span>} (<span class="id">x</span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabMonad.A">A</a></span>) (<span class="id">f</span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabMonad.A">A</a></span> -&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id">B</span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id">B</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">st</span> =&gt; <span class="kwd">match</span> (<span class="id">x</span> <span class="id">st</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id">a</span>, <span class="id">st</span>') =&gt; <span class="id">f</span> <span class="id">a</span> <span class="id">st</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#Error">Error</a></span> <span class="id">err</span> =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#Error">Error</a></span> <span class="id">err</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="bind2">bind2</a></span> {<span class="id">A1</span> <span class="id">A2</span> <span class="id">B</span> : <span class="kwd">Type</span>} (<span class="id">x</span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> (<span class="id">A1</span> * <span class="id">A2</span>)) (<span class="id">f</span> : <span class="id">A1</span> -&gt; <span class="id">A2</span> -&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id">B</span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id">B</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">st</span> =&gt; <span class="kwd">match</span> (<span class="id">x</span> <span class="id">st</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> ((<span class="id">a1</span>, <span class="id">a2</span>), <span class="id">st</span>') =&gt; <span class="id">f</span> <span class="id">a1</span> <span class="id">a2</span> <span class="id">st</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#Error">Error</a></span> <span class="id">err</span> =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#Error">Error</a></span> <span class="id">err</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="error">error</a></span> (<span class="id">msg</span> : <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#errmsg">errmsg</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabMonad.A">A</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">st</span> =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#Error">Error</a></span> <span class="id">msg</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">err_loc</span>' (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">m</span>: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#errmsg">errmsg</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#string_of_astloc">string_of_astloc</a></span> <span class="id">loc</span>) :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> ":" :: <span class="id">m</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="err_loc">err_loc</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">m</span>: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#errmsg">errmsg</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabMonad.A">A</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#error">error</a></span> (<span class="id">err_loc</span>' <span class="id">loc</span> <span class="id">m</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="fresh_ident">fresh_ident</a></span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">fun</span> '(<span class="id">n</span>, <span class="id">sub1</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">id</span> := <span class="id"><a href="Velus.Ident.html#Ids.gensym">Ids.gensym</a></span> <span class="id"><a href="Velus.Ident.html#Ids.elab">Ids.elab</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> <span class="id">n</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id">id</span>, (<span class="id"><a href="https://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.succ">Pos.succ</a></span> <span class="id">n</span>, <span class="id">sub1</span>)).<br/>
<br/>
<div class="doc">Substitution functions </div>
<br/>
<br/>
<div class="doc">Occur check </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="occurs">occurs</a></span> <span class="id">id</span> <span class="id">sck</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">sck</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Sbase">Sbase</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Svar">Svar</a></span> <span class="id">x</span> =&gt; <span class="id">x</span> ==<span class="id">b</span> <span class="id">id</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Son">Son</a></span> <span class="id">sck</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">occurs</span> <span class="id">id</span> <span class="id">sck</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Substitute `ck` to `id` in `sck` </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="subst_in_sclock">subst_in_sclock</a></span> (<span class="id">id</span> : <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) (<span class="id">ck</span> <span class="id">sck</span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">sck</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Sbase">Sbase</a></span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#Sbase">Sbase</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Svar">Svar</a></span> <span class="id">x</span> =&gt; <span class="kwd">if</span> <span class="id">x</span> ==<span class="id">b</span> <span class="id">id</span> <span class="kwd">then</span> <span class="id">ck</span> <span class="kwd">else</span> <span class="id">sck</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Son">Son</a></span> <span class="id">sck</span> <span class="id">ckid</span> <span class="id">b</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#Son">Son</a></span> (<span class="id">subst_in_sclock</span> <span class="id">id</span> <span class="id">ck</span> <span class="id">sck</span>) <span class="id">ckid</span> <span class="id">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="subst_clock">subst_clock</a></span> (<span class="id">id</span> : <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">st</span> =&gt; <span class="kwd">let</span> '(<span class="id">_</span>, <span class="id">sub1</span>) := <span class="id">st</span> <span class="kwd">in</span> <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">id</span> <span class="id">sub1</span>, <span class="id">st</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="bind_inv">bind_inv</a></span> {<span class="id">B</span>} : <span class="kwd">forall</span> (<span class="id">x</span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabMonad.A">A</a></span>) (<span class="id">f</span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabMonad.A">A</a></span> -&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id">B</span>) <span class="id">res</span> <span class="id">st</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.LustreElab.html#bind">bind</a></span> <span class="id">x</span> <span class="id">f</span>) <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> <span class="id">res</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">y</span> <span class="id">st</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">x</span> <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id">y</span>, <span class="id">st</span>'') /\ <span class="id">f</span> <span class="id">y</span> <span class="id">st</span>'' = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> <span class="id">res</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof4')">Proof.</span></div>
<div class="proofscript" id="proof4">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hbind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#bind">bind</a></span> <span class="kwd">in</span> <span class="id">Hbind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">x</span> <span class="id">st</span>) <span class="kwd">as</span> [[<span class="id">y</span> <span class="id">st</span>'']|]; <span class="id">eauto</span>. <span class="id">inv</span> <span class="id">Hbind</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="bind2_inv">bind2_inv</a></span> {<span class="id">A1</span> <span class="id">A2</span> <span class="id">B</span>} : <span class="kwd">forall</span> (<span class="id">x</span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> (<span class="id">A1</span> * <span class="id">A2</span>)) (<span class="id">f</span> : <span class="id">A1</span> -&gt; <span class="id">A2</span> -&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id">B</span>) <span class="id">res</span> <span class="id">st</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.LustreElab.html#bind2">bind2</a></span> <span class="id">x</span> <span class="id">f</span>) <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> <span class="id">res</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">y1</span> <span class="id">y2</span> <span class="id">st</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">x</span> <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> ((<span class="id">y1</span>, <span class="id">y2</span>), <span class="id">st</span>'') /\ <span class="id">f</span> <span class="id">y1</span> <span class="id">y2</span> <span class="id">st</span>'' = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> <span class="id">res</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof5')">Proof.</span></div>
<div class="proofscript" id="proof5">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hbind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#bind2">bind2</a></span> <span class="kwd">in</span> <span class="id">Hbind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">x</span> <span class="id">st</span>) <span class="kwd">as</span> [[[<span class="id">y1</span> <span class="id">y2</span>] <span class="id">st</span>'']|]; <span class="id">eauto</span>. <span class="id">inv</span> <span class="id">Hbind</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabMonad">ElabMonad</a></span>.<br/>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="ElabNotations">ElabNotations</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Notation</span> "'<span class="id">do</span>' <span class="id">X</span> &lt;- <span class="id">A</span> ; <span class="id">B</span>" :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.LustreElab.html#bind">bind</a></span> <span class="id">A</span> (<span class="kwd">fun</span> <span class="id">X</span> =&gt; <span class="id">B</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">at</span> <span class="id">level</span> 200, <span class="id">X</span> <span class="id">name</span>, <span class="id">A</span> <span class="kwd">at</span> <span class="id">level</span> 100, <span class="id">B</span> <span class="kwd">at</span> <span class="id">level</span> 200).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Notation</span> "'<span class="id">do</span>' ( <span class="id">X</span> , <span class="id">Y</span> ) &lt;- <span class="id">A</span> ; <span class="id">B</span>" :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.LustreElab.html#bind2">bind2</a></span> <span class="id">A</span> (<span class="kwd">fun</span> <span class="id">X</span> <span class="id">Y</span> =&gt; <span class="id">B</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">at</span> <span class="id">level</span> 200, <span class="id">X</span> <span class="id">name</span>, <span class="id">Y</span> <span class="id">name</span>, <span class="id">A</span> <span class="kwd">at</span> <span class="id">level</span> 100, <span class="id">B</span> <span class="kwd">at</span> <span class="id">level</span> 200).<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabNotations">ElabNotations</a></span>.<br/>
<br/>
<span class="kwd">Import</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabNotations">ElabNotations</a></span>.<br/>
<br/>
<span class="id">Local</span> <span class="kwd">Ltac</span> <span class="id">monadInv</span> :=<br/>
&nbsp;&nbsp;<span class="id">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">H</span>: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> <span class="id">_</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H</span>; <span class="id">clear</span> <span class="id">H</span>; <span class="id">try</span> <span class="id">subst</span><br/>
&nbsp;&nbsp;| <span class="id">H</span>: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#Error">Error</a></span> <span class="id">_</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">discriminate</span><br/>
&nbsp;&nbsp;| <span class="id">H</span>: <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id">_</span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="kwd">in</span> <span class="id">H</span><br/>
&nbsp;&nbsp;| <span class="id">H</span>: <span class="id"><a href="Velus.Lustre.LustreElab.html#bind">bind</a></span> ?<span class="id">x</span> ?<span class="id">f</span> ?<span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> ?<span class="id">res</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">H1</span> := <span class="id">fresh</span> "<span class="id">Hbind</span>" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">H2</span> := <span class="id">fresh</span> "<span class="id">Hbind</span>" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#bind_inv">bind_inv</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> (?&amp;?&amp;<span class="id">H1</span>&amp;<span class="id">H2</span>)<br/>
&nbsp;&nbsp;| <span class="id">H</span>: <span class="id"><a href="Velus.Lustre.LustreElab.html#bind2">bind2</a></span> ?<span class="id">x</span> ?<span class="id">f</span> ?<span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> ?<span class="id">res</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">H1</span> := <span class="id">fresh</span> "<span class="id">Hbind</span>" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">H2</span> := <span class="id">fresh</span> "<span class="id">Hbind</span>" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#bind2_inv">bind2_inv</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> (?&amp;?&amp;?&amp;<span class="id">H1</span>&amp;<span class="id">H2</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="mmap">mmap</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>}.<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> (<span class="id"><a name="mmap.f">f</a></span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap.A">A</a></span> -&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap.B">B</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="mmap">mmap</a></span> (<span class="id">l</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap.A">A</a></span>) {<span class="id">struct</span> <span class="id">l</span>} : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap.B">B</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#hd">hd</a></span> :: <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#tl">tl</a></span> =&gt; <span class="id">do</span> <span class="id">hd</span>' &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap.f">f</a></span> <span class="id">hd</span>; <span class="id">do</span> <span class="id">tl</span>' &lt;- <span class="id">mmap</span> <span class="id">tl</span>; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id">hd</span>' :: <span class="id">tl</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="mmap_values">mmap_values</a></span> : <span class="kwd">forall</span> <span class="id">a</span> <span class="id">st</span> <span class="id">a1s</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> <span class="id">a</span> <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id">a1s</span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">a</span> <span class="id">a1</span> =&gt; <span class="kwd">exists</span> <span class="id">st</span>'', <span class="kwd">exists</span> <span class="id">st</span>''', <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap.f">f</a></span> <span class="id">a</span> <span class="id">st</span>'' = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id">a1</span>, <span class="id">st</span>''')) <span class="id">a</span> <span class="id">a1s</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof6')">Proof.</span></div>
<div class="proofscript" id="proof6">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">a</span>; <span class="id">intros</span> <span class="id">st</span> <span class="id">a1s</span> <span class="id">st</span>' <span class="id">Hfold</span>; <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">IHa</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hbind1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="ElabSclock">ElabSclock</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id"><a name="ElabSclock.tenv">tenv</a></span> : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="msg_of_enumtag">msg_of_enumtag</a></span> (<span class="id">t</span>: <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) (<span class="id">c</span>: <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.enumtag">enumtag</a></span>) : <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#errcode">errcode</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">t</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabSclock.tenv">tenv</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">cs</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">cs</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">c</span> =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">c</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> ""<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> ""<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="msg_of_clock">msg_of_clock</a></span> (<span class="id">ck</span>: <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.clock">clock</a></span>) : <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#errmsg">errmsg</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ck</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.Cbase">Cbase</a></span>          =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "."<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.Con">Con</a></span> <span class="id">ck</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#id">id</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tenum">Tenum</a></span> <span class="id">t</span> <span class="id">_</span>, <span class="id">c</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">msg_of_clock</span> <span class="id">ck</span> ++ <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> " <span class="id">on</span> " :: <span class="id"><a href="Velus.Lustre.LustreElab.html#msg_of_enumtag">msg_of_enumtag</a></span> <span class="id">t</span> <span class="id">c</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "(" :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">id</span> :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> ")" :: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> ""<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="msg_of_sclock">msg_of_sclock</a></span> (<span class="id">ck</span>: <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>) : <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#errmsg">errmsg</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ck</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Sbase">Sbase</a></span>          =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "."<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Svar">Svar</a></span> <span class="id">x</span>         =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">x</span> :: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Son">Son</a></span> <span class="id">ck</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#id">id</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tenum">Tenum</a></span> <span class="id">t</span> <span class="id">_</span>, <span class="id">c</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">msg_of_sclock</span> <span class="id">ck</span> ++ <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> " <span class="id">on</span> " :: <span class="id"><a href="Velus.Lustre.LustreElab.html#msg_of_enumtag">msg_of_enumtag</a></span> <span class="id">t</span> <span class="id">c</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "(" :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">id</span> :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> ")" :: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> ""<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Add a new association to the substitution </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="add_to_clock_subst">add_to_clock_subst</a></span> (<span class="id">id</span> : <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) (<span class="id">sck</span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">fun</span> '(<span class="id">nid</span>, <span class="id">sub1</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">sub1</span>' := <span class="id"><a href="Velus.Environment.html#Env.map">Env.map</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#subst_in_sclock">subst_in_sclock</a></span> <span class="id">id</span> <span class="id">sck</span>) <span class="id">sub1</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">id</span> <span class="id">sub1</span>' <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">sck</span>' =&gt; <span class="kwd">if</span> <span class="id">sck</span>' ==<span class="id">b</span> <span class="id">sck</span> <span class="kwd">then</span> <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span>, (<span class="id">nid</span>, <span class="id">sub1</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#Error">Error</a></span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "<span class="id">Imcompatibility</span> <span class="kwd">in</span> <span class="id">subst</span> : " :: <span class="id"><a href="Velus.Lustre.LustreElab.html#msg_of_sclock">msg_of_sclock</a></span> <span class="id">sck</span> ++ <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> " <span class="id">and</span> "<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: <span class="id"><a href="Velus.Lustre.LustreElab.html#msg_of_sclock">msg_of_sclock</a></span> <span class="id">sck</span>' ++ <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span>, (<span class="id">nid</span>, <span class="id"><a href="Velus.Environment.html#Env.add">Env.add</a></span> <span class="id">id</span> <span class="id">sck</span> <span class="id">sub1</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Apply the current substitution to a clock </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="subst_sclock">subst_sclock</a></span> (<span class="id">sck</span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">sck</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Sbase">Sbase</a></span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#Sbase">Sbase</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Svar">Svar</a></span> <span class="id">x</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">x</span>' &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#subst_clock">subst_clock</a></span> <span class="id">x</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span>' <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">sck</span>' =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id">sck</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Svar">Svar</a></span> <span class="id">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Son">Son</a></span> <span class="id">sck</span>' <span class="id">x</span> <span class="id">b</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">sck</span>' &lt;- <span class="id">subst_sclock</span> <span class="id">sck</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Son">Son</a></span> <span class="id">sck</span>' <span class="id">x</span> <span class="id">b</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="subst_ann">subst_ann</a></span> (<span class="id">a</span> : (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>)) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '(<span class="id">ty</span>, <span class="id">ck</span>) := <span class="id">a</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">ck</span>' &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#subst_sclock">subst_sclock</a></span> <span class="id">ck</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id">ty</span>, <span class="id">ck</span>').<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="unify_ident">unify_ident</a></span> <span class="id">loc</span> (<span class="id">id1</span> <span class="id">id2</span> : <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">id1</span> ==<span class="id">b</span> <span class="id">id2</span> <span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "<span class="id">Mismatched</span> <span class="id">idents</span> <span class="kwd">in</span> <span class="id">clock</span> <span class="id">unification</span>: " :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">id1</span> :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> ", " :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">id2</span> :: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>).<br/>
<br/>
<div class="doc">Unify two clocks </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="unify_sclock">unify_sclock</a></span> (<span class="id">loc</span> : <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">ck1</span> <span class="id">ck2</span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">ck1</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#subst_sclock">subst_sclock</a></span> <span class="id">ck1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">ck2</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#subst_sclock">subst_sclock</a></span> <span class="id">ck2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fix</span> <span class="id">aux</span> <span class="id">ck1</span> <span class="id">ck2</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ck1</span>, <span class="id">ck2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Sbase">Sbase</a></span>, <span class="id"><a href="Velus.Lustre.LustreElab.html#Sbase">Sbase</a></span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Svar">Svar</a></span> <span class="id">x</span>, <span class="id">ck</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">ck</span>, <span class="id"><a href="Velus.Lustre.LustreElab.html#Svar">Svar</a></span> <span class="id">x</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">ck</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#subst_sclock">subst_sclock</a></span> <span class="id">ck</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#add_to_clock_subst">add_to_clock_subst</a></span> <span class="id">x</span> <span class="id">ck</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Son">Son</a></span> <span class="id">ck1</span> <span class="id">id1</span> (<span class="id">ty1</span>, <span class="id">k1</span>), <span class="id"><a href="Velus.Lustre.LustreElab.html#Son">Son</a></span> <span class="id">ck2</span> <span class="id">id2</span> (<span class="id">ty2</span>, <span class="id">k2</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> (<span class="id">k1</span> =? <span class="id">k2</span>) &amp;&amp; (<span class="id">ty1</span> ==<span class="id">b</span> <span class="id">ty2</span>) <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#unify_ident">unify_ident</a></span> <span class="id">loc</span> <span class="id">id1</span> <span class="id">id2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">aux</span> <span class="id">ck1</span> <span class="id">ck2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "<span class="id">Clock</span> <span class="id">unification</span> <span class="id">error</span> : " :: <span class="id"><a href="Velus.Lustre.LustreElab.html#msg_of_sclock">msg_of_sclock</a></span> <span class="id">ck1</span> ++ <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> ", " ::<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#msg_of_sclock">msg_of_sclock</a></span> <span class="id">ck2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "<span class="id">Clock</span> <span class="id">unification</span> <span class="id">error</span> : " :: <span class="id"><a href="Velus.Lustre.LustreElab.html#msg_of_sclock">msg_of_sclock</a></span> <span class="id">ck1</span> ++ <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> ", " ::<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#msg_of_sclock">msg_of_sclock</a></span> <span class="id">ck2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">ck1</span> <span class="id">ck2</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="unify_nclock">unify_nclock</a></span> (<span class="id">loc</span> : <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">id1</span> : <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>)  (<span class="id">ck1</span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>) (<span class="id">nck2</span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#nsclock">nsclock</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '(<span class="id">ck2</span>, <span class="id">id2</span>) := <span class="id">nck2</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#unify_sclock">unify_sclock</a></span> <span class="id">loc</span> <span class="id">ck1</span> <span class="id">ck2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">id2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">id2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#unify_ident">unify_ident</a></span> <span class="id">loc</span> <span class="id">id1</span> <span class="id">id2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabSclock">ElabSclock</a></span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="ElabExpressions">ElabExpressions</a></span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id"><a name="ElabExpressions.env">env</a></span> : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.clock">clock</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>).<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id"><a name="ElabExpressions.tenv">tenv</a></span>: <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>).<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id"><a name="ElabExpressions.eenv">eenv</a></span>: <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.ctype">ctype</a></span> * <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.ctype">ctype</a></span>).<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id"><a name="ElabExpressions.nenv">nenv</a></span> : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.clock">clock</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.clock">clock</a></span>))).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">nat</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="find_var">find_var</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">x</span>: <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabExpressions.env">env</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">x</span> :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> " <span class="id">is</span> <span class="id">not</span> <span class="id">declared</span>.")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">ty</span>, <span class="id">ck</span>, <span class="id">_</span>) =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id">ty</span>, <span class="id"><a href="Velus.Lustre.LustreElab.html#sclk">sclk</a></span> <span class="id">ck</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="find_last">find_last</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">x</span>: <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabExpressions.env">env</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">x</span> :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> " <span class="id">is</span> <span class="id">not</span> <span class="id">declared</span>.")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">ty</span>, <span class="id">ck</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>) =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id">ty</span>, <span class="id"><a href="Velus.Lustre.LustreElab.html#sclk">sclk</a></span> <span class="id">ck</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">x</span> :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> " <span class="id">is</span> <span class="id">not</span> <span class="id">declared</span> <span class="kwd">with</span> <span class="id">last</span>.")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="assert_id_type">assert_id_type</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">x</span>: <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) (<span class="id">xty</span> <span class="id">ty</span>: <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">xty</span> ==<span class="id">b</span> <span class="id">ty</span> <span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">x</span> :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> ": " :: <span class="id"><a href="Velus.Lustre.LustreElab.html#msg_of_types">msg_of_types</a></span> <span class="id">xty</span> <span class="id">ty</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="assert_type">assert_type</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">x</span>: <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) (<span class="id">xty</span> <span class="id">ty</span>: <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">xty</span> ==<span class="id">b</span> <span class="id">ty</span> <span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">x</span> :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> ": " :: <span class="id"><a href="Velus.Lustre.LustreElab.html#msg_of_types">msg_of_types</a></span> <span class="id">xty</span> <span class="id">ty</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">assert_type</span>' (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">xty</span> <span class="id">ty</span>: <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">xty</span> ==<span class="id">b</span> <span class="id">ty</span> <span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#msg_of_types">msg_of_types</a></span> <span class="id">xty</span> <span class="id">ty</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="assert_types">assert_types</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">xty</span> <span class="id">ty</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">xty</span> ==<span class="id">b</span> <span class="id">ty</span> <span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "<span class="id">Incompatible</span> <span class="id">types</span>: <span class="id">expected</span> (" :: <span class="id"><a href="Velus.Lustre.LustreElab.html#msg_of_list_types">msg_of_list_types</a></span> <span class="id">xty</span> ++ <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "), <span class="id">got</span> (" :: <span class="id"><a href="Velus.Lustre.LustreElab.html#msg_of_list_types">msg_of_list_types</a></span> <span class="id">ty</span> ++ <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> ")").<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="assert_enum_type">assert_enum_type</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">x</span>: <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) (<span class="id">xty</span>: <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">xty</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tenum">Tenum</a></span> <span class="id">tx</span> <span class="id">tn</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id">tx</span>, <span class="id">tn</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">x</span> :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> ": " :: <span class="id"><a href="Velus.Lustre.LustreElab.html#msg_of_enum_type">msg_of_enum_type</a></span> <span class="id">xty</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">assert_enum_type</span>' (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">ty</span>: <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ty</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tenum">Tenum</a></span> <span class="id">tx</span> <span class="id">tn</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id">tx</span>, <span class="id">tn</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#msg_of_enum_type">msg_of_enum_type</a></span> <span class="id">ty</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">assert_primitive_type</span>' (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">ty</span>: <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ty</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tprimitive">Tprimitive</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tenum">Tenum</a></span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#msg_of_primitive_type">msg_of_primitive_type</a></span> <span class="id">ty</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="node_interface">node_interface</a></span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="Internal">Internal</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.clock">clock</a></span>)) -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.clock">clock</a></span>)) -&gt; <span class="id">node_interface</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="External">External</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.ctype">ctype</a></span> -&gt; <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.ctype">ctype</a></span> -&gt; <span class="id">node_interface</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="find_node_interface">find_node_interface</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">f</span>: <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#node_interface">node_interface</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">f</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabExpressions.nenv">nenv</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">ins</span>, <span class="id">outs</span>) =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Internal">Internal</a></span> <span class="id">ins</span> <span class="id">outs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">f</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabExpressions.eenv">eenv</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">ins</span>, <span class="id">outs</span>) =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#External">External</a></span> <span class="id">ins</span> <span class="id">outs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "<span class="id">node</span> " :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">f</span> :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> " <span class="id">not</span> <span class="id">found</span>.")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="enum_to_enumtag">enum_to_enumtag</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">ty</span>: <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) (<span class="id">c</span>: <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) (<span class="id">cs</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.enumtag">enumtag</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">t</span>, <span class="id">n</span>) := <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#fold_left">fold_left</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> (<span class="id">acc</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.enumtag">enumtag</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) <span class="id">c</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">t</span>, <span class="id">n</span>) := <span class="id">acc</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">t</span> := <span class="kwd">match</span> <span class="id">t</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="kwd">if</span> <span class="id">c</span>' ==<span class="id">b</span> <span class="id">c</span> <span class="kwd">then</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">n</span> <span class="kwd">else</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">t</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span> (<span class="id">t</span>, <span class="id">n</span> + 1)) <span class="id">cs</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>, 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span> <span class="kwd">match</span> <span class="id">t</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">t</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">t</span>, <span class="id">cs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="elab_enum">elab_enum</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">c</span>: <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.enumtag">enumtag</a></span> * (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">r</span> := <span class="id"><a href="Velus.Environment.html#Env.fold">Env.fold</a></span> (<span class="kwd">fun</span> <span class="id">ty</span> <span class="id">cs</span> <span class="id">r</span> =&gt; <span class="kwd">match</span> <span class="id">r</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#enum_to_enumtag">enum_to_enumtag</a></span> <span class="id">loc</span> <span class="id">ty</span> <span class="id">c</span> <span class="id">cs</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">t</span>, <span class="id">n</span>) =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">t</span>, (<span class="id">ty</span>, <span class="id">n</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabExpressions.tenv">tenv</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span> <span class="kwd">match</span> <span class="id">r</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">r</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "<span class="id">constructor</span> " :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">c</span> :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> " <span class="id">not</span> <span class="id">declared</span>.")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="elab_constant">elab_constant</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">c</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#constant">LustreAst.constant</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#const_annot">const_annot</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#CONST_ENUM">CONST_ENUM</a></span> <span class="id">c</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">c</span>, <span class="id">tn</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_enum">elab_enum</a></span> <span class="id">loc</span> <span class="id">c</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#EnumA">EnumA</a></span> <span class="id">c</span> <span class="id">tn</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#CONST_INT">CONST_INT</a></span> <span class="id">s</span>       =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#ConstA">ConstA</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#elab_const_int">elab_const_int</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#cabsloc_of_astloc">cabsloc_of_astloc</a></span> <span class="id">loc</span>) <span class="id">s</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#CONST_FLOAT">CONST_FLOAT</a></span> <span class="id">fi</span>    =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#ConstA">ConstA</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#elab_const_float">elab_const_float</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#cabs_floatinfo">cabs_floatinfo</a></span> <span class="id">fi</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#CONST_CHAR">CONST_CHAR</a></span> <span class="id">enc</span> <span class="id">l</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#ConstA">ConstA</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#elab_const_char">elab_const_char</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#cabsloc_of_astloc">cabsloc_of_astloc</a></span> <span class="id">loc</span>) <span class="id">enc</span> <span class="id">l</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="elab_unop">elab_unop</a></span> (<span class="id">op</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#unary_operator">unary_operator</a></span>) : <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.unop">unop</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">op</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#MINUS">MINUS</a></span> =&gt; <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.UnaryOp">UnaryOp</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Cop.html#Oneg">Cop.Oneg</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#NOT">NOT</a></span>   =&gt; <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.UnaryOp">UnaryOp</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Cop.html#Onotint">Cop.Onotint</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#BNOT">BNOT</a></span>  =&gt; <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.UnaryOp">UnaryOp</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Cop.html#Onotbool">Cop.Onotbool</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="elab_binop">elab_binop</a></span> (<span class="id">op</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#binary_operator">binary_operator</a></span>) : <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.binop">binop</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">op</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#ADD">ADD</a></span>  =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Cop.html#Oadd">Cop.Oadd</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#SUB">SUB</a></span>  =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Cop.html#Osub">Cop.Osub</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#MUL">MUL</a></span>  =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Cop.html#Omul">Cop.Omul</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#DIV">DIV</a></span>  =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Cop.html#Odiv">Cop.Odiv</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#MOD">MOD</a></span>  =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Cop.html#Omod">Cop.Omod</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#BAND">BAND</a></span> =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Cop.html#Oand">Cop.Oand</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#BOR">BOR</a></span>  =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Cop.html#Oor">Cop.Oor</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#LAND">LAND</a></span> =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Cop.html#Oand">Cop.Oand</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#LOR">LOR</a></span>  =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Cop.html#Oor">Cop.Oor</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#XOR">XOR</a></span>  =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Cop.html#Oxor">Cop.Oxor</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#LSL">LSL</a></span>  =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Cop.html#Oshl">Cop.Oshl</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#LSR">LSR</a></span>  =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Cop.html#Oshr">Cop.Oshr</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#EQ">EQ</a></span>   =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Cop.html#Oeq">Cop.Oeq</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#NE">NE</a></span>   =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Cop.html#One">Cop.One</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#LT">LT</a></span>   =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Cop.html#Olt">Cop.Olt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#GT">GT</a></span>   =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Cop.html#Ogt">Cop.Ogt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#LE">LE</a></span>   =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Cop.html#Ole">Cop.Ole</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#GE">GE</a></span>   =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Cop.html#Oge">Cop.Oge</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="find_type_unop">find_type_unop</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">op</span>: <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.unop">unop</a></span>) (<span class="id">ty</span>: <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type_unop">type_unop</a></span> <span class="id">op</span> <span class="id">ty</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">wrong</span> <span class="id">operator</span> <span class="id">argument</span> <span class="id">type</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">ty</span>' =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id">ty</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="find_type_binop">find_type_binop</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">op</span>: <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.binop">binop</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ty1</span> <span class="id">ty2</span>: <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type_binop">type_binop</a></span> <span class="id">op</span> <span class="id">ty1</span> <span class="id">ty2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">wrong</span> <span class="id">operator</span> <span class="id">argument</span> <span class="id">type</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">ty</span>' =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id">ty</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="enum_bound">enum_bound</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">ty</span>: <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">ty</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabExpressions.tenv">tenv</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "<span class="id">enumerated</span> <span class="id">type</span> " :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">ty</span> :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> " <span class="id">not</span> <span class="id">declared</span>.")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">cs</span> =&gt; <span class="kwd">let</span> <span class="id">n</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length">length</a></span> <span class="id">cs</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> 0 &lt;? <span class="id">n</span> <span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id">cs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "<span class="id">empty</span> <span class="id">enumerated</span> <span class="id">type</span> " :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">ty</span> :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> " .")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="elab_type">elab_type</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">ty</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#type_name">LustreAst.type_name</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ty</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#Tint8">Tint8</a></span>    =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tprimitive">Tprimitive</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tint">Tint</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#I8">Ctypes.I8</a></span>  <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#Signed">Ctypes.Signed</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#Tuint8">Tuint8</a></span>   =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tprimitive">Tprimitive</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tint">Tint</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#I8">Ctypes.I8</a></span>  <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#Unsigned">Ctypes.Unsigned</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#Tint16">Tint16</a></span>   =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tprimitive">Tprimitive</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tint">Tint</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#I16">Ctypes.I16</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#Signed">Ctypes.Signed</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#Tuint16">Tuint16</a></span>  =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tprimitive">Tprimitive</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tint">Tint</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#I16">Ctypes.I16</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#Unsigned">Ctypes.Unsigned</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#Tint32">Tint32</a></span>   =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tprimitive">Tprimitive</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tint">Tint</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#I32">Ctypes.I32</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#Signed">Ctypes.Signed</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#Tuint32">Tuint32</a></span>  =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tprimitive">Tprimitive</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tint">Tint</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#I32">Ctypes.I32</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#Unsigned">Ctypes.Unsigned</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#Tint64">Tint64</a></span>   =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tprimitive">Tprimitive</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tlong">Tlong</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#Signed">Ctypes.Signed</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#Tuint64">Tuint64</a></span>  =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tprimitive">Tprimitive</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tlong">Tlong</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#Unsigned">Ctypes.Unsigned</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#Tfloat32">Tfloat32</a></span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tprimitive">Tprimitive</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tfloat">Tfloat</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#F32">Ctypes.F32</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#Tfloat64">Tfloat64</a></span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tprimitive">Tprimitive</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tfloat">Tfloat</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#F64">Ctypes.F64</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#Tenum_name">Tenum_name</a></span> <span class="id">t</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">tn</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#enum_bound">enum_bound</a></span> <span class="id">loc</span> <span class="id">t</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tenum">Tenum</a></span> <span class="id">t</span> <span class="id">tn</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="elab_primitive_type">elab_primitive_type</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>)  (<span class="id">ty</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#type_name">LustreAst.type_name</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.ctype">ctype</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">ty</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_type">elab_type</a></span> <span class="id">loc</span> <span class="id">ty</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ty</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tprimitive">Tprimitive</a></span> <span class="id">t</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tenum">Tenum</a></span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">primitive</span> <span class="id">type</span> <span class="id">expected</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="err_not_singleton">err_not_singleton</a></span> {<span class="id">A</span>} (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id">A</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">singleton</span> <span class="id">argument</span> <span class="id">expected</span>").<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="single_annot">single_annot</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">e</span>: <span class="id"><a href="Velus.Lustre.LustreElab.html#eexp">eexp</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">e</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Econst">Econst</a></span> <span class="id">c</span> <span class="id">ck</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tprimitive">Tprimitive</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.ctype_cconst">ctype_cconst</a></span> <span class="id">c</span>), <span class="id">ck</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Eenum">Eenum</a></span> <span class="id">_</span> <span class="id">ty</span> <span class="id">ck</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id">ty</span>, <span class="id">ck</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Eapp">Eapp</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> [(<span class="id">ty</span>, <span class="id">ck</span>)]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Evar">Evar</a></span> <span class="id">_</span> (<span class="id">ty</span>, <span class="id">ck</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Elast">Elast</a></span> <span class="id">_</span> (<span class="id">ty</span>, <span class="id">ck</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Eunop">Eunop</a></span> <span class="id">_</span> <span class="id">_</span> (<span class="id">ty</span>, <span class="id">ck</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Ebinop">Ebinop</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">ty</span>, <span class="id">ck</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Ewhen">Ewhen</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> ([<span class="id">ty</span>], <span class="id">ck</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Efby">Efby</a></span> <span class="id">_</span> <span class="id">_</span> [(<span class="id">ty</span>, <span class="id">ck</span>)]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Earrow">Earrow</a></span> <span class="id">_</span> <span class="id">_</span> [(<span class="id">ty</span>, <span class="id">ck</span>)]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Emerge">Emerge</a></span> <span class="id">_</span> <span class="id">_</span> ([<span class="id">ty</span>], <span class="id">ck</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Ecase">Ecase</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> ([<span class="id">ty</span>], <span class="id">ck</span>) =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id">ty</span>, <span class="id">ck</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Eextcall">Eextcall</a></span> <span class="id">_</span> <span class="id">_</span> (<span class="id">cty</span>, <span class="id">ck</span>) =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tprimitive">Tprimitive</a></span> <span class="id">cty</span>, <span class="id">ck</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_not_singleton">err_not_singleton</a></span> <span class="id">loc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="lannot">lannot</a></span> (<span class="id">el</span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#eexp">eexp</a></span> * <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> ((<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>) * <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">e</span>, <span class="id">loc</span>) := <span class="id">el</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">e</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Econst">Econst</a></span> <span class="id">c</span> <span class="id">ck</span> =&gt; [((<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tprimitive">Tprimitive</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.ctype_cconst">ctype_cconst</a></span> <span class="id">c</span>), <span class="id">ck</span>), <span class="id">loc</span>)]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Eenum">Eenum</a></span> <span class="id">_</span> <span class="id">ty</span> <span class="id">ck</span> =&gt; [((<span class="id">ty</span>, <span class="id">ck</span>), <span class="id">loc</span>)]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Evar">Evar</a></span> <span class="id">_</span> (<span class="id">ty</span>, <span class="id">ck</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Elast">Elast</a></span> <span class="id">_</span> (<span class="id">ty</span>, <span class="id">ck</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Eunop">Eunop</a></span> <span class="id">_</span> <span class="id">_</span> (<span class="id">ty</span>, <span class="id">ck</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Ebinop">Ebinop</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">ty</span>, <span class="id">ck</span>) =&gt; [((<span class="id">ty</span>, <span class="id">ck</span>), <span class="id">loc</span>)]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Eextcall">Eextcall</a></span> <span class="id">_</span> <span class="id">_</span> (<span class="id">cty</span>, <span class="id">ck</span>) =&gt; [((<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tprimitive">Tprimitive</a></span> <span class="id">cty</span>, <span class="id">ck</span>), <span class="id">loc</span>)]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Ewhen">Ewhen</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">tys</span>, <span class="id">ck</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Emerge">Emerge</a></span> <span class="id">_</span> <span class="id">_</span> (<span class="id">tys</span>, <span class="id">ck</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Ecase">Ecase</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">tys</span>, <span class="id">ck</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">ty</span>=&gt; ((<span class="id">ty</span>, <span class="id">ck</span>), <span class="id">loc</span>)) <span class="id">tys</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Efby">Efby</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">anns</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Earrow">Earrow</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">anns</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Eapp">Eapp</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">anns</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">tc</span> =&gt; (<span class="id">tc</span>, <span class="id">loc</span>)) <span class="id">anns</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="lannots">lannots</a></span> (<span class="id">els</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#eexp">eexp</a></span> * <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> ((<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>) * <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) := <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#flat_map">flat_map</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#lannot">lannot</a></span> <span class="id">els</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="lnannot">lnannot</a></span> (<span class="id">el</span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#eexp">eexp</a></span> * <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> ((<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.Lustre.LustreElab.html#nsclock">nsclock</a></span>) * <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">e</span>, <span class="id">loc</span>) := <span class="id">el</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">e</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Econst">Econst</a></span> <span class="id">c</span> <span class="id">ck</span> =&gt; [((<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tprimitive">Tprimitive</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.ctype_cconst">ctype_cconst</a></span> <span class="id">c</span>), (<span class="id">ck</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)), <span class="id">loc</span>)]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Eenum">Eenum</a></span> <span class="id">_</span> <span class="id">ty</span> <span class="id">ck</span> =&gt; [((<span class="id">ty</span>, (<span class="id">ck</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)), <span class="id">loc</span>)]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Evar">Evar</a></span> <span class="id">x</span> (<span class="id">ty</span>, <span class="id">ck</span>) =&gt; [((<span class="id">ty</span>, (<span class="id">ck</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span>)), <span class="id">loc</span>)]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Elast">Elast</a></span> <span class="id">_</span> (<span class="id">ty</span>, <span class="id">ck</span>) =&gt; [((<span class="id">ty</span>, (<span class="id">ck</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)), <span class="id">loc</span>)]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Eunop">Eunop</a></span> <span class="id">_</span> <span class="id">_</span> (<span class="id">ty</span>, <span class="id">ck</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Ebinop">Ebinop</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">ty</span>, <span class="id">ck</span>) =&gt; [((<span class="id">ty</span>, (<span class="id">ck</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)), <span class="id">loc</span>)]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Eextcall">Eextcall</a></span> <span class="id">_</span> <span class="id">_</span> (<span class="id">cty</span>, <span class="id">ck</span>) =&gt; [((<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tprimitive">Tprimitive</a></span> <span class="id">cty</span>, (<span class="id">ck</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)), <span class="id">loc</span>)]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Ewhen">Ewhen</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">tys</span>, <span class="id">ck</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Emerge">Emerge</a></span> <span class="id">_</span> <span class="id">_</span> (<span class="id">tys</span>, <span class="id">ck</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Ecase">Ecase</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">tys</span>, <span class="id">ck</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">ty</span>=&gt; ((<span class="id">ty</span>, (<span class="id">ck</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)), <span class="id">loc</span>)) <span class="id">tys</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Efby">Efby</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">anns</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Earrow">Earrow</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">anns</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Eapp">Eapp</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">anns</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">tc</span> =&gt; ((<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">tc</span>, (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">tc</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)), <span class="id">loc</span>)) <span class="id">anns</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="lannots_ty">lannots_ty</a></span> {<span class="id">A</span> <span class="id">B</span>} (<span class="id">tcl</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> ((<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id">A</span>) * <span class="id">B</span>)) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">x</span>=&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">x</span>)) <span class="id">tcl</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="lannots_ck">lannots_ck</a></span> {<span class="id">A</span> <span class="id">B</span>} (<span class="id">tcl</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> ((<span class="id">A</span> * <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>) * <span class="id">B</span>)) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">x</span>)) <span class="id">tcl</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="lnannots">lnannots</a></span> (<span class="id">els</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#eexp">eexp</a></span> * <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> ((<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.Lustre.LustreElab.html#nsclock">nsclock</a></span>) * <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) := <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#flat_map">flat_map</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#lnannot">lnannot</a></span> <span class="id">els</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="hd_sclock">hd_sclock</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">ls</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> ((<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>) * <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ls</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">empty</span> <span class="id">expression</span> <span class="id">list</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">l</span>::<span class="id">_</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">l</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="unify_same_clock">unify_same_clock</a></span> (<span class="id">lck</span>: <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ans</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> ((<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>) * <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>)) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ans</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">an</span>::<span class="id">ans</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '((<span class="id">ty</span>, <span class="id">ck</span>), <span class="id">loc</span>) := <span class="id">an</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#unify_sclock">unify_sclock</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabExpressions.tenv">tenv</a></span> <span class="id">loc</span> <span class="id">ck</span> <span class="id">lck</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unify_same_clock</span> <span class="id">lck</span> <span class="id">ans</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="unify_paired_types">unify_paired_types</a></span> (<span class="id">gloc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ants</span> <span class="id">anfs</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> ((<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>) * <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>)) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ants</span>, <span class="id">anfs</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [], [] =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">ant</span>::<span class="id">ants</span>', <span class="id">anf</span>::<span class="id">anfs</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '((<span class="id">tty</span>, <span class="id">tck</span>), <span class="id">tloc</span>) := <span class="id">ant</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '((<span class="id">fty</span>, <span class="id">fck</span>), <span class="id">floc</span>) := <span class="id">anf</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">tty</span> ==<span class="id">b</span> <span class="id">fty</span> <span class="kwd">then</span> <span class="id">unify_paired_types</span> <span class="id">gloc</span> <span class="id">ants</span>' <span class="id">anfs</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">gloc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "<span class="id">expression</span> <span class="kwd">at</span> "<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#string_of_astloc">string_of_astloc</a></span> <span class="id">tloc</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> " <span class="id">has</span> <span class="id">type</span> '" :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#string_of_type">string_of_type</a></span> <span class="id">tty</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "' <span class="id">but</span> <span class="id">expression</span> <span class="kwd">at</span> "<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#string_of_astloc">string_of_astloc</a></span> <span class="id">floc</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> " <span class="id">has</span> <span class="id">type</span> '" :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#string_of_type">string_of_type</a></span> <span class="id">fty</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "'")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">gloc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">arguments</span> <span class="id">are</span> <span class="id">of</span> <span class="id">different</span> <span class="id">lengths</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="unify_paired_clock_types">unify_paired_clock_types</a></span> (<span class="id">gloc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ants</span> <span class="id">anfs</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> ((<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>) * <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>)) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ants</span>, <span class="id">anfs</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [], [] =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">ant</span>::<span class="id">ants</span>', <span class="id">anf</span>::<span class="id">anfs</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '((<span class="id">tty</span>, <span class="id">tck</span>), <span class="id">tloc</span>) := <span class="id">ant</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '((<span class="id">fty</span>, <span class="id">fck</span>), <span class="id">floc</span>) := <span class="id">anf</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#unify_sclock">unify_sclock</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabExpressions.tenv">tenv</a></span> <span class="id">tloc</span> <span class="id">tck</span> <span class="id">fck</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">tty</span> ==<span class="id">b</span> <span class="id">fty</span> <span class="kwd">then</span> <span class="id">unify_paired_clock_types</span> <span class="id">gloc</span> <span class="id">ants</span>' <span class="id">anfs</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">gloc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "<span class="id">expression</span> <span class="kwd">at</span> "<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#string_of_astloc">string_of_astloc</a></span> <span class="id">tloc</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> " <span class="id">has</span> <span class="id">type</span> '" :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#string_of_type">string_of_type</a></span> <span class="id">tty</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "' <span class="id">but</span> <span class="id">expression</span> <span class="kwd">at</span> "<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#string_of_astloc">string_of_astloc</a></span> <span class="id">floc</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> " <span class="id">has</span> <span class="id">type</span> '" :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#string_of_type">string_of_type</a></span> <span class="id">fty</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "'")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">gloc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">arguments</span> <span class="id">are</span> <span class="id">of</span> <span class="id">different</span> <span class="id">lengths</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="instantiating_subst">instantiating_subst</a></span> (<span class="id">xtc</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) (<span class="id">nanns</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.adds_opt">Env.adds_opt</a></span> <span class="id">xtc</span> <span class="id">nanns</span> (<span class="id"><a href="Velus.Environment.html#Env.empty">Env.empty</a></span> <span class="id">_</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="inst_clock">inst_clock</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">base</span>: <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>) (<span class="id">sub</span> : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) (<span class="id">ck</span>: <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.clock">clock</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ck</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.Cbase">Cbase</a></span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id">base</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.Con">Con</a></span> <span class="id">ck</span>' <span class="id">x</span> <span class="id">b</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">sck</span>' &lt;- <span class="id">inst_clock</span> <span class="id">loc</span> <span class="id">base</span> <span class="id">sub</span> <span class="id">ck</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> <span class="id">sub</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">Clocks</span> <span class="id">of</span> <span class="id">node</span> <span class="id">calls</span> <span class="id">may</span> <span class="id">only</span> <span class="id">depend</span> <span class="id">on</span> <span class="id">named</span> <span class="id">variables</span> <span class="id">of</span> <span class="id">the</span> <span class="id">caller</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">ni</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Son">Son</a></span> <span class="id">sck</span>' <span class="id">ni</span> <span class="id">b</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="inst_annot">inst_annot</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">base</span>: <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>) (<span class="id">sub</span> : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">xtc</span>: <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.clock">clock</a></span>)) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ann">ann</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '(<span class="id">x</span>, (<span class="id">ty</span>, <span class="id">ck</span>)) := <span class="id">xtc</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">sck</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#inst_clock">inst_clock</a></span> <span class="id">loc</span> <span class="id">base</span> <span class="id">sub</span> <span class="id">ck</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id">ty</span>, <span class="id">sck</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="unify_params">unify_params</a></span> (<span class="id">gloc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">iface</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">args</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> ((<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.Lustre.LustreElab.html#nsclock">nsclock</a></span>) * <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>)) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">iface</span>, <span class="id">args</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>, <span class="id">_</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">gloc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">too</span> <span class="id">many</span> <span class="id">arguments</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">gloc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">not</span> <span class="id">enough</span> <span class="id">arguments</span>")<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">ty</span>, <span class="id">ck</span>)::<span class="id">iface</span>', ((<span class="id">ty</span>', (<span class="id">ck</span>', <span class="id">_</span>)), <span class="id">loc</span>)::<span class="id">args</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id">assert_type</span>' <span class="id">loc</span> <span class="id">ty</span>' <span class="id">ty</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#unify_sclock">unify_sclock</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabExpressions.tenv">tenv</a></span> <span class="id">loc</span> <span class="id">ck</span>' <span class="id">ck</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unify_params</span> <span class="id">gloc</span> <span class="id">iface</span>' <span class="id">args</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="discardloc">discardloc</a></span> (<span class="id">ann</span> : (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span> * <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>)) : (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '(<span class="id">ty</span>, <span class="id">ck</span>, <span class="id">_</span>) := <span class="id">ann</span> <span class="kwd">in</span> (<span class="id">ty</span>, <span class="id">ck</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="assert_reset_type">assert_reset_type</a></span> '(<span class="id">er</span>, <span class="id">loc</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">erty</span>, <span class="id">_</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#single_annot">single_annot</a></span> <span class="id">loc</span> <span class="id">er</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert_type</span>' <span class="id">loc</span> <span class="id">erty</span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.bool_type">bool_type</a></span>.<br/>
<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="check_duplicates">check_duplicates</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">cs</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.enumtag">enumtag</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length">length</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nodup">nodup</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span> <span class="id">cs</span>) ==<span class="id">b</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length">length</a></span> <span class="id">cs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">duplicate</span> <span class="id">branch</span>").<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="check_exhaustivity">check_exhaustivity</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">n</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) (<span class="id">cs</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.enumtag">enumtag</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length">length</a></span> <span class="id">cs</span> ==<span class="id">b</span> <span class="id">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">non</span>-<span class="id">exhaustive</span> <span class="id">pattern</span> <span class="id">matching</span>").<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="check_noreset">check_noreset</a></span> {<span class="id">A</span>} (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">er</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Velus.Common.CommonList.html#is_nil">is_nil</a></span> <span class="id">er</span> <span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">External</span> <span class="id">call</span> <span class="id">cannot</span> <span class="id">be</span> <span class="id">reset</span>").<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="hd_branch">hd_branch</a></span> {<span class="id">A</span> : <span class="kwd">Type</span>} <span class="id">loc</span> (<span class="id">xs</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id">A</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">xs</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#hd">hd</a></span>::<span class="id">_</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id">hd</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">no</span> <span class="id">branch</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="elab_branches">elab_branches</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">tn</span>: <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) (<span class="id">exhaustive</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">elab_exp</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#expression">LustreAst.expression</a></span> -&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#eexp">eexp</a></span> * <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f_ck</span>: <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.enumtag">enumtag</a></span> -&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">aes</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#expression">LustreAst.expression</a></span>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.enumtag">enumtag</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#eexp">eexp</a></span>) * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span> * <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">aes</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="kwd">fun</span> '(<span class="id">c</span>, <span class="id">ae</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">c</span>, <span class="id">tn</span>') &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_enum">elab_enum</a></span> <span class="id">loc</span> <span class="id">c</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id">assert_type</span>' <span class="id">loc</span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tenum">Tenum</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">tn</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">tn</span>)) (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tenum">Tenum</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">tn</span>') (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">tn</span>'));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">e</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> <span class="id">elab_exp</span> <span class="id">ae</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#unify_same_clock">unify_same_clock</a></span> (<span class="id">f_ck</span> <span class="id">c</span>) (<span class="id"><a href="Velus.Lustre.LustreElab.html#lannots">lannots</a></span> <span class="id">e</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id">c</span>, <span class="id">e</span>)) <span class="id">aes</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">cs</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#split">split</a></span> <span class="id">aes</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#check_duplicates">check_duplicates</a></span> <span class="id">loc</span> <span class="id">cs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="kwd">if</span> <span class="id">exhaustive</span> <span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_exhaustivity">check_exhaustivity</a></span> <span class="id">loc</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length">length</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">tn</span>)) <span class="id">cs</span> <span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">e0</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#hd_branch">hd_branch</a></span> <span class="id">loc</span> <span class="id">aes</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">anns0</span> := <span class="id"><a href="Velus.Lustre.LustreElab.html#lannots">lannots</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">e0</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="kwd">fun</span> '(<span class="id">_</span>, <span class="id">ae</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#unify_paired_types">unify_paired_types</a></span> <span class="id">loc</span> <span class="id">anns0</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#lannots">lannots</a></span> <span class="id">ae</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="id">aes</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> '(<span class="id">c</span>, <span class="id">es</span>) =&gt; (<span class="id">c</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">es</span>)) <span class="id">aes</span>, <span class="id">anns0</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="elab_exp">elab_exp</a></span> (<span class="id">ae</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#expression">expression</a></span>) {<span class="id">struct</span> <span class="id">ae</span>} : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#eexp">eexp</a></span> * <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ae</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#CONSTANT">CONSTANT</a></span> <span class="id">ac</span> <span class="id">loc</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">x</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#fresh_ident">fresh_ident</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">c</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_constant">elab_constant</a></span> <span class="id">loc</span> <span class="id">ac</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#ConstA">ConstA</a></span> <span class="id">c</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Econst">Econst</a></span> <span class="id">c</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Svar">Svar</a></span> <span class="id">x</span>), <span class="id">loc</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#EnumA">EnumA</a></span> <span class="id">tag</span> <span class="id">ty</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Eenum">Eenum</a></span> <span class="id">tag</span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tenum">Tenum</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">ty</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">ty</span>)) (<span class="id"><a href="Velus.Lustre.LustreElab.html#Svar">Svar</a></span> <span class="id">x</span>), <span class="id">loc</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#VARIABLE">VARIABLE</a></span> <span class="id">x</span> <span class="id">loc</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">ty</span>, <span class="id">ck</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#find_var">find_var</a></span> <span class="id">loc</span> <span class="id">x</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Evar">Evar</a></span> <span class="id">x</span> (<span class="id">ty</span>, <span class="id">ck</span>), <span class="id">loc</span>)<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#LAST">LAST</a></span> <span class="id">x</span> <span class="id">loc</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">ty</span>, <span class="id">ck</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#find_last">find_last</a></span> <span class="id">loc</span> <span class="id">x</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Elast">Elast</a></span> <span class="id">x</span> (<span class="id">ty</span>, <span class="id">ck</span>), <span class="id">loc</span>)<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#UNARY">UNARY</a></span> <span class="id">aop</span> [<span class="id">ae</span>'] <span class="id">loc</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">op</span> := <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_unop">elab_unop</a></span> <span class="id">aop</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">e</span>, <span class="id">loc</span>') &lt;- <span class="id">elab_exp</span> <span class="id">ae</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">ty</span>, <span class="id">sck</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#single_annot">single_annot</a></span> <span class="id">loc</span>' <span class="id">e</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">ty</span>' &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#find_type_unop">find_type_unop</a></span> <span class="id">loc</span> <span class="id">op</span> <span class="id">ty</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Eunop">Eunop</a></span> <span class="id">op</span> <span class="id">e</span> (<span class="id">ty</span>', <span class="id">sck</span>), <span class="id">loc</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#UNARY">UNARY</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">loc</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_not_singleton">err_not_singleton</a></span> <span class="id">loc</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#CAST">CAST</a></span> <span class="id">aty</span>' [<span class="id">ae</span>'] <span class="id">loc</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">ty</span>' &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_primitive_type">elab_primitive_type</a></span> <span class="id">loc</span> <span class="id">aty</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">e</span>, <span class="id">loc</span>') &lt;- <span class="id">elab_exp</span> <span class="id">ae</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">ty</span>, <span class="id">sck</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#single_annot">single_annot</a></span> <span class="id">loc</span>' <span class="id">e</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id">assert_primitive_type</span>' <span class="id">loc</span>' <span class="id">ty</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Eunop">Eunop</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.CastOp">CastOp</a></span> <span class="id">ty</span>') <span class="id">e</span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tprimitive">Tprimitive</a></span> <span class="id">ty</span>', <span class="id">sck</span>), <span class="id">loc</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#CAST">CAST</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">loc</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_not_singleton">err_not_singleton</a></span> <span class="id">loc</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#BINARY">BINARY</a></span> <span class="id">aop</span> [<span class="id">ae1</span>] [<span class="id">ae2</span>] <span class="id">loc</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">op</span> := <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_binop">elab_binop</a></span> <span class="id">aop</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">e1</span>, <span class="id">loc1</span>) &lt;- <span class="id">elab_exp</span> <span class="id">ae1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">ty1</span>, <span class="id">sck1</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#single_annot">single_annot</a></span> <span class="id">loc1</span> <span class="id">e1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">e2</span>, <span class="id">loc2</span>) &lt;- <span class="id">elab_exp</span> <span class="id">ae2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">ty2</span>, <span class="id">sck2</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#single_annot">single_annot</a></span> <span class="id">loc2</span> <span class="id">e2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">ty</span>' &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#find_type_binop">find_type_binop</a></span> <span class="id">loc</span> <span class="id">op</span> <span class="id">ty1</span> <span class="id">ty2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#unify_sclock">unify_sclock</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabExpressions.tenv">tenv</a></span> <span class="id">loc</span> <span class="id">sck1</span> <span class="id">sck2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Ebinop">Ebinop</a></span> <span class="id">op</span> <span class="id">e1</span> <span class="id">e2</span> (<span class="id">ty</span>', <span class="id">sck1</span>), <span class="id">loc</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#BINARY">BINARY</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">loc</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_not_singleton">err_not_singleton</a></span> <span class="id">loc</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#FBY">FBY</a></span> <span class="id">ae0s</span> <span class="id">aes</span> <span class="id">loc</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">e0s</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> <span class="id">elab_exp</span> <span class="id">ae0s</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">es</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> <span class="id">elab_exp</span> <span class="id">aes</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ans0</span> := <span class="id"><a href="Velus.Lustre.LustreElab.html#lannots">lannots</a></span> <span class="id">e0s</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#unify_paired_clock_types">unify_paired_clock_types</a></span> <span class="id">loc</span> <span class="id">ans0</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#lannots">lannots</a></span> <span class="id">es</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">ans0</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#subst_ann">subst_ann</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#discardloc">discardloc</a></span> <span class="id">ans0</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Efby">Efby</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">e0s</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">es</span>) <span class="id">ans0</span>, <span class="id">loc</span>)<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#ARROW">ARROW</a></span> <span class="id">ae0s</span> <span class="id">aes</span> <span class="id">loc</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">e0s</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> <span class="id">elab_exp</span> <span class="id">ae0s</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">es</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> <span class="id">elab_exp</span> <span class="id">aes</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ans0</span> := <span class="id"><a href="Velus.Lustre.LustreElab.html#lannots">lannots</a></span> <span class="id">e0s</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#unify_paired_clock_types">unify_paired_clock_types</a></span> <span class="id">loc</span> <span class="id">ans0</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#lannots">lannots</a></span> <span class="id">es</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">ans0</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#subst_ann">subst_ann</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#discardloc">discardloc</a></span> <span class="id">ans0</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Earrow">Earrow</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">e0s</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">es</span>) <span class="id">ans0</span>, <span class="id">loc</span>)<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#WHEN">WHEN</a></span> <span class="id">aes</span>' <span class="id">x</span> <span class="id">c</span> <span class="id">loc</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">xty</span>, <span class="id">xck</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#find_var">find_var</a></span> <span class="id">loc</span> <span class="id">x</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">c</span>, <span class="id">tn</span>') &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_enum">elab_enum</a></span> <span class="id">loc</span> <span class="id">c</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">eas</span>' &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> <span class="id">elab_exp</span> <span class="id">aes</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ans</span>' := <span class="id"><a href="Velus.Lustre.LustreElab.html#lannots">lannots</a></span> <span class="id">eas</span>' <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#unify_same_clock">unify_same_clock</a></span> <span class="id">xck</span> <span class="id">ans</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Ewhen">Ewhen</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">eas</span>') (<span class="id">x</span>, <span class="id">xty</span>) <span class="id">c</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.LustreElab.html#lannots_ty">lannots_ty</a></span> <span class="id">ans</span>', <span class="id"><a href="Velus.Lustre.LustreElab.html#Son">Son</a></span> <span class="id">xck</span> <span class="id">x</span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tenum">Tenum</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">tn</span>') (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">tn</span>'), <span class="id">c</span>)), <span class="id">loc</span>)<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#MERGE">MERGE</a></span> <span class="id">x</span> <span class="id">aes</span> <span class="id">loc</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">xty</span>, <span class="id">sck</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#find_var">find_var</a></span> <span class="id">loc</span> <span class="id">x</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">tn</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#assert_enum_type">assert_enum_type</a></span> <span class="id">loc</span> <span class="id">x</span> <span class="id">xty</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">eas</span>, <span class="id">tys</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_branches">elab_branches</a></span> <span class="id">loc</span> <span class="id">tn</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> <span class="id">elab_exp</span> (<span class="kwd">fun</span> <span class="id">c</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#Son">Son</a></span> <span class="id">sck</span> <span class="id">x</span> (<span class="id">xty</span>, <span class="id">c</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">aes</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Emerge">Emerge</a></span> (<span class="id">x</span>, <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tenum">Tenum</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">tn</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">tn</span>)) <span class="id">eas</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#lannots_ty">lannots_ty</a></span> <span class="id">tys</span>, <span class="id">sck</span>), <span class="id">loc</span>)<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#CASE">CASE</a></span> [<span class="id">ae</span>] <span class="id">aes</span> [] <span class="id">loc</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">e</span>, <span class="id">eloc</span>) &lt;- <span class="id">elab_exp</span> <span class="id">ae</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">ety</span>, <span class="id">eck</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#single_annot">single_annot</a></span> <span class="id">eloc</span> <span class="id">e</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">tn</span> &lt;- <span class="id">assert_enum_type</span>' <span class="id">loc</span> <span class="id">ety</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">eas</span>, <span class="id">anns</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_branches">elab_branches</a></span> <span class="id">loc</span> <span class="id">tn</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> <span class="id">elab_exp</span> (<span class="kwd">fun</span> <span class="id">_</span> =&gt; <span class="id">eck</span>) <span class="id">aes</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">tys</span> := <span class="id"><a href="Velus.Lustre.LustreElab.html#lannots_ty">lannots_ty</a></span> <span class="id">anns</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Ecase">Ecase</a></span> <span class="id">e</span> <span class="id">eas</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (<span class="id">tys</span>, <span class="id">eck</span>), <span class="id">loc</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#CASE">CASE</a></span> [<span class="id">ae</span>] <span class="id">aes</span> <span class="id">des</span> <span class="id">loc</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">e</span>, <span class="id">eloc</span>) &lt;- <span class="id">elab_exp</span> <span class="id">ae</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">ety</span>, <span class="id">eck</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#single_annot">single_annot</a></span> <span class="id">eloc</span> <span class="id">e</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">tn</span> &lt;- <span class="id">assert_enum_type</span>' <span class="id">loc</span> <span class="id">ety</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">eas</span>, <span class="id">anns</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_branches">elab_branches</a></span> <span class="id">loc</span> <span class="id">tn</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> <span class="id">elab_exp</span> (<span class="kwd">fun</span> <span class="id">_</span> =&gt; <span class="id">eck</span>) <span class="id">aes</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">deas</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> <span class="id">elab_exp</span> <span class="id">des</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#unify_paired_types">unify_paired_types</a></span> <span class="id">loc</span> <span class="id">anns</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#lannots">lannots</a></span> <span class="id">deas</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">tys</span> := <span class="id"><a href="Velus.Lustre.LustreElab.html#lannots_ty">lannots_ty</a></span> <span class="id">anns</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Ecase">Ecase</a></span> <span class="id">e</span> <span class="id">eas</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">deas</span>)) (<span class="id">tys</span>, <span class="id">eck</span>), <span class="id">loc</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#CASE">CASE</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">loc</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_not_singleton">err_not_singleton</a></span> <span class="id">loc</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#APP">APP</a></span> <span class="id">f</span> <span class="id">aes</span> <span class="id">aer</span> <span class="id">loc</span> =&gt;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">eas</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> <span class="id">elab_exp</span> <span class="id">aes</span>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">interface</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#find_node_interface">find_node_interface</a></span> <span class="id">loc</span> <span class="id">f</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">interface</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Internal">Internal</a></span> <span class="id">tyck_in</span> <span class="id">tyck_out</span> =&gt;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">er</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> <span class="id">elab_exp</span> <span class="id">aer</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#assert_reset_type">assert_reset_type</a></span> <span class="id">er</span>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">nanns</span> := <span class="id"><a href="Velus.Lustre.LustreElab.html#lnannots">lnannots</a></span> <span class="id">eas</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">sub</span> := <span class="id"><a href="Velus.Lustre.LustreElab.html#instantiating_subst">instantiating_subst</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">tyck_in</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> '(<span class="id">_</span>, (<span class="id">_</span>, <span class="id">x</span>), <span class="id">_</span>) =&gt; <span class="id">x</span>) <span class="id">nanns</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">xbase</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#fresh_ident">fresh_ident</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">ianns</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#inst_annot">inst_annot</a></span> <span class="id">loc</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Svar">Svar</a></span> <span class="id">xbase</span>) <span class="id">sub</span>) <span class="id">tyck_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">oanns</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#inst_annot">inst_annot</a></span> <span class="id">loc</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Svar">Svar</a></span> <span class="id">xbase</span>) <span class="id">sub</span>) <span class="id">tyck_out</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#unify_params">unify_params</a></span> <span class="id">loc</span> <span class="id">ianns</span> <span class="id">nanns</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Eapp">Eapp</a></span> <span class="id">f</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">eas</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">er</span>) <span class="id">oanns</span>, <span class="id">loc</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#External">External</a></span> <span class="id">tyins</span> <span class="id">tyout</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#check_noreset">check_noreset</a></span> <span class="id">loc</span> <span class="id">aer</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">anns</span> := <span class="id"><a href="Velus.Lustre.LustreElab.html#lannots">lannots</a></span> <span class="id">eas</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">xck</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#hd_sclock">hd_sclock</a></span> <span class="id">loc</span> <span class="id">anns</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#assert_types">assert_types</a></span> <span class="id">loc</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tprimitive">Tprimitive</a></span> <span class="id">tyins</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> '(<span class="id">ty</span>, <span class="id">_</span>, <span class="id">_</span>) =&gt; <span class="id">ty</span>) <span class="id">anns</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#unify_same_clock">unify_same_clock</a></span> <span class="id">xck</span> <span class="id">anns</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Eextcall">Eextcall</a></span> <span class="id">f</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">eas</span>) (<span class="id">tyout</span>, <span class="id">xck</span>), <span class="id">loc</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="freeze_clock">freeze_clock</a></span> (<span class="id">sck</span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.clock">clock</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">sck</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#subst_sclock">subst_sclock</a></span> <span class="id">sck</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id">sclk</span>' <span class="id">sck</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="freeze_ann">freeze_ann</a></span> (<span class="id">tc</span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#ann">ann</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ann">Syn.ann</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '(<span class="id">ty</span>, <span class="id">nck</span>) := <span class="id">tc</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">nck</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#freeze_clock">freeze_clock</a></span> <span class="id">nck</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id">ty</span>, <span class="id">nck</span>).<br/>
<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="add_whens">add_whens</a></span> (<span class="id">e</span>: <span class="id"><a href="Velus.Lustre.LustreElab.html#exp">Syn.exp</a></span>) (<span class="id">tys</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span>) (<span class="id">ck</span>: <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.clock">clock</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#exp">Syn.exp</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ck</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.Cbase">Cbase</a></span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id">e</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.Con">Con</a></span> <span class="id">ck</span>' <span class="id">x</span> (<span class="id">tx</span>, <span class="id">k</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">e</span>' &lt;- <span class="id">add_whens</span> <span class="id">e</span> <span class="id">tys</span> <span class="id">ck</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Velus.Environment.html#Env.mem">Env.mem</a></span> <span class="id">x</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabExpressions.env">env</a></span> <span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Ewhen">Syn.Ewhen</a></span> [<span class="id">e</span>'] (<span class="id">x</span>, <span class="id">tx</span>) <span class="id">k</span> (<span class="id">tys</span>, <span class="id">ck</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#error">error</a></span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "<span class="id">Clock</span> <span class="id">variable</span> " :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">x</span> :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> " <span class="id">escapes</span> <span class="id">its</span> <span class="id">scope</span>" :: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="freeze_exp">freeze_exp</a></span> (<span class="id">e</span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#eexp">eexp</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#exp">Syn.exp</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">freeze_exps</span> := <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> <span class="id">freeze_exp</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">e</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Econst">Econst</a></span> <span class="id">c</span> <span class="id">ck</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ty</span> := <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.ctype_cconst">ctype_cconst</a></span> <span class="id">c</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">ck</span>' &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#freeze_clock">freeze_clock</a></span> <span class="id">ck</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#add_whens">add_whens</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Econst">Syn.Econst</a></span> <span class="id">c</span>) [<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tprimitive">Tprimitive</a></span> <span class="id">ty</span>] <span class="id">ck</span>'<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Eenum">Eenum</a></span> <span class="id">k</span> <span class="id">ty</span> <span class="id">ck</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">ck</span>' &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#freeze_clock">freeze_clock</a></span> <span class="id">ck</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#add_whens">add_whens</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Eenum">Syn.Eenum</a></span> <span class="id">k</span> <span class="id">ty</span>) [<span class="id">ty</span>] <span class="id">ck</span>'<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Evar">Evar</a></span> <span class="id">x</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ann">ann</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">ann</span>' &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#freeze_ann">freeze_ann</a></span> <span class="id">ann</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Evar">Syn.Evar</a></span> <span class="id">x</span> <span class="id">ann</span>')<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Elast">Elast</a></span> <span class="id">x</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ann">ann</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">ann</span>' &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#freeze_ann">freeze_ann</a></span> <span class="id">ann</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Elast">Syn.Elast</a></span> <span class="id">x</span> <span class="id">ann</span>')<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Eunop">Eunop</a></span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.unop">unop</a></span> <span class="id">e</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ann">ann</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">e</span>' &lt;- <span class="id">freeze_exp</span> <span class="id">e</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">ann</span>' &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#freeze_ann">freeze_ann</a></span> <span class="id">ann</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Eunop">Syn.Eunop</a></span> <span class="id">unop</span> <span class="id">e</span>' <span class="id">ann</span>')<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Ebinop">Ebinop</a></span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.binop">binop</a></span> <span class="id">e1</span> <span class="id">e2</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ann">ann</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">e1</span>' &lt;- <span class="id">freeze_exp</span> <span class="id">e1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">e2</span>' &lt;- <span class="id">freeze_exp</span> <span class="id">e2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">ann</span>' &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#freeze_ann">freeze_ann</a></span> <span class="id">ann</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Ebinop">Syn.Ebinop</a></span> <span class="id">binop</span> <span class="id">e1</span>' <span class="id">e2</span>' <span class="id">ann</span>')<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Eextcall">Eextcall</a></span> <span class="id">f</span> <span class="id">es</span> (<span class="id">cty</span>, <span class="id">ck</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">es</span>' &lt;- <span class="id">freeze_exps</span> <span class="id">es</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">ck</span>' &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#freeze_clock">freeze_clock</a></span> <span class="id">ck</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Eextcall">Syn.Eextcall</a></span> <span class="id">f</span> <span class="id">es</span>' (<span class="id">cty</span>, <span class="id">ck</span>'))<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Efby">Efby</a></span> <span class="id">e0s</span> <span class="id">es</span> <span class="id">anns</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">e0s</span> &lt;- <span class="id">freeze_exps</span> <span class="id">e0s</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">es</span> &lt;- <span class="id">freeze_exps</span> <span class="id">es</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">anns</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#freeze_ann">freeze_ann</a></span> <span class="id">anns</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Efby">Syn.Efby</a></span> <span class="id">e0s</span> <span class="id">es</span> <span class="id">anns</span>)<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Earrow">Earrow</a></span> <span class="id">e0s</span> <span class="id">es</span> <span class="id">anns</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">e0s</span> &lt;- <span class="id">freeze_exps</span> <span class="id">e0s</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">es</span> &lt;- <span class="id">freeze_exps</span> <span class="id">es</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">anns</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#freeze_ann">freeze_ann</a></span> <span class="id">anns</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Earrow">Syn.Earrow</a></span> <span class="id">e0s</span> <span class="id">es</span> <span class="id">anns</span>)<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Ewhen">Ewhen</a></span> <span class="id">es</span> (<span class="id">ckid</span>, <span class="id">tx</span>) <span class="id">b</span> (<span class="id">tys</span>, <span class="id">nck</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">es</span> &lt;- <span class="id">freeze_exps</span> <span class="id">es</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">nck</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#freeze_clock">freeze_clock</a></span> <span class="id">nck</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Ewhen">Syn.Ewhen</a></span> <span class="id">es</span> (<span class="id">ckid</span>, <span class="id">tx</span>) <span class="id">b</span> (<span class="id">tys</span>, <span class="id">nck</span>))<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Emerge">Emerge</a></span> <span class="id">ckid</span> <span class="id">es</span> (<span class="id">tys</span>, <span class="id">nck</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">es</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="kwd">fun</span> '(<span class="id">i</span>, <span class="id">es</span>) =&gt; <span class="id">do</span> <span class="id">es</span>' &lt;- <span class="id">freeze_exps</span> <span class="id">es</span>; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id">i</span>, <span class="id">es</span>')) <span class="id">es</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">nck</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#freeze_clock">freeze_clock</a></span> <span class="id">nck</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Emerge">Syn.Emerge</a></span> <span class="id">ckid</span> <span class="id">es</span> (<span class="id">tys</span>, <span class="id">nck</span>))<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Ecase">Ecase</a></span> <span class="id">e</span> <span class="id">es</span> <span class="id">d</span> (<span class="id">tys</span>, <span class="id">nck</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">e</span> &lt;- <span class="id">freeze_exp</span> <span class="id">e</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">es</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="kwd">fun</span> '(<span class="id">i</span>, <span class="id">es</span>) =&gt; <span class="id">do</span> <span class="id">es</span>' &lt;- <span class="id">freeze_exps</span> <span class="id">es</span>; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id">i</span>, <span class="id">es</span>')) <span class="id">es</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">d</span> &lt;- <span class="id"><a href="Velus.Common.Common.html#or_default_with">or_default_with</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) (<span class="kwd">fun</span> <span class="id">d</span> =&gt; <span class="id">do</span> <span class="id">d</span>' &lt;- <span class="id">freeze_exps</span> <span class="id">d</span>; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">d</span>')) <span class="id">d</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">nck</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#freeze_clock">freeze_clock</a></span> <span class="id">nck</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Ecase">Syn.Ecase</a></span> <span class="id">e</span> <span class="id">es</span> <span class="id">d</span> (<span class="id">tys</span>, <span class="id">nck</span>))<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Eapp">Eapp</a></span> <span class="id">f</span> <span class="id">es</span> <span class="id">er</span> <span class="id">anns</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">es</span> &lt;- <span class="id">freeze_exps</span> <span class="id">es</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">er</span> &lt;- <span class="id">freeze_exps</span> <span class="id">er</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">anns</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#freeze_ann">freeze_ann</a></span> <span class="id">anns</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Eapp">Syn.Eapp</a></span> <span class="id">f</span> <span class="id">es</span> <span class="id">er</span> <span class="id">anns</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="unify_pat">unify_pat</a></span> (<span class="id">gloc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">xs</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">anns</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> ((<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>) * <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>)) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">xs</span>, <span class="id">anns</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">x</span>::<span class="id">xs</span>', ((<span class="id">ty</span>, <span class="id">ck</span>), <span class="id">loc</span>)::<span class="id">anns</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">xty</span>, <span class="id">xck</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#find_var">find_var</a></span> <span class="id">loc</span> <span class="id">x</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#assert_id_type">assert_id_type</a></span> <span class="id">loc</span> <span class="id">x</span> <span class="id">xty</span> <span class="id">ty</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#unify_sclock">unify_sclock</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabExpressions.tenv">tenv</a></span> <span class="id">loc</span> <span class="id">xck</span> <span class="id">ck</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unify_pat</span> <span class="id">gloc</span> <span class="id">xs</span>' <span class="id">anns</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>, <span class="id">_</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">gloc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">too</span> <span class="id">few</span> <span class="id">variables</span> <span class="id">on</span> <span class="id">lhs</span> <span class="id">of</span> <span class="id">equation</span>.")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">gloc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">too</span> <span class="id">many</span> <span class="id">variables</span> <span class="id">on</span> <span class="id">lhs</span> <span class="id">of</span> <span class="id">equation</span>.")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="unify_npat">unify_npat</a></span> (<span class="id">gloc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">xs</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">anns</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> ((<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.Lustre.LustreElab.html#sclock">sclock</a></span>))) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">xs</span>, <span class="id">anns</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">x</span>::<span class="id">xs</span>', (<span class="id">ty</span>, <span class="id">ck</span>)::<span class="id">anns</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">xty</span>, <span class="id">xck</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#find_var">find_var</a></span> <span class="id">gloc</span> <span class="id">x</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#assert_id_type">assert_id_type</a></span> <span class="id">gloc</span> <span class="id">x</span> <span class="id">xty</span> <span class="id">ty</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#unify_sclock">unify_sclock</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabExpressions.tenv">tenv</a></span> <span class="id">gloc</span> <span class="id">xck</span> <span class="id">ck</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unify_npat</span> <span class="id">gloc</span> <span class="id">xs</span>' <span class="id">anns</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>, <span class="id">_</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">gloc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">too</span> <span class="id">few</span> <span class="id">variables</span> <span class="id">on</span> <span class="id">lhs</span> <span class="id">of</span> <span class="id">equation</span>.")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">gloc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">too</span> <span class="id">many</span> <span class="id">variables</span> <span class="id">on</span> <span class="id">lhs</span> <span class="id">of</span> <span class="id">equation</span>.")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="elab_equation">elab_equation</a></span> (<span class="id">aeq</span> : <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#equation">LustreAst.equation</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#equation">Syn.equation</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '((<span class="id">xs</span>, <span class="id">es</span>), <span class="id">loc</span>) := <span class="id">aeq</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">es</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#APP">APP</a></span> <span class="id">f</span> <span class="id">aes</span> <span class="id">aer</span> <span class="id">loc</span>]  =&gt;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">interface</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#find_node_interface">find_node_interface</a></span> <span class="id">loc</span> <span class="id">f</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">interface</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Internal">Internal</a></span> <span class="id">tyck_in</span> <span class="id">tyck_out</span> =&gt;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">eas</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_exp">elab_exp</a></span> <span class="id">aes</span>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">er</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_exp">elab_exp</a></span> <span class="id">aer</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#assert_reset_type">assert_reset_type</a></span> <span class="id">er</span>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">anns</span> := <span class="id"><a href="Velus.Lustre.LustreElab.html#lnannots">lnannots</a></span> <span class="id">eas</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">sub</span> := <span class="id"><a href="Velus.Lustre.LustreElab.html#instantiating_subst">instantiating_subst</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id">tyck_in</span>++<span class="id">tyck_out</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> '(<span class="id">_</span>, (<span class="id">_</span>, <span class="id">x</span>), <span class="id">_</span>) =&gt; <span class="id">x</span>) <span class="id">anns</span>++<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">xs</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">xbase</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#fresh_ident">fresh_ident</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">ianns</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#inst_annot">inst_annot</a></span> <span class="id">loc</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Svar">Svar</a></span> <span class="id">xbase</span>) <span class="id">sub</span>) <span class="id">tyck_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">oanns</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#inst_annot">inst_annot</a></span> <span class="id">loc</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Svar">Svar</a></span> <span class="id">xbase</span>) <span class="id">sub</span>) <span class="id">tyck_out</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#unify_params">unify_params</a></span> <span class="id">loc</span> <span class="id">ianns</span> <span class="id">anns</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#unify_npat">unify_npat</a></span> <span class="id">loc</span> <span class="id">xs</span> <span class="id">oanns</span>;<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">e</span>' &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#freeze_exp">freeze_exp</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Eapp">Eapp</a></span> <span class="id">f</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">eas</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">er</span>) <span class="id">oanns</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id">xs</span>, [<span class="id">e</span>'])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">es</span>' &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_exp">elab_exp</a></span> <span class="id">es</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#unify_pat">unify_pat</a></span> <span class="id">loc</span> <span class="id">xs</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#lannots">lannots</a></span> <span class="id">es</span>');<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">es</span>' &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#freeze_exp">freeze_exp</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">es</span>');<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id">xs</span>, <span class="id">es</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>  =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">es</span>' &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_exp">elab_exp</a></span> <span class="id">es</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#unify_pat">unify_pat</a></span> <span class="id">loc</span> <span class="id">xs</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#lannots">lannots</a></span> <span class="id">es</span>');<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">es</span>' &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#freeze_exp">freeze_exp</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">es</span>');<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id">xs</span>, <span class="id">es</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabExpressions">ElabExpressions</a></span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="ElabVarDecls">ElabVarDecls</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="err_incoherent_clock">err_incoherent_clock</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">x</span>: <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "<span class="id">The</span> <span class="id">declared</span> <span class="id">clock</span> <span class="id">of</span> " :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> " <span class="id">is</span> <span class="id">incoherent</span> <span class="kwd">with</span> <span class="id">the</span> <span class="id">other</span> <span class="id">declarations</span>").<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id"><a name="ElabVarDecls.tenv">tenv</a></span> : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>).<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id"><a name="ElabVarDecls.extenv">extenv</a></span> : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.ctype">ctype</a></span> * <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.ctype">ctype</a></span>).<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id"><a name="ElabVarDecls.lasts">lasts</a></span> : <span class="id"><a href="Velus.Common.Common.html#PS.t">PS.t</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="assert_preclock">assert_preclock</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">x</span>: <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">pck</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#clock">LustreAst.clock</a></span>) (<span class="id">ck</span>: <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.clock">clock</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">pck</span>, <span class="id">ck</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#BASE">BASE</a></span>, <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.Cbase">Cbase</a></span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#ON">ON</a></span> <span class="id">pck</span>' <span class="id">py</span> <span class="id">pc</span>, <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.Con">Con</a></span> <span class="id">ck</span>' <span class="id">y</span> (<span class="id">_</span>, <span class="id">c</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">py</span> ==<span class="id">b</span> <span class="id">y</span> <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">c</span>', <span class="id">tn</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_enum">elab_enum</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabVarDecls.tenv">tenv</a></span> <span class="id">loc</span> <span class="id">pc</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">c</span>' ==<span class="id">b</span> <span class="id">c</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">assert_preclock</span> <span class="id">loc</span> <span class="id">x</span> <span class="id">pck</span>' <span class="id">ck</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_incoherent_clock">err_incoherent_clock</a></span> <span class="id">loc</span> <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_incoherent_clock">err_incoherent_clock</a></span> <span class="id">loc</span> <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_incoherent_clock">err_incoherent_clock</a></span> <span class="id">loc</span> <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="elab_decls_pass">elab_decls_pass</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">acc</span>: <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.clock">clock</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * (<span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#type_name">type_name</a></span> * <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#preclock">preclock</a></span> * <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">vds</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * (<span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#type_name">type_name</a></span> * <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#preclock">preclock</a></span> * <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> (<span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.clock">clock</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * (<span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#type_name">type_name</a></span> * <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#preclock">preclock</a></span> * <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>))) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">vds</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id">acc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">x</span>, (<span class="id">sty</span>, <span class="id">pck</span>, <span class="id">loc</span>)) <span class="kwd">as</span> <span class="id">vd</span> :: <span class="id">vds</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">env</span>, <span class="id">notdone</span>) := <span class="id">acc</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">pck</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#FULLCK">FULLCK</a></span> <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#BASE">BASE</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Velus.Environment.html#Env.mem">Env.mem</a></span> <span class="id">x</span> <span class="id">env</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">x</span> :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> " <span class="id">is</span> <span class="id">declared</span> <span class="id">more</span> <span class="id">than</span> <span class="id">once</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">ty</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_type">elab_type</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabVarDecls.tenv">tenv</a></span> <span class="id">loc</span> <span class="id">sty</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">elab_decls_pass</span> (<span class="id"><a href="Velus.Environment.html#Env.add">Env.add</a></span> <span class="id">x</span> (<span class="id">ty</span>, <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.Cbase">Cbase</a></span>, <span class="id"><a href="Velus.Common.Common.html#PS.mem">PS.mem</a></span> <span class="id">x</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabVarDecls.lasts">lasts</a></span>) <span class="id">env</span>, <span class="id">notdone</span>) <span class="id">vds</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#FULLCK">FULLCK</a></span> (<span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#ON">ON</a></span> <span class="id">cy</span>' <span class="id">y</span> <span class="id">c</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">y</span> <span class="id">env</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id">elab_decls_pass</span> (<span class="id">env</span>, <span class="id">vd</span> :: <span class="id">notdone</span>) <span class="id">vds</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">yt</span>, <span class="id">cy</span>, <span class="id">_</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Velus.Environment.html#Env.mem">Env.mem</a></span> <span class="id">x</span> <span class="id">env</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">x</span> :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> " <span class="id">is</span> <span class="id">declared</span> <span class="id">more</span> <span class="id">than</span> <span class="id">once</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#assert_enum_type">assert_enum_type</a></span> <span class="id">loc</span> <span class="id">y</span> <span class="id">yt</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#assert_preclock">assert_preclock</a></span> <span class="id">loc</span> <span class="id">x</span> <span class="id">cy</span>' <span class="id">cy</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">c</span>', <span class="id">tn</span>') &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_enum">elab_enum</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabVarDecls.tenv">tenv</a></span> <span class="id">loc</span> <span class="id">c</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#assert_id_type">assert_id_type</a></span> <span class="id">loc</span> <span class="id">y</span> <span class="id">yt</span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tenum">Tenum</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">tn</span>') (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">tn</span>'));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">ty</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_type">elab_type</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabVarDecls.tenv">tenv</a></span> <span class="id">loc</span> <span class="id">sty</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">elab_decls_pass</span> (<span class="id"><a href="Velus.Environment.html#Env.add">Env.add</a></span> <span class="id">x</span> (<span class="id">ty</span>, <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.Con">Con</a></span> <span class="id">cy</span> <span class="id">y</span> (<span class="id">yt</span>, <span class="id">c</span>'), <span class="id"><a href="Velus.Common.Common.html#PS.mem">PS.mem</a></span> <span class="id">x</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabVarDecls.lasts">lasts</a></span>) <span class="id">env</span>, <span class="id">notdone</span>) <span class="id">vds</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#WHENCK">WHENCK</a></span> <span class="id">y</span> <span class="id">c</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">y</span> <span class="id">env</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id">elab_decls_pass</span> (<span class="id">env</span>, <span class="id">vd</span> :: <span class="id">notdone</span>) <span class="id">vds</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">yt</span>, <span class="id">cy</span>, <span class="id">_</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Velus.Environment.html#Env.mem">Env.mem</a></span> <span class="id">x</span> <span class="id">env</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">x</span> :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> " <span class="id">is</span> <span class="id">declared</span> <span class="id">more</span> <span class="id">than</span> <span class="id">once</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#assert_enum_type">assert_enum_type</a></span> <span class="id">loc</span> <span class="id">y</span> <span class="id">yt</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">c</span>', <span class="id">tn</span>') &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_enum">elab_enum</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabVarDecls.tenv">tenv</a></span> <span class="id">loc</span> <span class="id">c</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#assert_id_type">assert_id_type</a></span> <span class="id">loc</span> <span class="id">y</span> <span class="id">yt</span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tenum">Tenum</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">tn</span>') (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">tn</span>'));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">ty</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_type">elab_type</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabVarDecls.tenv">tenv</a></span> <span class="id">loc</span> <span class="id">sty</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">elab_decls_pass</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Environment.html#Env.add">Env.add</a></span> <span class="id">x</span> (<span class="id">ty</span>, <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.Con">Con</a></span> <span class="id">cy</span> <span class="id">y</span> (<span class="id">yt</span>, <span class="id">c</span>'), <span class="id"><a href="Velus.Common.Common.html#PS.mem">PS.mem</a></span> <span class="id">x</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabVarDecls.lasts">lasts</a></span>) <span class="id">env</span>, <span class="id">notdone</span>) <span class="id">vds</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id">elab_decls</span>' {<span class="id">A</span>: <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">loc</span> : <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">fuel</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">env</span> : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.clock">clock</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">vds</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * (<span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#type_name">type_name</a></span> * <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#preclock">preclock</a></span> * <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> (<span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.clock">clock</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">vds</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id">env</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">fuel</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "<span class="id">incoherent</span> <span class="id">or</span> <span class="id">cyclic</span> <span class="id">clocks</span>: "<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: <span class="id"><a href="Velus.Lustre.LustreElab.html#msg_ident_list">msg_ident_list</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">vds</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> :: <span class="id">fuel</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">env</span>', <span class="id">notdone</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_decls_pass">elab_decls_pass</a></span> (<span class="id">env</span>, []) <span class="id">vds</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">elab_decls</span>' <span class="id">loc</span> <span class="id">fuel</span>' <span class="id">env</span>' <span class="id">notdone</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="elab_decls">elab_decls</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">env</span>: <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.clock">clock</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">vds</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#var_decls">var_decls</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> (<span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.clock">clock</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">elab_decls</span>' <span class="id">loc</span> <span class="id">vds</span> <span class="id">env</span> <span class="id">vds</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="annotate">annotate</a></span> (<span class="id">env</span>: <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.clock">clock</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">vd</span>: <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * (<span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#type_name">type_name</a></span> * <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#preclock">preclock</a></span> * <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.clock">clock</a></span> * <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '(<span class="id">x</span>, (<span class="id">sty</span>, <span class="id">pck</span>, <span class="id">loc</span>)) := <span class="id">vd</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">cx</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#fresh_ident">fresh_ident</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> <span class="id">env</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#error">error</a></span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">internal</span> <span class="id">error</span> (<span class="id">annotate</span>)")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">ty</span>, <span class="id">ck</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>) =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id">x</span>, (<span class="id">ty</span>, <span class="id">ck</span>, <span class="id">cx</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">ty</span>, <span class="id">ck</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">clx</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#fresh_ident">fresh_ident</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id">x</span>, (<span class="id">ty</span>, <span class="id">ck</span>, <span class="id">cx</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">clx</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabVarDecls">ElabVarDecls</a></span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="AtomOrGensym">AtomOrGensym</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="check_atom">check_atom</a></span> <span class="id">loc</span> <span class="id">name</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Velus.Ident.html#Ids.is_atom">is_atom</a></span> <span class="id">name</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">name</span> :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> " <span class="id">should</span> <span class="id">be</span> <span class="id">an</span> <span class="id">atom</span>" :: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="check_atom_spec">check_atom_spec</a></span> : <span class="kwd">forall</span> <span class="id">loc</span> <span class="id">name</span> <span class="id">st</span> <span class="id">res</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#check_atom">check_atom</a></span> <span class="id">loc</span> <span class="id">name</span> <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> <span class="id">res</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Ident.html#Ids.atom">atom</a></span> <span class="id">name</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof7')">Proof.</span></div>
<div class="proofscript" id="proof7">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hcheck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_atom">check_atom</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="Velus.Ident.html#Ids.is_atom">is_atom</a></span> <span class="id">eqn</span>:<span class="id">Hat</span>; <span class="id">inv</span> <span class="id">Hcheck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Ident.html#Ids.is_atom_spec">is_atom_spec</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="mmap_check_atom_AtomOrGensym">mmap_check_atom_AtomOrGensym</a></span> : <span class="kwd">forall</span> <span class="id">loc</span> <span class="id">xs</span> <span class="id">st</span> <span class="id">res</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#check_atom">check_atom</a></span> <span class="id">loc</span>) <span class="id">xs</span> <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> <span class="id">res</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Ident.html#Ids.AtomOrGensym">AtomOrGensym</a></span> <span class="id"><a href="Velus.Ident.html#Ids.elab_prefs">elab_prefs</a></span>) <span class="id">xs</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof8')">Proof.</span></div>
<div class="proofscript" id="proof8">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">xs</span>; <span class="id">intros</span> * <span class="id">Hmap</span>; <span class="id">repeat</span> <span class="id">monadInv</span>; <span class="id">constructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_atom_spec">check_atom_spec</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#AtomOrGensym">AtomOrGensym</a></span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="ElabBlock">ElabBlock</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id"><a name="ElabBlock.tenv">tenv</a></span> : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>).<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id"><a name="ElabBlock.extenv">extenv</a></span> : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.ctype">ctype</a></span> * <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.ctype">ctype</a></span>).<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id"><a name="ElabBlock.nenv">nenv</a></span> : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.clock">clock</a></span>)) * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.clock">clock</a></span>))).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="vars_defined">vars_defined</a></span> (<span class="id">d</span> : <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#block">LustreAst.block</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#BEQ">BEQ</a></span> (<span class="id">xs</span>, <span class="id">_</span>, <span class="id">_</span>) =&gt; <span class="id"><a href="Velus.Common.CommonPS.html#ps_from_list">ps_from_list</a></span> <span class="id">xs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#BLAST">BLAST</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id"><a href="Velus.Common.Common.html#PS.empty">PS.empty</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#BRESET">BRESET</a></span> <span class="id">blocks</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id"><a href="Velus.Common.CommonPS.html#PSUnion">PSUnion</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id">vars_defined</span> <span class="id">blocks</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#BSWITCH">BSWITCH</a></span> <span class="id">_</span> <span class="id">branches</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonPS.html#PSUnion">PSUnion</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> '(<span class="id">_</span>, <span class="id">blks</span>) =&gt; <span class="id"><a href="Velus.Common.CommonPS.html#PSUnion">PSUnion</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id">vars_defined</span> <span class="id">blks</span>)) <span class="id">branches</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#BAUTO">BAUTO</a></span> <span class="id">_</span> <span class="id">states</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonPS.html#PSUnion">PSUnion</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> '(<span class="id">_</span>, (<span class="id">locs</span>, <span class="id">blks</span>, <span class="id">_</span>, <span class="id">_</span>)) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">locs</span> := <span class="id"><a href="Velus.Common.CommonPS.html#ps_from_list">ps_from_list</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">locs</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.Common.html#PS.filter">PS.filter</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#negb">negb</a></span> (<span class="id"><a href="Velus.Common.Common.html#PS.mem">PS.mem</a></span> <span class="id">x</span> <span class="id">locs</span>)) (<span class="id"><a href="Velus.Common.CommonPS.html#PSUnion">PSUnion</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id">vars_defined</span> <span class="id">blks</span>))) <span class="id">states</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#BLOCAL">BLOCAL</a></span> <span class="id">locs</span> <span class="id">blks</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">locs</span> := <span class="id"><a href="Velus.Common.CommonPS.html#ps_from_list">ps_from_list</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">locs</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.Common.html#PS.filter">PS.filter</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#negb">negb</a></span> (<span class="id"><a href="Velus.Common.Common.html#PS.mem">PS.mem</a></span> <span class="id">x</span> <span class="id">locs</span>)) (<span class="id"><a href="Velus.Common.CommonPS.html#PSUnion">PSUnion</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id">vars_defined</span> <span class="id">blks</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="lasts_defined">lasts_defined</a></span> (<span class="id">d</span> : <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#block">LustreAst.block</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#BEQ">BEQ</a></span> (<span class="id">xs</span>, <span class="id">_</span>, <span class="id">_</span>) =&gt; <span class="id"><a href="Velus.Common.Common.html#PS.empty">PS.empty</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#BLAST">BLAST</a></span> <span class="id">x</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id"><a href="Velus.Common.Common.html#PS.singleton">PS.singleton</a></span> <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#BRESET">BRESET</a></span> <span class="id">blocks</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id"><a href="Velus.Common.CommonPS.html#PSUnion">PSUnion</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id">lasts_defined</span> <span class="id">blocks</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#BSWITCH">BSWITCH</a></span> <span class="id">_</span> <span class="id">branches</span> <span class="id">_</span> =&gt; <span class="id"><a href="Velus.Common.Common.html#PS.empty">PS.empty</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#BAUTO">BAUTO</a></span> <span class="id">_</span> <span class="id">states</span> <span class="id">_</span> =&gt; <span class="id"><a href="Velus.Common.Common.html#PS.empty">PS.empty</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#BLOCAL">BLOCAL</a></span> <span class="id">locs</span> <span class="id">blks</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">locs</span> := <span class="id"><a href="Velus.Common.CommonPS.html#ps_from_list">ps_from_list</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">locs</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.Common.html#PS.filter">PS.filter</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#negb">negb</a></span> (<span class="id"><a href="Velus.Common.Common.html#PS.mem">PS.mem</a></span> <span class="id">x</span> <span class="id">locs</span>)) (<span class="id"><a href="Velus.Common.CommonPS.html#PSUnion">PSUnion</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id">lasts_defined</span> <span class="id">blks</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="lasts_defineds">lasts_defineds</a></span> <span class="id">blocks</span> := <span class="id"><a href="Velus.Common.CommonPS.html#PSUnion">PSUnion</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#lasts_defined">lasts_defined</a></span> <span class="id">blocks</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="find_a_clock">find_a_clock</a></span> (<span class="id">tenv</span> : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.clock">clock</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>)) (<span class="id">xs</span> : <span class="id"><a href="Velus.Common.Common.html#PS.t">PS.t</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> (<span class="id"><a href="Velus.Common.Common.html#PS.choose">PS.choose</a></span> <span class="id">xs</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.Cbase">Cbase</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span> =&gt; <span class="id"><a href="Velus.Common.Common.html#or_default_with">or_default_with</a></span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.Cbase">Cbase</a></span> (<span class="kwd">fun</span> '(<span class="id">_</span>, <span class="id">ck</span>, <span class="id">_</span>) =&gt; <span class="id">ck</span>) (<span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> <span class="id">tenv</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="find_a_clock_of_defined">find_a_clock_of_defined</a></span> <span class="id">tenv</span> (<span class="id">ab</span> : <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#block">LustreAst.block</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#find_a_clock">find_a_clock</a></span> <span class="id">tenv</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#vars_defined">vars_defined</a></span> <span class="id">ab</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="elab_transition_cond">elab_transition_cond</a></span> <span class="id">env</span> <span class="id">nenv</span> (<span class="id">es</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#expression">expression</a></span>) <span class="id">loc</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">es</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">e</span>] =&gt; <span class="id">do</span> (<span class="id">e</span>, <span class="id">_</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_exp">elab_exp</a></span> <span class="id">env</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabBlock.tenv">tenv</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabBlock.extenv">extenv</a></span> <span class="id">nenv</span> <span class="id">e</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">ety</span>, <span class="id">eck</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#single_annot">single_annot</a></span> <span class="id">loc</span> <span class="id">e</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">ety</span> &lt;- <span class="id">assert_type</span>' <span class="id">loc</span> <span class="id">ety</span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.bool_type">bool_type</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#unify_sclock">unify_sclock</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabBlock.tenv">tenv</a></span> <span class="id">loc</span> <span class="id">eck</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#Sbase">Sbase</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">e</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#freeze_exp">freeze_exp</a></span> <span class="id">env</span> <span class="id">e</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id">e</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_not_singleton">err_not_singleton</a></span> <span class="id">loc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="elab_block">elab_block</a></span> <span class="id">env</span> (<span class="id">ab</span> : <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#block">LustreAst.block</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#block">Syn.block</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ab</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#BEQ">BEQ</a></span> <span class="id">aeq</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">eq</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_equation">elab_equation</a></span> <span class="id">env</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabBlock.tenv">tenv</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabBlock.extenv">extenv</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabBlock.nenv">nenv</a></span> <span class="id">aeq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Beq">Beq</a></span> <span class="id">eq</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#BLAST">BLAST</a></span> <span class="id">x</span> [<span class="id">ae</span>] <span class="id">loc</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">e</span>, <span class="id">loc</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_exp">elab_exp</a></span> <span class="id">env</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabBlock.tenv">tenv</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabBlock.extenv">extenv</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabBlock.nenv">nenv</a></span> <span class="id">ae</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#unify_pat">unify_pat</a></span> <span class="id">env</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabBlock.tenv">tenv</a></span> <span class="id">loc</span> [<span class="id">x</span>] (<span class="id"><a href="Velus.Lustre.LustreElab.html#lannot">lannot</a></span> (<span class="id">e</span>, <span class="id">loc</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">e</span>' &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#freeze_exp">freeze_exp</a></span> <span class="id">env</span> <span class="id">e</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Blast">Blast</a></span> <span class="id">x</span> <span class="id">e</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#BLAST">BLAST</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">loc</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_not_singleton">err_not_singleton</a></span> <span class="id">loc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#BRESET">BRESET</a></span> <span class="id">ablks</span> [<span class="id">aer</span>] <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">blks</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="id">elab_block</span> <span class="id">env</span>) <span class="id">ablks</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">er</span>, <span class="id">loc</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_exp">elab_exp</a></span> <span class="id">env</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabBlock.tenv">tenv</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabBlock.extenv">extenv</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabBlock.nenv">nenv</a></span> <span class="id">aer</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#assert_reset_type">assert_reset_type</a></span> (<span class="id">er</span>, <span class="id">loc</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">er</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#freeze_exp">freeze_exp</a></span> <span class="id">env</span> <span class="id">er</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Breset">Breset</a></span> <span class="id">blks</span> <span class="id">er</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#BRESET">BRESET</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">loc</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_not_singleton">err_not_singleton</a></span> <span class="id">loc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#BSWITCH">BSWITCH</a></span> [<span class="id">aec</span>] <span class="id">abrs</span> <span class="id">loc</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">ec</span>, <span class="id">eloc</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_exp">elab_exp</a></span> <span class="id">env</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabBlock.tenv">tenv</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabBlock.extenv">extenv</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabBlock.nenv">nenv</a></span> <span class="id">aec</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">ety</span>, <span class="id">eck</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#single_annot">single_annot</a></span> <span class="id">eloc</span> <span class="id">ec</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">ec</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#freeze_exp">freeze_exp</a></span> <span class="id">env</span> <span class="id">ec</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">tn</span> &lt;- <span class="id">assert_enum_type</span>' <span class="id">loc</span> <span class="id">ety</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ck</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#hd">List.hd</a></span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.Cbase">Cbase</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#clockof">clockof</a></span> <span class="id">ec</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">env</span> := <span class="id"><a href="Velus.Environment.html#Env.map">Env.map</a></span> (<span class="kwd">fun</span> '(<span class="id">ty</span>, <span class="id">_</span>, <span class="id">b</span>) =&gt; (<span class="id">ty</span>, <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.Cbase">Cbase</a></span>, <span class="id">b</span>)) (<span class="id"><a href="Velus.Environment.html#Env.Props.P.filter">Env.Props.P.filter</a></span> (<span class="kwd">fun</span> <span class="id">_</span> '(<span class="id">_</span>, <span class="id">ck</span>', <span class="id">_</span>) =&gt; <span class="id">ck</span> ==<span class="id">b</span> <span class="id">ck</span>') <span class="id">env</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">xs</span> := <span class="id"><a href="Velus.Lustre.LustreElab.html#vars_defined">vars_defined</a></span> <span class="id">ab</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">brs</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="kwd">fun</span> '(<span class="id">c</span>, <span class="id">ablks</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">c</span>, <span class="id">tn</span>') &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_enum">elab_enum</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabBlock.tenv">tenv</a></span> <span class="id">loc</span> <span class="id">c</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id">assert_type</span>' <span class="id">loc</span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tenum">Tenum</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">tn</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">tn</span>)) (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tenum">Tenum</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">tn</span>') (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">tn</span>'));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">blks</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="id">elab_block</span> <span class="id">env</span>) <span class="id">ablks</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">caus</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">do</span> <span class="id">cx</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#fresh_ident">fresh_ident</a></span>; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id">x</span>, <span class="id">cx</span>)) (<span class="id"><a href="Velus.Common.Common.html#PSP.to_list">PSP.to_list</a></span> <span class="id">xs</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id">c</span>, <span class="id"><a href="Velus.Lustre.LustreElab.html#Branch">Branch</a></span> <span class="id">caus</span> <span class="id">blks</span>)) <span class="id">abrs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">cs</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#split">split</a></span> <span class="id">brs</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#check_duplicates">check_duplicates</a></span> <span class="id">loc</span> <span class="id">cs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#check_exhaustivity">check_exhaustivity</a></span> <span class="id">loc</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length">length</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">tn</span>)) <span class="id">cs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Bswitch">Bswitch</a></span> <span class="id">ec</span> <span class="id">brs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#BAUTO">BAUTO</a></span> (<span class="id">ini</span>, <span class="id">oth</span>) <span class="id">states</span> <span class="id">loc</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ck</span> := <span class="id"><a href="Velus.Lustre.LustreElab.html#find_a_clock_of_defined">find_a_clock_of_defined</a></span> <span class="id">env</span> (<span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#BAUTO">BAUTO</a></span> (<span class="id">ini</span>, <span class="id">oth</span>) <span class="id">states</span> <span class="id">loc</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">env</span> := <span class="id"><a href="Velus.Environment.html#Env.map">Env.map</a></span> (<span class="kwd">fun</span> '(<span class="id">ty</span>, <span class="id">_</span>, <span class="id">b</span>) =&gt; (<span class="id">ty</span>, <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.Cbase">Cbase</a></span>, <span class="id">b</span>)) (<span class="id"><a href="Velus.Environment.html#Env.Props.P.filter">Env.Props.P.filter</a></span> (<span class="kwd">fun</span> <span class="id">_</span> '(<span class="id">_</span>, <span class="id">ck</span>', <span class="id">_</span>) =&gt; <span class="id">ck</span> ==<span class="id">b</span> <span class="id">ck</span>') <span class="id">env</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">tenv</span>' := <span class="id"><a href="Velus.Environment.html#Env.add">Env.add</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">states</span>) (@<span class="id"><a href="Velus.Environment.html#Env.empty">Env.empty</a></span> <span class="id">_</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">xs</span> := <span class="id"><a href="Velus.Lustre.LustreElab.html#vars_defined">vars_defined</a></span> <span class="id">ab</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">oth</span>, <span class="id">_</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_enum">elab_enum</a></span> <span class="id">tenv</span>' <span class="id">loc</span> <span class="id">oth</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">ini</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="kwd">fun</span> '(<span class="id">e</span>, <span class="id">t</span>, <span class="id">loc</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">t</span>, <span class="id">_</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_enum">elab_enum</a></span> <span class="id">tenv</span>' <span class="id">loc</span> <span class="id">t</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">e</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_transition_cond">elab_transition_cond</a></span> <span class="id">env</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabBlock.nenv">nenv</a></span> <span class="id">e</span> <span class="id">loc</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id">e</span>, <span class="id">t</span>)) <span class="id">ini</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">states</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="kwd">fun</span> '(<span class="id">constr</span>, (<span class="id">locs</span>, <span class="id">ablks</span>, <span class="id">unt</span>, <span class="id">unl</span>)) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">t</span>, <span class="id">_</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_enum">elab_enum</a></span> <span class="id">tenv</span>' <span class="id">loc</span> <span class="id">constr</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">unl</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="kwd">fun</span> '(<span class="id">e</span>, (<span class="id">t</span>, <span class="id">b</span>), <span class="id">loc</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">t</span>, <span class="id">_</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_enum">elab_enum</a></span> <span class="id">tenv</span>' <span class="id">loc</span> <span class="id">t</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">e</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_transition_cond">elab_transition_cond</a></span> <span class="id">env</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabBlock.nenv">nenv</a></span> <span class="id">e</span> <span class="id">loc</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id">e</span>, (<span class="id">t</span>, <span class="id">b</span>))) <span class="id">unl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">lasts</span> := <span class="id"><a href="Velus.Lustre.LustreElab.html#lasts_defineds">lasts_defineds</a></span> <span class="id">ablks</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">env</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_decls">elab_decls</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabBlock.tenv">tenv</a></span> <span class="id">lasts</span> <span class="id">loc</span> <span class="id">env</span> <span class="id">locs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">locs</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#annotate">annotate</a></span> <span class="id">env</span>) <span class="id">locs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#check_atom">check_atom</a></span> <span class="id">loc</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">locs</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">blks</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="id">elab_block</span> <span class="id">env</span>) <span class="id">ablks</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">unt</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="kwd">fun</span> '(<span class="id">e</span>, (<span class="id">t</span>, <span class="id">b</span>), <span class="id">loc</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> (<span class="id">t</span>, <span class="id">_</span>) &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_enum">elab_enum</a></span> <span class="id">tenv</span>' <span class="id">loc</span> <span class="id">t</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">e</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_transition_cond">elab_transition_cond</a></span> <span class="id">env</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabBlock.nenv">nenv</a></span> <span class="id">e</span> <span class="id">loc</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id">e</span>, (<span class="id">t</span>, <span class="id">b</span>))) <span class="id">unt</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">caus</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">do</span> <span class="id">cx</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#fresh_ident">fresh_ident</a></span>; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id">x</span>, <span class="id">cx</span>)) (<span class="id"><a href="Velus.Common.Common.html#PSP.to_list">PSP.to_list</a></span> <span class="id">xs</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> ((<span class="id">t</span>, <span class="id">constr</span>), <span class="id"><a href="Velus.Lustre.LustreElab.html#Branch">Branch</a></span> <span class="id">caus</span> (<span class="id">unl</span>, (<span class="kwd">Scope</span> <span class="id">locs</span> (<span class="id">blks</span>, <span class="id">unt</span>))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="id">states</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">type</span> &lt;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#forallb">forallb</a></span> (<span class="kwd">fun</span> '(<span class="id">_</span>, <span class="id"><a href="Velus.Lustre.LustreElab.html#Branch">Branch</a></span> <span class="id">_</span> (<span class="id">unl</span>, <span class="id">_</span>)) =&gt; <span class="id"><a href="Velus.Common.CommonList.html#is_nil">is_nil</a></span> <span class="id">unl</span>) <span class="id">states</span> <span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#Weak">Weak</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="kwd">if</span> <span class="id"><a href="Velus.Common.CommonList.html#is_nil">is_nil</a></span> <span class="id">ini</span> &amp;&amp; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#forallb">forallb</a></span> (<span class="kwd">fun</span> '(<span class="id">_</span>, <span class="id"><a href="Velus.Lustre.LustreElab.html#Branch">Branch</a></span> <span class="id">_</span> (<span class="id">_</span>, <span class="kwd">Scope</span> <span class="id">_</span> (<span class="id">_</span>, <span class="id">unt</span>))) =&gt; <span class="id"><a href="Velus.Common.CommonList.html#is_nil">is_nil</a></span> <span class="id">unt</span>) <span class="id">states</span> <span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#Strong">Strong</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">Strong</span> <span class="id">and</span> <span class="id">Weak</span> <span class="id">transitions</span> <span class="id">cannot</span> <span class="id">be</span> <span class="id">mixed</span> <span class="kwd">in</span> <span class="id">the</span> <span class="id">same</span> <span class="id">state</span>-<span class="id">machine</span>");<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Bauto">Bauto</a></span> <span class="id">type</span> <span class="id">ck</span> (<span class="id">ini</span>, <span class="id">oth</span>) <span class="id">states</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#BSWITCH">BSWITCH</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">loc</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_not_singleton">err_not_singleton</a></span> <span class="id">loc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#BLOCAL">BLOCAL</a></span> <span class="id">locs</span> <span class="id">ablks</span> <span class="id">loc</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">lasts</span> := <span class="id"><a href="Velus.Lustre.LustreElab.html#lasts_defineds">lasts_defineds</a></span> <span class="id">ablks</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">env</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_decls">elab_decls</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabBlock.tenv">tenv</a></span> <span class="id">lasts</span> <span class="id">loc</span> <span class="id">env</span> <span class="id">locs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">locs</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#annotate">annotate</a></span> <span class="id">env</span>) <span class="id">locs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#check_atom">check_atom</a></span> <span class="id">loc</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">locs</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">blks</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="id">elab_block</span> <span class="id">env</span>) <span class="id">ablks</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Blocal">Blocal</a></span> (<span class="kwd">Scope</span> <span class="id">locs</span> <span class="id">blks</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabBlock">ElabBlock</a></span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="ElabDeclaration">ElabDeclaration</a></span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id"><a name="ElabDeclaration.tenv">tenv</a></span>: <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>).<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id"><a name="ElabDeclaration.extenv">extenv</a></span>: <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.ctype">ctype</a></span> * <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.ctype">ctype</a></span>).<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id"><a name="ElabDeclaration.nenv">nenv</a></span> : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.clock">clock</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.clock">clock</a></span>))).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="nameset">nameset</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} <span class="id">s</span> (<span class="id">xs</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * <span class="id">A</span>)) : <span class="id"><a href="Velus.Common.Common.html#PS.t">PS.t</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#fold_left">List.fold_left</a></span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">x</span> =&gt; <span class="id"><a href="Velus.Common.Common.html#PS.add">PS.add</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">x</span>) <span class="id">acc</span>) <span class="id">xs</span> <span class="id">s</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="nameset_spec">nameset_spec</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>: <span class="kwd">Type</span>} <span class="id">x</span> (<span class="id">xs</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * <span class="id">A</span>)) <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.Common.html#PS.In">PS.In</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#nameset">nameset</a></span> <span class="id">s</span> <span class="id">xs</span>) &lt;-&gt; <span class="id"><a href="Velus.Common.Common.html#PS.In">PS.In</a></span> <span class="id">x</span> <span class="id">s</span> \/ <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">xs</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof9')">Proof.</span></div>
<div class="proofscript" id="proof9">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">xs</span> <span class="kwd">as</span> [|<span class="id">yv</span> <span class="id">xs</span> <span class="id">IH</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">yv</span> <span class="kwd">as</span> (<span class="id">y</span> &amp; <span class="id">v</span>); <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; <span class="id">intro</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">apply</span> <span class="id">IH</span> <span class="kwd">in</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">HH</span> <span class="kwd">as</span> [<span class="id">HH</span>|]; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#PSP.FM.add_iff">PSP.FM.add_iff</a></span> <span class="kwd">in</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">apply</span> <span class="id">IH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#PSP.FM.add_iff">PSP.FM.add_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intuition</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="find_dup">find_dup</a></span> (<span class="id">xs</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">xs</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">x</span>::<span class="id">xs</span> =&gt; <span class="kwd">if</span> <span class="id"><a href="Velus.Common.Common.html#mem_ident">mem_ident</a></span> <span class="id">x</span> <span class="id">xs</span> <span class="kwd">then</span> <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">find_dup</span> <span class="id">xs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="check_nodup">check_nodup</a></span> <span class="id">loc</span> (<span class="id">xs</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Velus.Common.Common.html#check_nodup">check_nodup</a></span> <span class="id">xs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "<span class="id">Duplicate</span> <span class="id">declaration</span> <span class="id">of</span> " :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#find_dup">find_dup</a></span> <span class="id">xs</span>) :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "").<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="check_nodup_spec">check_nodup_spec</a></span> : <span class="kwd">forall</span> <span class="id">loc</span> <span class="id">xs</span> <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#check_nodup">check_nodup</a></span> <span class="id">loc</span> <span class="id">xs</span> <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">xs</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof10')">Proof.</span></div>
<div class="proofscript" id="proof10">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hcheck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_nodup">check_nodup</a></span> <span class="kwd">in</span> <span class="id">Hcheck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="Velus.Common.Common.html#check_nodup">Common.check_nodup</a></span> <span class="id">_</span>) <span class="id">eqn</span>:<span class="id">Hndup</span>. 2:<span class="id">inv</span> <span class="id">Hcheck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.Common.html#check_nodup_correct">check_nodup_correct</a></span> <span class="kwd">in</span> <span class="id">Hndup</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="check_nointersect">check_nointersect</a></span> <span class="id">loc</span> (<span class="id">xs1</span> <span class="id">xs2</span> : <span class="id"><a href="Velus.Common.Common.html#PS.t">PS.t</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Velus.Common.Common.html#PS.for_all">PS.for_all</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#negb">negb</a></span> (<span class="id"><a href="Velus.Common.Common.html#PS.mem">PS.mem</a></span> <span class="id">x</span> <span class="id">xs2</span>)) <span class="id">xs1</span> <span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">Duplicate</span> <span class="id">local</span> <span class="id">var</span>").<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="check_nointersect_spec">check_nointersect_spec</a></span> : <span class="kwd">forall</span> <span class="id">loc</span> <span class="id">xs1</span> <span class="id">xs2</span> <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#check_nointersect">check_nointersect</a></span> <span class="id">loc</span> <span class="id">xs1</span> <span class="id">xs2</span> <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="Velus.Common.Common.html#PS.In">PS.In</a></span> <span class="id">x</span> <span class="id">xs1</span> -&gt; ~<span class="id"><a href="Velus.Common.Common.html#PS.In">PS.In</a></span> <span class="id">x</span> <span class="id">xs2</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof11')">Proof.</span></div>
<div class="proofscript" id="proof11">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hcheck</span>. <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_nointersect">check_nointersect</a></span> <span class="kwd">in</span> <span class="id">Hcheck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id">Hf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.Common.html#PS.for_all_spec">PS.for_all_spec</a></span> <span class="kwd">in</span> <span class="id">Hf</span>. 2:<span class="id">intros</span> ?? <span class="id">Heq</span>; <span class="id">now</span> <span class="id">rewrite</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> ? <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">Hf</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html#negb_true_iff">Bool.negb_true_iff</a></span>, <span class="id"><a href="Velus.Common.Common.html#PSE.mem_4">PSE.mem_4</a></span> <span class="kwd">in</span> <span class="id">Hin</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="check_nodupscope">check_nodupscope</a></span> {<span class="id">A</span> <span class="id">B</span>} (<span class="id">f_nd</span>: <span class="id">_</span> -&gt; <span class="id">_</span> -&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id">B</span>) <span class="id">loc</span> (<span class="id">env</span> : <span class="id"><a href="Velus.Common.Common.html#PS.t">PS.t</a></span>) (<span class="id">s</span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#scope">scope</a></span> <span class="id">A</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '<span class="kwd">Scope</span> <span class="id">locs</span> <span class="id">blk</span> := <span class="id">s</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#check_nodup">check_nodup</a></span> <span class="id">loc</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">locs</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">locsanon</span> := <span class="id"><a href="Velus.Lustre.LustreElab.html#nameset">nameset</a></span> <span class="id"><a href="Velus.Common.Common.html#PS.empty">PS.empty</a></span> <span class="id">locs</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#check_nointersect">check_nointersect</a></span> <span class="id">loc</span> <span class="id">env</span> <span class="id">locsanon</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id">f_nd</span> (<span class="id"><a href="Velus.Common.Common.html#PS.union">PS.union</a></span> <span class="id">env</span> <span class="id">locsanon</span>) <span class="id">blk</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="check_nodupbranch">check_nodupbranch</a></span> {<span class="id">A</span> <span class="id">B</span>} (<span class="id">f_nd</span>: <span class="id">_</span> -&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id">B</span>) <span class="id">loc</span> (<span class="id">s</span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#branch">branch</a></span> <span class="id">A</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '<span class="id"><a href="Velus.Lustre.LustreElab.html#Branch">Branch</a></span> <span class="id">caus</span> <span class="id">blk</span> := <span class="id">s</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#check_nodup">check_nodup</a></span> <span class="id">loc</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">caus</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id">f_nd</span> <span class="id">blk</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="check_noduplocals">check_noduplocals</a></span> <span class="id">loc</span> (<span class="id">env</span> : <span class="id"><a href="Velus.Common.Common.html#PS.t">PS.t</a></span>) (<span class="id">blk</span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#block">block</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">blk</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Beq">Beq</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Blast">Blast</a></span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Breset">Breset</a></span> <span class="id">blks</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="id">check_noduplocals</span> <span class="id">loc</span> <span class="id">env</span>) <span class="id">blks</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Bswitch">Bswitch</a></span> <span class="id">_</span> <span class="id">branches</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="kwd">fun</span> '(<span class="id">_</span>, <span class="id">s</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#check_nodupbranch">check_nodupbranch</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="id">check_noduplocals</span> <span class="id">loc</span> <span class="id">env</span>)) <span class="id">loc</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">branches</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Bauto">Bauto</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">states</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="kwd">fun</span> '(<span class="id">_</span>, <span class="id">br</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#check_nodupbranch">check_nodupbranch</a></span> (<span class="kwd">fun</span> '(<span class="id">_</span>, <span class="id">s</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#check_nodupscope">check_nodupscope</a></span> (<span class="kwd">fun</span> <span class="id">env</span> '(<span class="id">blks</span>, <span class="id">_</span>) =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="id">check_noduplocals</span> <span class="id">loc</span> <span class="id">env</span>) <span class="id">blks</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">loc</span> <span class="id">env</span> <span class="id">s</span>) <span class="id">loc</span> <span class="id">br</span>) <span class="id">states</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Blocal">Blocal</a></span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#check_nodupscope">check_nodupscope</a></span> (<span class="kwd">fun</span> <span class="id">env</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="id">check_noduplocals</span> <span class="id">loc</span> <span class="id">env</span>)) <span class="id">loc</span> <span class="id">env</span> <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="check_nodupscope_spec">check_nodupscope_spec</a></span> {<span class="id">A</span> <span class="id">B</span>} (<span class="id">f_nd</span> : <span class="id">_</span> -&gt; <span class="id">_</span> -&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id">B</span>) (<span class="id">P_nd</span>: <span class="id">_</span> -&gt; <span class="id">_</span> -&gt; <span class="kwd">Prop</span>) : <span class="kwd">forall</span> <span class="id">env</span> <span class="id">xs</span> <span class="id">loc</span> <span class="id">locs</span> (<span class="id">blk</span>: <span class="id">A</span>) <span class="id">st</span> <span class="id">res</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> <span class="id">xs</span> -&gt; <span class="id"><a href="Velus.Common.Common.html#PS.In">PS.In</a></span> <span class="id">x</span> <span class="id">env</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#check_nodupscope">check_nodupscope</a></span> <span class="id">f_nd</span> <span class="id">loc</span> <span class="id">env</span> (<span class="kwd">Scope</span> <span class="id">locs</span> <span class="id">blk</span>) <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> <span class="id">res</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">xs</span> <span class="id">env</span> <span class="id">st</span> <span class="id">res</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> <span class="id">xs</span> -&gt; <span class="id"><a href="Velus.Common.Common.html#PS.In">PS.In</a></span> <span class="id">x</span> <span class="id">env</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f_nd</span> <span class="id">env</span> <span class="id">blk</span> <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> <span class="id">res</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P_nd</span> <span class="id">xs</span> <span class="id">blk</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#NoDupScope">NoDupScope</a></span> <span class="id">P_nd</span> <span class="id">xs</span> (<span class="kwd">Scope</span> <span class="id">locs</span> <span class="id">blk</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof12')">Proof.</span></div>
<div class="proofscript" id="proof12">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Henv</span> <span class="id">Hc</span>; <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hbind0</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hin</span>. <span class="id">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#PS.union_spec">PS.union_spec</a></span>, <span class="id"><a href="Velus.Lustre.LustreElab.html#nameset_spec">nameset_spec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span> <span class="kwd">in</span> <span class="id">Hin</span>. <span class="id">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [?|?]; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> <span class="id">x</span>. <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_nodup_spec">check_nodup_spec</a></span> <span class="kwd">in</span> <span class="id">Hbind</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#fst_NoDupMembers">fst_NoDupMembers</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span> ? <span class="id">Hin1</span> <span class="id">Hin2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">x1</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_nointersect_spec">check_nointersect_spec</a></span> <span class="kwd">in</span> <span class="id">Hbind1</span>. 2:<span class="id">eapply</span> <span class="id">Henv</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">Hbind1</span>. <span class="id">repeat</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#nameset_spec">nameset_spec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#fst_InMembers">fst_InMembers</a></span> <span class="kwd">in</span> <span class="id">Hin1</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="check_nodupbranch_spec">check_nodupbranch_spec</a></span> {<span class="id">A</span> <span class="id">B</span>} (<span class="id">f_nd</span> : <span class="id">_</span> -&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id">B</span>) (<span class="id">P_nd</span>: <span class="id">_</span> -&gt; <span class="kwd">Prop</span>) : <span class="kwd">forall</span> <span class="id">env</span> <span class="id">xs</span> <span class="id">loc</span> <span class="id">locs</span> (<span class="id">blk</span>: <span class="id">A</span>) <span class="id">st</span> <span class="id">res</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> <span class="id">xs</span> -&gt; <span class="id"><a href="Velus.Common.Common.html#PS.In">PS.In</a></span> <span class="id">x</span> <span class="id">env</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#check_nodupbranch">check_nodupbranch</a></span> <span class="id">f_nd</span> <span class="id">loc</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Branch">Branch</a></span> <span class="id">locs</span> <span class="id">blk</span>) <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> <span class="id">res</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">st</span> <span class="id">res</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f_nd</span> <span class="id">blk</span> <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> <span class="id">res</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P_nd</span> <span class="id">blk</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#NoDupBranch">NoDupBranch</a></span> <span class="id">P_nd</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Branch">Branch</a></span> <span class="id">locs</span> <span class="id">blk</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof13')">Proof.</span></div>
<div class="proofscript" id="proof13">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Henv</span> <span class="id">Hc</span>; <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hbind1</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> <span class="id">x</span>. <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_nodup_spec">check_nodup_spec</a></span> <span class="kwd">in</span> <span class="id">Hbind</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#fst_NoDupMembers">fst_NoDupMembers</a></span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="check_noduplocals_spec">check_noduplocals_spec</a></span> <span class="id">loc</span> : <span class="kwd">forall</span> <span class="id">blk</span> <span class="id">xs</span> <span class="id">env</span> <span class="id">st</span> <span class="id">res</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> <span class="id">xs</span> -&gt; <span class="id"><a href="Velus.Common.Common.html#PS.In">PS.In</a></span> <span class="id">x</span> <span class="id">env</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#check_noduplocals">check_noduplocals</a></span> <span class="id">loc</span> <span class="id">env</span> <span class="id">blk</span> <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> <span class="id">res</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#NoDupLocals">NoDupLocals</a></span> <span class="id">xs</span> <span class="id">blk</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof14')">Proof.</span></div>
<div class="proofscript" id="proof14">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Opaque</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_nodupscope">check_nodupscope</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">blk</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#block_ind2">block_ind2</a></span>; <span class="id">intros</span> * <span class="id">Henv</span> <span class="id">Hc</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;equation&nbsp;*)</span> <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;last&nbsp;*)</span> <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;reset&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore2">Forall2_ignore2</a></span> <span class="kwd">in</span> <span class="id">Hbind</span>. <span class="id">simpl_Forall</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;switch&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore2">Forall2_ignore2</a></span> <span class="kwd">in</span> <span class="id">Hbind</span>. <span class="id">simpl_Forall</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">b</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_nodupbranch_spec">check_nodupbranch_spec</a></span>; <span class="id">eauto</span>. <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">res</span>. <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore2">Forall2_ignore2</a></span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">simpl_Forall</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;automaton&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore2">Forall2_ignore2</a></span> <span class="kwd">in</span> <span class="id">Hbind</span>. <span class="id">simpl_Forall</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">b</span> <span class="kwd">as</span> [?(?&amp;[?(?&amp;?)])]. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_nodupbranch_spec">check_nodupbranch_spec</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_nodupscope_spec">check_nodupscope_spec</a></span>; <span class="id">eauto</span>. <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">res0</span>. <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore2">Forall2_ignore2</a></span> <span class="kwd">in</span> <span class="id">H5</span>. <span class="id">simpl_Forall</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;local&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_nodupscope_spec">check_nodupscope_spec</a></span>; <span class="id">eauto</span>. <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">res0</span>. <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore2">Forall2_ignore2</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">simpl_Forall</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
<h3> VarsDefined </h3>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="msg_of_missing_variables">msg_of_missing_variables</a></span> (<span class="id">exp</span> <span class="id">def</span> : <span class="id"><a href="Velus.Common.Common.html#PS.t">PS.t</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> (<span class="id"><a href="Velus.Common.Common.html#PS.elements">PS.elements</a></span> (<span class="id"><a href="Velus.Common.Common.html#PS.diff">PS.diff</a></span> <span class="id">exp</span> <span class="id">def</span>)) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">x</span>::<span class="id">_</span> =&gt; (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">x</span> :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> " <span class="id">is</span> <span class="id">not</span> <span class="id">defined</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="kwd">match</span> (<span class="id"><a href="Velus.Common.Common.html#PS.elements">PS.elements</a></span> (<span class="id"><a href="Velus.Common.Common.html#PS.diff">PS.diff</a></span> <span class="id">def</span> <span class="id">exp</span>)) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">x</span>::<span class="id">_</span> =&gt; (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">x</span> :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> " <span class="id">shouldn</span>'<span class="id">t</span> <span class="id">be</span> <span class="id">defined</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">Missing</span> <span class="id">or</span> <span class="id">too</span> <span class="id">many</span> <span class="id">variables</span> <span class="id">defined</span>"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="check_defined_vars">check_defined_vars</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">exp</span> <span class="id">def</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Velus.Common.Common.html#check_nodup">Common.check_nodup</a></span> <span class="id">def</span> <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">exp</span> := <span class="id"><a href="Velus.Common.CommonPS.html#ps_from_list">ps_from_list</a></span> <span class="id">exp</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">def</span> := <span class="id"><a href="Velus.Common.CommonPS.html#ps_from_list">ps_from_list</a></span> <span class="id">def</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Velus.Common.Common.html#PS.equal">PS.equal</a></span> <span class="id">exp</span> <span class="id">def</span> <span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#msg_of_missing_variables">msg_of_missing_variables</a></span> <span class="id">exp</span> <span class="id">def</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "<span class="id">Duplicate</span> <span class="id">definition</span> <span class="id">of</span> " :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#find_dup">find_dup</a></span> <span class="id">def</span>) :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "").<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="check_defined_vars_spec">check_defined_vars_spec</a></span> <span class="id">loc</span> : <span class="kwd">forall</span> <span class="id">exp</span> <span class="id">def</span> <span class="id">st</span> <span class="id">res</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">exp</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_vars">check_defined_vars</a></span> <span class="id">loc</span> <span class="id">exp</span> <span class="id">def</span> <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> <span class="id">res</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation">Permutation</a></span> <span class="id">exp</span> <span class="id">def</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof15')">Proof.</span></div>
<div class="proofscript" id="proof15">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_vars">check_defined_vars</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hnd</span> <span class="id">Hc</span>. <span class="id">cases_eqn</span> <span class="id">Heq</span>; <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.Common.html#check_nodup_correct">check_nodup_correct</a></span> <span class="kwd">in</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.Common.html#PSF.equal_2">PSF.equal_2</a></span>, <span class="id"><a href="Velus.Common.CommonPS.html#PS_elements_Equal">PS_elements_Equal</a></span> <span class="kwd">in</span> <span class="id">Heq0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Common.CommonPS.html#ps_from_list">ps_from_list</a></span> <span class="kwd">in</span> <span class="id">Heq0</span>. <span class="id">rewrite</span> 2 <span class="id"><a href="Velus.Common.CommonPS.html#Permutation_PS_elements_ps_adds">Permutation_PS_elements_ps_adds</a></span> <span class="kwd">in</span> <span class="id">Heq0</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2,3:<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>; <span class="id">intros</span>; <span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonPS.html#not_In_empty">not_In_empty</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#PSP.elements_empty">PSP.elements_empty</a></span>, 2 <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span> <span class="kwd">in</span> <span class="id">Heq0</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="check_defined_local">check_defined_local</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">locals</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) (<span class="id">xs</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">locals</span>', <span class="id">ys</span>) := <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#partition">partition</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#existsb">existsb</a></span> (<span class="id"><a href="Velus.Common.Common.html#ident_eqb">ident_eqb</a></span> <span class="id">x</span>) <span class="id">locals</span>) <span class="id">xs</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_vars">check_defined_vars</a></span> <span class="id">loc</span> <span class="id">locals</span> <span class="id">locals</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id">ys</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="check_defined_local_spec">check_defined_local_spec</a></span> <span class="id">loc</span> : <span class="kwd">forall</span> <span class="id">locals</span> <span class="id">xs</span> <span class="id">ys</span> <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">locals</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_local">check_defined_local</a></span> <span class="id">loc</span> <span class="id">locals</span> <span class="id">xs</span> <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id">ys</span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation">Permutation</a></span> (<span class="id">locals</span> ++ <span class="id">ys</span>) <span class="id">xs</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof16')">Proof.</span></div>
<div class="proofscript" id="proof16">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hnd2</span> <span class="id">Hc</span>. <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_local">check_defined_local</a></span> <span class="kwd">in</span> <span class="id">Hc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id">Hf</span>; <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#partition_Partition">partition_Partition</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Partition_Permutation">Partition_Permutation</a></span> <span class="kwd">in</span> <span class="id">Hf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_vars_spec">check_defined_vars_spec</a></span> <span class="kwd">in</span> <span class="id">Hbind</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> <span class="id">Hf</span>, <span class="id">Hbind</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="check_incl">check_incl</a></span> <span class="id">loc</span> <span class="id">xs</span> <span class="id">ys</span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ys</span> := <span class="id"><a href="Velus.Common.CommonPS.html#ps_from_list">ps_from_list</a></span> <span class="id">ys</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#forallb">forallb</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="Velus.Common.Common.html#PS.mem">PS.mem</a></span> <span class="id">x</span> <span class="id">ys</span>) <span class="id">xs</span> <span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#msg_of_missing_variables">msg_of_missing_variables</a></span> <span class="id">ys</span> (<span class="id"><a href="Velus.Common.CommonPS.html#ps_from_list">ps_from_list</a></span> <span class="id">xs</span>)).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="check_incl_spec">check_incl_spec</a></span> <span class="id">loc</span> : <span class="kwd">forall</span> <span class="id">xs</span> <span class="id">ys</span> <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#check_incl">check_incl</a></span> <span class="id">loc</span> <span class="id">xs</span> <span class="id">ys</span> <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> <span class="id">xs</span> <span class="id">ys</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof17')">Proof.</span></div>
<div class="proofscript" id="proof17">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_incl">check_incl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hc</span>; <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">cases_eqn</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Eq">Eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#forallb_Forall">forallb_Forall</a></span> <span class="kwd">in</span> <span class="id">Eq</span>. <span class="id">intros</span> ??; <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.Common.html#PSF.mem_2">PSF.mem_2</a></span>, <span class="id"><a href="Velus.Common.CommonPS.html#ps_from_list_In">ps_from_list_In</a></span> <span class="kwd">in</span> <span class="id">Eq</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="check_defined_scope">check_defined_scope</a></span> {<span class="id">A</span>} <span class="id">f_nd</span> <span class="id">loc</span> ( : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>) (<span class="id">s</span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#scope">scope</a></span> <span class="id">A</span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '<span class="kwd">Scope</span> <span class="id">locs</span> <span class="id">blk</span> := <span class="id">s</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">xs</span> &lt;- <span class="id">f_nd</span> (<span class="id">Env.adds</span>' (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, (<span class="id">_</span>, <span class="id">_</span>, <span class="id">_</span>, <span class="id">o</span>)) =&gt; (<span class="id">x</span>, <span class="id"><a href="Velus.Common.Common.html#isSome">isSome</a></span> <span class="id">o</span>)) <span class="id">locs</span>) ) <span class="id">blk</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">xs</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_local">check_defined_local</a></span> <span class="id">loc</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">locs</span>) <span class="id">xs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id">xs</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="check_defined_branch">check_defined_branch</a></span> {<span class="id">A</span>} <span class="id">f_nd</span> <span class="id">loc</span> ( : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>) (<span class="id">s</span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#branch">branch</a></span> <span class="id">A</span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '<span class="id"><a href="Velus.Lustre.LustreElab.html#Branch">Branch</a></span> <span class="id">caus</span> <span class="id">blk</span> := <span class="id">s</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">xs</span> &lt;- <span class="id">f_nd</span> <span class="id">blk</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#check_nodup">check_nodup</a></span> <span class="id">loc</span> <span class="id">xs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id">xs</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="check_defined_branches">check_defined_branches</a></span> {<span class="id">E</span> <span class="id">A</span>} <span class="id">f_nd</span> <span class="id">loc</span> ( : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>) (<span class="id">brs</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id">E</span> * <span class="id"><a href="Velus.Lustre.LustreElab.html#branch">branch</a></span> <span class="id">A</span>)) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Velus.Common.CommonList.html#is_nil">is_nil</a></span> <span class="id">brs</span> <span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">there</span> <span class="id">should</span> <span class="id">be</span> <span class="kwd">at</span> <span class="id">least</span> <span class="id">one</span> <span class="id">branch</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">defs</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="kwd">fun</span> '(<span class="id">_</span>, <span class="id">blks</span>) =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_branch">check_defined_branch</a></span> <span class="id">f_nd</span> <span class="id">loc</span>  <span class="id">blks</span>) <span class="id">brs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">defs</span>' := <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="Velus.Common.Common.html#PSP.of_list">PSP.of_list</a></span> <span class="id">defs</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">all_defs</span> := <span class="id"><a href="Velus.Common.Common.html#PSP.to_list">PSP.to_list</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PSUnion">PSUnion</a></span> <span class="id">defs</span>') <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="kwd">fun</span> '(<span class="id">_</span>, <span class="id"><a href="Velus.Lustre.LustreElab.html#Branch">Branch</a></span> <span class="id">caus</span> <span class="id">_</span>) =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#check_incl">check_incl</a></span> <span class="id">loc</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">caus</span>) <span class="id">all_defs</span>) <span class="id">brs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="kwd">fun</span> <span class="id">defs</span> =&gt; <span class="kwd">if</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#negb">negb</a></span> (<span class="id"><a href="Velus.Common.Common.html#PS.mem">PS.mem</a></span> <span class="id">x</span> <span class="id">defs</span>) &amp;&amp; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#negb">negb</a></span> (<span class="id"><a href="Velus.Common.Common.html#or_default">or_default</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> (<span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> ))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">x</span> :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> " <span class="id">should</span> <span class="id">be</span> <span class="id">declared</span> <span class="kwd">with</span> <span class="id">last</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span>) <span class="id">defs</span>') <span class="id">all_defs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id">all_defs</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="check_defined_block">check_defined_block</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) ( : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>) (<span class="id">blk</span>: <span class="id"><a href="Velus.Lustre.LustreElab.html#block">block</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">blk</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Beq">Beq</a></span> (<span class="id">xs</span>, <span class="id">_</span>) =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id">xs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Blast">Blast</a></span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> []<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Breset">Breset</a></span> <span class="id">blks</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">xs</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="id">check_defined_block</span> <span class="id">loc</span> ) <span class="id">blks</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">xs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Bswitch">Bswitch</a></span> <span class="id">_</span> <span class="id">brs</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">xs</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_branches">check_defined_branches</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">blks</span> =&gt; <span class="id">do</span> <span class="id">xs</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="id">check_defined_block</span> <span class="id">loc</span> ) <span class="id">blks</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">xs</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">loc</span>  <span class="id">brs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id">xs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Bauto">Bauto</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">sts</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">xs</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_branches">check_defined_branches</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> '(<span class="id">_</span>, <span class="id">s</span>) =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_scope">check_defined_scope</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span>  '(<span class="id">blks</span>, <span class="id">_</span>) =&gt; <span class="id">do</span> <span class="id">xs</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="id">check_defined_block</span> <span class="id">loc</span> ) <span class="id">blks</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">xs</span>)) <span class="id">loc</span>  <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">loc</span>  <span class="id">sts</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id">xs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Blocal">Blocal</a></span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_scope">check_defined_scope</a></span> (<span class="kwd">fun</span>  <span class="id">blks</span> =&gt; <span class="id">do</span> <span class="id">xs</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="id">check_defined_block</span> <span class="id">loc</span> ) <span class="id">blks</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">xs</span>)) <span class="id">loc</span>  <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="IsVar_IsLast_incl">IsVar_IsLast_incl</a></span> : <span class="kwd">forall</span> <span class="id">env</span>  ',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span>  -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> '  -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> <span class="id">env</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt; <span class="id"><a href="Velus.Instantiator.html#L.Senv.IsVar">IsVar</a></span>  <span class="id">x</span> -&gt; <span class="id"><a href="Velus.Instantiator.html#L.Senv.IsLast">IsLast</a></span>  <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> <span class="id">env</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt; <span class="id"><a href="Velus.Instantiator.html#L.Senv.IsVar">IsVar</a></span> ' <span class="id">x</span> -&gt; <span class="id"><a href="Velus.Instantiator.html#L.Senv.IsLast">IsLast</a></span> ' <span class="id">x</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof18')">Proof.</span></div>
<div class="proofscript" id="proof18">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">ND</span> <span class="id">Incl</span> <span class="id">Last</span> * <span class="id">Find</span> <span class="id">Var</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Instantiator.html#L.Senv.IsVar_incl">IsVar_incl</a></span> <span class="kwd">in</span> <span class="id">Var</span>' <span class="kwd">as</span> <span class="id">Var</span>; [|<span class="id">eauto</span>]. <span class="id">eapply</span> <span class="id">Last</span> <span class="kwd">in</span> <span class="id">Var</span>; [|<span class="id">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Var</span>. <span class="id">inv</span> <span class="id">Var</span>'. <span class="id">simpl_In</span>. <span class="id">econstructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">Incl</span>, <span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers_det">NoDupMembers_det</a></span> <span class="kwd">in</span> <span class="id">Hin</span>. 3:<span class="id">eapply</span> <span class="id">H</span>. <span class="id">all</span>:<span class="id">subst</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="check_defined_is_defined">check_defined_is_defined</a></span> : <span class="kwd">forall</span> <span class="id">blk</span> <span class="id">loc</span> <span class="id">env</span> <span class="id">xs</span> <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_block">check_defined_block</a></span> <span class="id">loc</span> <span class="id">env</span> <span class="id">blk</span> <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id">xs</span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> <span class="id">xs</span> -&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#Is_defined_in">Is_defined_in</a></span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#Var">FunctionalEnvironment.Var</a></span> <span class="id">x</span>) <span class="id">blk</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof19')">Proof.</span></div>
<div class="proofscript" id="proof19">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">blk</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#block_ind2">block_ind2</a></span>; <span class="id">intros</span> * <span class="id">C</span> * <span class="id">In</span>; <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;equation&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">eq</span>. <span class="id">repeat</span> <span class="id">monadInv</span>. <span class="id">now</span> <span class="id">constructor</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;last&nbsp;*)</span> <span class="id">inv</span> <span class="id">In</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;reset&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_concat">in_concat</a></span> <span class="kwd">in</span> <span class="id">In</span> <span class="kwd">as</span> (?&amp;<span class="id">In1</span>&amp;<span class="id">In2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore1">Forall2_ignore1</a></span> <span class="kwd">in</span> <span class="id">Hbind</span>. <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="id">solve_Exists</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;switch&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_branches">check_defined_branches</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>. <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonPS.html#In_PS_elements">In_PS_elements</a></span>, <span class="id"><a href="Velus.Common.CommonPS.html#PSUnion_In_In">PSUnion_In_In</a></span> <span class="kwd">in</span> <span class="id">In</span> <span class="kwd">as</span> (?&amp;<span class="id">In1</span>&amp;<span class="id">In2</span>). <span class="id">simpl_In</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.Common.html#In_of_list">In_of_list</a></span> <span class="kwd">in</span> <span class="id">In2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore1">Forall2_ignore1</a></span> <span class="kwd">in</span> <span class="id">Hbind0</span>. <span class="id">simpl_Forall</span>. <span class="id">destruct</span> <span class="id">b</span>; <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_concat">in_concat</a></span> <span class="kwd">in</span> <span class="id">In2</span> <span class="kwd">as</span> (?&amp;<span class="id">In1</span>&amp;<span class="id">In2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore1">Forall2_ignore1</a></span> <span class="kwd">in</span> <span class="id">Hbind2</span>. <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="id">solve_Exists</span>. <span class="id">constructor</span>. <span class="id">solve_Exists</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;automaton&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_branches">check_defined_branches</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>. <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonPS.html#In_PS_elements">In_PS_elements</a></span>, <span class="id"><a href="Velus.Common.CommonPS.html#PSUnion_In_In">PSUnion_In_In</a></span> <span class="kwd">in</span> <span class="id">In</span> <span class="kwd">as</span> (?&amp;<span class="id">In1</span>&amp;<span class="id">In2</span>). <span class="id">simpl_In</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.Common.html#In_of_list">In_of_list</a></span> <span class="kwd">in</span> <span class="id">In2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore1">Forall2_ignore1</a></span> <span class="kwd">in</span> <span class="id">Hbind0</span>. <span class="id">simpl_Forall</span>. <span class="id">destruct</span> <span class="id">b</span> <span class="kwd">as</span> [?(?&amp;[?(?&amp;?)])]; <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_local">check_defined_local</a></span> <span class="kwd">in</span> *. <span class="id">cases_eqn</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Eq">Eq</a></span>. <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">In3</span>:=<span class="id">In2</span>). <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#or_intror">or_intror</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#elements_in_partition">elements_in_partition</a></span> <span class="kwd">in</span> <span class="id">In2</span>; [|<span class="id">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_concat">in_concat</a></span> <span class="kwd">in</span> <span class="id">In2</span> <span class="kwd">as</span> (?&amp;<span class="id">In1</span>&amp;<span class="id">In2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore1">Forall2_ignore1</a></span> <span class="kwd">in</span> <span class="id">Hbind4</span>. <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="id">solve_Exists</span>. <span class="id">do</span> 2 <span class="id">constructor</span>. <span class="id">solve_Exists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">contra</span>. <span class="id">simpl_In</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#partition_Partition">partition_Partition</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Partition_Forall2">Partition_Forall2</a></span> <span class="kwd">in</span> <span class="id">Eq</span>. <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html#not_true_iff_false">Bool.not_true_iff_false</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#existsb_Forall">existsb_Forall</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#forallb_Forall">forallb_Forall</a></span> <span class="kwd">in</span> <span class="id">Eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>. <span class="id">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#ident_eqb_refl">ident_eqb_refl</a></span> <span class="kwd">in</span> <span class="id">Eq</span>. <span class="id">inv</span> <span class="id">Eq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;scope&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_local">check_defined_local</a></span> <span class="kwd">in</span> *. <span class="id">cases_eqn</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Eq">Eq</a></span>. <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">In2</span>:=<span class="id">In</span>). <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#or_intror">or_intror</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#elements_in_partition">elements_in_partition</a></span> <span class="kwd">in</span> <span class="id">In2</span>; [|<span class="id">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_concat">in_concat</a></span> <span class="kwd">in</span> <span class="id">In2</span> <span class="kwd">as</span> (?&amp;<span class="id">In1</span>&amp;<span class="id">In2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore1">Forall2_ignore1</a></span> <span class="kwd">in</span> <span class="id">Hbind0</span>. <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> 2 <span class="id">constructor</span>. <span class="id">solve_Exists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">contra</span>. <span class="id">simpl_In</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#partition_Partition">partition_Partition</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Partition_Forall2">Partition_Forall2</a></span> <span class="kwd">in</span> <span class="id">Eq</span>. <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html#not_true_iff_false">Bool.not_true_iff_false</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#existsb_Forall">existsb_Forall</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#forallb_Forall">forallb_Forall</a></span> <span class="kwd">in</span> <span class="id">Eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>. <span class="id">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#ident_eqb_refl">ident_eqb_refl</a></span> <span class="kwd">in</span> <span class="id">Eq</span>. <span class="id">inv</span> <span class="id">Eq</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="check_defined_scope_spec">check_defined_scope_spec</a></span> {<span class="id">A</span>} <span class="id">f_nd</span> <span class="id">P_nd</span> (<span class="id">P_vd</span>: <span class="id">_</span> -&gt; <span class="id">_</span> -&gt; <span class="kwd">Prop</span>) : <span class="kwd">forall</span> <span class="id">env</span>  <span class="id">loc</span> <span class="id">locs</span> (<span class="id">blk</span>: <span class="id">A</span>) <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span>  -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#NoDupScope">NoDupScope</a></span> <span class="id">P_nd</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> ) (<span class="kwd">Scope</span> <span class="id">locs</span> <span class="id">blk</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#NoDupScope">NoDupScope</a></span> <span class="id">P_nd</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Environment.html#Env.elements">Env.elements</a></span> <span class="id">env</span>)) (<span class="kwd">Scope</span> <span class="id">locs</span> <span class="id">blk</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> <span class="id">env</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt; <span class="id"><a href="Velus.Instantiator.html#L.Senv.IsVar">IsVar</a></span>  <span class="id">x</span> -&gt; <span class="id"><a href="Velus.Instantiator.html#L.Senv.IsLast">IsLast</a></span>  <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_scope">check_defined_scope</a></span> <span class="id">f_nd</span> <span class="id">loc</span> <span class="id">env</span> (<span class="kwd">Scope</span> <span class="id">locs</span> <span class="id">blk</span>) <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> , <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">xs</span> <span class="id">ys</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> <span class="id">xs</span> <span class="id">ys</span> -&gt; <span class="id">P_nd</span> <span class="id">ys</span> <span class="id">blk</span> -&gt; <span class="id">P_nd</span> <span class="id">xs</span> <span class="id">blk</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">xs</span> <span class="id">ys</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation">Permutation</a></span> <span class="id">xs</span> <span class="id">ys</span> -&gt; <span class="id">P_vd</span> <span class="id">blk</span> <span class="id">xs</span> -&gt; <span class="id">P_vd</span> <span class="id">blk</span> <span class="id">ys</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">env</span>' ' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> ' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P_nd</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> ') <span class="id">blk</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P_nd</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Environment.html#Env.elements">Env.elements</a></span> <span class="id">env</span>')) <span class="id">blk</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> <span class="id">env</span>' = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt; <span class="id"><a href="Velus.Instantiator.html#L.Senv.IsVar">IsVar</a></span> ' <span class="id">x</span> -&gt; <span class="id"><a href="Velus.Instantiator.html#L.Senv.IsLast">IsLast</a></span> ' <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f_nd</span> <span class="id">env</span>' <span class="id">blk</span> <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> ', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P_vd</span> <span class="id">blk</span> ') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#VarsDefinedScope">VarsDefinedScope</a></span> <span class="id">P_vd</span> (<span class="kwd">Scope</span> <span class="id">locs</span> <span class="id">blk</span>) .<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof20')">Proof.</span></div>
<div class="proofscript" id="proof20">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Nd1</span> <span class="id">Nd2</span> <span class="id">Nd3</span> <span class="id">Env</span> <span class="id">C</span> <span class="id">Perm1</span> <span class="id">Perm2</span> <span class="id">Ind</span>; <span class="id">inv</span> <span class="id">Nd2</span>; <span class="id">inv</span> <span class="id">Nd3</span>; <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_local_spec">check_defined_local_spec</a></span> <span class="kwd">in</span> <span class="id">Hbind1</span>; [|<span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#fst_NoDupMembers">fst_NoDupMembers</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;-<span class="id"><a href="Velus.Instantiator.html#L.Senv.map_fst_senv_of_decls">map_fst_senv_of_decls</a></span>, &lt;-<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span> <span class="kwd">in</span> <span class="id">Hbind1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">symmetry</span> <span class="kwd">in</span> <span class="id">Hbind1</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_map_inv">Permutation_map_inv</a></span> <span class="kwd">in</span> <span class="id">Hbind1</span> <span class="kwd">as</span> (?&amp;?&amp;<span class="id">Perm</span>); <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">Ind</span> <span class="kwd">in</span> <span class="id">Hbind</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id">Perm2</span>; [|<span class="id">eauto</span>]. <span class="id">now</span> <span class="id">rewrite</span> &lt;-<span class="id">Perm</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_app_comm">Permutation_app_comm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">rewrite</span> &lt;-<span class="id">Perm</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_app_comm">Permutation_app_comm</a></span>. <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#NoDupScope_NoDupMembers">NoDupScope_NoDupMembers</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id">Perm1</span>; [|<span class="id">eapply</span> <span class="id">H1</span>]. <span class="id">now</span> <span class="id">rewrite</span> &lt;-<span class="id">Perm</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>, <span class="id"><a href="Velus.Instantiator.html#L.Senv.map_fst_senv_of_decls">map_fst_senv_of_decls</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_app_comm">Permutation_app_comm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id">Perm1</span>; [|<span class="id">eapply</span> <span class="id">H2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> ? <span class="id">In</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_In</span>. <span class="id">apply</span> <span class="id"><a href="Velus.Environment.html#Env.elements_In">Env.elements_In</a></span>, <span class="id">Env.In_adds_spec</span>' <span class="kwd">in</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">In</span>|<span class="id">In</span>]; <span class="id">clear</span> - <span class="id">In</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>. <span class="id">solve_In</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Velus.Environment.html#Env.In_Members">Env.In_Members</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#fst_InMembers">fst_InMembers</a></span> <span class="kwd">in</span> <span class="id">In</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">intros</span> * <span class="id">Find</span> <span class="id">V</span>. <span class="id">rewrite</span> &lt;-<span class="id">Perm</span>, <span class="id"><a href="Velus.Instantiator.html#L.Senv.IsVar_app">IsVar_app</a></span> <span class="kwd">in</span> <span class="id">V</span>. <span class="id">rewrite</span> &lt;-<span class="id">Perm</span>, <span class="id"><a href="Velus.Instantiator.html#L.Senv.IsLast_app">IsLast_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">Env.find_adds</span>'<span class="id">_In</span> <span class="kwd">in</span> <span class="id">Find</span> <span class="kwd">as</span> [<span class="id">Find</span>|<span class="id">Find</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl_In</span>. <span class="id">destruct</span> <span class="id">o</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>. <span class="id">econstructor</span>. <span class="id">solve_In</span>. <span class="id">simpl</span>. <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> <span class="id">V</span>; <span class="id">auto</span>. <span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Instantiator.html#L.Senv.IsVar_senv_of_decls">IsVar_senv_of_decls</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.elements_correct">Env.elements_correct</a></span> <span class="kwd">in</span> <span class="id">Find</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">H7</span>; <span class="id">eauto</span>. <span class="id">solve_In</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="check_defined_branches_nnil">check_defined_branches_nnil</a></span> {<span class="id">E</span> <span class="id">A</span>} : <span class="kwd">forall</span> <span class="id">f_ch</span> <span class="id">loc</span> <span class="id">env</span> <span class="id">brs</span> <span class="id">xs</span> <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_branches">check_defined_branches</a></span> <span class="id">E</span> <span class="id">A</span> <span class="id">f_ch</span> <span class="id">loc</span> <span class="id">env</span> <span class="id">brs</span> <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id">xs</span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">brs</span> &lt;&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof21')">Proof.</span></div>
<div class="proofscript" id="proof21">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_branches">check_defined_branches</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">C</span> <span class="id">contra</span>; <span class="id">subst</span>. <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">C</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="default_ann">default_ann</a></span> : <span class="id"><a href="Velus.Instantiator.html#L.Senv.annotation">annotation</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Instantiator.html#L.Senv.Build_annotation">Build_annotation</a></span> <span class="id"><a href="Velus.ObcToClight.Interface.html#OpAux.bool_velus_type">OpAux.bool_velus_type</a></span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.Cbase">Cbase</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="check_defined_branches_spec">check_defined_branches_spec</a></span> {<span class="id">E</span> <span class="id">A</span>} <span class="id">f_nd</span> <span class="id">P_nd1</span> <span class="id">P_nd2</span> (<span class="id">P_vd</span>: <span class="id">_</span> -&gt; <span class="id">_</span> -&gt; <span class="kwd">Prop</span>) : <span class="kwd">forall</span> <span class="id">env</span>  <span class="id">loc</span> <span class="id">brs</span> <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span>  -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> '(<span class="id">_</span>, <span class="id">br</span>) =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#NoDupBranch">NoDupBranch</a></span> <span class="id">P_nd1</span> <span class="id">br</span>) <span class="id">brs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> '(<span class="id">_</span>, <span class="id">br</span>) =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#NoDupBranch">NoDupBranch</a></span> <span class="id">P_nd2</span> <span class="id">br</span>) <span class="id">brs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> <span class="id">env</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt; <span class="id"><a href="Velus.Instantiator.html#L.Senv.IsVar">IsVar</a></span>  <span class="id">x</span> -&gt; <span class="id"><a href="Velus.Instantiator.html#L.Senv.IsLast">IsLast</a></span>  <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_branches">check_defined_branches</a></span> <span class="id">E</span> <span class="id">A</span> <span class="id">f_nd</span> <span class="id">loc</span> <span class="id">env</span> <span class="id">brs</span> <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> , <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> '(<span class="id">_</span>, <span class="id"><a href="Velus.Lustre.LustreElab.html#Branch">Branch</a></span> <span class="id">_</span> <span class="id">blk</span>) =&gt; <span class="kwd">forall</span> ' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> '  -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> ' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P_nd1</span> <span class="id">blk</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P_nd2</span> <span class="id">blk</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> <span class="id">env</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt; <span class="id"><a href="Velus.Instantiator.html#L.Senv.IsVar">IsVar</a></span> ' <span class="id">x</span> -&gt; <span class="id"><a href="Velus.Instantiator.html#L.Senv.IsLast">IsLast</a></span> ' <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f_nd</span> <span class="id">blk</span> <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> ', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P_vd</span> <span class="id">blk</span> ') <span class="id">brs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> '(<span class="id">_</span>, <span class="id">br</span>) =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#VarsDefinedBranch">VarsDefinedBranch</a></span> <span class="id">P_vd</span> <span class="id">br</span> ) <span class="id">brs</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof22')">Proof.</span></div>
<div class="proofscript" id="proof22">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_branches">check_defined_branches</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Nd1</span> <span class="id">Nd2</span> <span class="id">Nd3</span> <span class="id">Env</span> <span class="id">C</span> <span class="id">Ind</span>. <span class="id">cases_eqn</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Eq">Eq</a></span>. <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore2">Forall2_ignore2</a></span> <span class="kwd">in</span> <span class="id">Hbind</span>. <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Nd2</span>. <span class="id">inv</span> <span class="id">Nd3</span>. <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> (<span class="id">take</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> <span class="id">and</span> <span class="id">destruct</span> <span class="id">it</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="kwd">exists</span> 1 2, <span class="id">x4</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> 1 /\ <span class="id"><a href="https://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation">Permutation</a></span> (1 ++ 2) ) <span class="kwd">as</span> (1&amp;2&amp;?&amp;<span class="id">Perm</span>); <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="kwd">exists</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; (<span class="id">x</span>, <span class="id"><a href="Velus.Common.Common.html#or_default">or_default</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#default_ann">default_ann</a></span> (<span class="id"><a href="Velus.Common.Common.html#assoc_ident">assoc_ident</a></span> <span class="id">x</span> ))) <span class="id">x4</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#filter">filter</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, <span class="id">_</span>) =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#negb">negb</a></span> (<span class="id"><a href="Velus.Common.Common.html#mem_ident">mem_ident</a></span> <span class="id">x</span> <span class="id">x4</span>)) ). <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_map">map_map</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_id">map_id</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">symmetry</span>. <span class="id">etransitivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Partition_Permutation">Partition_Permutation</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#partition_Partition">partition_Partition</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#surjective_pairing">surjective_pairing</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#fst_partition_filter">fst_partition_filter</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#snd_partition_filter">snd_partition_filter</a></span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_app">Permutation_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id">erewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#filter_ext">filter_ext</a></span>; [<span class="id">reflexivity</span>|<span class="id">instantiate</span> (1:=<span class="kwd">fun</span> '(<span class="id">_</span>, <span class="id">_</span>) =&gt; <span class="id">_</span>); <span class="id">intros</span>; <span class="id">destruct_conjs</span>; <span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Sorting.Permutation.html#NoDup_Permutation">NoDup_Permutation</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#NoDup_filter">NoDup_filter</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers_NoDup">NoDupMembers_NoDup</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Logic.FinFun.html#Injective_map_NoDup">FinFun.Injective_map_NoDup</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_nodup_spec">check_nodup_spec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> ?? <span class="id">EQ</span>; <span class="id">now</span> <span class="id">inv</span> <span class="id">EQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span> *; <span class="id">destruct_conjs</span>. <span class="id">split</span>; <span class="id">intros</span> * <span class="id">In</span>; <span class="id">simpl_In</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">apply</span> <span class="id"><a href="Velus.Common.Common.html#mem_ident_spec">mem_ident_spec</a></span> <span class="kwd">in</span> <span class="id">Hf</span>. <span class="id">do</span> 2 <span class="id">esplit</span>; [|<span class="id">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="Velus.Common.Common.html#assoc_ident_true">assoc_ident_true</a></span>; <span class="id">eauto</span>. <span class="id">simpl</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span>. <span class="id">split</span>; [|<span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="Velus.Common.Common.html#mem_ident_spec">mem_ident_spec</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Common.CommonList.html#InMembers">InMembers</a></span> <span class="id">i</span> ); [|<span class="id">simpl_In</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#fst_InMembers">fst_InMembers</a></span>, &lt;-<span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonPS.html#In_PS_elements">In_PS_elements</a></span>, <span class="id"><a href="Velus.Common.CommonPS.html#In_In_PSUnion">In_In_PSUnion</a></span>; [|<span class="id">solve_In</span>]. <span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="Velus.Common.Common.html#In_of_list">In_of_list</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="Velus.Common.Common.html#assoc_ident_true">assoc_ident_true</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> 1 ) <span class="kwd">as</span> <span class="id">Incl1</span> <span class="kwd">by</span> (<span class="id">rewrite</span> &lt;-<span class="id">Perm</span>; <span class="id">solve_incl_app</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> 2 ) <span class="kwd">as</span> <span class="id">Incl2</span> <span class="kwd">by</span> (<span class="id">rewrite</span> &lt;-<span class="id">Perm</span>; <span class="id">solve_incl_app</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> 1) <span class="kwd">as</span> <span class="id">Nd1</span>' <span class="kwd">by</span> (<span class="id">rewrite</span> &lt;-<span class="id">Perm</span> <span class="kwd">in</span> <span class="id">Nd1</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers_app_l">NoDupMembers_app_l</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">Ind</span> <span class="kwd">with</span> (':=1) <span class="kwd">in</span> <span class="id">Hbind</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#IsVar_IsLast_incl">IsVar_IsLast_incl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">intros</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#IsVar_IsLast_incl">IsVar_IsLast_incl</a></span>. 3,5:<span class="id">eauto</span>. 1-2:<span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore2">Forall2_ignore2</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hbind0</span> <span class="kwd">as</span> (?&amp;<span class="id">_</span>&amp;?&amp;?&amp;<span class="id">Map</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id">rewrite</span> <span class="id">H0</span>; <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl_map">incl_map</a></span>, <span class="id"><a href="Velus.Instantiator.html#L.Senv.IsVar_fst">IsVar_fst</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore2">Forall2_ignore2</a></span> <span class="kwd">in</span> <span class="id">Map</span>. <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id">Eq</span>. <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html#andb_false_iff">Bool.andb_false_iff</a></span> <span class="kwd">in</span> <span class="id">Eq0</span> <span class="kwd">as</span> [<span class="id">F</span>|<span class="id">F</span>]; <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html#negb_false_iff">Bool.negb_false_iff</a></span> <span class="kwd">in</span> <span class="id">F</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.Common.html#PSF.mem_2">PSF.mem_2</a></span>, <span class="id"><a href="Velus.Common.Common.html#In_of_list">In_of_list</a></span> <span class="kwd">in</span> <span class="id">F</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;-<span class="id">Perm</span> <span class="kwd">in</span> <span class="id">Nd1</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers_app_InMembers">NoDupMembers_app_InMembers</a></span> <span class="kwd">in</span> <span class="id">Nd1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">take</span> (<span class="id"><a href="Velus.Instantiator.html#L.Senv.IsVar">IsVar</a></span> <span class="id">_</span> <span class="id">_</span>) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>. <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#fst_InMembers">fst_InMembers</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> (<span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x4</span> <span class="id">env</span>); <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">subst</span>; <span class="id">auto</span>. <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore2">Forall2_ignore2</a></span> <span class="kwd">in</span> <span class="id">Hbind1</span>. <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> <span class="id">and</span> <span class="id">destruct</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">etransitivity</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl_map">incl_map</a></span>, <span class="id"><a href="Velus.Lustre.LustreElab.html#check_incl_spec">check_incl_spec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="check_defined_block_spec">check_defined_block_spec</a></span> <span class="id">loc</span> : <span class="kwd">forall</span> <span class="id">blk</span>  <span class="id">env</span> <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span>  -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#NoDupLocals">NoDupLocals</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> ) <span class="id">blk</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#NoDupLocals">NoDupLocals</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Environment.html#Env.elements">Env.elements</a></span> <span class="id">env</span>)) <span class="id">blk</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> <span class="id">env</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt; <span class="id"><a href="Velus.Instantiator.html#L.Senv.IsVar">IsVar</a></span>  <span class="id">x</span> -&gt; <span class="id"><a href="Velus.Instantiator.html#L.Senv.IsLast">IsLast</a></span>  <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_block">check_defined_block</a></span> <span class="id">loc</span> <span class="id">env</span> <span class="id">blk</span> <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> , <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#VarsDefined">VarsDefined</a></span> <span class="id">blk</span> .<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof23')">Proof.</span></div>
<div class="proofscript" id="proof23">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Opaque</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_scope">check_defined_scope</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">blk</span> <span class="kwd">as</span> [(?&amp;?)| | | | |] <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#block_ind2">block_ind2</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Nd1</span> <span class="id">Nd2</span> <span class="id">Nd3</span> <span class="id">Henv</span> <span class="id">Hc</span>; <span class="id">inv</span> <span class="id">Nd2</span>; <span class="id">inv</span> <span class="id">Nd3</span>; <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;equation&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;last&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">symmetry</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_eq_nil">map_eq_nil</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;reset&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#map_eq_concat">map_eq_concat</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> (?&amp;?&amp;?); <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span> <span class="kwd">in</span> <span class="id">Hbind</span>. <span class="id">simpl_Forall</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">H</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers_concat">NoDupMembers_concat</a></span>, <span class="id"><a href="Velus.Lustre.LustreElab.html#NoDupLocals_incl">NoDupLocals_incl</a></span>, <span class="id"><a href="Velus.Lustre.LustreElab.html#IsVar_IsLast_incl">IsVar_IsLast_incl</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl_map">incl_map</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#incl_concat">incl_concat</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;switch&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">constructor</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_branches_nnil">check_defined_branches_nnil</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_branches_spec">check_defined_branches_spec</a></span> <span class="kwd">with</span> (<span class="id">P_nd2</span>:=<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#NoDupLocals">NoDupLocals</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Environment.html#Env.elements">Env.elements</a></span> <span class="id">_</span>)))) <span class="kwd">in</span> <span class="id">Hbind</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1-3:<span class="id">simpl_Forall</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+{ <span class="id">simpl_Forall</span>. <span class="id">destruct</span> <span class="id">b</span>. <span class="id">intros</span>. <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#map_eq_concat">map_eq_concat</a></span> <span class="kwd">in</span> <span class="id">H9</span> <span class="kwd">as</span> (?&amp;?&amp;?); <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> 2 <span class="id">esplit</span>; [|<span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span> <span class="kwd">in</span> <span class="id">Hbind0</span>. <span class="id">simpl_Forall</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">H</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers_concat">NoDupMembers_concat</a></span>, <span class="id"><a href="Velus.Lustre.LustreElab.html#NoDupLocals_incl">NoDupLocals_incl</a></span>, <span class="id"><a href="Velus.Lustre.LustreElab.html#IsVar_IsLast_incl">IsVar_IsLast_incl</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl_map">incl_map</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#incl_concat">incl_concat</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl_tran">incl_tran</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_is_defined">check_defined_is_defined</a></span>; <span class="id">eauto</span>. <span class="id">simpl</span>. <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#bind">bind</a></span>. <span class="id">setoid_rewrite</span> <span class="id">Hbind</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_In</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;automaton&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_branches_nnil">check_defined_branches_nnil</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_branches_spec">check_defined_branches_spec</a></span> <span class="kwd">with</span> (<span class="id">P_nd2</span>:=<span class="kwd">fun</span> <span class="id">_</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#NoDupScope">NoDupScope</a></span> <span class="id">_</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Environment.html#Env.elements">Env.elements</a></span> <span class="id">_</span>)) <span class="id">_</span>) <span class="kwd">in</span> <span class="id">Hbind</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1-3:<span class="id">simpl_Forall</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+{ <span class="id">simpl_Forall</span>. <span class="id">destruct</span> <span class="id">b</span> <span class="kwd">as</span> [?(?&amp;[?(?&amp;?)])]. <span class="id">intros</span>. <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_scope_spec">check_defined_scope_spec</a></span> <span class="kwd">in</span> <span class="id">H8</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#NoDupScope_incl">NoDupScope_incl</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl_map">incl_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#NoDupLocals_incl">NoDupLocals_incl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#NoDupLocals_incl">NoDupLocals_incl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span>; <span class="id">destruct_conjs</span>. <span class="id">do</span> 2 <span class="id">esplit</span>; <span class="id">eauto</span>. <span class="id">etransitivity</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span>. <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#map_eq_concat">map_eq_concat</a></span> <span class="kwd">in</span> <span class="id">H14</span> <span class="kwd">as</span> (?&amp;?&amp;?); <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> 2 <span class="id">esplit</span>; [|<span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span> <span class="kwd">in</span> <span class="id">Hbind0</span>. <span class="id">simpl_Forall</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">H</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers_concat">NoDupMembers_concat</a></span>, <span class="id"><a href="Velus.Lustre.LustreElab.html#NoDupLocals_incl">NoDupLocals_incl</a></span>, <span class="id"><a href="Velus.Lustre.LustreElab.html#IsVar_IsLast_incl">IsVar_IsLast_incl</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl_map">incl_map</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#incl_concat">incl_concat</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl_tran">incl_tran</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_is_defined">check_defined_is_defined</a></span>; <span class="id">eauto</span>. <span class="id">simpl</span>. <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#bind">bind</a></span>. <span class="id">setoid_rewrite</span> <span class="id">Hbind</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_In</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;local&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_scope_spec">check_defined_scope_spec</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#NoDupLocals_incl">NoDupLocals_incl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span>; <span class="id">destruct_conjs</span>. <span class="id">do</span> 2 <span class="id">esplit</span>; <span class="id">eauto</span>. <span class="id">etransitivity</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span>. <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#map_eq_concat">map_eq_concat</a></span> <span class="kwd">in</span> <span class="id">H7</span> <span class="kwd">as</span> (?&amp;?&amp;?); <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> 2 <span class="id">esplit</span>; [|<span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span> <span class="kwd">in</span> <span class="id">Hbind</span>. <span class="id">simpl_Forall</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">H</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers_concat">NoDupMembers_concat</a></span>, <span class="id"><a href="Velus.Lustre.LustreElab.html#NoDupLocals_incl">NoDupLocals_incl</a></span>, <span class="id"><a href="Velus.Lustre.LustreElab.html#IsVar_IsLast_incl">IsVar_IsLast_incl</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl_map">incl_map</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#incl_concat">incl_concat</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl_tran">incl_tran</a></span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
<h3> LastsDefined </h3>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="msg_of_missing_lasts">msg_of_missing_lasts</a></span> (<span class="id">exp</span> <span class="id">def</span> : <span class="id"><a href="Velus.Common.Common.html#PS.t">PS.t</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> (<span class="id"><a href="Velus.Common.Common.html#PS.elements">PS.elements</a></span> (<span class="id"><a href="Velus.Common.Common.html#PS.diff">PS.diff</a></span> <span class="id">exp</span> <span class="id">def</span>)) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">x</span>::<span class="id">_</span> =&gt; (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "<span class="id">last</span> " :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">x</span> :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> " <span class="id">is</span> <span class="id">not</span> <span class="id">defined</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="kwd">match</span> (<span class="id"><a href="Velus.Common.Common.html#PS.elements">PS.elements</a></span> (<span class="id"><a href="Velus.Common.Common.html#PS.diff">PS.diff</a></span> <span class="id">def</span> <span class="id">exp</span>)) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">x</span>::<span class="id">_</span> =&gt; (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "<span class="id">last</span> " :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">x</span> :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> " <span class="id">shouldn</span>'<span class="id">t</span> <span class="id">be</span> <span class="id">defined</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">Missing</span> <span class="id">or</span> <span class="id">too</span> <span class="id">many</span> <span class="id">variables</span> <span class="id">defined</span>"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="check_defined_lasts">check_defined_lasts</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">exp</span> <span class="id">def</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Velus.Common.Common.html#check_nodup">Common.check_nodup</a></span> <span class="id">def</span> <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">exp</span> := <span class="id"><a href="Velus.Common.CommonPS.html#ps_from_list">ps_from_list</a></span> <span class="id">exp</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">def</span> := <span class="id"><a href="Velus.Common.CommonPS.html#ps_from_list">ps_from_list</a></span> <span class="id">def</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Velus.Common.Common.html#PS.equal">PS.equal</a></span> <span class="id">exp</span> <span class="id">def</span> <span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#msg_of_missing_variables">msg_of_missing_variables</a></span> <span class="id">exp</span> <span class="id">def</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "<span class="id">Duplicate</span> <span class="id">definition</span> <span class="id">of</span> <span class="id">last</span> " :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#find_dup">find_dup</a></span> <span class="id">def</span>) :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "").<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="check_defined_lasts_spec">check_defined_lasts_spec</a></span> <span class="id">loc</span> : <span class="kwd">forall</span> <span class="id">exp</span> <span class="id">def</span> <span class="id">st</span> <span class="id">res</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">exp</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_lasts">check_defined_lasts</a></span> <span class="id">loc</span> <span class="id">exp</span> <span class="id">def</span> <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> <span class="id">res</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation">Permutation</a></span> <span class="id">exp</span> <span class="id">def</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof24')">Proof.</span></div>
<div class="proofscript" id="proof24">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_lasts">check_defined_lasts</a></span> .<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hnd</span> <span class="id">Hc</span>. <span class="id">cases_eqn</span> <span class="id">Heq</span>; <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.Common.html#check_nodup_correct">check_nodup_correct</a></span> <span class="kwd">in</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.Common.html#PSF.equal_2">PSF.equal_2</a></span>, <span class="id"><a href="Velus.Common.CommonPS.html#PS_elements_Equal">PS_elements_Equal</a></span> <span class="kwd">in</span> <span class="id">Heq0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Common.CommonPS.html#ps_from_list">ps_from_list</a></span> <span class="kwd">in</span> <span class="id">Heq0</span>. <span class="id">rewrite</span> 2 <span class="id"><a href="Velus.Common.CommonPS.html#Permutation_PS_elements_ps_adds">Permutation_PS_elements_ps_adds</a></span> <span class="kwd">in</span> <span class="id">Heq0</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2,3:<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>; <span class="id">intros</span>; <span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonPS.html#not_In_empty">not_In_empty</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#PSP.elements_empty">PSP.elements_empty</a></span>, 2 <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span> <span class="kwd">in</span> <span class="id">Heq0</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="check_lasts_defined_local">check_lasts_defined_local</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">locals</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) (<span class="id">xs</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">locals</span>', <span class="id">ys</span>) := <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#partition">partition</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#existsb">existsb</a></span> (<span class="id"><a href="Velus.Common.Common.html#ident_eqb">ident_eqb</a></span> <span class="id">x</span>) <span class="id">locals</span>) <span class="id">xs</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_lasts">check_defined_lasts</a></span> <span class="id">loc</span> <span class="id">locals</span> <span class="id">locals</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id">ys</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="check_lasts_defined_local_spec">check_lasts_defined_local_spec</a></span> <span class="id">loc</span> : <span class="kwd">forall</span> <span class="id">locals</span> <span class="id">xs</span> <span class="id">ys</span> <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">locals</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#check_lasts_defined_local">check_lasts_defined_local</a></span> <span class="id">loc</span> <span class="id">locals</span> <span class="id">xs</span> <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id">ys</span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation">Permutation</a></span> (<span class="id">locals</span> ++ <span class="id">ys</span>) <span class="id">xs</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof25')">Proof.</span></div>
<div class="proofscript" id="proof25">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hnd2</span> <span class="id">Hc</span>. <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_lasts_defined_local">check_lasts_defined_local</a></span> <span class="kwd">in</span> <span class="id">Hc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id">Hf</span>; <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#partition_Partition">partition_Partition</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Partition_Permutation">Partition_Permutation</a></span> <span class="kwd">in</span> <span class="id">Hf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_lasts_spec">check_defined_lasts_spec</a></span> <span class="kwd">in</span> <span class="id">Hbind</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> <span class="id">Hf</span>, <span class="id">Hbind</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="check_lasts_defined_scope">check_lasts_defined_scope</a></span> {<span class="id">A</span>} <span class="id">f_nd</span> <span class="id">loc</span> (<span class="id">s</span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#scope">scope</a></span> <span class="id">A</span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '<span class="kwd">Scope</span> <span class="id">locs</span> <span class="id">blk</span> := <span class="id">s</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">xs</span> &lt;- <span class="id">f_nd</span> <span class="id">blk</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">xs</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#check_lasts_defined_local">check_lasts_defined_local</a></span> <span class="id">loc</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#lasts_of_decls">lasts_of_decls</a></span> <span class="id">locs</span>) <span class="id">xs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id">xs</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="check_lasts_defined_branch">check_lasts_defined_branch</a></span> {<span class="id">A</span>} <span class="id">f_nd</span> <span class="id">loc</span> (<span class="id">s</span> : <span class="id"><a href="Velus.Lustre.LustreElab.html#branch">branch</a></span> <span class="id">A</span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '<span class="id"><a href="Velus.Lustre.LustreElab.html#Branch">Branch</a></span> <span class="id">caus</span> <span class="id">blk</span> := <span class="id">s</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">xs</span> &lt;- <span class="id">f_nd</span> <span class="id">blk</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">xs</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">x</span>::<span class="id">_</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "<span class="id">last</span> " :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">x</span> :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> " <span class="id">should</span> <span class="id">not</span> <span class="id">be</span> <span class="id">defined</span> <span class="id">under</span> <span class="id">a</span> <span class="id">branch</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="check_lasts_defined_block">check_lasts_defined_block</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">blk</span>: <span class="id"><a href="Velus.Lustre.LustreElab.html#block">block</a></span>) : <span class="id"><a href="Velus.Lustre.LustreElab.html#Elab">Elab</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">blk</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Beq">Beq</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> []<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Blast">Blast</a></span> <span class="id">x</span> <span class="id">_</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> [<span class="id">x</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Breset">Breset</a></span> <span class="id">blks</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">xs</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="id">check_lasts_defined_block</span> <span class="id">loc</span>) <span class="id">blks</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">xs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Bswitch">Bswitch</a></span> <span class="id">_</span> <span class="id">brs</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Velus.Common.CommonList.html#is_nil">is_nil</a></span> <span class="id">brs</span> <span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">there</span> <span class="id">should</span> <span class="id">be</span> <span class="kwd">at</span> <span class="id">least</span> <span class="id">one</span> <span class="id">branch</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="kwd">fun</span> '(<span class="id">_</span>, <span class="id">br</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#check_lasts_defined_branch">check_lasts_defined_branch</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">blks</span> =&gt; <span class="id">do</span> <span class="id">xs</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="id">check_lasts_defined_block</span> <span class="id">loc</span>) <span class="id">blks</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">xs</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">loc</span> <span class="id">br</span>) <span class="id">brs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> []<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Bauto">Bauto</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">sts</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Velus.Common.CommonList.html#is_nil">is_nil</a></span> <span class="id">sts</span> <span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">there</span> <span class="id">should</span> <span class="id">be</span> <span class="kwd">at</span> <span class="id">least</span> <span class="id">one</span> <span class="id">branch</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">do</span> <span class="id">_</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="kwd">fun</span> '(<span class="id">_</span>, <span class="id">br</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#check_lasts_defined_branch">check_lasts_defined_branch</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> '(<span class="id">_</span>, <span class="id">s</span>) =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#check_lasts_defined_scope">check_lasts_defined_scope</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> '(<span class="id">blks</span>, <span class="id">_</span>) =&gt; <span class="id">do</span> <span class="id">xs</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="id">check_lasts_defined_block</span> <span class="id">loc</span>) <span class="id">blks</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">xs</span>)) <span class="id">loc</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">loc</span> <span class="id">br</span>) <span class="id">sts</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> []<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.LustreElab.html#Blocal">Blocal</a></span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.LustreElab.html#check_lasts_defined_scope">check_lasts_defined_scope</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">blks</span> =&gt; <span class="id">do</span> <span class="id">xs</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="id">check_lasts_defined_block</span> <span class="id">loc</span>) <span class="id">blks</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">xs</span>)) <span class="id">loc</span> <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="check_lasts_defined_scope_spec">check_lasts_defined_scope_spec</a></span> {<span class="id">A</span>} <span class="id">f_nd</span> <span class="id">P_nd</span> (<span class="id">P_vd</span>: <span class="id">_</span> -&gt; <span class="id">_</span> -&gt; <span class="kwd">Prop</span>) : <span class="kwd">forall</span>  <span class="id">xs</span> <span class="id">loc</span> <span class="id">locs</span> (<span class="id">blk</span>: <span class="id">A</span>) <span class="id">st</span> <span class="id">st</span>',<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#NoDupScope">NoDupScope</a></span> <span class="id">P_nd</span>  (<span class="kwd">Scope</span> <span class="id">locs</span> <span class="id">blk</span>) -&gt;<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#check_lasts_defined_scope">check_lasts_defined_scope</a></span> <span class="id">f_nd</span> <span class="id">loc</span> (<span class="kwd">Scope</span> <span class="id">locs</span> <span class="id">blk</span>) <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id">xs</span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">xs</span> <span class="id">ys</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> <span class="id">xs</span> <span class="id">ys</span> -&gt; <span class="id">P_nd</span> <span class="id">ys</span> <span class="id">blk</span> -&gt; <span class="id">P_nd</span> <span class="id">xs</span> <span class="id">blk</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">xs</span> <span class="id">ys</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation">Permutation</a></span> <span class="id">xs</span> <span class="id">ys</span> -&gt; <span class="id">P_vd</span> <span class="id">blk</span> <span class="id">xs</span> -&gt; <span class="id">P_vd</span> <span class="id">blk</span> <span class="id">ys</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span>  <span class="id">xs</span> <span class="id">st</span> <span class="id">st</span>',<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P_nd</span>  <span class="id">blk</span> -&gt;<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f_nd</span> <span class="id">blk</span> <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id">xs</span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P_vd</span> <span class="id">blk</span> <span class="id">xs</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#LastsDefinedScope">LastsDefinedScope</a></span> <span class="id">P_vd</span> (<span class="kwd">Scope</span> <span class="id">locs</span> <span class="id">blk</span>) <span class="id">xs</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof26')">Proof.</span></div>
<div class="proofscript" id="proof26">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="comment">(*&nbsp;Nd1&nbsp;*)</span> <span class="id">Nd2</span> <span class="comment">(*&nbsp;Nd3&nbsp;Env&nbsp;*)</span> <span class="id">C</span> <span class="id">Perm1</span> <span class="id">Perm2</span> <span class="id">Ind</span>; <span class="id">inv</span> <span class="id">Nd2</span>; <span class="comment">(*&nbsp;inv&nbsp;Nd2;&nbsp;inv&nbsp;Nd3;&nbsp;*)</span> <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_lasts_defined_local_spec">check_lasts_defined_local_spec</a></span> <span class="kwd">in</span> <span class="id">Hbind1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#lasts_of_decls">lasts_of_decls</a></span>. <span class="id">erewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#map_filter_ext">map_filter_ext</a></span>, &lt;-<span class="id"><a href="Velus.Common.CommonList.html#map_map_filter">map_map_filter</a></span>, &lt;-<span class="id"><a href="Velus.Common.CommonList.html#fst_NoDupMembers">fst_NoDupMembers</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers_map_filter">NoDupMembers_map_filter</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:=<span class="kwd">fun</span> '(<span class="id">x</span>, (<span class="id">_</span>, <span class="id">_</span>, <span class="id">_</span>, <span class="id">o</span>)) =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option_map">option_map</a></span> (<span class="kwd">fun</span> <span class="id">_</span> =&gt; (<span class="id">x</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span>)) <span class="id">o</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="id">intros</span>; <span class="id">destruct_conjs</span>; <span class="id">auto</span>; <span class="id">destruct</span> <span class="id">o</span>; <span class="id">simpl</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">Ind</span> <span class="kwd">in</span> <span class="id">Hbind</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id">Perm2</span>; [|<span class="id">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> &lt;-<span class="id">Hbind1</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_app_comm">Permutation_app_comm</a></span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="check_lasts_defined_branch_spec">check_lasts_defined_branch_spec</a></span> {<span class="id">A</span>} <span class="id">f_nd</span> <span class="id">P_nd</span> (<span class="id">P_vd</span>: <span class="id">_</span> -&gt; <span class="kwd">Prop</span>) : <span class="kwd">forall</span> <span class="id">loc</span> <span class="id">caus</span> <span class="id">blk</span> <span class="id">st</span> <span class="id">st</span>',<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#NoDupBranch">NoDupBranch</a></span> <span class="id">P_nd</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Branch">Branch</a></span> <span class="id">caus</span> <span class="id">blk</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="Velus.Lustre.LustreElab.html#check_lasts_defined_branch">check_lasts_defined_branch</a></span> <span class="id">A</span> <span class="id">f_nd</span> <span class="id">loc</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Branch">Branch</a></span> <span class="id">caus</span> <span class="id">blk</span>) <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">xs</span> <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P_nd</span> <span class="id">blk</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f_nd</span> <span class="id">blk</span> <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id">xs</span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P_vd</span> <span class="id">blk</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#LastsDefinedBranch">LastsDefinedBranch</a></span> <span class="id">P_vd</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#Branch">Branch</a></span> <span class="id">caus</span> <span class="id">blk</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof27')">Proof.</span></div>
<div class="proofscript" id="proof27">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_lasts_defined_branch">check_lasts_defined_branch</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Nd1</span> <span class="id">C</span> <span class="id">Ind</span>. <span class="id">inv</span> <span class="id">Nd1</span>. <span class="id">cases_eqn</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Eq">Eq</a></span>. <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="id">destruct</span> <span class="id">x</span>; <span class="id">inv</span> <span class="id">Hbind0</span>. <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="check_lasts_defined_block_spec">check_lasts_defined_block_spec</a></span> <span class="id">loc</span> : <span class="kwd">forall</span> <span class="id">blk</span>  <span class="id">xs</span> <span class="id">st</span> <span class="id">st</span>',<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#NoDupLocals">NoDupLocals</a></span>  <span class="id">blk</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#check_lasts_defined_block">check_lasts_defined_block</a></span> <span class="id">loc</span> <span class="id">blk</span> <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id">xs</span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#LastsDefined">LastsDefined</a></span> <span class="id">blk</span> <span class="id">xs</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof28')">Proof.</span></div>
<div class="proofscript" id="proof28">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Opaque</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_lasts_defined_scope">check_lasts_defined_scope</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">blk</span> <span class="kwd">as</span> [(?&amp;?)| | | | |] <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#block_ind2">block_ind2</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Nd2</span> <span class="id">Hc</span>; <span class="id">inv</span> <span class="id">Nd2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;equation&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">monadInv</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;last&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">monadInv</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;reset&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">monadInv</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span> <span class="kwd">in</span> <span class="id">Hbind</span>. <span class="id">simpl_Forall</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;switch&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">cases_eqn</span> <span class="id">Nil</span>. <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> <span class="id">branches</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore2">Forall2_ignore2</a></span> <span class="kwd">in</span> <span class="id">Hbind</span>. <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> <span class="id">and</span> <span class="id">destruct</span> <span class="id">it</span>, <span class="id">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_lasts_defined_branch_spec">check_lasts_defined_branch_spec</a></span> <span class="kwd">in</span> <span class="id">H3</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore2">Forall2_ignore2</a></span> <span class="kwd">in</span> <span class="id">Hbind2</span>. <span class="id">simpl_Forall</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">_</span>) <span class="id">eqn</span>:<span class="id">Hconc</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">inv</span> <span class="id">Hbind1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#concat_eq_nil">concat_eq_nil</a></span> <span class="kwd">in</span> <span class="id">Hconc</span>. <span class="id">simpl_Forall</span>. <span class="id">subst</span>. <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;automaton&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">cases_eqn</span> <span class="id">Nil</span>. <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> <span class="id">states</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore2">Forall2_ignore2</a></span> <span class="kwd">in</span> <span class="id">Hbind</span>. <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> <span class="id">and</span> <span class="id">destruct</span> <span class="id">it</span>, <span class="id">b</span>, <span class="id">p</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_lasts_defined_branch_spec">check_lasts_defined_branch_spec</a></span> <span class="kwd">in</span> <span class="id">H3</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">x0</span>; <span class="id">inv</span> <span class="id">Hbind0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">s</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_lasts_defined_scope_spec">check_lasts_defined_scope_spec</a></span> <span class="kwd">in</span> <span class="id">Hbind</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">intros</span>. <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#NoDupLocals_incl">NoDupLocals_incl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">intros</span>. <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">destruct_conjs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> 2 <span class="id">esplit</span>; <span class="id">eauto</span>. <span class="id">etransitivity</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">intros</span>. <span class="id">destruct_conjs</span>. <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> 2 <span class="id">esplit</span>; [|<span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span> <span class="kwd">in</span> <span class="id">Hbind0</span>. <span class="id">simpl_Forall</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;local&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_lasts_defined_scope_spec">check_lasts_defined_scope_spec</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#NoDupLocals_incl">NoDupLocals_incl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span>; <span class="id">destruct_conjs</span>. <span class="id">do</span> 2 <span class="id">esplit</span>; <span class="id">eauto</span>. <span class="id">etransitivity</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span>. <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> 2 <span class="id">esplit</span>; [|<span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span> <span class="kwd">in</span> <span class="id">Hbind</span>. <span class="id">simpl_Forall</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="id">Local</span> <span class="kwd">Ltac</span> <span class="id">destruct_to_singl</span> <span class="id">l</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">l</span>; [|<span class="id">destruct</span> <span class="id">l</span>]; <span class="id">auto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="elab_block_GoodLocals">elab_block_GoodLocals</a></span> : <span class="kwd">forall</span> <span class="id">ablk</span> <span class="id">env</span> <span class="id">blk</span> <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#elab_block">elab_block</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabDeclaration.tenv">tenv</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabDeclaration.extenv">extenv</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabDeclaration.nenv">nenv</a></span> <span class="id">env</span> <span class="id">ablk</span> <span class="id">st</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id">blk</span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#GoodLocals">GoodLocals</a></span> <span class="id"><a href="Velus.Ident.html#Ids.elab_prefs">elab_prefs</a></span> <span class="id">blk</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof29')">Proof.</span></div>
<div class="proofscript" id="proof29">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">ablk</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#block_ind2">LustreAst.block_ind2</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Helab</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;equation&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;last&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>. <span class="id">repeat</span> <span class="id">monadInv</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;reset&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>. <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore1">Forall2_ignore1</a></span> <span class="kwd">in</span> <span class="id">Hbind</span>. <span class="id">simpl_Forall</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;switch&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>. <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore1">Forall2_ignore1</a></span> <span class="kwd">in</span> <span class="id">Hbind3</span>. <span class="id">simpl_Forall</span>; <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">constructor</span>. <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore1">Forall2_ignore1</a></span> <span class="kwd">in</span> <span class="id">Hbind6</span>. <span class="id">simpl_Forall</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;automaton&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>. <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore1">Forall2_ignore1</a></span> <span class="kwd">in</span> <span class="id">Hbind0</span>. <span class="id">simpl_Forall</span>; <span class="id">repeat</span> <span class="id">monadInv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_check_atom_AtomOrGensym">mmap_check_atom_AtomOrGensym</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore1">Forall2_ignore1</a></span> <span class="kwd">in</span> <span class="id">Hbind7</span>. <span class="id">simpl_Forall</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;local&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_check_atom_AtomOrGensym">mmap_check_atom_AtomOrGensym</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_values">mmap_values</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore1">Forall2_ignore1</a></span> <span class="kwd">in</span> <span class="id">Hbind2</span>. <span class="id">simpl_Forall</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="id">Local</span> <span class="kwd">Obligation</span> <span class="kwd">Tactic</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Tactics.program_simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>:<span class="id">_</span> = <span class="id"><a href="Velus.Lustre.LustreElab.html#bind">bind</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="id">symmetry</span> <span class="kwd">in</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">monadInv</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> (<span class="id">progress</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">x</span>:<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> |- <span class="id">_</span> =&gt; <span class="id">destruct</span> <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>:(<span class="kwd">if</span> ?<span class="id">b</span> <span class="kwd">then</span> <span class="id">_</span> <span class="kwd">else</span> <span class="id">_</span>) <span class="id">_</span> = <span class="id">_</span> |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Hb</span> := <span class="id">fresh</span> "<span class="id">Hb</span>" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">destruct</span> <span class="id">b</span> <span class="id">eqn</span>:<span class="id">Hb</span>; <span class="id">try</span> <span class="id">discriminate</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>:<span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="id">_</span> <span class="id">_</span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="id">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="elab_declaration_node">elab_declaration_node</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">name</span>: <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) (<span class="id">has_state</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>) (<span class="id">inputs</span> : <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#var_decls">var_decls</a></span>) (<span class="id">outputs</span> : <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#var_decls">var_decls</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">blk</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#block">LustreAst.block</a></span>) (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) : <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#res">res</a></span> (@<span class="id"><a href="Velus.Lustre.LustreElab.html#node">node</a></span> (<span class="kwd">fun</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span>) <span class="id"><a href="Velus.Ident.html#Ids.elab_prefs">elab_prefs</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> (<span class="id">do</span> <span class="id">env_in</span>  &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_decls">elab_decls</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabDeclaration.tenv">tenv</a></span> <span class="id"><a href="Velus.Common.Common.html#PS.empty">PS.empty</a></span> <span class="id">loc</span> (<span class="id"><a href="Velus.Environment.html#Env.empty">Env.empty</a></span> <span class="id">_</span>) <span class="id">inputs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">lasts</span> := <span class="id"><a href="Velus.Lustre.LustreElab.html#lasts_defined">lasts_defined</a></span> <span class="id">blk</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">env</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_decls">elab_decls</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabDeclaration.tenv">tenv</a></span> <span class="id">lasts</span> <span class="id">loc</span> <span class="id">env_in</span> <span class="id">outputs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">xin</span>     &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#annotate">annotate</a></span> <span class="id">env</span>) <span class="id">inputs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">xout</span>    &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#annotate">annotate</a></span> <span class="id">env</span>) <span class="id">outputs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">blk</span>     &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_block">elab_block</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabDeclaration.tenv">tenv</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabDeclaration.extenv">extenv</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabDeclaration.nenv">nenv</a></span> <span class="id">env</span> <span class="id">blk</span>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span>       &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#check_nodup">check_nodup</a></span> <span class="id">loc</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id">xin</span>++<span class="id">xout</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span>       &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#check_noduplocals">check_noduplocals</a></span> <span class="id">loc</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#nameset">nameset</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#nameset">nameset</a></span> <span class="id"><a href="Velus.Common.Common.html#PS.empty">PS.empty</a></span> <span class="id">xin</span>) <span class="id">xout</span>) <span class="id">blk</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">defs</span>    &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_block">check_defined_block</a></span> <span class="id">loc</span> (<span class="id"><a href="Velus.Environment.html#Env.from_list">Env.from_list</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">xtc</span> =&gt; (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">xtc</span>, <span class="id"><a href="Velus.Common.Common.html#isSome">isSome</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">xtc</span>)))) <span class="id">xout</span>)) <span class="id">blk</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span>       &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#check_nodup">check_nodup</a></span> <span class="id">loc</span> <span class="id">defs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span>       &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_vars">check_defined_vars</a></span> <span class="id">loc</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">xout</span>) <span class="id">defs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">lasts</span>   &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#check_lasts_defined_block">check_lasts_defined_block</a></span> <span class="id">loc</span> <span class="id">blk</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span>       &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#check_nodup">check_nodup</a></span> <span class="id">loc</span> <span class="id">lasts</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span>       &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_vars">check_defined_vars</a></span> <span class="id">loc</span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#lasts_of_decls">lasts_of_decls</a></span> <span class="id">xout</span>) <span class="id">lasts</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span>       &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#check_atom">check_atom</a></span> <span class="id">loc</span> <span class="id">name</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">_</span>       &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap">mmap</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#check_atom">check_atom</a></span> <span class="id">loc</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id">xin</span> ++ <span class="id">xout</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length">length</a></span> <span class="id">xin</span> ==<span class="id">b</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#O">O</a></span>) || (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length">length</a></span> <span class="id">xout</span> ==<span class="id">b</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#O">O</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#err_loc">err_loc</a></span> <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">not</span> <span class="id">enough</span> <span class="id">inputs</span> <span class="id">or</span> <span class="id">outputs</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ret">ret</a></span> (<span class="id">xin</span>, <span class="id">xout</span>, <span class="id">blk</span>)) <span class="id"><a href="Velus.Lustre.LustreElab.html#init_state">init_state</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#Error">Error</a></span> <span class="id">e</span> =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#Error">Error</a></span> <span class="id">e</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> ((<span class="id">xin</span>, <span class="id">xout</span>, <span class="id">blk</span>), (<span class="id">nfui</span>, <span class="id">_</span>)) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> {| <span class="id"><a href="Velus.Lustre.LustreElab.html#n_name">n_name</a></span>     := <span class="id">name</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#n_hasstate">n_hasstate</a></span> := <span class="id">has_state</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#n_in">n_in</a></span>       := <span class="id"><a href="Velus.Common.Common.html#idfst">idfst</a></span> <span class="id">xin</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#n_out">n_out</a></span>      := <span class="id">xout</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.LustreElab.html#n_block">n_block</a></span>    := <span class="id">blk</span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof30')">Next Obligation.</span></div>
<div class="proofscript" id="proof30">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;0&nbsp;&lt;&nbsp;length&nbsp;xin&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html#orb_false_iff">Bool.orb_false_iff</a></span> <span class="kwd">in</span> <span class="id">Hb</span>; <span class="id">destruct</span> <span class="id">Hb</span> <span class="kwd">as</span> (<span class="id">Hin</span> &amp; <span class="id">Hout</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.Common.html#not_equiv_decb_equiv">not_equiv_decb_equiv</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.neq_0_lt_0">Nat.neq_0_lt_0</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof31')">Next Obligation.</span></div>
<div class="proofscript" id="proof31">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;0&nbsp;&lt;&nbsp;length&nbsp;xout&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html#orb_false_iff">Bool.orb_false_iff</a></span> <span class="kwd">in</span> <span class="id">Hb</span>; <span class="id">destruct</span> <span class="id">Hb</span> <span class="kwd">as</span> (<span class="id">Hin</span> &amp; <span class="id">Hout</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.Common.html#not_equiv_decb_equiv">not_equiv_decb_equiv</a></span> <span class="kwd">in</span> <span class="id">Hout</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.neq_0_lt_0">Nat.neq_0_lt_0</a></span> <span class="kwd">in</span> <span class="id">Hout</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof32')">Next Obligation.</span></div>
<div class="proofscript" id="proof32">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_vars_spec">check_defined_vars_spec</a></span> <span class="kwd">in</span> <span class="id">Hbind8</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_nodup_spec">check_nodup_spec</a></span> <span class="kwd">in</span> <span class="id">Hbind4</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span> <span class="kwd">in</span> <span class="id">Hbind4</span>. <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_r">NoDup_app_r</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">symmetry</span> <span class="kwd">in</span> <span class="id">Hbind8</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_map_inv">Permutation_map_inv</a></span> <span class="kwd">in</span> <span class="id">Hbind8</span> <span class="kwd">as</span> (?&amp;?&amp;<span class="id">Perm</span>); <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;-<span class="id"><a href="Velus.Instantiator.html#L.Senv.map_fst_senv_of_decls">map_fst_senv_of_decls</a></span> <span class="kwd">in</span> <span class="id">Hbind6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_noduplocals_spec">check_noduplocals_spec</a></span> <span class="kwd">with</span> (<span class="id">xs</span>:=<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">xout</span>) <span class="kwd">in</span> <span class="id">Hbind5</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">intros</span> * <span class="id">In</span>. <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#nameset_spec">nameset_spec</a></span>; <span class="id">auto</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_block_spec">check_defined_block_spec</a></span> <span class="kwd">in</span> <span class="id">Hbind6</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">do</span> 2 <span class="id">esplit</span>; <span class="id">eauto</span>. <span class="id">unfold</span> <span class="id"><a href="Velus.Instantiator.html#L.Senv.senv_of_decls">senv_of_decls</a></span>. <span class="id">now</span> <span class="id">rewrite</span> <span class="id">Perm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Velus.Instantiator.html#L.Senv.NoDupMembers_senv_of_decls">NoDupMembers_senv_of_decls</a></span>. <span class="id">rewrite</span> &lt;-<span class="id">Perm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_nodup_spec">check_nodup_spec</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#fst_NoDupMembers">fst_NoDupMembers</a></span> <span class="kwd">in</span> <span class="id">Hbind4</span>. <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers_app_r">NoDupMembers_app_r</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Instantiator.html#L.Senv.map_fst_senv_of_decls">map_fst_senv_of_decls</a></span>, &lt;-<span class="id">Perm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#NoDupLocals_incl">NoDupLocals_incl</a></span>; [|<span class="id">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> ? <span class="id">In</span>. <span class="id">simpl_In</span>. <span class="id">clear</span> - <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Environment.html#Env.elements_In">Env.elements_In</a></span>, <span class="id"><a href="Velus.Environment.html#Env.In_from_list">Env.In_from_list</a></span> <span class="kwd">in</span> <span class="id">Hin</span>. <span class="id">solve_In</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">intros</span> * <span class="id">Find</span> <span class="id">In</span>. <span class="id">apply</span> <span class="id"><a href="Velus.Environment.html#Env.from_list_find_In">Env.from_list_find_In</a></span> <span class="kwd">in</span> <span class="id">Find</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_In</span>. <span class="id">destruct</span> <span class="id">o</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Instantiator.html#L.Senv.senv_of_decls">senv_of_decls</a></span>. <span class="id">rewrite</span> &lt;-<span class="id">Perm</span>. <span class="id">econstructor</span>. <span class="id">solve_In</span>. <span class="id">simpl</span>; <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof33')">Next Obligation.</span></div>
<div class="proofscript" id="proof33">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_defined_vars_spec">check_defined_vars_spec</a></span> <span class="kwd">in</span> <span class="id">Hbind11</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_nodup_spec">check_nodup_spec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_nodup_spec">check_nodup_spec</a></span> <span class="kwd">in</span> <span class="id">Hbind4</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span> <span class="kwd">in</span> <span class="id">Hbind4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_r">NoDup_app_r</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#fst_NoDupMembers">fst_NoDupMembers</a></span> <span class="kwd">in</span> <span class="id">Hbind4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#lasts_of_decls">lasts_of_decls</a></span>. <span class="id">erewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#map_filter_ext">map_filter_ext</a></span>, &lt;-<span class="id"><a href="Velus.Common.CommonList.html#map_map_filter">map_map_filter</a></span>, &lt;-<span class="id"><a href="Velus.Common.CommonList.html#fst_NoDupMembers">fst_NoDupMembers</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers_map_filter">NoDupMembers_map_filter</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1:=<span class="kwd">fun</span> '(<span class="id">x</span>, (<span class="id">_</span>, <span class="id">_</span>, <span class="id">_</span>, <span class="id">o</span>)) =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option_map">option_map</a></span> (<span class="kwd">fun</span> <span class="id">_</span> =&gt; (<span class="id">x</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span>)) <span class="id">o</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="id">intros</span>; <span class="id">destruct_conjs</span>; <span class="id">auto</span>; <span class="id">destruct</span> <span class="id">o</span>; <span class="id">simpl</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_noduplocals_spec">check_noduplocals_spec</a></span> <span class="kwd">with</span> (<span class="id">xs</span>:=<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">xout</span>) <span class="kwd">in</span> <span class="id">Hbind5</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">intros</span> * <span class="id">In</span>. <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#nameset_spec">nameset_spec</a></span>; <span class="id">auto</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_lasts_defined_block_spec">check_lasts_defined_block_spec</a></span> <span class="kwd">in</span> <span class="id">Hbind9</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> 2 <span class="id">esplit</span>; <span class="id">eauto</span>. <span class="id">now</span> <span class="id">symmetry</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof34')">Next Obligation.</span></div>
<div class="proofscript" id="proof34">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_nodup_spec">check_nodup_spec</a></span> <span class="kwd">in</span> <span class="id">Hbind4</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>, &lt;-<span class="id"><a href="Velus.Common.Common.html#map_fst_idfst">map_fst_idfst</a></span> <span class="kwd">in</span> <span class="id">Hbind4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_noduplocals_spec">check_noduplocals_spec</a></span> <span class="kwd">in</span> <span class="id">Hbind5</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> ??. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span>, <span class="id"><a href="Velus.Common.Common.html#map_fst_idfst">map_fst_idfst</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#nameset_spec">nameset_spec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">Hin</span>|<span class="id">Hin</span>]; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof35')">Next Obligation.</span></div>
<div class="proofscript" id="proof35">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#map_fst_idfst">map_fst_idfst</a></span>, &lt;-<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#mmap_check_atom_AtomOrGensym">mmap_check_atom_AtomOrGensym</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_block_GoodLocals">elab_block_GoodLocals</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#check_atom_spec">check_atom_spec</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="id">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="elab_declaration_type">elab_declaration_type</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">name</span>: <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) (<span class="id">constr</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) : <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#res">res</a></span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Velus.Common.Common.html#check_nodup">Common.check_nodup</a></span> <span class="id">constr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tenum">Tenum</a></span> <span class="id">name</span> <span class="id">constr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#Error">Error</a></span> (<span class="id">err_loc</span>' <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "<span class="id">duplicate</span> <span class="id">constructor</span> <span class="kwd">for</span> <span class="id">type</span> " :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">name</span> :: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)).<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabDeclaration">ElabDeclaration</a></span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="ElabDeclarations">ElabDeclarations</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">error_monad_scope</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="elab_ctype">elab_ctype</a></span> (<span class="id">loc</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#astloc">astloc</a></span>) (<span class="id">ty</span>: <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#type_name">LustreAst.type_name</a></span>) : <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#res">res</a></span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.ctype">ctype</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ty</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#Tint8">Tint8</a></span>    =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tint">Tint</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#I8">Ctypes.I8</a></span>  <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#Signed">Ctypes.Signed</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#Tuint8">Tuint8</a></span>   =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tint">Tint</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#I8">Ctypes.I8</a></span>  <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#Unsigned">Ctypes.Unsigned</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#Tint16">Tint16</a></span>   =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tint">Tint</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#I16">Ctypes.I16</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#Signed">Ctypes.Signed</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#Tuint16">Tuint16</a></span>  =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tint">Tint</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#I16">Ctypes.I16</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#Unsigned">Ctypes.Unsigned</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#Tint32">Tint32</a></span>   =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tint">Tint</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#I32">Ctypes.I32</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#Signed">Ctypes.Signed</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#Tuint32">Tuint32</a></span>  =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tint">Tint</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#I32">Ctypes.I32</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#Unsigned">Ctypes.Unsigned</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#Tint64">Tint64</a></span>   =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tlong">Tlong</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#Signed">Ctypes.Signed</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#Tuint64">Tuint64</a></span>  =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tlong">Tlong</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#Unsigned">Ctypes.Unsigned</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#Tfloat32">Tfloat32</a></span> =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tfloat">Tfloat</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#F32">Ctypes.F32</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#Tfloat64">Tfloat64</a></span> =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.Tfloat">Tfloat</a></span> <span class="id"><a href="../../CompCert/doc/html/compcert.cfrontend.Ctypes.html#F64">Ctypes.F64</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#Tenum_name">Tenum_name</a></span> <span class="id">t</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#Error">Error</a></span> (<span class="id">err_loc</span>' <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">Only</span> <span class="id">primitive</span> <span class="id">types</span> <span class="id">are</span> <span class="id">allowed</span> <span class="kwd">in</span> <span class="id">external</span> <span class="id">declarations</span>"))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id">elab_declarations</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">G</span>: <span class="id"><a href="Velus.Lustre.LustreElab.html#global">global</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tenv</span>: <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">eenv</span>: <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.ctype">ctype</a></span> * <span class="id"><a href="Velus.ObcToClight.Interface.html#Op.ctype">ctype</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">nenv</span>: <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.clock">clock</a></span>)) * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * (<span class="id"><a href="Velus.ObcToClight.Interface.html#Op.type">type</a></span> * <span class="id"><a href="Velus.ObcToClight.Interface.html#Cks.clock">clock</a></span>))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">decls</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#declaration">declaration</a></span>) : <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#res">res</a></span> <span class="id"><a href="Velus.Lustre.LustreElab.html#global">global</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">decls</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [] =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> <span class="id">G</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#NODE">NODE</a></span> <span class="id">name</span> <span class="id">has_state</span> <span class="id">inputs</span> <span class="id">outputs</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#block">block</a></span> <span class="id">loc</span> :: <span class="id">ds</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">n</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_declaration_node">elab_declaration_node</a></span> <span class="id">tenv</span> <span class="id">eenv</span> <span class="id">nenv</span> <span class="id">name</span> <span class="id">has_state</span> <span class="id">inputs</span> <span class="id">outputs</span> <span class="id">block</span> <span class="id">loc</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Velus.Environment.html#Env.mem">Env.mem</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#n_name">n_name</a></span> <span class="id">n</span>) <span class="id">nenv</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#Error">Error</a></span> (<span class="id">err_loc</span>' <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "<span class="id">deplicate</span> <span class="id">definition</span> <span class="kwd">for</span> " :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">name</span> :: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">elab_declarations</span>' (<span class="id"><a href="Velus.Lustre.LustreElab.html#Global">Global</a></span> <span class="id">G</span>.(<span class="id"><a href="Velus.Lustre.LustreElab.html#types">types</a></span>) <span class="id">G</span>.(<span class="id"><a href="Velus.Lustre.LustreElab.html#externs">externs</a></span>) (<span class="id">n</span> :: <span class="id">G</span>.(<span class="id"><a href="Velus.Lustre.LustreElab.html#nodes">nodes</a></span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tenv</span> <span class="id">eenv</span> (<span class="id"><a href="Velus.Environment.html#Env.add">Env.add</a></span> <span class="id">n</span>.(<span class="id"><a href="Velus.Lustre.LustreElab.html#n_name">n_name</a></span>) (<span class="id"><a href="Velus.Common.Common.html#idfst">idfst</a></span> <span class="id">n</span>.(<span class="id"><a href="Velus.Lustre.LustreElab.html#n_in">n_in</a></span>), <span class="id"><a href="Velus.Common.Common.html#idfst">idfst</a></span> (<span class="id"><a href="Velus.Common.Common.html#idfst">idfst</a></span> <span class="id">n</span>.(<span class="id"><a href="Velus.Lustre.LustreElab.html#n_out">n_out</a></span>))) <span class="id">nenv</span>) <span class="id">ds</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#TYPE">TYPE</a></span> <span class="id">name</span> <span class="id">constructors</span> <span class="id">loc</span> :: <span class="id">ds</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">t</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_declaration_type">elab_declaration_type</a></span> <span class="id">name</span> <span class="id">constructors</span> <span class="id">loc</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Velus.Environment.html#Env.mem">Env.mem</a></span> <span class="id">name</span> <span class="id">tenv</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#Error">Error</a></span> (<span class="id">err_loc</span>' <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "<span class="id">duplicate</span> <span class="id">definition</span> <span class="kwd">for</span> " :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">name</span> :: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">elab_declarations</span>' (<span class="id"><a href="Velus.Lustre.LustreElab.html#Global">Global</a></span> (<span class="id">t</span> :: <span class="id">G</span>.(<span class="id"><a href="Velus.Lustre.LustreElab.html#types">types</a></span>)) <span class="id">G</span>.(<span class="id"><a href="Velus.Lustre.LustreElab.html#externs">externs</a></span>) <span class="id">G</span>.(<span class="id"><a href="Velus.Lustre.LustreElab.html#nodes">nodes</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Environment.html#Env.add">Env.add</a></span> <span class="id">name</span> <span class="id">constructors</span> <span class="id">tenv</span>) <span class="id">eenv</span> <span class="id">nenv</span> <span class="id">ds</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#EXTERNAL">EXTERNAL</a></span> <span class="id">name</span> <span class="id">tyins</span> <span class="id">tyout</span> <span class="id">loc</span> :: <span class="id">ds</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">tyins</span> &lt;- <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#mmap">Errors.mmap</a></span> (<span class="id"><a href="Velus.Lustre.LustreElab.html#elab_ctype">elab_ctype</a></span> <span class="id">loc</span>) <span class="id">tyins</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> <span class="id">tyout</span> &lt;- <span class="id"><a href="Velus.Lustre.LustreElab.html#elab_ctype">elab_ctype</a></span> <span class="id">loc</span> <span class="id">tyout</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Velus.Environment.html#Env.mem">Env.mem</a></span> <span class="id">name</span> <span class="id">eenv</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#Error">Error</a></span> (<span class="id">err_loc</span>' <span class="id">loc</span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#MSG">MSG</a></span> "<span class="id">duplicate</span> <span class="id">definition</span> <span class="kwd">for</span> " :: <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#CTX">CTX</a></span> <span class="id">name</span> :: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">elab_declarations</span>' (<span class="id"><a href="Velus.Lustre.LustreElab.html#Global">Global</a></span> <span class="id">G</span>.(<span class="id"><a href="Velus.Lustre.LustreElab.html#types">types</a></span>) ((<span class="id">name</span>, (<span class="id">tyins</span>, <span class="id">tyout</span>))::<span class="id">G</span>.(<span class="id"><a href="Velus.Lustre.LustreElab.html#externs">externs</a></span>)) <span class="id">G</span>.(<span class="id"><a href="Velus.Lustre.LustreElab.html#nodes">nodes</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tenv</span> (<span class="id"><a href="Velus.Environment.html#Env.add">Env.add</a></span> <span class="id">name</span> (<span class="id">tyins</span>, <span class="id">tyout</span>) <span class="id">eenv</span>) <span class="id">nenv</span> <span class="id">ds</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Import</span> <span class="id"><a href="Velus.Instantiator.html#L">Instantiator.L</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="bool_tenv">bool_tenv</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.add">Env.add</a></span> <span class="id"><a href="Velus.Ident.html#Ids.bool_id">bool_id</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id"><a href="Velus.Ident.html#Ids.false_id">false_id</a></span>; <span class="id"><a href="Velus.Ident.html#Ids.true_id">true_id</a></span>] <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Environment.html#Env.empty">Env.empty</a></span> <span class="id">_</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="id">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="elab_declarations">elab_declarations</a></span> (<span class="id">decls</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Parser.LustreAst.html#declaration">declaration</a></span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#res">res</a></span> {<span class="id">G</span> | <span class="id"><a href="Velus.Instantiator.html#L.Typ.wt_global">wt_global</a></span> <span class="id">G</span> /\ <span class="id"><a href="Velus.Instantiator.html#L.Clo.wc_global">wc_global</a></span> <span class="id">G</span> } :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">elab_declarations</span>' (<span class="id"><a href="Velus.Instantiator.html#L.Syn.Global">Global</a></span> [<span class="id"><a href="Velus.ObcToClight.Interface.html#OpAux.bool_velus_type">bool_velus_type</a></span>] [] []) <span class="id"><a href="Velus.Lustre.LustreElab.html#bool_tenv">bool_tenv</a></span> (<span class="id"><a href="Velus.Environment.html#Env.empty">Env.empty</a></span> <span class="id">_</span>) (<span class="id"><a href="Velus.Environment.html#Env.empty">Env.empty</a></span> <span class="id">_</span>) <span class="id">decls</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> <span class="id">G</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Velus.Instantiator.html#L.Typ.check_global">Typ.check_global</a></span> <span class="id">G</span>, <span class="id"><a href="Velus.Instantiator.html#L.Clo.check_global">Clo.check_global</a></span> <span class="id">G</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">OK</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">G</span> <span class="id">_</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>, <span class="id">_</span> =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#Error">Error</a></span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">Post</span>-<span class="id">elab</span> <span class="id">check</span> <span class="id">failed</span> (<span class="id">typing</span>)")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#Error">Error</a></span> (<span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#msg">msg</a></span> "<span class="id">Post</span>-<span class="id">elab</span> <span class="id">check</span> <span class="id">failed</span> (<span class="id">clocking</span>)")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#Error">Error</a></span> <span class="id">err</span> =&gt; <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#Error">Error</a></span> <span class="id">err</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof36')">Next Obligation.</span></div>
<div class="proofscript" id="proof36">
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rename</span> <span class="id">Heq_anonymous</span> <span class="id">into</span> <span class="id">Hwt</span>. <span class="id">rename</span> <span class="id">Heq_anonymous0</span> <span class="id">into</span> <span class="id">Hwc</span>. <span class="id">rename</span> <span class="id">Heq_anonymous1</span> <span class="id">into</span> <span class="id">Helab</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">symmetry</span> <span class="kwd">in</span> <span class="id">Hwt</span>, <span class="id">Hwc</span>, <span class="id">Helab</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Instantiator.html#L.Typ.check_global_correct">Typ.check_global_correct</a></span> <span class="kwd">in</span> <span class="id">Hwt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Instantiator.html#L.Clo.check_global_correct">Clo.check_global_correct</a></span> <span class="kwd">in</span> <span class="id">Hwc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.LustreElab.html#ElabDeclarations">ElabDeclarations</a></span>.<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
