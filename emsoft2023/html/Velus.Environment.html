
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Environment</title>
<meta name="description" content="Documentation of Coq module Environment" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Environment</h1>
<div class="coq">
<span class="kwd">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.FSets.FMapPositive.html">FSets.FMapPositive</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.FSets.FMapFacts.html">FSets.FMapFacts</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.ZArith.html">ZArith.ZArith</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html">Classes.EquivDec</a></span>.<br/>
<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Common.CommonTactics.html">Common.CommonTactics</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Common.CommonList.html">Common.CommonList</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Common.Common.html">Common</a></span>.<br/>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="Env">Env</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Include</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.FSets.FMapPositive.html#PositiveMap">PositiveMap</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Include</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.FSets.FMapPositive.html#PositiveMapAdditionalFacts">PositiveMapAdditionalFacts</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Module</span> <span class="id"><a name="Env.Props">Props</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.FSets.FMapFacts.html#OrdProperties">FMapFacts.OrdProperties</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.FSets.FMapPositive.html#PositiveMap">PositiveMap</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="Env.Extra">Extra</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">A</span>: <span class="kwd">Type</span>}.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.add_comm">add_comm</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">a</span> <span class="id">b</span> (<span class="id">m</span>: <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">x</span> &lt;&gt; <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> <span class="id">a</span> (<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">y</span> <span class="id">b</span> <span class="id">m</span>) = <span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">y</span> <span class="id">b</span> (<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> <span class="id">a</span> <span class="id">m</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof1')">Proof.</span></div>
<div class="proofscript" id="proof1">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">x</span>, <span class="id">y</span>, <span class="id">m</span>; <span class="tactic">simpl</span>; <span class="tactic">intro</span> <span class="id">Neq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="tactic">f_equal</span>; <span class="tactic">apply</span> <span class="id">IHx</span>; <span class="tactic">intro</span> <span class="id">Eq</span>; <span class="tactic">apply</span> <span class="id">Neq</span>; <span class="id">now</span> <span class="tactic">inversion</span> <span class="id">Eq</span>) || <span class="id">now</span> <span class="id">contradict</span> <span class="id">Neq</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.in_dec">in_dec</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> (<span class="id">m</span>: <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> <span class="id">m</span> \/ ~<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> <span class="id">m</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof2')">Proof.</span></div>
<div class="proofscript" id="proof2">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">destruct</span> (<span class="id"><a href="Velus.Environment.html#Env.In_dec">Props.P.F.In_dec</a></span> <span class="id">m</span> <span class="id">x</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Remark</span> <span class="id"><a name="Env.option_map_map">option_map_map</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> <span class="id">B</span> <span class="id">C</span>} (<span class="id">f</span>: <span class="id">A</span> -&gt; <span class="id">B</span>) (<span class="id">g</span>: <span class="id">B</span> -&gt; <span class="id">C</span>) <span class="id">o</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option_map">option_map</a></span> <span class="id">g</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option_map">option_map</a></span> <span class="id">f</span> <span class="id">o</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option_map">option_map</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">g</span> (<span class="id">f</span> <span class="id">x</span>)) <span class="id">o</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof3')">Proof.</span></div>
<div class="proofscript" id="proof3">
 <span class="id">now</span> <span class="tactic">destruct</span> <span class="id">o</span>. Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.xmapi_xmapi">xmapi_xmapi</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">B</span> <span class="id">C</span>} (<span class="id">f</span>: <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> -&gt; <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span> -&gt; <span class="id">B</span>) (<span class="id">g</span>: <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> -&gt; <span class="id">B</span> -&gt; <span class="id">C</span>) (<span class="id">m</span>: <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>) <span class="id">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.xmapi">xmapi</a></span> <span class="id">g</span> (<span class="id"><a href="Velus.Environment.html#Env.xmapi">xmapi</a></span> <span class="id">f</span> <span class="id">m</span> <span class="id">x</span>) <span class="id">x</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.xmapi">xmapi</a></span> (<span class="kwd">fun</span> <span class="id">x</span> (<span class="id">v</span> : <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>) =&gt; <span class="id">g</span> <span class="id">x</span> (<span class="id">f</span> <span class="id">x</span> <span class="id">v</span>)) <span class="id">m</span> <span class="id">x</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof4')">Proof.</span></div>
<div class="proofscript" id="proof4">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">m</span>; <span class="tactic">intro</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">f_equal</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.option_map_map">option_map_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.mapi_mapi">mapi_mapi</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">B</span> <span class="id">C</span>} (<span class="id">f</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> -&gt; <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span> -&gt; <span class="id">B</span>) (<span class="id">g</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> -&gt; <span class="id">B</span> -&gt; <span class="id">C</span>) (<span class="id">m</span>: <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.mapi">mapi</a></span> <span class="id">g</span> (<span class="id"><a href="Velus.Environment.html#Env.mapi">mapi</a></span> <span class="id">f</span> <span class="id">m</span>) = <span class="id"><a href="Velus.Environment.html#Env.mapi">mapi</a></span> (<span class="kwd">fun</span> <span class="id">x</span> <span class="id">v</span> =&gt; <span class="id">g</span> <span class="id">x</span> (<span class="id">f</span> <span class="id">x</span> <span class="id">v</span>)) <span class="id">m</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof5')">Proof.</span></div>
<div class="proofscript" id="proof5">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.mapi">mapi</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.xmapi_xmapi">xmapi_xmapi</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.mapi_elements">mapi_elements</a></span> {<span class="id">B</span>} (<span class="id">f</span> : <span class="id">_</span> -&gt; <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span> -&gt; <span class="id">B</span>) : <span class="kwd">forall</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.elements">Env.elements</a></span> (<span class="id"><a href="Velus.Environment.html#Env.mapi">Env.mapi</a></span> <span class="id">f</span> <span class="id">m</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, <span class="id">y</span>) =&gt; (<span class="id">x</span>, <span class="id">f</span> <span class="id">x</span> <span class="id">y</span>)) (<span class="id"><a href="Velus.Environment.html#Env.elements">Env.elements</a></span> <span class="id">m</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof6')">Proof.</span></div>
<div class="proofscript" id="proof6">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">m</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.elements">elements</a></span>, <span class="id"><a href="Velus.Environment.html#Env.mapi">mapi</a></span>. <span class="tactic">generalize</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span> <span class="kwd">as</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">m</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>; <span class="tactic">simpl</span>; <span class="tactic">f_equal</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.map_map">map_map</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">B</span> <span class="id">C</span>} (<span class="id">f</span>: <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span> -&gt; <span class="id">B</span>) (<span class="id">g</span>: <span class="id">B</span> -&gt; <span class="id">C</span>) (<span class="id">m</span>: <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.map">map</a></span> <span class="id">g</span> (<span class="id"><a href="Velus.Environment.html#Env.map">map</a></span> <span class="id">f</span> <span class="id">m</span>) = <span class="id"><a href="Velus.Environment.html#Env.map">map</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">g</span> (<span class="id">f</span> <span class="id">x</span>)) <span class="id">m</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof7')">Proof.</span></div>
<div class="proofscript" id="proof7">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.map">map</a></span>, <span class="id"><a href="Velus.Environment.html#Env.mapi">mapi</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.xmapi_xmapi">xmapi_xmapi</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="Env.xmapi_ext">xmapi_ext</a></span> : <span class="kwd">forall</span> {<span class="id">B</span>} (<span class="id">f</span> <span class="id">g</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> -&gt; <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span> -&gt; <span class="id">B</span>) (<span class="id">m</span> : <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>) <span class="id">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">p</span> <span class="id">x</span>, <span class="id">f</span> <span class="id">p</span> <span class="id">x</span> = <span class="id">g</span> <span class="id">p</span> <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.xmapi">xmapi</a></span> <span class="id">f</span> <span class="id">m</span> <span class="id">p</span> = <span class="id"><a href="Velus.Environment.html#Env.xmapi">xmapi</a></span> <span class="id">g</span> <span class="id">m</span> <span class="id">p</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof8')">Proof.</span></div>
<div class="proofscript" id="proof8">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">m</span>; <span class="tactic">intros</span> <span class="id">p</span> <span class="id">Heq</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">f_equal</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">simpl</span>; <span class="tactic">f_equal</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.map_ext">map_ext</a></span>: <span class="kwd">forall</span> {<span class="id">B</span>} (<span class="id">f</span> <span class="id">g</span> : <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span> -&gt; <span class="id">B</span>) (<span class="id">m</span>: <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id">f</span> <span class="id">x</span> = <span class="id">g</span> <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.map">map</a></span> <span class="id">f</span> <span class="id">m</span> = <span class="id"><a href="Velus.Environment.html#Env.map">map</a></span> <span class="id">g</span> <span class="id">m</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof9')">Proof.</span></div>
<div class="proofscript" id="proof9">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.map">map</a></span>, <span class="id"><a href="Velus.Environment.html#Env.mapi">mapi</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.xmapi_ext">xmapi_ext</a></span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.map_Equiv">map_Equiv</a></span> {<span class="id">B</span>} {<span class="id">Ra</span>: <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span> -&gt; <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span> -&gt; <span class="kwd">Prop</span>} {<span class="id">Rb</span>: <span class="id">B</span> -&gt; <span class="id">B</span> -&gt; <span class="kwd">Prop</span>} : <span class="kwd">forall</span> (<span class="id">f</span> : <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span> -&gt; <span class="id">B</span>) (<span class="id">m1</span> <span class="id">m2</span>: <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">Ra</span> <span class="id">x</span> <span class="id">y</span> -&gt; <span class="id">Rb</span> (<span class="id">f</span> <span class="id">x</span>) (<span class="id">f</span> <span class="id">y</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.Equiv">Env.Equiv</a></span> <span class="id">Ra</span> <span class="id">m1</span> <span class="id">m2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.Equiv">Env.Equiv</a></span> <span class="id">Rb</span> (<span class="id"><a href="Velus.Environment.html#Env.map">Env.map</a></span> <span class="id">f</span> <span class="id">m1</span>) (<span class="id"><a href="Velus.Environment.html#Env.map">Env.map</a></span> <span class="id">f</span> <span class="id">m2</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof10')">Proof.</span></div>
<div class="proofscript" id="proof10">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hf</span> (<span class="id">HIn</span>&amp;<span class="id">Hfind</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span>. <span class="id">now</span> <span class="tactic">rewrite</span> 2 <span class="id"><a href="Velus.Environment.html#Env.map_in_iff">Props.P.F.map_in_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.MapsTo">MapsTo</a></span> <span class="kwd">in</span> *. <span class="tactic">intros</span> * <span class="id">Hfind1</span> <span class="id">Hfind2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.map_o">Props.P.F.map_o</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">k</span> <span class="id">m1</span>) <span class="id">eqn</span>:<span class="id">Hfind1</span>'; <span class="id">inv</span> <span class="id">Hfind1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">k</span> <span class="id">m2</span>) <span class="id">eqn</span>:<span class="id">Hfind2</span>'; <span class="id">inv</span> <span class="id">Hfind2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hf</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Env.adds_with">adds_with</a></span> {<span class="id">B</span>} (<span class="id">f</span>: <span class="id">B</span> -&gt; <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>) (<span class="id">xs</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> * <span class="id">B</span>)) (<span class="id">m</span>: <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>) : <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_left">fold_left</a></span> (<span class="kwd">fun</span> <span class="id">env</span> (<span class="id">xv</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> * <span class="id">B</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">x</span>, <span class="id">v</span>) := <span class="id">xv</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> (<span class="id">f</span> <span class="id">v</span>) <span class="id">env</span>) <span class="id">xs</span> <span class="id">m</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Env.from_list_with">from_list_with</a></span> {<span class="id">B</span>} (<span class="id">f</span>: <span class="id">B</span> -&gt; <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>) (<span class="id">xs</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> * <span class="id">B</span>)) : <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.adds_with">adds_with</a></span> <span class="id">f</span> <span class="id">xs</span> (@<span class="id"><a href="Velus.Environment.html#Env.empty">empty</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">adds</span>' (<span class="id">xs</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> * <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>)) (<span class="id">m</span>: <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>) : <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_left">fold_left</a></span> (<span class="kwd">fun</span> <span class="id">env</span> (<span class="id">xv</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> * <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">x</span> , <span class="id">v</span>) := <span class="id">xv</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">env</span>) <span class="id">xs</span> <span class="id">m</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Env.from_list">from_list</a></span> (<span class="id">xs</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> * <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>)) : <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">adds</span>' <span class="id">xs</span> (@<span class="id"><a href="Velus.Environment.html#Env.empty">empty</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Env.adds_opt">adds_opt</a></span> (<span class="id">xs</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">vos</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>)) (<span class="id">e</span> : <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>) : <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_right">fold_right</a></span> (<span class="kwd">fun</span> (<span class="id">xvo</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>) <span class="id">env</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">xvo</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">x</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>) =&gt; <span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">env</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">env</span> <span class="kwd">end</span>) <span class="id">e</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#combine">combine</a></span> <span class="id">xs</span> <span class="id">vos</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Env.adds">adds</a></span> (<span class="id">xs</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>) (<span class="id">m</span> : <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>) : <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">adds</span>' (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#combine">combine</a></span> <span class="id">xs</span> <span class="id">vs</span>) <span class="id">m</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">adds</span>'<span class="id">_is_adds_with_identity</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">xs</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">adds</span>' <span class="id">xs</span> <span class="id">m</span> = <span class="id"><a href="Velus.Environment.html#Env.adds_with">adds_with</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">x</span>) <span class="id">xs</span> <span class="id">m</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof11')">Proof.</span></div>
<div class="proofscript" id="proof11">
 <span class="tactic">reflexivity</span>. Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="Env.Extra.AddsWith">AddsWith</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">B</span>: <span class="kwd">Type</span>}.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id"><a name="Env.Extra.AddsWith.f">f</a></span>: <span class="id"><a href="Velus.Environment.html#Env.Extra.AddsWith.B">B</a></span> -&gt; <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.adds_with_app">adds_with_app</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">xs</span> <span class="id">ys</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.adds_with">adds_with</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.AddsWith.f">f</a></span> <span class="id">ys</span> (<span class="id"><a href="Velus.Environment.html#Env.adds_with">adds_with</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.AddsWith.f">f</a></span> <span class="id">xs</span> <span class="id">s</span>) = <span class="id"><a href="Velus.Environment.html#Env.adds_with">adds_with</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.AddsWith.f">f</a></span> (<span class="id">xs</span> ++ <span class="id">ys</span>) <span class="id">s</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof12')">Proof.</span></div>
<div class="proofscript" id="proof12">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xs</span> <span class="kwd">as</span> [|<span class="id">x</span> <span class="id">xs</span> <span class="id">IH</span>]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">setoid_rewrite</span> <span class="id">IH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.find_adds_with_spec">find_adds_with_spec</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">xvs</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Common.CommonList.html#InMembers">InMembers</a></span> <span class="id">x</span> <span class="id">xvs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span>', <span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.adds_with">adds_with</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.AddsWith.f">f</a></span> <span class="id">xvs</span> <span class="id">s</span>) = <span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.adds_with">adds_with</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.AddsWith.f">f</a></span> <span class="id">xvs</span> <span class="id">s</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (~ <span class="id"><a href="Velus.Common.CommonList.html#InMembers">InMembers</a></span> <span class="id">x</span> <span class="id">xvs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.adds_with">adds_with</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.AddsWith.f">f</a></span> <span class="id">xvs</span> <span class="id">s</span>) = <span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">s</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof13')">Proof.</span></div>
<div class="proofscript" id="proof13">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xvs</span> <span class="kwd">as</span> [|(<span class="id">x</span>', <span class="id">v</span>')].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intuition</span>; <span class="tactic">destruct</span> <span class="id">H</span>; <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span>; <span class="tactic">intros</span> [?|<span class="id">Hin</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*{ <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Common.CommonList.html#InMembers_dec">InMembers_dec</a></span> <span class="id">x</span> <span class="id">xvs</span>) <span class="kwd">as</span> [|<span class="id">Notin</span>]; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span>; <span class="tactic">eapply</span> <span class="id">IHxvs</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">pose</span> <span class="id">proof</span> <span class="id">Notin</span> <span class="kwd">as</span> <span class="id">Notin</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHxvs</span> <span class="kwd">in</span> <span class="id">Notin</span>; <span class="tactic">rewrite</span> <span class="id">Notin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHxvs</span> <span class="kwd">in</span> <span class="id">Notin</span>'; <span class="tactic">rewrite</span> <span class="id">Notin</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> 2 <span class="id"><a href="Velus.Environment.html#Env.gss">gss</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span>; <span class="tactic">eapply</span> <span class="id">IHxvs</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#NotInMembers_cons">NotInMembers_cons</a></span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span> (<span class="id">Notin</span> &amp;?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHxvs</span> <span class="kwd">in</span> <span class="id">Notin</span>; <span class="tactic">rewrite</span> <span class="id">Notin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.gso">gso</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.gsso_with">gsso_with</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">xvs</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="Velus.Common.CommonList.html#InMembers">InMembers</a></span> <span class="id">x</span> <span class="id">xvs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.adds_with">adds_with</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.AddsWith.f">f</a></span> <span class="id">xvs</span> <span class="id">m</span>) = <span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof14')">Proof.</span></div>
<div class="proofscript" id="proof14">
 <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.find_adds_with_spec">find_adds_with_spec</a></span>. Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.find_adds_with_spec_Some">find_adds_with_spec_Some</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">xvs</span> <span class="id">x</span> <span class="id">a</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.adds_with">adds_with</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.AddsWith.f">f</a></span> <span class="id">xvs</span> <span class="id">m</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">a</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">exists</span> <span class="id">b</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> (<span class="id">x</span>, <span class="id">b</span>) <span class="id">xvs</span> /\ <span class="id"><a href="Velus.Environment.html#Env.Extra.AddsWith.f">f</a></span> <span class="id">b</span> = <span class="id">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/ (~ <span class="id"><a href="Velus.Common.CommonList.html#InMembers">InMembers</a></span> <span class="id">x</span> <span class="id">xvs</span> /\ <span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">a</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof15')">Proof.</span></div>
<div class="proofscript" id="proof15">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xvs</span> <span class="kwd">as</span> [|(<span class="id">x</span>', <span class="id">v</span>') <span class="id">xs</span> <span class="id">IH</span>]; <span class="tactic">simpl</span>. <span class="id">now</span> <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hfind</span>. <span class="tactic">apply</span> <span class="id">IH</span> <span class="kwd">in</span> <span class="id">Hfind</span> <span class="kwd">as</span> [(?&amp;?&amp;?)|(<span class="id">Hnim</span> &amp; <span class="id">Hfind</span>)]; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">x</span>' <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">subst</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gss">gss</a></span> <span class="kwd">in</span> <span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">injection</span> <span class="id">Hfind</span>. <span class="tactic">intro</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gso">gso</a></span> <span class="kwd">in</span> <span class="id">Hfind</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.find_gsso_with">find_gsso_with</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">xvs</span> <span class="id">x</span> <span class="id">y</span> <span class="id">a</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">x</span> &lt;&gt; <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.adds_with">adds_with</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.AddsWith.f">f</a></span> ((<span class="id">y</span>, <span class="id">a</span>) :: <span class="id">xvs</span>) <span class="id">m</span>) = <span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.adds_with">adds_with</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.AddsWith.f">f</a></span> <span class="id">xvs</span> <span class="id">m</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof16')">Proof.</span></div>
<div class="proofscript" id="proof16">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Common.CommonList.html#InMembers_dec">InMembers_dec</a></span> <span class="id">x</span> <span class="id">xvs</span>) <span class="kwd">as</span> [|<span class="id">Notin</span>]; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.find_adds_with_spec">find_adds_with_spec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> 2 <span class="id"><a href="Velus.Environment.html#Env.gsso_with">gsso_with</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.gso">gso</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.find_gsss_with">find_gsss_with</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">a</span> <span class="id">xvs</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="Velus.Common.CommonList.html#InMembers">InMembers</a></span> <span class="id">x</span> <span class="id">xvs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.adds_with">adds_with</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.AddsWith.f">f</a></span> ((<span class="id">x</span>, <span class="id">a</span>) :: <span class="id">xvs</span>) <span class="id">m</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Velus.Environment.html#Env.Extra.AddsWith.f">f</a></span> <span class="id">a</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof17')">Proof.</span></div>
<div class="proofscript" id="proof17">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> (<span class="id"><a href="Velus.Environment.html#Env.find_adds_with_spec">find_adds_with_spec</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>)); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.gss">gss</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.In_find_adds_with">In_find_adds_with</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">a</span> <span class="id">xvs</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> <span class="id">xvs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> (<span class="id">x</span>, <span class="id">a</span>) <span class="id">xvs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.adds_with">adds_with</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.AddsWith.f">f</a></span> <span class="id">xvs</span> <span class="id">m</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Velus.Environment.html#Env.Extra.AddsWith.f">f</a></span> <span class="id">a</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof18')">Proof.</span></div>
<div class="proofscript" id="proof18">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xvs</span> <span class="kwd">as</span> [|(<span class="id">y</span>, <span class="id">b</span>)]; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion_clear</span> 1 <span class="kwd">as</span> [|?? <span class="id">Notin</span>]; <span class="tactic">inversion_clear</span> 1 <span class="kwd">as</span> [<span class="id">E</span>|]; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">E</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gsso_with">gsso_with</a></span>, <span class="id"><a href="Velus.Environment.html#Env.gss">gss</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.adds_with_cons">adds_with_cons</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">xvs</span> <span class="id">x</span> <span class="id">b</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="Velus.Common.CommonList.html#InMembers">InMembers</a></span> <span class="id">x</span> <span class="id">xvs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.adds_with">adds_with</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.AddsWith.f">f</a></span> ((<span class="id">x</span>, <span class="id">b</span>) :: <span class="id">xvs</span>) <span class="id">m</span> = <span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.Extra.AddsWith.f">f</a></span> <span class="id">b</span>) (<span class="id"><a href="Velus.Environment.html#Env.adds_with">adds_with</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.AddsWith.f">f</a></span> <span class="id">xvs</span> <span class="id">m</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof19')">Proof.</span></div>
<div class="proofscript" id="proof19">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.adds_with">adds_with</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xvs</span> <span class="kwd">as</span> [|(<span class="id">y</span>, <span class="id">b</span>')]; <span class="tactic">intros</span> * <span class="id">NotIn</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#NotInMembers_cons">NotInMembers_cons</a></span> <span class="kwd">in</span> <span class="id">NotIn</span>. <span class="tactic">destruct</span> <span class="id">NotIn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;-<span class="id">IHxvs</span>; <span class="tactic">auto</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.add_comm">add_comm</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="Velus.Environment.html#Env.Extra.AddsWith">AddsWith</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">adds</span>'<span class="id">_app</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">xs</span> <span class="id">ys</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">adds</span>' <span class="id">ys</span> (<span class="id">adds</span>' <span class="id">xs</span> <span class="id">s</span>) = <span class="id">adds</span>' (<span class="id">xs</span> ++ <span class="id">ys</span>) <span class="id">s</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof20')">Proof.</span></div>
<div class="proofscript" id="proof20">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">setoid_rewrite</span> <span class="id">adds</span>'<span class="id">_is_adds_with_identity</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">adds</span>'<span class="id">_is_adds_with_identity</span> <span class="id">xs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.adds_with_app">adds_with_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">gsso</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">xvs</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="Velus.Common.CommonList.html#InMembers">InMembers</a></span> <span class="id">x</span> <span class="id">xvs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id">adds</span>' <span class="id">xvs</span> <span class="id">m</span>) = <span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof21')">Proof.</span></div>
<div class="proofscript" id="proof21">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id">adds</span>'<span class="id">_is_adds_with_identity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.gsso_with">gsso_with</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="Env.gsso">gsso</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">xs</span> (<span class="id">vs</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>) <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> <span class="id">x</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.adds">adds</a></span> <span class="id">xs</span> <span class="id">vs</span> <span class="id">m</span>) = <span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof22')">Proof.</span></div>
<div class="proofscript" id="proof22">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.adds">adds</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">gsso</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hin</span>; <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#InMembers_In_combine">InMembers_In_combine</a></span> <span class="kwd">in</span> <span class="id">Hin</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.from_list_find_In">from_list_find_In</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">xvs</span> <span class="id">x</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.from_list">from_list</a></span> <span class="id">xvs</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">a</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> (<span class="id">x</span>, <span class="id">a</span>) <span class="id">xvs</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof23')">Proof.</span></div>
<div class="proofscript" id="proof23">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.from_list">from_list</a></span>. <span class="tactic">setoid_rewrite</span> <span class="id">adds</span>'<span class="id">_is_adds_with_identity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Find</span>; <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.find_adds_with_spec_Some">find_adds_with_spec_Some</a></span> <span class="kwd">in</span> <span class="id">Find</span> <span class="kwd">as</span> [(?&amp;?&amp;?)|(?&amp; <span class="id">Find</span>)]; <span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gempty">gempty</a></span> <span class="kwd">in</span> <span class="id">Find</span>; <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">find_gsso</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">xvs</span> <span class="id">x</span> <span class="id">y</span> <span class="id">a</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">x</span> &lt;&gt; <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id">adds</span>' ((<span class="id">y</span>, <span class="id">a</span>) :: <span class="id">xvs</span>) <span class="id">m</span>) = <span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id">adds</span>' <span class="id">xvs</span> <span class="id">m</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof24')">Proof.</span></div>
<div class="proofscript" id="proof24">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">setoid_rewrite</span> <span class="id">adds</span>'<span class="id">_is_adds_with_identity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.find_gsso_with">find_gsso_with</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="Env.find_gsso">find_gsso</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">xs</span> (<span class="id">vs</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>) <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">x</span> &lt;&gt; <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.adds">adds</a></span> (<span class="id">y</span> :: <span class="id">xs</span>) <span class="id">vs</span> <span class="id">m</span>) = <span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.adds">adds</a></span> <span class="id">xs</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#tl">tl</a></span> <span class="id">vs</span>) <span class="id">m</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof25')">Proof.</span></div>
<div class="proofscript" id="proof25">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hneq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.adds">adds</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">vs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">xs</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="id">combine</span>; <span class="id">now</span> <span class="tactic">apply</span> <span class="id">find_gsso</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">find_gsss</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">a</span> <span class="id">xvs</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="Velus.Common.CommonList.html#InMembers">InMembers</a></span> <span class="id">x</span> <span class="id">xvs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id">adds</span>' ((<span class="id">x</span>, <span class="id">a</span>) :: <span class="id">xvs</span>) <span class="id">m</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">a</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof26')">Proof.</span></div>
<div class="proofscript" id="proof26">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">setoid_rewrite</span> <span class="id">adds</span>'<span class="id">_is_adds_with_identity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.find_gsss_with">find_gsss_with</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="Env.find_gsss">find_gsss</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">a</span> <span class="id">xs</span> (<span class="id">vs</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>) <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> <span class="id">x</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.adds">adds</a></span> (<span class="id">x</span> :: <span class="id">xs</span>) (<span class="id">a</span> :: <span class="id">vs</span>) <span class="id">m</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">a</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof27')">Proof.</span></div>
<div class="proofscript" id="proof27">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.adds">adds</a></span>; <span class="tactic">simpl</span> <span class="id">combine</span>; <span class="tactic">apply</span> <span class="id">find_gsss</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hin</span>; <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#InMembers_In_combine">InMembers_In_combine</a></span> <span class="kwd">in</span> <span class="id">Hin</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">In_find_adds</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">a</span> <span class="id">xvs</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> <span class="id">xvs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> (<span class="id">x</span>, <span class="id">a</span>) <span class="id">xvs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id">adds</span>' <span class="id">xvs</span> <span class="id">m</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">a</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof28')">Proof.</span></div>
<div class="proofscript" id="proof28">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">rewrite</span> <span class="id">adds</span>'<span class="id">_is_adds_with_identity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="Velus.Environment.html#Env.In_find_adds_with">In_find_adds_with</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="Env.In_find_adds">In_find_adds</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">a</span> <span class="id">xs</span> <span class="id">vs</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> (<span class="id">x</span>, <span class="id">a</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#combine">combine</a></span> <span class="id">xs</span> <span class="id">vs</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.adds">adds</a></span> <span class="id">xs</span> <span class="id">vs</span> <span class="id">m</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">a</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof29')">Proof.</span></div>
<div class="proofscript" id="proof29">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.adds">adds</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">In_find_adds</span>'; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDup_NoDupMembers_combine">NoDup_NoDupMembers_combine</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">In_adds_spec</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">xvs</span> (<span class="id">m</span>: <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> (<span class="id">adds</span>' <span class="id">xvs</span> <span class="id">m</span>) &lt;-&gt; (<span class="id"><a href="Velus.Common.CommonList.html#InMembers">InMembers</a></span> <span class="id">x</span> <span class="id">xvs</span> \/ <span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> <span class="id">m</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof30')">Proof.</span></div>
<div class="proofscript" id="proof30">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xvs</span> <span class="kwd">as</span> [|(<span class="id">x</span>', <span class="id">v</span>')]; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intro</span>; <span class="tactic">rewrite</span> <span class="id">IHxvs</span>, <span class="id"><a href="Velus.Environment.html#Env.add_in_iff">Props.P.F.add_in_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">find_adds</span>'<span class="id">_In</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">xvs</span> (<span class="id">m</span>: <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id">adds</span>' <span class="id">xvs</span> <span class="id">m</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span> -&gt; (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> (<span class="id">x</span>, <span class="id">y</span>) <span class="id">xvs</span> \/ <span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof31')">Proof.</span></div>
<div class="proofscript" id="proof31">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xvs</span> <span class="kwd">as</span> [|(<span class="id">x</span>', <span class="id">v</span>')]; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">IHxvs</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">H</span>|<span class="id">H</span>]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.FSets.FMapPositive.html#PositiveMap.E.eq_dec">PositiveMap.E.eq_dec</a></span> <span class="id">x</span> <span class="id">x</span>'); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.FSets.FMapPositive.html#PositiveMap.gss">PositiveMap.gss</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.FSets.FMapPositive.html#PositiveMap.gso">PositiveMap.gso</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">find_adds</span>'<span class="id">_nIn</span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">xvs</span> (<span class="id">m</span> : <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id">adds</span>' <span class="id">xvs</span> <span class="id">m</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> &lt;-&gt; (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#not">not</a></span> (<span class="id"><a href="Velus.Common.CommonList.html#InMembers">InMembers</a></span> <span class="id">x</span> <span class="id">xvs</span>) /\ <span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof32')">Proof.</span></div>
<div class="proofscript" id="proof32">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xvs</span>; <span class="tactic">intros</span> *; <span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">split</span>; [<span class="tactic">intros</span> <span class="id">Hfind</span>|<span class="tactic">intros</span> (<span class="id">Hnin</span>&amp;<span class="id">Hfind</span>)]); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">a</span> <span class="kwd">as</span> (?&amp;?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHxvs</span> <span class="kwd">in</span> <span class="id">Hfind</span> <span class="kwd">as</span> (<span class="id">Hfind</span>&amp;<span class="id">Hnin</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.FSets.FMapPositive.html#PositiveMap.E.eq_dec">PositiveMap.E.eq_dec</a></span> <span class="id">p</span> <span class="id">x</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gss">Env.gss</a></span> <span class="kwd">in</span> <span class="id">Hnin</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gso">Env.gso</a></span> <span class="kwd">in</span> <span class="id">Hnin</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">intros</span> [?|?]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">a</span> <span class="kwd">as</span> (?&amp;?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHxvs</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intro</span> <span class="id">contra</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gso">Env.gso</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">find_gsss</span>'<span class="id">_irrelevant</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">a</span> <span class="id">xvs</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#InMembers">InMembers</a></span> <span class="id">x</span> <span class="id">xvs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id">adds</span>' <span class="id">xvs</span> <span class="id">m1</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">a</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id">adds</span>' <span class="id">xvs</span> <span class="id">m2</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">a</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof33')">Proof.</span></div>
<div class="proofscript" id="proof33">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xvs</span> <span class="kwd">as</span> [|(?&amp;?)]; <span class="tactic">intros</span> * <span class="id">Hin</span> <span class="id">Hfind</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">Hin</span>, (<span class="id"><a href="Velus.Common.Common.html#ident_eq_dec">ident_eq_dec</a></span> <span class="id">k</span> <span class="id">x</span>), (<span class="id"><a href="Velus.Common.CommonList.html#InMembers_dec">InMembers_dec</a></span> <span class="id">x</span> <span class="id">xvs</span> <span class="id"><a href="Velus.Common.Common.html#ident_eq_dec">ident_eq_dec</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id">find_gsss</span>' <span class="kwd">in</span> <span class="id">Hfind</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id">find_gsss</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id">find_gsss</span>'<span class="id">_empty</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">a</span> <span class="id">xvs</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id">adds</span>' <span class="id">xvs</span> (<span class="id"><a href="Velus.Environment.html#Env.empty">Env.empty</a></span> <span class="id">_</span>)) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">a</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id">adds</span>' <span class="id">xvs</span> <span class="id">m</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">a</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof34')">Proof.</span></div>
<div class="proofscript" id="proof34">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">find_gsss</span>'<span class="id">_irrelevant</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">find_adds</span>'<span class="id">_In</span> <span class="kwd">in</span> <span class="id">Hfind</span> <span class="kwd">as</span> [<span class="id">Hin</span>|<span class="id">Hin</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#In_InMembers">In_InMembers</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.FSets.FMapPositive.html#PositiveMap.gempty">PositiveMap.gempty</a></span> <span class="kwd">in</span> <span class="id">Hin</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="Env.In_adds_spec">In_adds_spec</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">xs</span> <span class="id">vs</span> (<span class="id">m</span>: <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">xs</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.adds">adds</a></span> <span class="id">xs</span> <span class="id">vs</span> <span class="id">m</span>) &lt;-&gt; (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> <span class="id">x</span> <span class="id">xs</span> \/ <span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> <span class="id">m</span>)).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof35')">Proof.</span></div>
<div class="proofscript" id="proof35">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.adds">adds</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">In_adds_spec</span>', &lt;-<span class="id"><a href="Velus.Common.CommonList.html#In_InMembers_combine">In_InMembers_combine</a></span>; <span class="tactic">auto</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.adds_opt_nil_nil">adds_opt_nil_nil</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.adds_opt">adds_opt</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nil">List.nil</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nil">List.nil</a></span> <span class="id">e</span> = <span class="id">e</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof36')">Proof.</span></div>
<div class="proofscript" id="proof36">
 <span class="tactic">simpl</span>; <span class="tactic">auto</span>. Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.adds_opt_nil_l">adds_opt_nil_l</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span> <span class="id">vs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.adds_opt">adds_opt</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nil">List.nil</a></span> <span class="id">vs</span> <span class="id">e</span> = <span class="id">e</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof37')">Proof.</span></div>
<div class="proofscript" id="proof37">
 <span class="tactic">simpl</span>; <span class="tactic">auto</span>. Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.adds_nil_nil">adds_nil_nil</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.adds">adds</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nil">List.nil</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nil">List.nil</a></span> <span class="id">e</span> = <span class="id">e</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof38')">Proof.</span></div>
<div class="proofscript" id="proof38">
 <span class="tactic">simpl</span>; <span class="tactic">auto</span>. Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.adds_nil_l">adds_nil_l</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e</span> <span class="id">vs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.adds">adds</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nil">List.nil</a></span> <span class="id">vs</span> <span class="id">e</span> = <span class="id">e</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof39')">Proof.</span></div>
<div class="proofscript" id="proof39">
 <span class="tactic">simpl</span>; <span class="tactic">auto</span>. Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.adds_cons">adds_cons</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">xs</span> <span class="id">vs</span> <span class="id">x</span> (<span class="id">a</span>: <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>) <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.adds">adds</a></span> (<span class="id">x</span> :: <span class="id">xs</span>) (<span class="id">a</span> :: <span class="id">vs</span>) <span class="id">m</span> = <span class="id"><a href="Velus.Environment.html#Env.adds">adds</a></span> <span class="id">xs</span> <span class="id">vs</span> (<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> <span class="id">a</span> <span class="id">m</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof40')">Proof.</span></div>
<div class="proofscript" id="proof40">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.adds">adds</a></span>; <span class="tactic">simpl</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">adds</span>'<span class="id">_cons</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">xvs</span> <span class="id">x</span> (<span class="id">a</span>: <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>) <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="Velus.Common.CommonList.html#InMembers">InMembers</a></span> <span class="id">x</span> <span class="id">xvs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">adds</span>' ((<span class="id">x</span>, <span class="id">a</span>) :: <span class="id">xvs</span>) <span class="id">m</span> = <span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> <span class="id">a</span> (<span class="id">adds</span>' <span class="id">xvs</span> <span class="id">m</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof41')">Proof.</span></div>
<div class="proofscript" id="proof41">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id">adds</span>'<span class="id">_is_adds_with_identity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.adds_with_cons">adds_with_cons</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="Env.adds_cons_cons">adds_cons_cons</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">xs</span> <span class="id">x</span> (<span class="id">a</span>: <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>) <span class="id">vs</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> <span class="id">x</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.adds">adds</a></span> (<span class="id">x</span> :: <span class="id">xs</span>) (<span class="id">a</span> :: <span class="id">vs</span>) <span class="id">m</span> = <span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> <span class="id">a</span> (<span class="id"><a href="Velus.Environment.html#Env.adds">adds</a></span> <span class="id">xs</span> <span class="id">vs</span> <span class="id">m</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof42')">Proof.</span></div>
<div class="proofscript" id="proof42">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.adds">adds</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="id">combine</span>; <span class="tactic">eapply</span> <span class="id">adds</span>'<span class="id">_cons</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hin</span>; <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#InMembers_In_combine">InMembers_In_combine</a></span> <span class="kwd">in</span> <span class="id">Hin</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.find_In_from_list">find_In_from_list</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> (<span class="id">v</span> : <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>) <span class="id">xs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> (<span class="id">x</span>, <span class="id">v</span>) <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.from_list">from_list</a></span> <span class="id">xs</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof43')">Proof.</span></div>
<div class="proofscript" id="proof43">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xs</span> <span class="kwd">as</span> [|(<span class="id">x</span>', <span class="id">v</span>') <span class="id">xs</span> <span class="id">IH</span>]. <span class="id">now</span> <span class="tactic">inversion</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Ix</span> <span class="id">ND</span>. <span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.from_list">from_list</a></span>. <span class="id">inv</span> <span class="id">Ix</span>; <span class="id">inv</span> <span class="id">ND</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">take</span> ((<span class="id">_</span>, <span class="id">_</span>) = (<span class="id">_</span>, <span class="id">_</span>)) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">adds</span>'<span class="id">_cons</span>, <span class="id"><a href="Velus.Environment.html#Env.gss">Env.gss</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">find_gsso</span>'. <span class="id">now</span> <span class="tactic">apply</span> <span class="id">IH</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> <span class="id">_</span> <span class="id">_</span>) <span class="id">and</span> <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#In_InMembers">In_InMembers</a></span> <span class="kwd">in</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>; <span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.In_from_list">In_from_list</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> (<span class="id">xs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.from_list">from_list</a></span> <span class="id">xs</span>) &lt;-&gt; <span class="id"><a href="Velus.Common.CommonList.html#InMembers">InMembers</a></span> <span class="id">x</span> <span class="id">xs</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof44')">Proof.</span></div>
<div class="proofscript" id="proof44">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.from_list">from_list</a></span>. <span class="tactic">setoid_rewrite</span> <span class="id">In_adds_spec</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">HH</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">HH</span> <span class="kwd">as</span> [|<span class="id">HH</span>]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.empty_in_iff">Props.P.F.empty_in_iff</a></span> <span class="kwd">in</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.In_find">In_find</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> (<span class="id">s</span>: <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> <span class="id">s</span> &lt;-&gt; (<span class="tactic">exists</span> <span class="id">v</span>, <span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">s</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof45')">Proof.</span></div>
<div class="proofscript" id="proof45">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.in_find_iff">Props.P.F.in_find_iff</a></span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="Env.find_In">find_In</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> (<span class="id">s</span>: <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>) <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">s</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> <span class="id">s</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof46')">Proof.</span></div>
<div class="proofscript" id="proof46">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.In_find">In_find</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.elements_In">elements_In</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> (<span class="id">a</span>: <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>) <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> (<span class="id">x</span>, <span class="id">a</span>) (<span class="id"><a href="Velus.Environment.html#Env.elements">elements</a></span> <span class="id">m</span>) -&gt; <span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> <span class="id">m</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof47')">Proof.</span></div>
<div class="proofscript" id="proof47">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.elements_complete">elements_complete</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.In_find">In_find</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.NoDup_snd_elements">NoDup_snd_elements</a></span> : <span class="kwd">forall</span> <span class="id">env</span> <span class="id">x1</span> <span class="id">x2</span> (<span class="id">y</span> : <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="Velus.Environment.html#Env.elements">elements</a></span> <span class="id">env</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x1</span> <span class="id">env</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x2</span> <span class="id">env</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">x1</span> = <span class="id">x2</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof48')">Proof.</span></div>
<div class="proofscript" id="proof48">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hnd</span> <span class="id">Hfind1</span> <span class="id">Hfind2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.elements_correct">elements_correct</a></span> <span class="kwd">in</span> <span class="id">Hfind1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.elements_correct">elements_correct</a></span> <span class="kwd">in</span> <span class="id">Hfind2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDup_snd_det">NoDup_snd_det</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.Equiv_orel">Equiv_orel</a></span> {<span class="id">R</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Relations.Relation_Definitions.html#relation">relation</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">S</span> <span class="id">T</span>, <span class="id"><a href="Velus.Environment.html#Env.Equiv">Env.Equiv</a></span> <span class="id">R</span> <span class="id">S</span> <span class="id">T</span> &lt;-&gt; (<span class="kwd">forall</span> <span class="id">x</span>, (<span class="id"><a href="Velus.Common.Common.html#orel">orel</a></span> <span class="id">R</span>) (<span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> <span class="id">S</span>) (<span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> <span class="id">T</span>)).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof49')">Proof.</span></div>
<div class="proofscript" id="proof49">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; [<span class="tactic">intros</span> (<span class="id">I</span> &amp; <span class="id">M</span>)|<span class="tactic">intros</span> <span class="id">LR</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> <span class="id">S</span>) <span class="kwd">as</span> [<span class="id">v</span>|] <span class="id">eqn</span>:<span class="id">FS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">pose</span> <span class="id">proof</span> (<span class="id"><a href="Velus.Environment.html#Env.find_2">Env.find_2</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">FS</span>) <span class="kwd">as</span> <span class="id">MS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.find_In">find_In</a></span>, <span class="id">I</span> <span class="kwd">in</span> <span class="id">FS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.In_find">In_find</a></span> <span class="kwd">in</span> <span class="id">FS</span>; <span class="tactic">destruct</span> <span class="id">FS</span> <span class="kwd">as</span> (<span class="id">v</span>' &amp; <span class="id">FT</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">pose</span> <span class="id">proof</span> (<span class="id"><a href="Velus.Environment.html#Env.find_2">Env.find_2</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">FT</span>) <span class="kwd">as</span> <span class="id">MT</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id">M</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">MS</span> <span class="id">MT</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">FT</span>. <span class="tactic">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.not_find_in_iff">Env.Props.P.F.not_find_in_iff</a></span> <span class="kwd">in</span> <span class="id">FS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (~<span class="id"><a href="Velus.Environment.html#Env.In">Env.In</a></span> <span class="id">x</span> <span class="id">T</span>) <span class="kwd">as</span> <span class="id">FT</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">intro</span> <span class="id">HH</span>; <span class="tactic">apply</span> <span class="id">I</span> <span class="kwd">in</span> <span class="id">HH</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.not_find_in_iff">Env.Props.P.F.not_find_in_iff</a></span> <span class="kwd">in</span> <span class="id">FT</span> <span class="kwd">as</span> -&gt;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intro</span> <span class="id">x</span>. <span class="tactic">specialize</span> (<span class="id">LR</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">LR</span> <span class="kwd">as</span> [<span class="id">LR1</span> <span class="id">LR2</span>|??? <span class="id">LR1</span> <span class="id">LR2</span>]; <span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">LR1</span>, <span class="id">LR2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.not_find_in_iff">Env.Props.P.F.not_find_in_iff</a></span> <span class="kwd">in</span> <span class="id">LR1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.not_find_in_iff">Env.Props.P.F.not_find_in_iff</a></span> <span class="kwd">in</span> <span class="id">LR2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.find_In">find_In</a></span> <span class="kwd">in</span> <span class="id">LR1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.find_In">find_In</a></span> <span class="kwd">in</span> <span class="id">LR2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">x</span> <span class="id">v</span> <span class="id">v</span>' <span class="id">MS</span> <span class="id">MT</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.find_1">find_1</a></span> <span class="kwd">in</span> <span class="id">MS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.find_1">find_1</a></span> <span class="kwd">in</span> <span class="id">MT</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id">LR</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">LR</span> <span class="kwd">as</span> [<span class="id">LR1</span> <span class="id">LR2</span>|??? <span class="id">LR1</span> <span class="id">LR2</span>]; <span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">LR1</span>, <span class="id">LR2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">MS</span> <span class="kwd">in</span> <span class="id">LR1</span>; <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">MS</span> <span class="kwd">in</span> <span class="id">LR1</span>. <span class="tactic">rewrite</span> <span class="id">MT</span> <span class="kwd">in</span> <span class="id">LR2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">inv</span> <span class="id">LR1</span>; <span class="id">inv</span> <span class="id">LR2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.NoDupMembers_NoDupA">NoDupMembers_NoDupA</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>} (<span class="id">xs</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> * <span class="id">A</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> <span class="id">xs</span> &lt;-&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.SetoidList.html#NoDupA">SetoidList.NoDupA</a></span> (@<span class="id"><a href="Velus.Environment.html#Env.eq_key">eq_key</a></span> <span class="id">A</span>) <span class="id">xs</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof50')">Proof.</span></div>
<div class="proofscript" id="proof50">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xs</span> <span class="kwd">as</span> [|[<span class="id">x</span> <span class="id">y</span>] <span class="id">xs</span> <span class="id">IH</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">HH</span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers_nil">NoDupMembers_nil</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">IH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">HH</span>; <span class="id">inv</span> <span class="id">HH</span>; <span class="tactic">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.SetoidList.html#InA_alt">SetoidList.InA_alt</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> 1 <span class="kwd">as</span> (<span class="id">xy</span> &amp; <span class="id">Heq</span> &amp; <span class="id">Hin</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.eq_key">eq_key</a></span>, <span class="id"><a href="Velus.Environment.html#Env.eq">E.eq</a></span> <span class="kwd">in</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H3</span>, <span class="id"><a href="Velus.Common.CommonList.html#fst_InMembers">fst_InMembers</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_map">in_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span> <span class="id">H</span>:~<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.SetoidList.html#InA">SetoidList.InA</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; <span class="tactic">rename</span> <span class="id">H</span> <span class="id">into</span> <span class="id">Hsl</span> <span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.SetoidList.html#InA_alt">SetoidList.InA_alt</a></span> <span class="kwd">in</span> <span class="id">Hsl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hin</span>. <span class="tactic">apply</span> <span class="id">Hsl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#InMembers_In">InMembers_In</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> (<span class="id">w</span>, <span class="id">Hin</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> (<span class="id">x</span>, <span class="id">w</span>); <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.InA_map_fst">InA_map_fst</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>} <span class="id">x</span> <span class="id">xs</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.SetoidList.html#InA">SetoidList.InA</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id">x</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (@<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> <span class="id">A</span>) <span class="id">xs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;-&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.SetoidList.html#InA">SetoidList.InA</a></span> (@<span class="id"><a href="Velus.Environment.html#Env.eq_key">eq_key</a></span> <span class="id">A</span>) (<span class="id">x</span>, <span class="id">y</span>) <span class="id">xs</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof51')">Proof.</span></div>
<div class="proofscript" id="proof51">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xs</span> <span class="kwd">as</span> [|(<span class="id">i</span>, <span class="id">a</span>) <span class="id">xs</span> <span class="id">IH</span>]; <span class="tactic">simpl</span>; <span class="tactic">split</span>; <span class="tactic">try</span> (<span class="id">now</span> <span class="tactic">inversion</span> 1).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">inversion</span> 1 <span class="kwd">as</span> [|? ? <span class="id">HH</span>]; <span class="tactic">subst</span>. <span class="id">now</span> <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">IH</span> <span class="id">y</span>) <span class="kwd">in</span> <span class="id">HH</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="id">now</span> <span class="tactic">constructor</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">inversion</span> 1 <span class="kwd">as</span> [|? ? <span class="id">HH</span>]; <span class="tactic">subst</span>. <span class="id">now</span> <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IH</span> <span class="kwd">in</span> <span class="id">HH</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="id">now</span> <span class="tactic">constructor</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.NoDupA_map_fst">NoDupA_map_fst</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>} <span class="id">xs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.SetoidList.html#NoDupA">SetoidList.NoDupA</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (@<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> <span class="id">A</span>) <span class="id">xs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;-&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.SetoidList.html#NoDupA">SetoidList.NoDupA</a></span> (@<span class="id"><a href="Velus.Environment.html#Env.eq_key">eq_key</a></span> <span class="id">A</span>) <span class="id">xs</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof52')">Proof.</span></div>
<div class="proofscript" id="proof52">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xs</span> <span class="kwd">as</span> [|(<span class="id">i</span>, <span class="id">a</span>) <span class="id">xs</span> <span class="id">IH</span>]; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">split</span>; <span class="tactic">inversion</span> 1; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">split</span>; <span class="tactic">inversion</span> 1 <span class="kwd">as</span> [|? ? <span class="id">Hni</span> <span class="id">Hnd</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">constructor</span>; <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id">IH</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.InA_map_fst">InA_map_fst</a></span> <span class="kwd">in</span> <span class="id">Hni</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.InA_map_fst">InA_map_fst</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.NoDupMembers_elements">NoDupMembers_elements</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> (@<span class="id"><a href="Velus.Environment.html#Env.elements">elements</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span> <span class="id">m</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof53')">Proof.</span></div>
<div class="proofscript" id="proof53">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.NoDupMembers_NoDupA">NoDupMembers_NoDupA</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.elements_3w">elements_3w</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.elements_add">elements_add</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> (<span class="id">v</span>: <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>) <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> <span class="id">m</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation">Permutation.Permutation</a></span> (<span class="id"><a href="Velus.Environment.html#Env.elements">elements</a></span> (<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">m</span>)) ((<span class="id">x</span>,<span class="id">v</span>) :: <span class="id"><a href="Velus.Environment.html#Env.elements">elements</a></span> <span class="id">m</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof54')">Proof.</span></div>
<div class="proofscript" id="proof54">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#NoDup_Permutation">Permutation.NoDup_Permutation</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers_NoDup">NoDupMembers_NoDup</a></span>, <span class="id"><a href="Velus.Environment.html#Env.NoDupMembers_elements">NoDupMembers_elements</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers_NoDup">NoDupMembers_NoDup</a></span>, <span class="id"><a href="Velus.Environment.html#Env.NoDupMembers_elements">NoDupMembers_elements</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hele</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.elements_complete">elements_complete</a></span> <span class="kwd">in</span> <span class="id">Hele</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hin</span>; <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.In_find">In_find</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">x0</span> <span class="kwd">as</span> (<span class="id">x</span>', <span class="id">v</span>'). <span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.elements_complete">elements_complete</a></span> <span class="kwd">in</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">x</span>' <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gss">gss</a></span> <span class="kwd">in</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">injection</span> <span class="id">HH</span>; <span class="tactic">intro</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gso">gso</a></span> <span class="kwd">in</span> <span class="id">HH</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">constructor</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.elements_correct">elements_correct</a></span> <span class="kwd">with</span> (1:=<span class="id">HH</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_inv">in_inv</a></span> <span class="kwd">in</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">HH</span> <span class="kwd">as</span> [<span class="id">He</span>|<span class="id">Hin</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">inv</span> <span class="id">He</span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.elements_correct">elements_correct</a></span>, <span class="id"><a href="Velus.Environment.html#Env.gss">gss</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.elements_correct">elements_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">x</span>' <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id">now</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gso">gso</a></span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Environment.html#Env.elements_complete">elements_complete</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.elements_complete">elements_complete</a></span> <span class="kwd">in</span> <span class="id">Hin</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.In_find">In_find</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.In_Members">In_Members</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> (<span class="id">m</span> : <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> <span class="id">m</span> &lt;-&gt; <span class="id"><a href="Velus.Common.CommonList.html#InMembers">InMembers</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.elements">elements</a></span> <span class="id">m</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof55')">Proof.</span></div>
<div class="proofscript" id="proof55">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.In_find">In_find</a></span> <span class="kwd">in</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">HH</span> <span class="kwd">as</span> (<span class="id">v</span> &amp; <span class="id">HH</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#In_InMembers">In_InMembers</a></span> <span class="kwd">with</span> (<span class="id">b</span>:=<span class="id">v</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.elements_correct">elements_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#InMembers_In">InMembers_In</a></span> <span class="kwd">in</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">HH</span> <span class="kwd">as</span> (<span class="id">v</span> &amp; <span class="id">HH</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.In_find">In_find</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Environment.html#Env.elements_complete">elements_complete</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.elements_adds">elements_adds</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">xs</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> (<span class="id"><a href="Velus.Environment.html#Env.elements">elements</a></span> <span class="id">m</span>++<span class="id">xs</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation">Permutation.Permutation</a></span> (<span class="id"><a href="Velus.Environment.html#Env.elements">elements</a></span> (<span class="id">adds</span>' <span class="id">xs</span> <span class="id">m</span>)) (<span class="id"><a href="Velus.Environment.html#Env.elements">elements</a></span> <span class="id">m</span>++<span class="id">xs</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof56')">Proof.</span></div>
<div class="proofscript" id="proof56">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xs</span> <span class="kwd">as</span> [|[<span class="id">k</span> <span class="id">a</span>] <span class="id">xs</span>]; <span class="tactic">intros</span> <span class="id">m</span> <span class="id">Hndup</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">specialize</span> (<span class="id">IHxs</span> (<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">k</span> <span class="id">a</span> <span class="id">m</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.elements_add">elements_add</a></span> <span class="kwd">in</span> <span class="id">IHxs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2: { <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_middle">Permutation.Permutation_middle</a></span> <span class="kwd">in</span> <span class="id">Hndup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hndup</span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#NotInMembers_app">NotInMembers_app</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">H1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.In_Members">In_Members</a></span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_middle">Permutation.Permutation_middle</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHxs</span> <span class="kwd">in</span> <span class="id">Hndup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">etransitivity</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="Env.elements_from_list">elements_from_list</a></span>: <span class="kwd">forall</span> <span class="id">xs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation">Permutation.Permutation</a></span> (<span class="id"><a href="Velus.Environment.html#Env.elements">elements</a></span> (<span class="id"><a href="Velus.Environment.html#Env.from_list">from_list</a></span> <span class="id">xs</span>)) <span class="id">xs</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof57')">Proof.</span></div>
<div class="proofscript" id="proof57">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hnd</span>. <span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.from_list">from_list</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.elements_adds">elements_adds</a></span>. 1,2:<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.elements_empty">Props.P.elements_empty</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.Equiv_empty">Equiv_empty</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">eq</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span> <span class="id">eq</span> <span class="id">m</span> (<span class="id"><a href="Velus.Environment.html#Env.empty">empty</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof58')">Proof.</span></div>
<div class="proofscript" id="proof58">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Spec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">setoid_rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.empty_in_iff">Props.P.F.empty_in_iff</a></span>; <span class="tactic">setoid_rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.In_find">In_find</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (?&amp; ?); <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">setoid_rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.empty_mapsto_iff">Props.P.F.empty_mapsto_iff</a></span>; <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.find_adds_opt_spec_Some">find_adds_opt_spec_Some</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">xs</span> <span class="id">vs</span> <span class="id">x</span> <span class="id">a</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">xs</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.adds_opt">adds_opt</a></span> <span class="id">xs</span> <span class="id">vs</span> <span class="id">m</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">a</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> (<span class="id">x</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">a</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#combine">combine</a></span> <span class="id">xs</span> <span class="id">vs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/ <span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">a</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof59')">Proof.</span></div>
<div class="proofscript" id="proof59">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.adds_opt">adds_opt</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xs</span> <span class="kwd">as</span> [|<span class="id">x</span>'], <span class="id">vs</span> <span class="kwd">as</span> [|<span class="id">v</span>']; <span class="tactic">simpl</span>; <span class="tactic">auto</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Length</span> <span class="id">Find</span>; <span class="id">inv</span> <span class="id">Length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">x</span> <span class="id">x</span>') <span class="kwd">as</span> [|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>; <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gss">gss</a></span> <span class="kwd">in</span> <span class="id">Find</span>; <span class="id">inv</span> <span class="id">Find</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gso">gso</a></span> <span class="kwd">in</span> <span class="id">Find</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHxs</span> <span class="kwd">in</span> <span class="id">Find</span> <span class="kwd">as</span> [|()]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">IHxs</span> <span class="kwd">in</span> <span class="id">Find</span> <span class="kwd">as</span> [|]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.find_gsso_opt">find_gsso_opt</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">x</span>' <span class="id">xs</span> (<span class="id">vs</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>)) <span class="id">S</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">x</span> &lt;&gt; <span class="id">x</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.adds_opt">adds_opt</a></span> (<span class="id">x</span>' :: <span class="id">xs</span>) <span class="id">vs</span> <span class="id">S</span>) = <span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.adds_opt">adds_opt</a></span> <span class="id">xs</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#tl">tl</a></span> <span class="id">vs</span>) <span class="id">S</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof60')">Proof.</span></div>
<div class="proofscript" id="proof60">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hneq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.adds_opt">adds_opt</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">vs</span>. <span class="id">now</span> <span class="tactic">destruct</span> <span class="id">xs</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gso">gso</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.find_gsss_opt">find_gsss_opt</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">v</span> <span class="id">xs</span> (<span class="id">vs</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>)) <span class="id">S</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.adds_opt">adds_opt</a></span> (<span class="id">x</span> :: <span class="id">xs</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span> :: <span class="id">vs</span>) <span class="id">S</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof61')">Proof.</span></div>
<div class="proofscript" id="proof61">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.adds_opt">adds_opt</a></span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.gss">gss</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.find_In_gsso_opt">find_In_gsso_opt</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">ys</span> (<span class="id">vs</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>)) <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> <span class="id">x</span> <span class="id">ys</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.adds_opt">adds_opt</a></span> <span class="id">ys</span> <span class="id">vs</span> <span class="id">env</span>) = <span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">env</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof62')">Proof.</span></div>
<div class="proofscript" id="proof62">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">ys</span> <span class="id">vs</span> <span class="id">env</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">vs</span>; <span class="tactic">induction</span> <span class="id">ys</span>; <span class="tactic">intro</span> <span class="id">vs</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.find_gsso_opt">find_gsso_opt</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">IHys</span>. <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">Hin</span>. <span class="id">now</span> <span class="tactic">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.adds_opt_cons_cons">adds_opt_cons_cons</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">xs</span> <span class="id">x</span> (<span class="id">v</span>: <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>) <span class="id">vs</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.adds_opt">adds_opt</a></span> (<span class="id">x</span> :: <span class="id">xs</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span> :: <span class="id">vs</span>) <span class="id">e</span> = <span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> <span class="id">v</span> (<span class="id"><a href="Velus.Environment.html#Env.adds_opt">adds_opt</a></span> <span class="id">xs</span> <span class="id">vs</span> <span class="id">e</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof63')">Proof.</span></div>
<div class="proofscript" id="proof63">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xs</span> <span class="kwd">as</span> [|<span class="id">x</span>']; <span class="tactic">intros</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">adds_opt_cons_cons</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">xs</span> <span class="id">x</span> (<span class="id">v</span>: <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>) <span class="id">vs</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> <span class="id">x</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.adds_opt">adds_opt</a></span> (<span class="id">x</span> :: <span class="id">xs</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span> :: <span class="id">vs</span>) <span class="id">e</span> = <span class="id"><a href="Velus.Environment.html#Env.adds_opt">adds_opt</a></span> <span class="id">xs</span> <span class="id">vs</span> (<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">e</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof64')">Proof.</span></div>
<div class="proofscript" id="proof64">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.adds_opt">adds_opt</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xs</span> <span class="kwd">as</span> [|<span class="id">x</span>']; <span class="tactic">intros</span> * <span class="id">NotIn</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">vs</span> <span class="kwd">as</span> [|<span class="id">v</span>']; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;-<span class="id">IHxs</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">destruct</span> <span class="id">v</span>'; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.add_comm">add_comm</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>; <span class="tactic">subst</span>; <span class="tactic">apply</span> <span class="id">NotIn</span>; <span class="tactic">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intro</span>; <span class="tactic">apply</span> <span class="id">NotIn</span>; <span class="tactic">right</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.adds_opt_cons_cons_None">adds_opt_cons_cons_None</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">xs</span> <span class="id">x</span> (<span class="id">vs</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>)) <span class="id">e</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.adds_opt">adds_opt</a></span> (<span class="id">x</span> :: <span class="id">xs</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> :: <span class="id">vs</span>) <span class="id">e</span> = <span class="id"><a href="Velus.Environment.html#Env.adds_opt">adds_opt</a></span> <span class="id">xs</span> <span class="id">vs</span> <span class="id">e</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof65')">Proof.</span></div>
<div class="proofscript" id="proof65">
 <span class="tactic">auto</span>. Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.In_adds_opt_In">In_adds_opt_In</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">xs</span> <span class="id">vos</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.adds_opt">adds_opt</a></span> <span class="id">xs</span> <span class="id">vos</span> (<span class="id"><a href="Velus.Environment.html#Env.empty">empty</a></span> <span class="id">_</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> <span class="id">x</span> <span class="id">xs</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof66')">Proof.</span></div>
<div class="proofscript" id="proof66">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">xs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.in_find_iff">Props.P.F.in_find_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xs</span> <span class="kwd">as</span> [|<span class="id">y</span> <span class="id">xs</span>' <span class="id">IH</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">vos</span> <span class="id">x</span>; <span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.adds_opt">adds_opt</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">vos</span>; <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gempty">gempty</a></span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">vos</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">vos</span> <span class="kwd">as</span> [|<span class="id">vo</span> <span class="id">vos</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.adds_opt">adds_opt</a></span>; <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gempty">gempty</a></span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">x</span> <span class="id">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*{ <span class="tactic">subst</span>; <span class="tactic">destruct</span> <span class="id">vo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">now</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.find_gsss_opt">find_gsss_opt</a></span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">now</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.adds_opt_cons_cons_None">adds_opt_cons_cons_None</a></span>; <span class="tactic">intro</span> <span class="id">HH</span>; <span class="tactic">apply</span> <span class="id">IH</span> <span class="kwd">in</span> <span class="id">HH</span>; <span class="tactic">constructor</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.find_gsso_opt">find_gsso_opt</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">HH</span>; <span class="tactic">apply</span> <span class="id">IH</span> <span class="kwd">in</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">constructor</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.adds_opt_is_adds">adds_opt_is_adds</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">xs</span> <span class="id">vs</span> (<span class="id">m</span>: <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.adds_opt">adds_opt</a></span> <span class="id">xs</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (@<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>) <span class="id">vs</span>) <span class="id">m</span> = <span class="id"><a href="Velus.Environment.html#Env.adds">adds</a></span> <span class="id">xs</span> <span class="id">vs</span> <span class="id">m</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof67')">Proof.</span></div>
<div class="proofscript" id="proof67">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.adds_opt">adds_opt</a></span>, <span class="id"><a href="Velus.Environment.html#Env.adds">adds</a></span>; <span class="tactic">intros</span> * <span class="id">Hndp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">vs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xs</span>, <span class="id">vs</span>; <span class="tactic">simpl</span>; <span class="tactic">inversion_clear</span> <span class="id">Hndp</span> <span class="kwd">as</span> [|?? <span class="id">Notin</span>]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHxs</span>, &lt;-<span class="id">adds</span>'<span class="id">_cons</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>; <span class="tactic">eapply</span> <span class="id">Notin</span>, <span class="id"><a href="Velus.Common.CommonList.html#InMembers_In_combine">InMembers_In_combine</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.add_not_Leaf">add_not_Leaf</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">v</span> <span class="id">S</span>, <span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">S</span> &lt;&gt; <span class="id"><a href="Velus.Environment.html#Env.Leaf">Leaf</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof68')">Proof.</span></div>
<div class="proofscript" id="proof68">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">x</span>; <span class="tactic">simpl</span>; <span class="tactic">destruct</span> <span class="id">S</span>; <span class="tactic">inversion</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.add_remove_comm">add_remove_comm</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">x</span>' (<span class="id">v</span>: <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>) <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">x</span> &lt;&gt; <span class="id">x</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.remove">remove</a></span> <span class="id">x</span>' (<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">m</span>) = <span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> <span class="id">v</span> (<span class="id"><a href="Velus.Environment.html#Env.remove">remove</a></span> <span class="id">x</span>' <span class="id">m</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof69')">Proof.</span></div>
<div class="proofscript" id="proof69">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Local</span> <span class="kwd">Ltac</span> <span class="id">AddRemoveDestructCases</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">progress</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id">context</span> [ <span class="kwd">match</span> ?<span class="id">e</span> <span class="kwd">with</span> <span class="id">_</span> =&gt; <span class="id">_</span> <span class="kwd">end</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Heq</span> := <span class="tactic">fresh</span> "<span class="id">Heq</span>" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">e</span> <span class="id">eqn</span>:<span class="id">Heq</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>:<span class="id">context</span> [ <span class="kwd">match</span> ?<span class="id">e</span> <span class="kwd">with</span> <span class="id">_</span> =&gt; <span class="id">_</span> <span class="kwd">end</span> ] |- <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Heq</span> := <span class="tactic">fresh</span> "<span class="id">Heq</span>" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">e</span> <span class="id">eqn</span>:<span class="id">Heq</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>:<span class="id"><a href="Velus.Environment.html#Env.Node">Node</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="id"><a href="Velus.Environment.html#Env.Node">Node</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">inversion_clear</span> <span class="id">H</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>:<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> = <span class="id"><a href="Velus.Environment.html#Env.Leaf">Leaf</a></span> <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.add_not_Leaf">add_not_Leaf</a></span> <span class="kwd">in</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">f_equal</span>; <span class="tactic">auto</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">x</span>, <span class="id">x</span>', <span class="id">m</span>; <span class="tactic">simpl</span>; <span class="tactic">intro</span> <span class="id">Neq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">try</span> <span class="id">now</span> <span class="id">contradiction</span> <span class="id">Neq</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">try</span> <span class="tactic">assert</span> (<span class="id">x</span> &lt;&gt; <span class="id">x</span>') <span class="kwd">as</span> <span class="id">Hnx</span> <span class="tactic">by</span> (<span class="id">now</span> <span class="tactic">intro</span> <span class="id">Heq</span>; <span class="tactic">apply</span> <span class="id">Neq</span>; <span class="tactic">subst</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">IHx</span>; <span class="tactic">auto</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.rleaf">rleaf</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">AddRemoveDestructCases</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.remove_comm">remove_comm</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">x</span>' (<span class="id">m</span> : <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.remove">remove</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.remove">remove</a></span> <span class="id">x</span>' <span class="id">m</span>) = <span class="id"><a href="Velus.Environment.html#Env.remove">remove</a></span> <span class="id">x</span>' (<span class="id"><a href="Velus.Environment.html#Env.remove">remove</a></span> <span class="id">x</span> <span class="id">m</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof70')">Proof.</span></div>
<div class="proofscript" id="proof70">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">x</span>, <span class="id">x</span>', <span class="id">m</span>; <span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m1</span>, <span class="id">o</span>, <span class="id">m2</span>; <span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">IHx</span>; <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.rleaf">rleaf</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">progress</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span>:<span class="id"><a href="Velus.Environment.html#Env.remove">remove</a></span> ?<span class="id">x1</span> ?<span class="id">n</span> = <span class="id"><a href="Velus.Environment.html#Env.Leaf">Leaf</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- <span class="id">context</span>[<span class="id"><a href="Velus.Environment.html#Env.remove">remove</a></span> ?<span class="id">x1</span> (<span class="id"><a href="Velus.Environment.html#Env.remove">remove</a></span> ?<span class="id">x2</span> ?<span class="id">n</span>)]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; (<span class="tactic">rewrite</span> <span class="id">IHx</span> || <span class="tactic">rewrite</span> &lt;-<span class="id">IHx</span>); <span class="tactic">rewrite</span> <span class="id">H1</span>, <span class="id"><a href="Velus.Environment.html#Env.rleaf">rleaf</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span>:<span class="id"><a href="Velus.Environment.html#Env.remove">remove</a></span> ?<span class="id">x1</span> ?<span class="id">n</span> = <span class="id"><a href="Velus.Environment.html#Env.Node">Node</a></span> ?<span class="id">l1</span> ?<span class="id">o1</span> ?<span class="id">r1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span>:<span class="id"><a href="Velus.Environment.html#Env.remove">remove</a></span> ?<span class="id">x2</span> ?<span class="id">n</span> = <span class="id"><a href="Velus.Environment.html#Env.Node">Node</a></span> ?<span class="id">l2</span> ?<span class="id">o2</span> ?<span class="id">r2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- <span class="id">context</span>[<span class="id"><a href="Velus.Environment.html#Env.remove">remove</a></span> ?<span class="id">x1</span> (<span class="id"><a href="Velus.Environment.html#Env.remove">remove</a></span> ?<span class="id">x2</span> ?<span class="id">n</span>)]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; (<span class="tactic">rewrite</span> <span class="id">IHx</span> || <span class="tactic">rewrite</span> &lt;-<span class="id">IHx</span>); <span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">clear</span> <span class="id">H1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H1</span>: <span class="id"><a href="Velus.Environment.html#Env.remove">remove</a></span> ?<span class="id">x1</span> ?<span class="id">n1</span> = <span class="id"><a href="Velus.Environment.html#Env.Node">Node</a></span> ?<span class="id">l</span> ?<span class="id">o</span> ?<span class="id">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- <span class="id">context</span>[<span class="id"><a href="Velus.Environment.html#Env.Node">Node</a></span> ?<span class="id">l</span> ?<span class="id">o</span> ?<span class="id">r</span>] =&gt; <span class="tactic">rewrite</span> &lt;-<span class="id">H1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id">context</span>[<span class="kwd">match</span> <span class="id"><a href="Velus.Environment.html#Env.remove">remove</a></span> ?<span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.Node">Node</a></span> ?<span class="id">l</span> ?<span class="id">o</span> ?<span class="id">r</span>) <span class="kwd">with</span> <span class="id">_</span> =&gt; <span class="id">_</span> <span class="kwd">end</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; <span class="kwd">let</span> <span class="id">Heq</span> := <span class="tactic">fresh</span> "<span class="id">Heq</span>" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Environment.html#Env.remove">remove</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.Node">Node</a></span> <span class="id">l</span> <span class="id">o</span> <span class="id">r</span>)) <span class="id">eqn</span>:<span class="id">Heq</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">f_equal</span>; <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.rleaf">rleaf</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id"><a name="Env.find_Proper">find_Proper</a></span> (<span class="id">R</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Relations.Relation_Definitions.html#relation">relation</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>) `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Equivalence">Equivalence</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span> <span class="id">R</span>}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.Morphisms.html#Proper">Proper</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> ==&gt; <span class="id"><a href="Velus.Environment.html#Env.Equiv">Env.Equiv</a></span> <span class="id">R</span> ==&gt; <span class="id"><a href="Velus.Common.Common.html#orel">orel</a></span> <span class="id">R</span>) (@<span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof71')">Proof.</span></div>
<div class="proofscript" id="proof71">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Hxy</span> <span class="id">E1</span> <span class="id">E2</span> (<span class="id">EE1</span> &amp; <span class="id">EE2</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">y</span> <span class="id">E1</span>) <span class="id">eqn</span>:<span class="id">Hx1</span>; <span class="tactic">destruct</span> (<span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">y</span> <span class="id">E2</span>) <span class="id">eqn</span>:<span class="id">Hx2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">repeat</span> (<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span> [ <span class="id">H</span>:<span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">_</span> <span class="id">_</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">_</span> |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.find_2">Env.find_2</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">end</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id">EE2</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hx1</span> <span class="id">Hx2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id">EE2</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.find_In">find_In</a></span> <span class="kwd">in</span> <span class="id">Hx1</span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.not_find_in_iff">Env.Props.P.F.not_find_in_iff</a></span> <span class="kwd">in</span> <span class="id">Hx2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>; <span class="tactic">apply</span> <span class="id">Hx2</span>. <span class="id">now</span> <span class="tactic">apply</span> <span class="id">EE1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.not_find_in_iff">Env.Props.P.F.not_find_in_iff</a></span> <span class="kwd">in</span> <span class="id">Hx1</span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.find_In">find_In</a></span> <span class="kwd">in</span> <span class="id">Hx2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>; <span class="tactic">apply</span> <span class="id">Hx1</span>. <span class="id">now</span> <span class="tactic">apply</span> <span class="id">EE1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id"><a name="Env.find_eq_Proper">find_eq_Proper</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.Morphisms.html#Proper">Proper</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> ==&gt; <span class="id"><a href="Velus.Environment.html#Env.Equiv">Env.Equiv</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> ==&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span>) (@<span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof72')">Proof.</span></div>
<div class="proofscript" id="proof72">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Hxy</span> <span class="id">E1</span> <span class="id">E2</span> <span class="id">EE</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Common.Common.html#orel_eq">orel_eq</a></span>. <span class="tactic">rewrite</span> <span class="id">EE</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.omap_find">omap_find</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">xs</span> (<span class="id">env</span> : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="Velus.Environment.html#Env.In">Env.In</a></span> <span class="id">x</span> <span class="id">env</span>) <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">vs</span>, <span class="id"><a href="Velus.Common.Common.html#omap">omap</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> <span class="id">env</span>) <span class="id">xs</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">vs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">x</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> <span class="id">env</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>) <span class="id">xs</span> <span class="id">vs</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof73')">Proof.</span></div>
<div class="proofscript" id="proof73">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xs</span> <span class="kwd">as</span> [|<span class="id">x</span> <span class="id">xs</span> <span class="id">IH</span>]; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion_clear</span> 1 <span class="kwd">as</span> [|?? <span class="id">Dx</span> <span class="id">Dxs</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.In_find">In_find</a></span> <span class="kwd">in</span> <span class="id">Dx</span>. <span class="tactic">destruct</span> <span class="id">Dx</span> <span class="kwd">as</span> (<span class="id">v</span> &amp; <span class="id">Fx</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Fx</span>. <span class="tactic">apply</span> <span class="id">IH</span> <span class="kwd">in</span> <span class="id">Dxs</span> <span class="kwd">as</span> (<span class="id">vs</span> &amp; -&gt; &amp; <span class="id">HH</span>). <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.elements_from_list_incl">elements_from_list_incl</a></span> : <span class="kwd">forall</span> <span class="id">xs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> (<span class="id"><a href="Velus.Environment.html#Env.elements">elements</a></span> (<span class="id"><a href="Velus.Environment.html#Env.from_list">from_list</a></span> <span class="id">xs</span>)) <span class="id">xs</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof74')">Proof.</span></div>
<div class="proofscript" id="proof74">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">xs</span> [? ?] <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.FSets.FMapPositive.html#PositiveMap.elements_complete">PositiveMap.elements_complete</a></span>, <span class="id"><a href="Velus.Environment.html#Env.from_list_find_In">from_list_find_In</a></span> <span class="kwd">in</span> <span class="id">Hin</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">find_env_from_list</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> (<span class="id">v</span>: <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>) <span class="id">xs</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id">adds</span>' <span class="id">xs</span> <span class="id">s</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> (<span class="id">x</span>, <span class="id">v</span>) <span class="id">xs</span> \/ (~<span class="id"><a href="Velus.Common.CommonList.html#InMembers">InMembers</a></span> <span class="id">x</span> <span class="id">xs</span> /\ <span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">s</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof75')">Proof.</span></div>
<div class="proofscript" id="proof75">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xs</span> <span class="kwd">as</span> [|(<span class="id">x</span>', <span class="id">v</span>') <span class="id">xs</span> <span class="id">IH</span>]; <span class="tactic">simpl</span>. <span class="id">now</span> <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">Hfind</span>. <span class="tactic">apply</span> <span class="id">IH</span> <span class="kwd">in</span> <span class="id">Hfind</span> <span class="kwd">as</span> [|(<span class="id">Hnim</span> &amp; <span class="id">Hfind</span>)]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Common.Common.html#ident_eq_dec">ident_eq_dec</a></span> <span class="id">x</span>' <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gss">Env.gss</a></span> <span class="kwd">in</span> <span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">injection</span> <span class="id">Hfind</span>. <span class="tactic">intro</span>; <span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gso">Env.gso</a></span> <span class="kwd">in</span> <span class="id">Hfind</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.adds_from_list">adds_from_list</a></span> : <span class="kwd">forall</span> <span class="id">xs</span> <span class="id">ys</span> (<span class="id">env</span> : <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Extra.A">A</a></span>) <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.adds">adds</a></span> <span class="id">xs</span> <span class="id">ys</span> <span class="id">env</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.from_list">from_list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#combine">combine</a></span> <span class="id">xs</span> <span class="id">ys</span>)) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span> \/ <span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">env</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof76')">Proof.</span></div>
<div class="proofscript" id="proof76">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Find</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.from_list">from_list</a></span>, <span class="id"><a href="Velus.Environment.html#Env.adds">adds</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">find_adds</span>'<span class="id">_In</span> <span class="kwd">in</span> <span class="id">Find</span> <span class="kwd">as</span> <span class="id">Find</span>'. <span class="tactic">destruct</span> <span class="id">Find</span>' <span class="kwd">as</span> [<span class="id">In</span>|]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">left</span>. <span class="id">erewrite</span> <span class="id">find_gsss</span>'<span class="id">_irrelevant</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Common.CommonList.html#In_InMembers">In_InMembers</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="Velus.Environment.html#Env.Extra">Extra</a></span>.<br/>
<br/>
<div class="doc">Equivalence of Environments </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="Env.Equiv">Equiv</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">A</span>} (<span class="id">R</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Relations.Relation_Definitions.html#relation">relation</a></span> <span class="id">A</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.find_Some_orel">find_Some_orel</a></span> `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Reflexive">Reflexive</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.Equiv.R">R</a></span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">x</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">env</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.Common.html#orel">orel</a></span> <span class="id"><a href="Velus.Environment.html#Env.Equiv.R">R</a></span> (<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">env</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof77')">Proof.</span></div>
<div class="proofscript" id="proof77">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">intros</span> * -&gt;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.orel_find_Some">orel_find_Some</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">x</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.Common.html#orel">orel</a></span> <span class="id"><a href="Velus.Environment.html#Env.Equiv.R">R</a></span> (<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">env</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">v</span>', <span class="id"><a href="Velus.Environment.html#Env.Equiv.R">R</a></span> <span class="id">v</span>' <span class="id">v</span> /\ <span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">env</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>'.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof78')">Proof.</span></div>
<div class="proofscript" id="proof78">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Fx</span>. <span class="id">inv</span> <span class="id">Fx</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Add</span> <span class="id">Parametric</span> <span class="id">Morphism</span> `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Equivalence">Equivalence</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.Equiv.R">R</a></span>} : (@<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id"><a href="Velus.Environment.html#Env.Equiv.A">A</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">signature</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> ==&gt; <span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span> <span class="id"><a href="Velus.Environment.html#Env.Equiv.R">R</a></span> ==&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#iff">iff</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> <span class="id">In_Equiv</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof79')">Proof.</span></div>
<div class="proofscript" id="proof79">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">env1</span> <span class="id">env2</span> <span class="id">EE</span>. <span class="tactic">setoid_rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.In_find">In_find</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span> (<span class="id">v</span>, <span class="id">Fx</span>); <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.find_Some_orel">find_Some_orel</a></span> <span class="kwd">in</span> <span class="id">Fx</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">EE</span> <span class="kwd">in</span> <span class="id">Fx</span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.orel_find_Some">orel_find_Some</a></span> <span class="kwd">in</span> <span class="id">Fx</span> <span class="kwd">as</span> (? &amp; ? &amp; ?); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> &lt;-<span class="id">EE</span> <span class="kwd">in</span> <span class="id">Fx</span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.orel_find_Some">orel_find_Some</a></span> <span class="kwd">in</span> <span class="id">Fx</span> <span class="kwd">as</span> (? &amp; ? &amp; ?); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id"><a name="Env.Equiv_Reflexive">Equiv_Reflexive</a></span> `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Reflexive">Reflexive</a></span> <span class="id"><a href="Velus.Environment.html#Env.Equiv.A">A</a></span> <span class="id"><a href="Velus.Environment.html#Env.Equiv.R">R</a></span>} : <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Reflexive">Reflexive</a></span> (<span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span> <span class="id"><a href="Velus.Environment.html#Env.Equiv.R">R</a></span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof80')">Proof.</span></div>
<div class="proofscript" id="proof80">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">env</span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.Equiv_orel">Equiv_orel</a></span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id"><a name="Env.Equiv_Transitive">Equiv_Transitive</a></span> `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Transitive">Transitive</a></span> <span class="id"><a href="Velus.Environment.html#Env.Equiv.A">A</a></span> <span class="id"><a href="Velus.Environment.html#Env.Equiv.R">R</a></span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Transitive">Transitive</a></span> (<span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span> <span class="id"><a href="Velus.Environment.html#Env.Equiv.R">R</a></span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof81')">Proof.</span></div>
<div class="proofscript" id="proof81">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env1</span> <span class="id">env2</span> <span class="id">env3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.Equiv_orel">Equiv_orel</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">E12</span> <span class="id">E23</span> <span class="id">x</span>. <span class="tactic">specialize</span> (<span class="id">E12</span> <span class="id">x</span>); <span class="tactic">specialize</span> (<span class="id">E23</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">E12</span>; <span class="id">inv</span> <span class="id">E23</span>; <span class="tactic">auto</span>; <span class="tactic">try</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span> <span class="id">H1</span>:<span class="id">_</span> = <span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> ?<span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span>:<span class="id">_</span> = <span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> ?<span class="id">env</span> |- <span class="id">_</span> =&gt; <span class="tactic">rewrite</span> &lt;- <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H2</span> <span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">datatypes</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">_</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">_</span>) <span class="id">and</span> <span class="tactic">inversion</span> <span class="id">it</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">constructor</span>. <span class="tactic">transitivity</span> <span class="id">sy</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id"><a name="Env.Equiv_Symmetric">Equiv_Symmetric</a></span> `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Symmetric">Symmetric</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.Equiv.R">R</a></span>} : <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Symmetric">Symmetric</a></span> (<span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span> <span class="id"><a href="Velus.Environment.html#Env.Equiv.R">R</a></span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof82')">Proof.</span></div>
<div class="proofscript" id="proof82">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env1</span> <span class="id">env2</span>. <span class="tactic">setoid_rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.Equiv_orel">Equiv_orel</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">E</span> <span class="id">x</span>. <span class="tactic">specialize</span> (<span class="id">E</span> <span class="id">x</span>). <span class="id">inv</span> <span class="id">E</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">datatypes</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Add</span> <span class="id">Parametric</span> <span class="id">Relation</span> `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Equivalence">Equivalence</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.Equiv.R">R</a></span>} : (<span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.Equiv.A">A</a></span>) (<span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span> <span class="id"><a href="Velus.Environment.html#Env.Equiv.R">R</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span> <span class="id">proved</span> <span class="tactic">by</span> <span class="id"><a href="Velus.Environment.html#Env.Equiv_Reflexive">Equiv_Reflexive</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span> <span class="id">proved</span> <span class="tactic">by</span> <span class="id"><a href="Velus.Environment.html#Env.Equiv_Symmetric">Equiv_Symmetric</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">transitivity</span> <span class="id">proved</span> <span class="tactic">by</span> <span class="id"><a href="Velus.Environment.html#Env.Equiv_Transitive">Equiv_Transitive</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> <span class="id">Equivalence_Equiv</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Add</span> <span class="id">Parametric</span> <span class="id">Morphism</span> `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Equivalence">Equivalence</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.Equiv.R">R</a></span>} : (<span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span> <span class="id"><a href="Velus.Environment.html#Env.Equiv.R">R</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">signature</span> (<span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span> <span class="id"><a href="Velus.Environment.html#Env.Equiv.R">R</a></span> ==&gt; <span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span> <span class="id"><a href="Velus.Environment.html#Env.Equiv.R">R</a></span> ==&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#iff">iff</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> <span class="id">Equiv_Equiv</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof83')">Proof.</span></div>
<div class="proofscript" id="proof83">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env1</span> <span class="id">env2</span> <span class="id">E12</span> <span class="id">env3</span> <span class="id">env4</span> <span class="id">E34</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.Equiv_orel">Env.Equiv_orel</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id">E12</span>. <span class="tactic">setoid_rewrite</span> <span class="id">E34</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.add_remove">add_remove</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">x</span> (<span class="id">v</span> : <span class="id"><a href="Velus.Environment.html#Env.Equiv.A">A</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> <span class="id">env</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.Equal">Env.Equal</a></span> <span class="id">env</span> (<span class="id"><a href="Velus.Environment.html#Env.add">Env.add</a></span> <span class="id">x</span> <span class="id">v</span> (<span class="id"><a href="Velus.Environment.html#Env.remove">Env.remove</a></span> <span class="id">x</span> <span class="id">env</span>)).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof84')">Proof.</span></div>
<div class="proofscript" id="proof84">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env</span> <span class="id">x</span> <span class="id">v</span> <span class="id">Fx</span>. <span class="tactic">intro</span> <span class="id">y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Common.Common.html#ident_eq_dec">ident_eq_dec</a></span> <span class="id">y</span> <span class="id">x</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">Fx</span>, <span class="id"><a href="Velus.Environment.html#Env.gss">Env.gss</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gso">Env.gso</a></span>, <span class="id"><a href="Velus.Environment.html#Env.gro">Env.gro</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.Equal_add_both">Equal_add_both</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> (<span class="id">v</span> : <span class="id"><a href="Velus.Environment.html#Env.Equiv.A">A</a></span>) <span class="id">env1</span> <span class="id">env2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.Equal">Env.Equal</a></span> <span class="id">env1</span> <span class="id">env2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.Equal">Env.Equal</a></span> (<span class="id"><a href="Velus.Environment.html#Env.add">Env.add</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">env1</span>) (<span class="id"><a href="Velus.Environment.html#Env.add">Env.add</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">env2</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof85')">Proof.</span></div>
<div class="proofscript" id="proof85">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">EE</span> <span class="id">y</span>. <span class="tactic">rewrite</span> <span class="id">EE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Common.Common.html#ident_eq_dec">ident_eq_dec</a></span> <span class="id">y</span> <span class="id">x</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="id">Existing</span> <span class="kwd">Instance</span> <span class="id">Equivalence_Equiv</span>.<br/>
<br/>
<div class="doc">Refinement of Environments </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="Env.EnvRefines">EnvRefines</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Relations.Relation_Definitions.html">Relation_Definitions</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Program.Basics.html">Basics</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">R</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Relations.Relation_Definitions.html#relation">relation</a></span> <span class="id">A</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Env.refines">refines</a></span> (<span class="id">env1</span> <span class="id">env2</span> : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.A">A</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">v</span>, <span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> <span class="id">env1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">v</span>', <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span> <span class="id">v</span> <span class="id">v</span>' /\ <span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> <span class="id">env2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>'.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Typeclasses</span> <span class="kwd">Opaque</span> <span class="id">refines</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.refines_empty">refines_empty</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span>, <span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> (<span class="id"><a href="Velus.Environment.html#Env.empty">empty</a></span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.A">A</a></span>) <span class="id">env</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof86')">Proof.</span></div>
<div class="proofscript" id="proof86">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env</span> <span class="id">x</span> <span class="id">v</span> <span class="id">Hfind</span>. <span class="id">now</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gempty">gempty</a></span> <span class="kwd">in</span> <span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.refines_refl">refines_refl</a></span> `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Reflexive">Reflexive</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span>} : <span class="id"><a href="http://coq.inria.fr/library/Coq.Relations.Relation_Definitions.html#reflexive">reflexive</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof87')">Proof.</span></div>
<div class="proofscript" id="proof87">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env</span> <span class="id">x</span> <span class="id">v</span> -&gt;; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.refines_trans">refines_trans</a></span> `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Transitive">Transitive</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span>} : <span class="id"><a href="http://coq.inria.fr/library/Coq.Relations.Relation_Definitions.html#transitive">transitive</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof88')">Proof.</span></div>
<div class="proofscript" id="proof88">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env1</span> <span class="id">env2</span> <span class="id">env3</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">x</span> <span class="id">v</span> <span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">Hfind</span> <span class="kwd">as</span> (? &amp; ? &amp; <span class="id">Hfind</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">Hfind</span> <span class="kwd">as</span> (? &amp; ? &amp; -&gt;).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Add</span> <span class="id">Parametric</span> <span class="id">Relation</span> `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Reflexive">Reflexive</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span>} `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Transitive">Transitive</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span> <span class="id">proved</span> <span class="tactic">by</span> <span class="id"><a href="Velus.Environment.html#Env.refines_refl">refines_refl</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">transitivity</span> <span class="id">proved</span> <span class="tactic">by</span> <span class="id"><a href="Velus.Environment.html#Env.refines_trans">refines_trans</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> <span class="id">env_refines_preorder</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Add</span> <span class="id">Parametric</span> <span class="id">Morphism</span> `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Reflexive">Reflexive</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span>} `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Transitive">Transitive</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span>} : <span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">signature</span> (<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> --&gt; <span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> ++&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Program.Basics.html#impl">impl</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> <span class="id">refines_refines1</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof89')">Proof.</span></div>
<div class="proofscript" id="proof89">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env2</span> <span class="id">env1</span> <span class="id">ER12</span> <span class="id">env3</span> <span class="id">env4</span> <span class="id">ER34</span> <span class="id">ER13</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">transitivity</span> <span class="id">env2</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">transitivity</span> <span class="id">env3</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Add</span> <span class="id">Parametric</span> <span class="id">Morphism</span> `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Reflexive">Reflexive</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span>} `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Transitive">Transitive</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span>} : <span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">signature</span> (<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> ++&gt; <span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> --&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Program.Basics.html#flip">flip</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Program.Basics.html#impl">impl</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> <span class="id">refines_refines2</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof90')">Proof.</span></div>
<div class="proofscript" id="proof90">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env1</span> <span class="id">env2</span> <span class="id">ER12</span> <span class="id">env4</span> <span class="id">env3</span> <span class="id">ER34</span> <span class="id">ER23</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">transitivity</span> <span class="id">env2</span>; <span class="tactic">auto</span>. <span class="tactic">transitivity</span> <span class="id">env3</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.refines_add">refines_add</a></span> `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Reflexive">Reflexive</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">x</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> <span class="id">env</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id">env</span> (<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">env</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof91')">Proof.</span></div>
<div class="proofscript" id="proof91">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env</span> <span class="id">x</span> <span class="id">v</span> <span class="id">nI</span> <span class="id">x</span>' <span class="id">v</span>' <span class="id">Fx</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Common.Common.html#ident_eq_dec">ident_eq_dec</a></span> <span class="id">x</span> <span class="id">x</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.find_In">find_In</a></span> <span class="kwd">in</span> <span class="id">Fx</span>'. <span class="id">exfalso</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gso">gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.refines_add_both">refines_add_both</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env1</span> <span class="id">env2</span> <span class="id">x</span> <span class="id">v1</span> <span class="id">v2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id">env1</span> <span class="id">env2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span> <span class="id">v1</span> <span class="id">v2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> (<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> <span class="id">v1</span> <span class="id">env1</span>) (<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> <span class="id">v2</span> <span class="id">env2</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof92')">Proof.</span></div>
<div class="proofscript" id="proof92">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env1</span> <span class="id">env2</span> <span class="id">x</span> <span class="id">v1</span> <span class="id">v2</span> <span class="id">Henv</span> <span class="id">Rv</span> <span class="id">y</span> <span class="id">yv</span> <span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Common.Common.html#ident_eq_dec">ident_eq_dec</a></span> <span class="id">x</span> <span class="id">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">subst</span>; <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gss">gss</a></span> <span class="kwd">in</span> *; <span class="id">inv</span> <span class="id">Hfind</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gso">gso</a></span> <span class="kwd">in</span> *; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Add</span> <span class="id">Morphism</span> (@<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.A">A</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">signature</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> ==&gt; <span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> ++&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Program.Basics.html#impl">impl</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> <span class="id">In_refines</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof93')">Proof.</span></div>
<div class="proofscript" id="proof93">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.In_find">In_find</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">E1</span> <span class="id">E2</span> <span class="id">ER12</span> (<span class="id">v</span> &amp; <span class="id">Fx</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">ER12</span> <span class="kwd">in</span> <span class="id">Fx</span> <span class="kwd">as</span> (<span class="id">v</span>' &amp; ? &amp; ?); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Add</span> <span class="id">Morphism</span> (@<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.A">A</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">signature</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> ==&gt; <span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> --&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Program.Basics.html#flip">flip</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Program.Basics.html#impl">impl</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> <span class="id">In_refines_flip</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof94')">Proof.</span></div>
<div class="proofscript" id="proof94">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.In_find">In_find</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">E1</span> <span class="id">E2</span> <span class="id">ER12</span> (<span class="id">v</span> &amp; <span class="id">Fx</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">ER12</span> <span class="kwd">in</span> <span class="id">Fx</span> <span class="kwd">as</span> (<span class="id">v</span>' &amp; ? &amp; ?); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id"><a name="Env.refines_Proper">refines_Proper</a></span> `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Reflexive">Reflexive</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span>} `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Transitive">Transitive</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.Morphisms.html#Proper">Proper</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Program.Basics.html#flip">flip</a></span> <span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> ==&gt; <span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> ==&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Program.Basics.html#impl">impl</a></span>) <span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof95')">Proof.</span></div>
<div class="proofscript" id="proof95">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">m1</span> <span class="id">m1</span>' <span class="id">Henv1</span> <span class="id">m2</span> <span class="id">m2</span>' <span class="id">Henv2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Henv</span> <span class="id">x</span> <span class="id">v</span> <span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Henv1</span> <span class="kwd">in</span> <span class="id">Hfind</span> <span class="kwd">as</span> (? &amp; ? &amp; <span class="id">Hfind</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Henv</span> <span class="kwd">in</span> <span class="id">Hfind</span> <span class="kwd">as</span> (? &amp; ? &amp; <span class="id">Hfind</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Henv2</span> <span class="kwd">in</span> <span class="id">Hfind</span> <span class="kwd">as</span> (? &amp; ? &amp; <span class="id">Hfind</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id"><a name="Env.add_refines_Proper">add_refines_Proper</a></span> `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Reflexive">Reflexive</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span>}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.Morphisms.html#Proper">Proper</a></span> (@<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> ==&gt; @<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.A">A</a></span> ==&gt; <span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> ==&gt; <span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span>) (@<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.A">A</a></span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof96')">Proof.</span></div>
<div class="proofscript" id="proof96">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Hxy</span> <span class="id">vx</span> <span class="id">vy</span> <span class="id">Hv</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">Henv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.refines_add_both">refines_add_both</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">Equiv_refines</span>' `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Symmetric">Symmetric</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span>}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env1</span> <span class="id">env2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span> <span class="id">env1</span> <span class="id">env2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id">env1</span> <span class="id">env2</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof97')">Proof.</span></div>
<div class="proofscript" id="proof97">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env1</span> <span class="id">env2</span> <span class="id">E</span> <span class="id">x</span> <span class="id">v</span> <span class="id">Fx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.Equiv_orel">Equiv_orel</a></span> <span class="kwd">in</span> <span class="id">E</span>. <span class="tactic">specialize</span> (<span class="id">E</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Fx</span> <span class="kwd">in</span> <span class="id">E</span>. <span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.orel_find_Some">orel_find_Some</a></span> <span class="kwd">in</span> <span class="id">E</span> <span class="kwd">as</span> (<span class="id">v</span>' &amp; <span class="id">Rvv</span> &amp; -&gt;).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">Rvv</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.Equiv_refines">Equiv_refines</a></span> `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Equivalence">Equivalence</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span>}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env1</span> <span class="id">env2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span> <span class="id">env1</span> <span class="id">env2</span> &lt;-&gt; (<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id">env1</span> <span class="id">env2</span> /\ <span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id">env2</span> <span class="id">env1</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof98')">Proof.</span></div>
<div class="proofscript" id="proof98">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">split</span>; <span class="tactic">apply</span> <span class="id">Equiv_refines</span>'; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">E</span> <span class="kwd">as</span> (<span class="id">E1</span> &amp; <span class="id">E2</span>). <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">Ik</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">E1</span> <span class="kwd">in</span> <span class="id">Ik</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">E2</span> <span class="kwd">in</span> <span class="id">Ik</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> * <span class="id">M1</span> <span class="id">M2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.find_1">Env.find_1</a></span> <span class="kwd">in</span> <span class="id">M1</span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.find_1">Env.find_1</a></span> <span class="kwd">in</span> <span class="id">M2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">E1</span> <span class="kwd">in</span> <span class="id">M1</span> <span class="kwd">as</span> (<span class="id">v</span> &amp; <span class="id">Rv</span> &amp; <span class="id">F2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">F2</span> <span class="kwd">in</span> <span class="id">M2</span>. <span class="id">now</span> <span class="id">inv</span> <span class="id">M2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Add</span> <span class="id">Parametric</span> <span class="id">Morphism</span> `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Equivalence">Equivalence</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span>} : <span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">signature</span> (<span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span> ==&gt; <span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span> ==&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#iff">iff</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> <span class="id">refines_Equiv</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof99')">Proof.</span></div>
<div class="proofscript" id="proof99">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">mA</span> <span class="id">mA</span>' <span class="id">EA</span> <span class="id">mB</span> <span class="id">mB</span>' <span class="id">EB</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.Equiv_refines">Equiv_refines</a></span> <span class="kwd">in</span> <span class="id">EA</span> <span class="kwd">as</span> (<span class="id">EA1</span> &amp; <span class="id">EA2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.Equiv_refines">Equiv_refines</a></span> <span class="kwd">in</span> <span class="id">EB</span> <span class="kwd">as</span> (<span class="id">EB1</span> &amp; <span class="id">EB2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">ER</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">transitivity</span> <span class="id">mA</span>; <span class="tactic">auto</span>. <span class="tactic">transitivity</span> <span class="id">mB</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">transitivity</span> <span class="id">mA</span>'; <span class="tactic">auto</span>. <span class="tactic">transitivity</span> <span class="id">mB</span>'; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Add</span> <span class="id">Parametric</span> <span class="id">Morphism</span> `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Equivalence">Equivalence</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span>} : <span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">signature</span> (<span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span> ==&gt; <span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span> ==&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Program.Basics.html#flip">flip</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Program.Basics.html#impl">impl</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> <span class="id">refines_Equiv_flip_impl</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof100')">Proof.</span></div>
<div class="proofscript" id="proof100">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">mA</span> <span class="id">mA</span>' <span class="id">EA</span> <span class="id">mB</span> <span class="id">mB</span>' <span class="id">EB</span> <span class="id">EAB</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.Equiv_refines">Equiv_refines</a></span> <span class="kwd">in</span> <span class="id">EA</span> <span class="kwd">as</span> (<span class="id">EA1</span> &amp; <span class="id">EA2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.Equiv_refines">Equiv_refines</a></span> <span class="kwd">in</span> <span class="id">EB</span> <span class="kwd">as</span> (<span class="id">EB1</span> &amp; <span class="id">EB2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">transitivity</span> <span class="id">mA</span>'; <span class="tactic">auto</span>. <span class="tactic">transitivity</span> <span class="id">mB</span>'; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id"><a name="Env.equiv_refines">equiv_refines</a></span> `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Equivalence">Equivalence</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#PartialOrder">PartialOrder</a></span> (<span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span>) <span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof101')">Proof.</span></div>
<div class="proofscript" id="proof101">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env1</span> <span class="id">env2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intro</span> <span class="id">E</span>. <span class="tactic">red</span>; <span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#predicate_intersection">predicate_intersection</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id">E</span>. <span class="tactic">split</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> (<span class="id">E1</span> &amp; <span class="id">E2</span>). <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.Equiv_refines">Equiv_refines</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.refines_add_right">refines_add_right</a></span> `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Reflexive">Reflexive</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span>} `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Transitive">Transitive</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span>}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env1</span> <span class="id">env2</span> <span class="id">x</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id">env1</span> <span class="id">env2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> <span class="id">env1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id">env1</span> (<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">env2</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof102')">Proof.</span></div>
<div class="proofscript" id="proof102">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">setoid_rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.refines_add">refines_add</a></span> <span class="tactic">at</span> 1; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.refines_add_both">refines_add_both</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.refines_remove">refines_remove</a></span> `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Reflexive">Reflexive</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span>}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> (<span class="id"><a href="Velus.Environment.html#Env.remove">remove</a></span> <span class="id">x</span> <span class="id">env</span>) <span class="id">env</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof103')">Proof.</span></div>
<div class="proofscript" id="proof103">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env</span> <span class="id">x</span> <span class="id">y</span> <span class="id">v</span> <span class="id">Fx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Common.Common.html#ident_eq_dec">ident_eq_dec</a></span> <span class="id">x</span> <span class="id">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">now</span> <span class="tactic">subst</span>; <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.grs">grs</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gro">gro</a></span> <span class="kwd">in</span> *; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.refines_remove_both">refines_remove_both</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env1</span> <span class="id">env2</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id">env1</span> <span class="id">env2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> (<span class="id"><a href="Velus.Environment.html#Env.remove">remove</a></span> <span class="id">x</span> <span class="id">env1</span>) (<span class="id"><a href="Velus.Environment.html#Env.remove">remove</a></span> <span class="id">x</span> <span class="id">env2</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof104')">Proof.</span></div>
<div class="proofscript" id="proof104">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env1</span> <span class="id">env2</span> <span class="id">x</span> <span class="id">Henv</span> <span class="id">y</span> <span class="id">v</span> <span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Common.Common.html#ident_eq_dec">ident_eq_dec</a></span> <span class="id">x</span> <span class="id">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">now</span> <span class="tactic">subst</span>; <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.grs">grs</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gro">gro</a></span> <span class="kwd">in</span> *; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.refines_add_remove">refines_add_remove</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env1</span> <span class="id">env2</span> <span class="id">x</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id">env1</span> <span class="id">env2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> (<span class="id"><a href="Velus.Environment.html#Env.remove">remove</a></span> <span class="id">x</span> <span class="id">env1</span>) (<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">env2</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof105')">Proof.</span></div>
<div class="proofscript" id="proof105">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env1</span> <span class="id">env2</span> <span class="id">x</span> <span class="id">v</span> <span class="id">Henv</span> <span class="id">y</span> <span class="id">vy</span> <span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Common.Common.html#ident_eq_dec">ident_eq_dec</a></span> <span class="id">x</span> <span class="id">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">now</span> <span class="tactic">subst</span>; <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.grs">grs</a></span> <span class="kwd">in</span> <span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gro">gro</a></span> <span class="kwd">in</span> <span class="id">Hfind</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gso">gso</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.find_add">find_add</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">x</span> <span class="id">v</span>} {<span class="id">env</span> : <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.A">A</a></span>},<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">env</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.Equal">Equal</a></span> <span class="id">env</span> (<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">env</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof106')">Proof.</span></div>
<div class="proofscript" id="proof106">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">v</span> <span class="id">env</span> <span class="id">Fx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.Equal_Equiv">Props.P.F.Equal_Equiv</a></span>, <span class="id"><a href="Velus.Environment.html#Env.Equiv_orel">Equiv_orel</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">y</span>. <span class="tactic">destruct</span> (<span class="id"><a href="Velus.Common.Common.html#ident_eq_dec">ident_eq_dec</a></span> <span class="id">y</span> <span class="id">x</span>) <span class="kwd">as</span> [|<span class="id">Nyx</span>]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">now</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gss">gss</a></span>, <span class="id">Fx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gso">gso</a></span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">datatypes</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.refines_orel_find">refines_orel_find</a></span> `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Reflexive">Reflexive</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span>} `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Transitive">Transitive</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span>}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env1</span> <span class="id">env2</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id">env1</span> <span class="id">env2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> <span class="id">env1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.Common.html#orel">orel</a></span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span> (<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">env1</span>) (<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">env2</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof107')">Proof.</span></div>
<div class="proofscript" id="proof107">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">ER</span> <span class="id">Ix</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.In_find">In_find</a></span> <span class="kwd">in</span> <span class="id">Ix</span>. <span class="tactic">destruct</span> <span class="id">Ix</span> <span class="kwd">as</span> (<span class="id">v</span> &amp; <span class="id">Fx1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id">ER</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Fx1</span>) <span class="kwd">as</span> (<span class="id">v</span>' &amp; <span class="id">Rvv</span> &amp; <span class="id">Fx2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">Fx1</span>, <span class="id">Fx2</span>, <span class="id">Rvv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.refines_find_add_left">refines_find_add_left</a></span> `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Reflexive">Reflexive</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span>}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">v</span> <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">env</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> (<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">env</span>) <span class="id">env</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof108')">Proof.</span></div>
<div class="proofscript" id="proof108">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Fx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">y</span> <span class="id">v</span>' <span class="id">Fy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Common.Common.html#ident_eq_dec">ident_eq_dec</a></span> <span class="id">y</span> <span class="id">x</span>) <span class="kwd">as</span> [|<span class="id">Nyx</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">subst</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gss">gss</a></span> <span class="kwd">in</span> <span class="id">Fy</span>. <span class="id">inv</span> <span class="id">Fy</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gso">gso</a></span> <span class="kwd">in</span> <span class="id">Fy</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.refines_find_add_right">refines_find_add_right</a></span> `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Reflexive">Reflexive</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span>}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">v</span> <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">env</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id">env</span> (<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">env</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof109')">Proof.</span></div>
<div class="proofscript" id="proof109">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Fx</span>. <span class="tactic">intros</span> <span class="id">y</span> <span class="id">v</span>' <span class="id">Fy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Common.Common.html#ident_eq_dec">ident_eq_dec</a></span> <span class="id">y</span> <span class="id">x</span>) <span class="kwd">as</span> [|<span class="id">Nyx</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">subst</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gss">gss</a></span>. <span class="tactic">rewrite</span> <span class="id">Fx</span> <span class="kwd">in</span> <span class="id">Fy</span>. <span class="id">inv</span> <span class="id">Fy</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gso">gso</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.refines_add_left">refines_add_left</a></span> `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Reflexive">Reflexive</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span>} `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Transitive">Transitive</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span>}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">v1</span> <span class="id">v2</span> <span class="id">env1</span> <span class="id">env2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id">env1</span> <span class="id">env2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">env2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.EnvRefines.R">R</a></span> <span class="id">v1</span> <span class="id">v2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> (<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> <span class="id">v1</span> <span class="id">env1</span>) <span class="id">env2</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof110')">Proof.</span></div>
<div class="proofscript" id="proof110">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">R12</span> <span class="id">MT</span> <span class="id">Rvv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.refines_find_add_left">refines_find_add_left</a></span> <span class="kwd">in</span> <span class="id">MT</span>. <span class="tactic">setoid_rewrite</span> &lt;-<span class="id">MT</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Environment.html#Env.refines_add_both">refines_add_both</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.refines_elements">refines_elements</a></span> : <span class="kwd">forall</span> <span class="id">env1</span> <span class="id">env2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id">env1</span> <span class="id">env2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Environment.html#Env.elements">elements</a></span> <span class="id">env1</span>)) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Environment.html#Env.elements">elements</a></span> <span class="id">env2</span>)).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof111')">Proof.</span></div>
<div class="proofscript" id="proof111">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Href</span> ? <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;-<span class="id"><a href="Velus.Common.CommonList.html#fst_InMembers">fst_InMembers</a></span>, &lt;-<span class="id"><a href="Velus.Environment.html#Env.In_Members">In_Members</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.In_refines">In_refines</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="Velus.Environment.html#Env.EnvRefines">EnvRefines</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="id">Existing</span> <span class="kwd">Instance</span> <span class="id">env_refines_preorder</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="id">Existing</span> <span class="kwd">Instance</span> <span class="id">Equivalence_Equiv</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Hint</span> <span class="kwd">Immediate</span> <span class="id">refines_empty</span> : <span class="id">env</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Hint</span> <span class="kwd">Extern</span> 4 (<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id">_</span> (<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> ?<span class="id">x</span> <span class="id">_</span> <span class="id">_</span>) (<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> ?<span class="id">x</span> <span class="id">_</span> <span class="id">_</span>)) =&gt; <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.refines_add">refines_add</a></span> : <span class="id">env</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">refines_refl</span> <span class="id">refines_trans</span> <span class="id">refines_add</span> <span class="id">refines_add_both</span> <span class="id">refines_add_right</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">refines_remove</span> <span class="id">refines_remove_both</span> <span class="id">refines_add_remove</span> <span class="id">refines_orel_find</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">refines_find_add_left</span> <span class="id">refines_find_add_right</span> <span class="id">refines_add_left</span> <span class="id">refines_elements</span> : <span class="id">env</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.Equal_Equiv">Equal_Equiv</a></span> {<span class="id">A</span>}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#relation_equivalence">relation_equivalence</a></span> <span class="id"><a href="Velus.Environment.html#Env.Equal">Equal</a></span> (<span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span> (@<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id">A</span>)).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof112')">Proof.</span></div>
<div class="proofscript" id="proof112">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">HH</span>; <span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.Equal_Equiv">Props.P.F.Equal_Equiv</a></span> <span class="kwd">in</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Add</span> <span class="id">Parametric</span> <span class="id">Morphism</span> {<span class="id">A</span>}: (@<span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">signature</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#subrelation">subrelation</a></span> ==&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> ==&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> ==&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Program.Basics.html#impl">impl</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> <span class="id">Equiv_subrelation</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof113')">Proof.</span></div>
<div class="proofscript" id="proof113">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">R1</span> <span class="id">R2</span> <span class="id">SR</span> <span class="id">env1</span> <span class="id">env2</span> <span class="id">ER</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="id">now</span> <span class="tactic">apply</span> <span class="id">ER</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ER</span> <span class="kwd">as</span> (? &amp; ?); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id"><a name="Env.subrelation_Equiv">subrelation_Equiv</a></span> {<span class="id">A</span>} (<span class="id">R1</span> <span class="id">R2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Relations.Relation_Definitions.html#relation">relation</a></span> <span class="id">A</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#subrelation">subrelation</a></span> <span class="id">R1</span> <span class="id">R2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#subrelation">subrelation</a></span> (<span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span> <span class="id">R1</span>) (<span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span> <span class="id">R2</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof114')">Proof.</span></div>
<div class="proofscript" id="proof114">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">SR</span> <span class="id">env1</span> <span class="id">env2</span> <span class="id">EE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">SR</span> <span class="kwd">in</span> <span class="id">EE</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id"><a name="Env.Equal_subrelation_Equiv">Equal_subrelation_Equiv</a></span> {<span class="id">A</span>} (<span class="id">R</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Relations.Relation_Definitions.html#relation">relation</a></span> <span class="id">A</span>) `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Reflexive">Reflexive</a></span> <span class="id">_</span> <span class="id">R</span>}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#subrelation">subrelation</a></span> <span class="id"><a href="Velus.Environment.html#Env.Equal">Equal</a></span> (<span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span> <span class="id">R</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof115')">Proof.</span></div>
<div class="proofscript" id="proof115">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.Equal_Equiv">Equal_Equiv</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.Morphisms.html#eq_subrelation">eq_subrelation</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">typeclasses</span> <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id"><a name="Env.Equiv_subrelation_Equal">Equiv_subrelation_Equal</a></span> {<span class="id">A</span>}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#subrelation">subrelation</a></span> (<span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span> (@<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id">A</span>)) <span class="id"><a href="Velus.Environment.html#Env.Equal">Equal</a></span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof116')">Proof.</span></div>
<div class="proofscript" id="proof116">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.Equal_Equiv">Equal_Equiv</a></span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id"><a name="Env.refines_Equal_Proper">refines_Equal_Proper</a></span> {<span class="id">A</span>}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.Morphisms.html#Proper">Proper</a></span> (@<span class="id"><a href="Velus.Environment.html#Env.Equal">Equal</a></span> <span class="id">A</span> ==&gt; @<span class="id"><a href="Velus.Environment.html#Env.Equal">Equal</a></span> <span class="id">A</span> ==&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#iff">iff</a></span>) (<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof117')">Proof.</span></div>
<div class="proofscript" id="proof117">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.Equal_Equiv">Equal_Equiv</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">typeclasses</span> <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="Env.RefinesAdds">RefinesAdds</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">V</span> : <span class="kwd">Type</span>}.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Variable</span> (<span class="id"><a name="Env.RefinesAdds.R">R</a></span> : <span class="id"><a href="Velus.Environment.html#Env.RefinesAdds.V">V</a></span> -&gt; <span class="id"><a href="Velus.Environment.html#Env.RefinesAdds.V">V</a></span> -&gt; <span class="kwd">Prop</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Hypothesis</span> <span class="id"><a name="Env.RefinesAdds.R_refl">R_refl</a></span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Reflexive">Reflexive</a></span> <span class="id"><a href="Velus.Environment.html#Env.RefinesAdds.R">R</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Hypothesis</span> <span class="id"><a name="Env.RefinesAdds.R_trans">R_trans</a></span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Transitive">Transitive</a></span> <span class="id"><a href="Velus.Environment.html#Env.RefinesAdds.R">R</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id">refines_adds</span>'<span class="id">_aux</span> : <span class="kwd">forall</span> (<span class="id">xs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * <span class="id"><a href="Velus.Environment.html#Env.RefinesAdds.V">V</a></span>)) <span class="id">H</span> <span class="id">H</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id"><a href="Velus.Environment.html#Env.RefinesAdds.R">R</a></span> <span class="id">H</span> <span class="id">H</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id"><a href="Velus.Environment.html#Env.RefinesAdds.R">R</a></span> (<span class="id">adds</span>' <span class="id">xs</span> <span class="id">H</span>) (<span class="id">adds</span>' <span class="id">xs</span> <span class="id">H</span>').<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof118')">Proof.</span></div>
<div class="proofscript" id="proof118">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xs</span>; <span class="tactic">intros</span> <span class="id">H</span> <span class="id">H</span>' <span class="id">Href</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHxs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.refines_add_both">refines_add_both</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">refines_adds</span>' : <span class="kwd">forall</span> (<span class="id">xs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * <span class="id"><a href="Velus.Environment.html#Env.RefinesAdds.V">V</a></span>)) <span class="id">H</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">id</span> =&gt; ~<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">id</span> <span class="id">H</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">xs</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id"><a href="Velus.Environment.html#Env.RefinesAdds.R">R</a></span> <span class="id">H</span> (<span class="id">adds</span>' <span class="id">xs</span> <span class="id">H</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof119')">Proof.</span></div>
<div class="proofscript" id="proof119">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xs</span> <span class="kwd">as</span> [|(?&amp;?)]; <span class="tactic">intros</span> * <span class="id">Hnin</span>; <span class="id">inv</span> <span class="id">Hnin</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.refines_refl">refines_refl</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.refines_trans">refines_trans</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">IHxs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">refines_adds</span>'<span class="id">_aux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.refines_add">refines_add</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="Env.refines_adds">refines_adds</a></span> : <span class="kwd">forall</span> <span class="id">ids</span> (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Environment.html#Env.RefinesAdds.V">V</a></span>) <span class="id">H</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">id</span> =&gt; ~<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">id</span> <span class="id">H</span>) <span class="id">ids</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id"><a href="Velus.Environment.html#Env.RefinesAdds.R">R</a></span> <span class="id">H</span> (<span class="id"><a href="Velus.Environment.html#Env.adds">adds</a></span> <span class="id">ids</span> <span class="id">vs</span> <span class="id">H</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof120')">Proof.</span></div>
<div class="proofscript" id="proof120">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.adds">adds</a></span>. <span class="tactic">eapply</span> <span class="id">refines_adds</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">vs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hf</span>; <span class="tactic">intros</span> [|]; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.refines_adds_opt">refines_adds_opt</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>} <span class="id">xs</span> <span class="id">m1</span> <span class="id">m2</span> (<span class="id">vos1</span> <span class="id">vos2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">A</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id">m2</span> <span class="id">m1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">vo1</span> <span class="id">vo2</span> =&gt; <span class="kwd">forall</span> <span class="id">v</span>, <span class="id">vo2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span> -&gt; <span class="id">vo1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>) <span class="id">vos1</span> <span class="id">vos2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; ~<span class="id"><a href="Velus.Environment.html#Env.In">Env.In</a></span> <span class="id">x</span> <span class="id">m2</span>) <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> (<span class="id"><a href="Velus.Environment.html#Env.adds_opt">Env.adds_opt</a></span> <span class="id">xs</span> <span class="id">vos2</span> <span class="id">m2</span>) (<span class="id"><a href="Velus.Environment.html#Env.adds_opt">Env.adds_opt</a></span> <span class="id">xs</span> <span class="id">vos1</span> <span class="id">m1</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof121')">Proof.</span></div>
<div class="proofscript" id="proof121">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xs</span> <span class="kwd">as</span> [|<span class="id">x</span> <span class="id">xs</span>]; <span class="tactic">induction</span> 2 <span class="kwd">as</span> [|<span class="id">vo1</span> <span class="id">vo2</span> <span class="id">vos1</span> <span class="id">vos2</span> <span class="id">Hvo</span> <span class="id">Hvos</span>]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion_clear</span> 1 <span class="kwd">as</span> [|? ? <span class="id">Hnxs</span> <span class="id">Hndup</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_cons2">Forall_cons2</a></span>; <span class="tactic">intros</span> (? &amp; <span class="id">Hnin</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">vo1</span>, <span class="id">vo2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">specialize</span> (<span class="id">Hvo</span> <span class="id">a0</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>); <span class="id">inv</span> <span class="id">Hvo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.adds_opt_cons_cons">Env.adds_opt_cons_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Environment.html#Env.refines_add_both">Env.refines_add_both</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">setoid_rewrite</span> <span class="id">Env.adds_opt_cons_cons</span>'; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.adds_opt_cons_cons_None">Env.adds_opt_cons_cons_None</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHxs</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.refines_add_right">Env.refines_add_right</a></span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#eq_Transitive">eq_Transitive</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">now</span> <span class="tactic">specialize</span> (<span class="id">Hvo</span> <span class="id">a</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">setoid_rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.adds_opt_cons_cons_None">Env.adds_opt_cons_cons_None</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="Velus.Environment.html#Env.RefinesAdds">RefinesAdds</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">refines_adds</span>' <span class="id">refines_adds</span> <span class="id">refines_adds_opt</span> : <span class="id">env</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.refines_map">refines_map</a></span> : <span class="kwd">forall</span> {<span class="id">V1</span> <span class="id">V2</span>} {<span class="id">eq1</span> : <span class="id">V1</span> -&gt; <span class="id">V1</span> -&gt; <span class="kwd">Prop</span>} {<span class="id">eq2</span> : <span class="id">V2</span> -&gt; <span class="id">V2</span> -&gt; <span class="kwd">Prop</span>} (<span class="id">f</span> : <span class="id">V1</span> -&gt; <span class="id">V2</span>) <span class="id">H1</span> <span class="id">H2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">eq1</span> <span class="id">x</span> <span class="id">y</span> -&gt; <span class="id">eq2</span> (<span class="id">f</span> <span class="id">x</span>) (<span class="id">f</span> <span class="id">y</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id">eq1</span> <span class="id">H1</span> <span class="id">H2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id">eq2</span> (<span class="id"><a href="Velus.Environment.html#Env.map">map</a></span> <span class="id">f</span> <span class="id">H1</span>) (<span class="id"><a href="Velus.Environment.html#Env.map">map</a></span> <span class="id">f</span> <span class="id">H2</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof122')">Proof.</span></div>
<div class="proofscript" id="proof122">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hf</span> <span class="id">Href</span> ?? <span class="id">Hfind1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.map_o">Props.P.F.map_o</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonTactics.html#option_map_inv">option_map_inv</a></span> <span class="kwd">in</span> <span class="id">Hfind1</span> <span class="kwd">as</span> (?&amp;<span class="id">Hfind1</span>&amp;?); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Href</span> <span class="kwd">in</span> <span class="id">Hfind1</span> <span class="kwd">as</span> (?&amp;?&amp;<span class="id">Hfind1</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hfind1</span>; <span class="tactic">simpl</span>. <span class="tactic">exists</span> (<span class="id">f</span> <span class="id">x1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.In_add1">In_add1</a></span> {<span class="id">A</span> : <span class="kwd">Type</span>}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> (<span class="id">v</span> : <span class="id">A</span>) <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">env</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof123')">Proof.</span></div>
<div class="proofscript" id="proof123">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.In_find">In_find</a></span>. <span class="tactic">setoid_rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gss">gss</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.In_add2">In_add2</a></span> {<span class="id">A</span> : <span class="kwd">Type</span>}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> (<span class="id">v</span> : <span class="id">A</span>) <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">y</span> <span class="id">env</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">y</span> (<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">env</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof124')">Proof.</span></div>
<div class="proofscript" id="proof124">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">y</span> <span class="id">v</span> <span class="id">env0</span> <span class="id">Iy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Common.Common.html#ident_eq_dec">ident_eq_dec</a></span> <span class="id">y</span> <span class="id">x</span>); [<span class="tactic">subst</span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Environment.html#Env.In_add1">In_add1</a></span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.In_find">In_find</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gso">gso</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Hint</span> <span class="kwd">Immediate</span> <span class="id">In_add1</span> : <span class="id">env</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Hint</span> <span class="kwd">Extern</span> 4 (<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> ?<span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> ?<span class="id">y</span> ?<span class="id">v</span> ?<span class="id">env</span>)) =&gt; <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.In_add2">In_add2</a></span> : <span class="id">env</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Hint</span> <span class="kwd">Extern</span> 4 (<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id">_</span> ?<span class="id">x</span> ?<span class="id">x</span>) =&gt; <span class="tactic">reflexivity</span> : <span class="id">env</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Hint</span> <span class="kwd">Immediate</span> <span class="id">eq_Transitive</span> : <span class="id">env</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.adds_opt_mono">adds_opt_mono</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> (<span class="id">env</span>: <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id">A</span>) <span class="id">ys</span> <span class="id">rvos</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> <span class="id">env</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.adds_opt">adds_opt</a></span> <span class="id">ys</span> <span class="id">rvos</span> <span class="id">env</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof125')">Proof.</span></div>
<div class="proofscript" id="proof125">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">ys</span> <span class="kwd">as</span> [|<span class="id">y</span>]; <span class="tactic">destruct</span> <span class="id">rvos</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.adds_opt_cons_cons">adds_opt_cons_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.In_add2">In_add2</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.adds_opt_cons_cons_None">adds_opt_cons_cons_None</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="Env.EnvDom">EnvDom</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span> { <span class="id">V</span> : <span class="kwd">Type</span> }.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Env.dom">dom</a></span> (<span class="id">env</span> : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> <span class="id"><a href="Velus.Environment.html#Env.EnvDom.V">V</a></span>) (<span class="id">dom</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="Velus.Environment.html#Env.In">Env.In</a></span> <span class="id">x</span> <span class="id">env</span> &lt;-&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> <span class="id">x</span> <span class="id">dom</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_use">dom_use</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">env</span> <span class="id">xs</span>},<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">env</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="Velus.Environment.html#Env.In">Env.In</a></span> <span class="id">x</span> <span class="id">env</span> &lt;-&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> <span class="id">x</span> <span class="id">xs</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof126')">Proof.</span></div>
<div class="proofscript" id="proof126">
 <span class="tactic">auto</span>. Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_intro">dom_intro</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">xs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="Velus.Environment.html#Env.In">Env.In</a></span> <span class="id">x</span> <span class="id">env</span> &lt;-&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> <span class="id">x</span> <span class="id">xs</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">env</span> <span class="id">xs</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof127')">Proof.</span></div>
<div class="proofscript" id="proof127">
 <span class="tactic">auto</span>. Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_add_cons">dom_add_cons</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">xs</span> <span class="id">x</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">env</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> (<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">env</span>) (<span class="id">x</span> :: <span class="id">xs</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof128')">Proof.</span></div>
<div class="proofscript" id="proof128">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">evn</span> <span class="id">xs</span> <span class="id">x</span> <span class="id">v</span> <span class="id">ED</span> <span class="id">y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.add_in_iff">Props.P.F.add_in_iff</a></span> <span class="kwd">in</span> <span class="id">HH</span> <span class="kwd">as</span> [<span class="id">HH</span>|<span class="id">HH</span>]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">constructor</span>. <span class="tactic">apply</span> <span class="id">ED</span> <span class="kwd">in</span> <span class="id">HH</span>. <span class="id">now</span> <span class="tactic">constructor</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">HH</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">env</span>. <span class="id">take</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> <span class="id">_</span> <span class="id">xs</span>) <span class="id">and</span> <span class="tactic">apply</span> <span class="id">ED</span> <span class="kwd">in</span> <span class="id">it</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">env</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_empty">dom_empty</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> (<span class="id"><a href="Velus.Environment.html#Env.empty">empty</a></span> <span class="id"><a href="Velus.Environment.html#Env.EnvDom.V">V</a></span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nil">List.nil</a></span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof129')">Proof.</span></div>
<div class="proofscript" id="proof129">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">split</span>; <span class="tactic">inversion</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.empty_in_iff">Props.P.F.empty_in_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html">Permutation</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Add</span> <span class="id">Parametric</span> <span class="id">Morphism</span> (<span class="id">E</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Relations.Relation_Definitions.html#relation">relation</a></span> <span class="id"><a href="Velus.Environment.html#Env.EnvDom.V">V</a></span>) `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Equivalence">Equivalence</a></span> <span class="id">_</span> <span class="id">E</span>} : <span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">signature</span> (<span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span> <span class="id">E</span> ==&gt; @<span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation">Permutation</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> ==&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#iff">iff</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> <span class="id">dom_Equiv_Permutation</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof130')">Proof.</span></div>
<div class="proofscript" id="proof130">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env1</span> <span class="id">env2</span> <span class="id">EE</span> <span class="id">xs1</span> <span class="id">xs2</span> <span class="id">Pxs</span>. <span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id">EE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Pxs</span>; <span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">HH</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> (<span class="tactic">setoid_rewrite</span> &lt;-<span class="id">HH</span> || <span class="tactic">setoid_rewrite</span> <span class="id">HH</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">setoid_rewrite</span> <span class="id">Pxs</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">now</span> <span class="tactic">setoid_rewrite</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#perm_swap">perm_swap</a></span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">now</span> <span class="tactic">setoid_rewrite</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#perm_swap">perm_swap</a></span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">now</span> <span class="tactic">setoid_rewrite</span> <span class="id">Pxs1</span>; <span class="tactic">setoid_rewrite</span> <span class="id">Pxs2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">now</span> <span class="tactic">setoid_rewrite</span> <span class="id">Pxs1</span>; <span class="tactic">setoid_rewrite</span> <span class="id">Pxs2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="Env.dom_Permutation">dom_Permutation</a></span> : <span class="kwd">forall</span> <span class="id">d</span> <span class="id">l1</span> <span class="id">l2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation">Permutation</a></span> <span class="id">l1</span> <span class="id">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">d</span> <span class="id">l1</span> &lt;-&gt; <span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">d</span> <span class="id">l2</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof131')">Proof.</span></div>
<div class="proofscript" id="proof131">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">d</span> <span class="id">l1</span> <span class="id">l2</span> <span class="id">Hperm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_Equiv_Permutation">dom_Equiv_Permutation</a></span> <span class="kwd">with</span> (<span class="id">E</span>:=<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_equal_empty">dom_equal_empty</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">M</span>, <span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">M</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nil">List.nil</a></span> &lt;-&gt; <span class="id"><a href="Velus.Environment.html#Env.Equal">Equal</a></span> <span class="id">M</span> (<span class="id"><a href="Velus.Environment.html#Env.empty">empty</a></span> <span class="id"><a href="Velus.Environment.html#Env.EnvDom.V">V</a></span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof132')">Proof.</span></div>
<div class="proofscript" id="proof132">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span>. <span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intro</span> <span class="id">x</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gempty">gempty</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.not_find_in_iff">Props.P.F.not_find_in_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">HH</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">x</span>. <span class="tactic">setoid_rewrite</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; [<span class="tactic">intro</span> <span class="id">Ix</span>|<span class="id">now</span> <span class="tactic">inversion</span> 1].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.empty_in_iff">Props.P.F.empty_in_iff</a></span> <span class="kwd">in</span> <span class="id">Ix</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_from_list_map_fst">dom_from_list_map_fst</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">xs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * <span class="id"><a href="Velus.Environment.html#Env.EnvDom.V">V</a></span>)) <span class="id">ys</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ys</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> (<span class="id"><a href="Velus.Environment.html#Env.from_list">from_list</a></span> <span class="id">xs</span>) <span class="id">ys</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof133')">Proof.</span></div>
<div class="proofscript" id="proof133">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">ND</span> <span class="id">HH</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xs</span> <span class="kwd">as</span> [|(<span class="id">x</span>, <span class="id">v</span>) <span class="id">xs</span> <span class="id">IH</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_empty">dom_empty</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">ND</span>; <span class="id">take</span> (<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> <span class="id">_</span>) <span class="id">and</span> <span class="tactic">specialize</span> (<span class="id">IH</span> <span class="id">it</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="kwd">in</span> *. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.In_from_list">In_from_list</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.In_from_list">In_from_list</a></span> <span class="kwd">in</span> <span class="id">IH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">y</span>; <span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">HH</span>; <span class="tactic">auto</span>. <span class="id">take</span> (<span class="id"><a href="Velus.Common.CommonList.html#InMembers">InMembers</a></span> <span class="id">_</span> <span class="id">_</span>) <span class="id">and</span> <span class="tactic">apply</span> <span class="id">IH</span> <span class="kwd">in</span> <span class="id">it</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">HH</span> <span class="kwd">as</span> [<span class="id">HH</span>|<span class="id">HH</span>]; <span class="tactic">subst</span>. <span class="id">now</span> <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#fst_InMembers">fst_InMembers</a></span> <span class="kwd">in</span> <span class="id">HH</span>. <span class="id">now</span> <span class="tactic">constructor</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_elements">dom_elements</a></span>: <span class="kwd">forall</span> (<span class="id">e</span> : <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.EnvDom.V">V</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">e</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Environment.html#Env.elements">elements</a></span> <span class="id">e</span>)).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof134')">Proof.</span></div>
<div class="proofscript" id="proof134">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">x</span>; <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.elements_in_iff">Props.P.F.elements_in_iff</a></span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> [<span class="id">v</span> <span class="id">Hin</span>]. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.SetoidList.html#InA_alt">InA_alt</a></span> <span class="kwd">in</span> <span class="id">Hin</span>. <span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [[<span class="id">x</span>' <span class="id">v</span>'] [<span class="id">Heq</span> <span class="id">Hin</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span>. <span class="tactic">exists</span> (<span class="id">x</span>', <span class="id">v</span>'); <span class="tactic">simpl</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Heq</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intro</span> <span class="id">Hin</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span> <span class="kwd">in</span> <span class="id">Hin</span> <span class="kwd">as</span> [[<span class="id">x</span>' <span class="id">v</span>'] [? <span class="id">Hin</span>]]; <span class="tactic">simpl</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">v</span>'; <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.SetoidList.html#In_InA">In_InA</a></span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.eqke_equiv">Props.P.eqke_equiv</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_Perm">dom_Perm</a></span> : <span class="kwd">forall</span> <span class="id">e</span> <span class="id">xs</span> <span class="id">ys</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">ys</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">e</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">e</span> <span class="id">ys</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation">Permutation</a></span> <span class="id">xs</span> <span class="id">ys</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof135')">Proof.</span></div>
<div class="proofscript" id="proof135">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hnd1</span> <span class="id">Hnd2</span> <span class="id">Hdom1</span> <span class="id">Hdom2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#NoDup_Permutation">NoDup_Permutation</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hdom1</span>, &lt;- <span class="id">Hdom2</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Opaque</span> <span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="Velus.Environment.html#Env.EnvDom">EnvDom</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Hint</span> <span class="kwd">Extern</span> 4 (<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> ?<span class="id">env</span> (?<span class="id">xs</span> ++ <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)) =&gt; <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span> : <span class="id">env</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Hint</span> <span class="kwd">Immediate</span> <span class="id">dom_empty</span> : <span class="id">env</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Add</span> <span class="id">Parametric</span> <span class="id">Morphism</span> {<span class="id">A</span>} (<span class="id">R</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Relations.Relation_Definitions.html#relation">relation</a></span> <span class="id">A</span>) `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Equivalence">Equivalence</a></span> <span class="id">_</span> <span class="id">R</span>} : (@<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">signature</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> ==&gt; <span class="id">R</span> ==&gt; <span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span> <span class="id">R</span> ==&gt; <span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span> <span class="id">R</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> <span class="id">add_Equiv</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof136')">Proof.</span></div>
<div class="proofscript" id="proof136">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.Equiv_orel">Equiv_orel</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">v1</span> <span class="id">v2</span> <span class="id">Rvv</span> <span class="id">env1</span> <span class="id">env2</span> <span class="id">EE</span> <span class="id">y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Common.Common.html#ident_eq_dec">ident_eq_dec</a></span> <span class="id">x</span> <span class="id">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">subst</span>. <span class="tactic">setoid_rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gss">gss</a></span>. <span class="id">now</span> <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">setoid_rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gso">gso</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Add</span> <span class="id">Parametric</span> <span class="id">Morphism</span> {<span class="id">A</span>} : (@<span class="id">adds</span>' <span class="id">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">signature</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> ==&gt; <span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> ==&gt; <span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> <span class="id">adds</span>'<span class="id">_Equiv</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof137')">Proof.</span></div>
<div class="proofscript" id="proof137">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">xs</span>; <span class="tactic">induction</span> <span class="id">xs</span> <span class="kwd">as</span> [|(?&amp;?)]; <span class="tactic">intros</span> * <span class="id">Heq</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHxs</span>. <span class="tactic">rewrite</span> <span class="id">Heq</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html">Permutation</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">adds</span>'<span class="id">_Perm</span> {<span class="id">A</span>} : <span class="kwd">forall</span> (<span class="id">xs</span> <span class="id">ys</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * <span class="id">A</span>)) <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation">Permutation</a></span> <span class="id">xs</span> <span class="id">ys</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.Equiv">Env.Equiv</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> (<span class="id">adds</span>' <span class="id">xs</span> <span class="id">m</span>) (<span class="id">adds</span>' <span class="id">ys</span> <span class="id">m</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof138')">Proof.</span></div>
<div class="proofscript" id="proof138">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hnd</span> <span class="id">Hperm</span>. <span class="id">revert</span> <span class="id">m</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hperm</span>; <span class="tactic">intros</span> *; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hnd</span>. <span class="tactic">apply</span> <span class="id">IHHperm</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hnd</span>. <span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">adds</span>'<span class="id">_Equiv</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.add_comm">add_comm</a></span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">H1</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">left</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">etransitivity</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHHperm2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> &lt;-<span class="id">Hperm1</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Add</span> <span class="id">Parametric</span> <span class="id">Morphism</span> {<span class="id">A</span>} : (@<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">signature</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> ==&gt; <span class="id"><a href="Velus.Common.CommonList.html#same_elements">same_elements</a></span> ==&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#iff">iff</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> <span class="id">dom_same_elements</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof139')">Proof.</span></div>
<div class="proofscript" id="proof139">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env</span> <span class="id">xs</span> <span class="id">ys</span> <span class="id">S</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">HH</span>; <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_intro">Env.dom_intro</a></span>; <span class="tactic">intro</span> <span class="id">y</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_use">Env.dom_use</a></span> <span class="kwd">with</span> (<span class="id">x</span>:=<span class="id">y</span>) <span class="kwd">in</span> <span class="id">HH</span>; <span class="tactic">rewrite</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">S</span>. <span class="id">now</span> <span class="tactic">symmetry</span>; <span class="tactic">apply</span> <span class="id">S</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.uniquify_dom">uniquify_dom</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>} (<span class="id">env</span> : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> <span class="id">A</span>) <span class="id">xs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">env</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">ys</span>, <span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">env</span> <span class="id">ys</span> /\ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">ys</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof140')">Proof.</span></div>
<div class="proofscript" id="proof140">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Dxs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> (<span class="id"><a href="Velus.Common.CommonList.html#nub">nub</a></span> <span class="id"><a href="Velus.Common.Common.html#ident_eq_dec">ident_eq_dec</a></span> <span class="id">xs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; [|<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDup_nub">NoDup_nub</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">setoid_rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#nub_same_elements">nub_same_elements</a></span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.find_not_In_dom">find_not_In_dom</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>} (<span class="id">H</span> : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> <span class="id">A</span>) <span class="id">xs</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">H</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> <span class="id">x</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">H</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof141')">Proof.</span></div>
<div class="proofscript" id="proof141">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">DH</span> <span class="id">NI</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_use">dom_use</a></span> <span class="kwd">with</span> (<span class="id">x</span>:=<span class="id">x</span>) <span class="kwd">in</span> <span class="id">DH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;-<span class="id">DH</span> <span class="kwd">in</span> <span class="id">NI</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.in_find_iff">Props.P.F.in_find_iff</a></span> <span class="kwd">in</span> <span class="id">NI</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.Common.html#None_eq_dne">None_eq_dne</a></span> <span class="kwd">in</span> <span class="id">NI</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_cons_remove">dom_cons_remove</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>} (<span class="id">env</span> : @<span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id">A</span>) <span class="id">x</span> <span class="id">xs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">env</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> (<span class="id"><a href="Velus.Environment.html#Env.remove">remove</a></span> <span class="id">x</span> <span class="id">env</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter">filter</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#nequiv_decb">nequiv_decb</a></span> <span class="id">x</span>) <span class="id">xs</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof142')">Proof.</span></div>
<div class="proofscript" id="proof142">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">D</span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_intro">dom_intro</a></span>. <span class="tactic">intros</span> <span class="id">y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_use">dom_use</a></span> <span class="kwd">with</span> (<span class="id">x</span>:=<span class="id">y</span>) <span class="kwd">in</span> <span class="id">D</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Common.Common.html#ident_eq_dec">ident_eq_dec</a></span> <span class="id">y</span> <span class="id">x</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">setoid_rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.In_find">In_find</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.grs">grs</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; [<span class="tactic">intros</span> (? &amp; ?); <span class="tactic">discriminate</span>|<span class="tactic">intros</span> (? &amp; <span class="id">HH</span>)].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#nequiv_decb_refl">nequiv_decb_refl</a></span> <span class="kwd">in</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.remove_in_iff">Props.P.F.remove_in_iff</a></span>, <span class="id">D</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span> (<span class="id">H1</span> &amp; <span class="id">H2</span>); <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.Common.html#nequiv_decb_true">nequiv_decb_true</a></span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_map">dom_map</a></span> : <span class="kwd">forall</span> {<span class="id">V1</span> <span class="id">V2</span>} (<span class="id">f</span> : <span class="id">V1</span> -&gt; <span class="id">V2</span>) <span class="id">xs</span> <span class="id">H</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> (<span class="id"><a href="Velus.Environment.html#Env.map">Env.map</a></span> <span class="id">f</span> <span class="id">H</span>) <span class="id">xs</span> &lt;-&gt; <span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">H</span> <span class="id">xs</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof143')">Proof.</span></div>
<div class="proofscript" id="proof143">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> *; <span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">Hdom</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_intro">dom_intro</a></span>; <span class="tactic">intros</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="id">erewrite</span> &lt;-<span class="id"><a href="Velus.Environment.html#Env.dom_use">dom_use</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="id">erewrite</span> <span class="id"><a href="Velus.Environment.html#Env.map_in_iff">Props.P.F.map_in_iff</a></span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="Env.DomAdds">DomAdds</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span> { <span class="id">V</span> : <span class="kwd">Type</span> }.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id">dom_adds</span>' : <span class="kwd">forall</span> (<span class="id">xs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> * <span class="id"><a href="Velus.Environment.html#Env.DomAdds.V">V</a></span>)) <span class="id">H</span> <span class="id">d</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">H</span> <span class="id">d</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> (<span class="id">adds</span>' <span class="id">xs</span> <span class="id">H</span>) ((<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">xs</span>)++<span class="id">d</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof144')">Proof.</span></div>
<div class="proofscript" id="proof144">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xs</span>; <span class="tactic">intros</span> <span class="id">H</span> <span class="id">d</span> <span class="id">Hdom</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_add_cons">dom_add_cons</a></span> <span class="kwd">with</span> (<span class="id">x</span>:=<span class="id">i</span>) (<span class="id">v</span>:=<span class="id">v</span>) <span class="kwd">in</span> <span class="id">Hdom</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHxs</span> <span class="kwd">in</span> <span class="id">Hdom</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="Velus.Environment.html#Env.dom_Permutation">dom_Permutation</a></span>; [<span class="tactic">eauto</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_middle">Permutation.Permutation_middle</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_adds">dom_adds</a></span> : <span class="kwd">forall</span> <span class="id">ids</span> (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Environment.html#Env.DomAdds.V">V</a></span>) <span class="id">H</span> <span class="id">d</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">ids</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">H</span> <span class="id">d</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> (<span class="id"><a href="Velus.Environment.html#Env.adds">adds</a></span> <span class="id">ids</span> <span class="id">vs</span> <span class="id">H</span>) (<span class="id">ids</span>++<span class="id">d</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof145')">Proof.</span></div>
<div class="proofscript" id="proof145">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.adds">adds</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">dom_adds</span>' <span class="kwd">with</span> (<span class="id">xs</span>:=(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#combine">combine</a></span> <span class="id">ids</span> <span class="id">vs</span>)) <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">combine_map_fst</span>' <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.adds_MapsTo">adds_MapsTo</a></span> : <span class="kwd">forall</span> <span class="id">ids</span> (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Environment.html#Env.DomAdds.V">V</a></span>) <span class="id">H</span> <span class="id">n</span> <span class="id">d</span> <span class="id">d</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">ids</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">n</span> &lt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">ids</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">ids</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.MapsTo">Env.MapsTo</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id">n</span> <span class="id">ids</span> <span class="id">d</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id">n</span> <span class="id">vs</span> <span class="id">d</span>') (<span class="id"><a href="Velus.Environment.html#Env.adds">Env.adds</a></span> <span class="id">ids</span> <span class="id">vs</span> <span class="id">H</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof146')">Proof.</span></div>
<div class="proofscript" id="proof146">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">ids</span>; <span class="tactic">intros</span> <span class="id">vs</span> <span class="id">H</span> <span class="id">n</span> <span class="id">d</span> <span class="id">d</span>' <span class="id">Hlen</span> <span class="id">Hn</span> <span class="id">Hndup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.adds">adds</a></span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">vs</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hndup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.MapsTo">MapsTo</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.find_gsss">find_gsss</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">IHids</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="Velus.Environment.html#Env.DomAdds">DomAdds</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="Env.EnvDomUpperBound">EnvDomUpperBound</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span> { <span class="id">V</span> : <span class="kwd">Type</span> }.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Env.dom_ub">dom_ub</a></span> (<span class="id">env</span> : <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.EnvDomUpperBound.V">V</a></span>) (<span class="id">dom</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> <span class="id">env</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> <span class="id">x</span> <span class="id">dom</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_ub_use">dom_ub_use</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">env</span> <span class="id">xs</span>},<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_ub">dom_ub</a></span> <span class="id">env</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> <span class="id">env</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> <span class="id">x</span> <span class="id">xs</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof147')">Proof.</span></div>
<div class="proofscript" id="proof147">
 <span class="tactic">auto</span>. Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_ub_intro">dom_ub_intro</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">xs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> <span class="id">env</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> <span class="id">x</span> <span class="id">xs</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_ub">dom_ub</a></span> <span class="id">env</span> <span class="id">xs</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof148')">Proof.</span></div>
<div class="proofscript" id="proof148">
 <span class="tactic">auto</span>. Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_dom_ub">dom_dom_ub</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">H</span> <span class="id">d</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id">H</span> <span class="id">d</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_ub">dom_ub</a></span> <span class="id">H</span> <span class="id">d</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof149')">Proof.</span></div>
<div class="proofscript" id="proof149">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">DH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_ub_intro">dom_ub_intro</a></span>. <span class="tactic">intros</span> <span class="id">x</span> <span class="id">Ix</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_use">dom_use</a></span> <span class="kwd">with</span> (1:=<span class="id">DH</span>) <span class="kwd">in</span> <span class="id">Ix</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_ub_empty">dom_ub_empty</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">d</span>, <span class="id"><a href="Velus.Environment.html#Env.dom_ub">dom_ub</a></span> (<span class="id"><a href="Velus.Environment.html#Env.empty">empty</a></span> <span class="id"><a href="Velus.Environment.html#Env.EnvDomUpperBound.V">V</a></span>) <span class="id">d</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof150')">Proof.</span></div>
<div class="proofscript" id="proof150">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">d</span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_ub_intro">dom_ub_intro</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">Ix</span>. <span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.empty_in_iff">Env.Props.P.F.empty_in_iff</a></span> <span class="kwd">in</span> <span class="id">Ix</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_ub_incl">dom_ub_incl</a></span>: <span class="kwd">forall</span> <span class="id">H</span> <span class="id">xs</span> <span class="id">ys</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> <span class="id">xs</span> <span class="id">ys</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_ub">dom_ub</a></span> <span class="id">H</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_ub">dom_ub</a></span> <span class="id">H</span> <span class="id">ys</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof151')">Proof.</span></div>
<div class="proofscript" id="proof151">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hincl</span> <span class="id">Hd</span> ? <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hincl</span>, <span class="id">Hd</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="Env.dom_ub_app">dom_ub_app</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">H</span> <span class="id">xs</span> <span class="id">ys</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_ub">dom_ub</a></span> <span class="id">H</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_ub">dom_ub</a></span> <span class="id">H</span> (<span class="id">xs</span> ++ <span class="id">ys</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof152')">Proof.</span></div>
<div class="proofscript" id="proof152">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">DH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_ub_incl">dom_ub_incl</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_appl">incl_appl</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#incl_refl">incl_refl</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Add</span> <span class="id">Parametric</span> <span class="id">Morphism</span> (<span class="id">E</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Relations.Relation_Definitions.html#relation">relation</a></span> <span class="id"><a href="Velus.Environment.html#Env.EnvDomUpperBound.V">V</a></span>) `{<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Equivalence">Equivalence</a></span> <span class="id">_</span> <span class="id">E</span>} : <span class="id"><a href="Velus.Environment.html#Env.dom_ub">dom_ub</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">signature</span> (<span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span> <span class="id">E</span> ==&gt; @<span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation">Permutation</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> ==&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#iff">iff</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> <span class="id">dom_ub_Equiv_Permutation</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof153')">Proof.</span></div>
<div class="proofscript" id="proof153">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env1</span> <span class="id">env2</span> <span class="id">EE</span> <span class="id">xs1</span> <span class="id">xs2</span> <span class="id">Pxs</span>. <span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.dom_ub">dom_ub</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id">EE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span> ?? <span class="id">HH</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">rewrite</span> <span class="id">Pxs</span>||<span class="tactic">rewrite</span> &lt;-<span class="id">Pxs</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Opaque</span> <span class="id"><a href="Velus.Environment.html#Env.dom_ub">dom_ub</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="Velus.Environment.html#Env.EnvDomUpperBound">EnvDomUpperBound</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_ub_map">dom_ub_map</a></span> : <span class="kwd">forall</span> {<span class="id">V1</span> <span class="id">V2</span>} (<span class="id">f</span> : <span class="id">V1</span> -&gt; <span class="id">V2</span>) <span class="id">xs</span> <span class="id">H</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_ub">dom_ub</a></span> (<span class="id"><a href="Velus.Environment.html#Env.map">Env.map</a></span> <span class="id">f</span> <span class="id">H</span>) <span class="id">xs</span> &lt;-&gt; <span class="id"><a href="Velus.Environment.html#Env.dom_ub">dom_ub</a></span> <span class="id">H</span> <span class="id">xs</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof154')">Proof.</span></div>
<div class="proofscript" id="proof154">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> *; <span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">Hdom</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_ub_intro">dom_ub_intro</a></span>; <span class="tactic">intros</span> <span class="id">x</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_ub_use">dom_ub_use</a></span>; [<span class="tactic">eauto</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="id">erewrite</span> <span class="id"><a href="Velus.Environment.html#Env.map_in_iff">Props.P.F.map_in_iff</a></span> <span class="kwd">in</span> *; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_ub_refines">dom_ub_refines</a></span>: <span class="kwd">forall</span> {<span class="id">A</span> <span class="id">R</span>} (<span class="id">H</span> <span class="id">H</span>' : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> <span class="id">A</span>) <span class="id">d</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id">R</span> <span class="id">H</span> <span class="id">H</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_ub">dom_ub</a></span> <span class="id">H</span>' <span class="id">d</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_ub">dom_ub</a></span> <span class="id">H</span> <span class="id">d</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof155')">Proof.</span></div>
<div class="proofscript" id="proof155">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Href</span> <span class="id">Hdom</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_ub_intro">dom_ub_intro</a></span>; <span class="tactic">intros</span> * <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_ub_use">dom_ub_use</a></span> <span class="kwd">in</span> <span class="id">Hdom</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.In_refines">In_refines</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.refines_dom_ub_dom">refines_dom_ub_dom</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> <span class="id">R</span>} (<span class="id">H</span> <span class="id">H</span>' : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> <span class="id">A</span>) <span class="id">d</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id">R</span> <span class="id">H</span> <span class="id">H</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">H</span> <span class="id">d</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_ub">dom_ub</a></span> <span class="id">H</span>' <span class="id">d</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">H</span>' <span class="id">d</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof156')">Proof.</span></div>
<div class="proofscript" id="proof156">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">A</span> <span class="id">R</span> <span class="id">H</span> <span class="id">H</span>' <span class="id">d</span> <span class="id">HH</span> <span class="id">DH</span> <span class="id">DH</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_intro">dom_intro</a></span>. <span class="tactic">intro</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">Ix</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_ub_use">dom_ub_use</a></span> <span class="kwd">with</span> (1:=<span class="id">DH</span>') <span class="kwd">in</span> <span class="id">Ix</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_use">dom_use</a></span> <span class="kwd">with</span> (1:=<span class="id">DH</span>) <span class="kwd">in</span> <span class="id">Ix</span>; <span class="tactic">rewrite</span> <span class="id">HH</span> <span class="kwd">in</span> <span class="id">Ix</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_ub_cons">dom_ub_cons</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">V</span>} <span class="id">x</span> <span class="id">xs</span> (<span class="id">env</span>: <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_ub">dom_ub</a></span> <span class="id">env</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_ub">dom_ub</a></span> <span class="id">env</span> (<span class="id">x</span>::<span class="id">xs</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof157')">Proof.</span></div>
<div class="proofscript" id="proof157">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">DU</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_ub_intro">dom_ub_intro</a></span>. <span class="tactic">intros</span> <span class="id">y</span> <span class="id">Iy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">DU</span> <span class="kwd">in</span> <span class="id">Iy</span>. <span class="id">now</span> <span class="tactic">constructor</span> 2.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_ub_add">dom_ub_add</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">V</span>} <span class="id">x</span> <span class="id">v</span> <span class="id">xs</span> (<span class="id">env</span>: <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_ub">dom_ub</a></span> <span class="id">env</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_ub">dom_ub</a></span> (<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">env</span>) (<span class="id">x</span>::<span class="id">xs</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof158')">Proof.</span></div>
<div class="proofscript" id="proof158">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">DU</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_ub_intro">Env.dom_ub_intro</a></span>. <span class="tactic">intros</span> <span class="id">y</span> <span class="id">Iy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.add_in_iff">Env.Props.P.F.add_in_iff</a></span> <span class="kwd">in</span> <span class="id">Iy</span> <span class="kwd">as</span> [<span class="id">Iy</span>|<span class="id">Iy</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">subst</span>; <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">DU</span> <span class="kwd">in</span> <span class="id">Iy</span>. <span class="id">now</span> <span class="tactic">constructor</span> 2.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_Forall_not_In">dom_Forall_not_In</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>} (<span class="id">H</span> : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> <span class="id">A</span>) <span class="id">xs</span> <span class="id">ys</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">H</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; ~<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> <span class="id">x</span> <span class="id">xs</span>) <span class="id">ys</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">y</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> <span class="id">y</span> <span class="id">ys</span> -&gt; ~(<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">y</span> <span class="id">H</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof159')">Proof.</span></div>
<div class="proofscript" id="proof159">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">DH</span> <span class="id">FA</span> <span class="id">y</span> <span class="id">Iy</span> <span class="id">Ey</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_use">Env.dom_use</a></span> <span class="kwd">with</span> (1:=<span class="id">DH</span>) <span class="kwd">in</span> <span class="id">Ey</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">FA</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">FA</span> <span class="kwd">in</span> <span class="id">Iy</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="Env.EnvDomLowerBound">EnvDomLowerBound</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span> { <span class="id">V</span> : <span class="kwd">Type</span> }.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Env.dom_lb">dom_lb</a></span> (<span class="id">env</span> : <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.EnvDomLowerBound.V">V</a></span>) (<span class="id">dom</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> <span class="id">x</span> <span class="id">dom</span> -&gt; <span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> <span class="id">env</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_lb_cons">dom_lb_cons</a></span> : <span class="kwd">forall</span> (<span class="id">env</span> : <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.EnvDomLowerBound.V">V</a></span>) (<span class="id">id</span> : <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) (<span class="id">xs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_lb">dom_lb</a></span> <span class="id">env</span> (<span class="id">id</span>::<span class="id">xs</span>) &lt;-&gt; (<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">id</span> <span class="id">env</span> /\ <span class="id"><a href="Velus.Environment.html#Env.dom_lb">dom_lb</a></span> <span class="id">env</span> <span class="id">xs</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof160')">Proof.</span></div>
<div class="proofscript" id="proof160">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env</span> <span class="id">id</span> <span class="id">xs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.dom_lb">dom_lb</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intro</span> <span class="id">H</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">H</span>. <span class="tactic">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">x</span> <span class="id">Hin</span>. <span class="tactic">apply</span> <span class="id">H</span>. <span class="tactic">right</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> [<span class="id">H1</span> <span class="id">H2</span>] <span class="id">x</span> <span class="id">HIn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">HIn</span>; <span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_lb_use">dom_lb_use</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">env</span> <span class="id">xs</span>},<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_lb">dom_lb</a></span> <span class="id">env</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> <span class="id">x</span> <span class="id">xs</span> -&gt; <span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> <span class="id">env</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof161')">Proof.</span></div>
<div class="proofscript" id="proof161">
 <span class="tactic">auto</span>. Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_lb_intro">dom_lb_intro</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">xs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> <span class="id">x</span> <span class="id">xs</span> -&gt; <span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> <span class="id">env</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_lb">dom_lb</a></span> <span class="id">env</span> <span class="id">xs</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof162')">Proof.</span></div>
<div class="proofscript" id="proof162">
 <span class="tactic">auto</span>. Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_dom_lb">dom_dom_lb</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">H</span> <span class="id">d</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">H</span> <span class="id">d</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_lb">dom_lb</a></span> <span class="id">H</span> <span class="id">d</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof163')">Proof.</span></div>
<div class="proofscript" id="proof163">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">DH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_lb_intro">dom_lb_intro</a></span>. <span class="tactic">intros</span> <span class="id">x</span> <span class="id">Ix</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_use">Env.dom_use</a></span> <span class="kwd">with</span> (1:=<span class="id">DH</span>) <span class="kwd">in</span> <span class="id">Ix</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_lb_nil">dom_lb_nil</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">E</span>, <span class="id"><a href="Velus.Environment.html#Env.dom_lb">dom_lb</a></span> <span class="id">E</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof164')">Proof.</span></div>
<div class="proofscript" id="proof164">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">E</span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_lb_intro">dom_lb_intro</a></span>. <span class="id">now</span> <span class="tactic">inversion</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_lb_add_cons">dom_lb_add_cons</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">xs</span> <span class="id">v</span> <span class="id">H</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_lb">dom_lb</a></span> <span class="id">H</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_lb">dom_lb</a></span> (<span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">H</span>) (<span class="id">x</span> :: <span class="id">xs</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof165')">Proof.</span></div>
<div class="proofscript" id="proof165">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">xs</span> <span class="id">v</span> <span class="id">H</span> <span class="id">DH</span> <span class="id">y</span> <span class="id">Iy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Iy</span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Environment.html#Env.In_add1">In_add1</a></span>, <span class="id"><a href="Velus.Environment.html#Env.In_add2">In_add2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_lb_incl">dom_lb_incl</a></span>: <span class="kwd">forall</span> <span class="id">H</span> <span class="id">xs</span> <span class="id">ys</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> <span class="id">xs</span> <span class="id">ys</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_lb">dom_lb</a></span> <span class="id">H</span> <span class="id">ys</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_lb">dom_lb</a></span> <span class="id">H</span> <span class="id">xs</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof166')">Proof.</span></div>
<div class="proofscript" id="proof166">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hincl</span> <span class="id">Hlb</span> ? <span class="id">Hin</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_lb_app">dom_lb_app</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">H</span> <span class="id">xs</span> <span class="id">ys</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_lb">dom_lb</a></span> <span class="id">H</span> (<span class="id">xs</span> ++ <span class="id">ys</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_lb">dom_lb</a></span> <span class="id">H</span> <span class="id">xs</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof167')">Proof.</span></div>
<div class="proofscript" id="proof167">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">H</span> <span class="id">xs</span> <span class="id">ys</span> <span class="id">DH</span> <span class="id">x</span> <span class="id">Ix</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">DH</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_or_app">in_or_app</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_lb_refines">dom_lb_refines</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">R</span> <span class="id">H</span> <span class="id">H</span>' <span class="id">xs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id">R</span> <span class="id">H</span> <span class="id">H</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_lb">dom_lb</a></span> <span class="id">H</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_lb">dom_lb</a></span> <span class="id">H</span>' <span class="id">xs</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof168')">Proof.</span></div>
<div class="proofscript" id="proof168">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Href</span> <span class="id">Hdom</span> ? <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.In_refines">In_refines</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_lb_map">dom_lb_map</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">H</span> <span class="id">xs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_lb">dom_lb</a></span> <span class="id">H</span> <span class="id">xs</span> &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_lb">dom_lb</a></span> (<span class="id"><a href="Velus.Environment.html#Env.map">map</a></span> <span class="id">f</span> <span class="id">H</span>) <span class="id">xs</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof169')">Proof.</span></div>
<div class="proofscript" id="proof169">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> *; <span class="tactic">split</span>; <span class="tactic">intros</span> * <span class="id">Hdom</span> ? <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.map_in_iff">Props.P.F.map_in_iff</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">erewrite</span> &lt;-<span class="id"><a href="Velus.Environment.html#Env.map_in_iff">Props.P.F.map_in_iff</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">dom_lb_app</span>': <span class="kwd">forall</span> <span class="id">H</span> <span class="id">xs</span> <span class="id">ys</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_lb">dom_lb</a></span> <span class="id">H</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_lb">dom_lb</a></span> <span class="id">H</span> <span class="id">ys</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_lb">dom_lb</a></span> <span class="id">H</span> (<span class="id">xs</span> ++ <span class="id">ys</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof170')">Proof.</span></div>
<div class="proofscript" id="proof170">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hd1</span> <span class="id">Hd2</span> ? <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_or">in_app_or</a></span> <span class="kwd">in</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Hin</span>|<span class="id">Hin</span>]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="Env.dom_lb_concat">dom_lb_concat</a></span>: <span class="kwd">forall</span> <span class="id">H</span> <span class="id">xss</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Environment.html#Env.dom_lb">dom_lb</a></span> <span class="id">H</span>) <span class="id">xss</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_lb">dom_lb</a></span> <span class="id">H</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">xss</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof171')">Proof.</span></div>
<div class="proofscript" id="proof171">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hf</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Environment.html#Env.dom_lb_nil">dom_lb_nil</a></span>, <span class="id">dom_lb_app</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Opaque</span> <span class="id"><a href="Velus.Environment.html#Env.dom_lb">dom_lb</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="Velus.Environment.html#Env.EnvDomLowerBound">EnvDomLowerBound</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">dom_lb_nil</span> : <span class="id">env</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.dom_lb_ub_dom">dom_lb_ub_dom</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>} (<span class="id">H</span> : <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id">A</span>) <span class="id">d</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_lb">dom_lb</a></span> <span class="id">H</span> <span class="id">d</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_ub">dom_ub</a></span> <span class="id">H</span> <span class="id">d</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">H</span> <span class="id">d</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof172')">Proof.</span></div>
<div class="proofscript" id="proof172">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Min</span> <span class="id">Max</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_intro">dom_intro</a></span>; <span class="tactic">intro</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">Ix</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_ub_use">dom_ub_use</a></span> <span class="kwd">with</span> (1:=<span class="id">Max</span>) <span class="kwd">in</span> <span class="id">Ix</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_lb_use">dom_lb_use</a></span> <span class="kwd">with</span> (1:=<span class="id">Min</span>) <span class="kwd">in</span> <span class="id">Ix</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">dom_lb_ub_dom</span> : <span class="id">env</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">adds</span>'<span class="id">_dom_ub</span> : <span class="kwd">forall</span> {<span class="id">A</span>} (<span class="id">H</span> : <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id">A</span>) <span class="id">d</span> <span class="id">xs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_ub">dom_ub</a></span> <span class="id">H</span> <span class="id">d</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_ub">dom_ub</a></span> (<span class="id">Env.adds</span>' <span class="id">xs</span> <span class="id">H</span>) (<span class="id">d</span> ++ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">xs</span>).<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof173')">Proof.</span></div>
<div class="proofscript" id="proof173">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hdom</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_ub_intro">dom_ub_intro</a></span>; <span class="tactic">intros</span> ? <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">In_adds_spec</span>' <span class="kwd">in</span> <span class="id">Hin</span> <span class="kwd">as</span> [|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_or_app">in_or_app</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#or_intror">or_intror</a></span>. <span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#fst_InMembers">fst_InMembers</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_ub_use">dom_ub_use</a></span> <span class="kwd">with</span> (<span class="id">x</span>:=<span class="id">x</span>) <span class="kwd">in</span> <span class="id">Hdom</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_or_app">in_or_app</a></span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id">adds_opt</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#ListNotations">List.ListNotations</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">adds_opt</span>' {<span class="id">A</span> : <span class="kwd">Type</span>} (<span class="id">xos</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>) (<span class="id">e</span> : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> <span class="id">A</span>) : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> <span class="id">A</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_right">fold_right</a></span> (<span class="kwd">fun</span> (<span class="id">xov</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span> * <span class="id">A</span>) <span class="id">env</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">xov</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span>, <span class="id">v</span>) =&gt; <span class="id"><a href="Velus.Environment.html#Env.add">Env.add</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">env</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">env</span> <span class="kwd">end</span>) <span class="id">e</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#combine">combine</a></span> <span class="id">xos</span> <span class="id">vs</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">find_adds_opt</span>'<span class="id">_spec_Some</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>} <span class="id">xs</span> <span class="id">vs</span> <span class="id">x</span> (<span class="id">a</span> : <span class="id">A</span>) <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">xs</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> (<span class="id">adds_opt</span>' <span class="id">xs</span> <span class="id">vs</span> <span class="id">m</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">a</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span>, <span class="id">a</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#combine">combine</a></span> <span class="id">xs</span> <span class="id">vs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/ <span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> <span class="id">m</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">a</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof174')">Proof.</span></div>
<div class="proofscript" id="proof174">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">adds_opt</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xs</span> <span class="kwd">as</span> [|<span class="id">x</span>'], <span class="id">vs</span> <span class="kwd">as</span> [|<span class="id">v</span>']; <span class="tactic">simpl</span>; <span class="tactic">auto</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Length</span> <span class="id">Find</span>; <span class="id">inv</span> <span class="id">Length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">x</span> <span class="id">p</span>) <span class="kwd">as</span> [|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>; <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gss">Env.gss</a></span> <span class="kwd">in</span> <span class="id">Find</span>; <span class="id">inv</span> <span class="id">Find</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gso">Env.gso</a></span> <span class="kwd">in</span> <span class="id">Find</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHxs</span> <span class="kwd">in</span> <span class="id">Find</span> <span class="kwd">as</span> [|()]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">IHxs</span> <span class="kwd">in</span> <span class="id">Find</span> <span class="kwd">as</span> [|]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">find_gsso_opt</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>}<span class="id">x</span> <span class="id">x</span>' <span class="id">xs</span> (<span class="id">vs</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>) <span class="id">S</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span> &lt;&gt; <span class="id">x</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> (<span class="id">adds_opt</span>' (<span class="id">x</span>' :: <span class="id">xs</span>) <span class="id">vs</span> <span class="id">S</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> (<span class="id">adds_opt</span>' <span class="id">xs</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#tl">tl</a></span> <span class="id">vs</span>) <span class="id">S</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof175')">Proof.</span></div>
<div class="proofscript" id="proof175">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hneq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">adds_opt</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">vs</span>. <span class="id">now</span> <span class="tactic">destruct</span> <span class="id">xs</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>'; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gso">Env.gso</a></span>; <span class="tactic">auto</span>. <span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">Hneq</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">find_gsss_opt</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>} <span class="id">x</span> <span class="id">v</span> <span class="id">xs</span> (<span class="id">vs</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>) <span class="id">S</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> (<span class="id">adds_opt</span>' (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span> :: <span class="id">xs</span>) (<span class="id">v</span> :: <span class="id">vs</span>) <span class="id">S</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof176')">Proof.</span></div>
<div class="proofscript" id="proof176">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">adds_opt</span>'. <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.gss">Env.gss</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">find_In_gsso_opt</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>} <span class="id">x</span> <span class="id">ys</span> (<span class="id">vs</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>) <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="Velus.Common.CommonList.html#Ino">Ino</a></span> <span class="id">x</span> <span class="id">ys</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> (<span class="id">adds_opt</span>' <span class="id">ys</span> <span class="id">vs</span> <span class="id">env</span>) = <span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> <span class="id">env</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof177')">Proof.</span></div>
<div class="proofscript" id="proof177">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> ? <span class="id">x</span> <span class="id">ys</span> <span class="id">vs</span> <span class="id">env</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">vs</span>; <span class="tactic">induction</span> <span class="id">ys</span>; <span class="tactic">intro</span> <span class="id">vs</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">find_gsso_opt</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">IHys</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Ino_In">Ino_In</a></span> <span class="kwd">in</span> *. <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">Hin</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Ino_In">Ino_In</a></span>. <span class="id">now</span> <span class="tactic">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">adds_opt</span>'<span class="id">_cons_Some</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>} <span class="id">xs</span> <span class="id">x</span> (<span class="id">v</span>: <span class="id">A</span>) <span class="id">vs</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">adds_opt</span>' (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span> :: <span class="id">xs</span>) (<span class="id">v</span> :: <span class="id">vs</span>) <span class="id">e</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.add">Env.add</a></span> <span class="id">x</span> <span class="id">v</span> (<span class="id">adds_opt</span>' <span class="id">xs</span> <span class="id">vs</span> <span class="id">e</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof178')">Proof.</span></div>
<div class="proofscript" id="proof178">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xs</span> <span class="kwd">as</span> [|<span class="id">x</span>']; <span class="tactic">intros</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">adds_opt</span>'<span class="id">_cons_None</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>} <span class="id">xs</span> (<span class="id">v</span> : <span class="id">A</span>) <span class="id">vs</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">adds_opt</span>' (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> :: <span class="id">xs</span>) (<span class="id">v</span> :: <span class="id">vs</span>) <span class="id">e</span> = <span class="id">adds_opt</span>' <span class="id">xs</span> <span class="id">vs</span> <span class="id">e</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof179')">Proof.</span></div>
<div class="proofscript" id="proof179">
 <span class="tactic">auto</span>. Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">adds_opt</span>'<span class="id">_app</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>} <span class="id">xs</span> (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>) <span class="id">xs</span>' <span class="id">vs</span>' <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">xs</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">adds_opt</span>' (<span class="id">xs</span> ++ <span class="id">xs</span>') (<span class="id">vs</span> ++ <span class="id">vs</span>') <span class="id">m</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id">adds_opt</span>' <span class="id">xs</span> <span class="id">vs</span> (<span class="id">adds_opt</span>' <span class="id">xs</span>' <span class="id">vs</span>' <span class="id">m</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof180')">Proof.</span></div>
<div class="proofscript" id="proof180">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xs</span> <span class="kwd">as</span> [|<span class="id">x</span> <span class="id">xs</span> <span class="id">IH</span>]; <span class="tactic">simpl</span>; <span class="tactic">intros</span> * <span class="id">Hlen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">Hlen</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#length_zero_iff_nil">length_zero_iff_nil</a></span> <span class="kwd">in</span> <span class="id">Hlen</span>. <span class="tactic">subst</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">vs</span> <span class="kwd">as</span> [| <span class="id">v</span> <span class="id">vs</span>]; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hlen</span>; <span class="id">inv</span> <span class="id">Hlen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id">adds_opt</span>'<span class="id">_cons_Some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IH</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id">adds_opt</span>'<span class="id">_cons_None</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IH</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">adds_opt</span>'<span class="id">_nil</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>} <span class="id">vs</span> (<span class="id">e</span> : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">adds_opt</span>' [] <span class="id">vs</span> <span class="id">e</span> = <span class="id">e</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof181')">Proof.</span></div>
<div class="proofscript" id="proof181">
 <span class="tactic">auto</span>. Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">adds_opt</span>'<span class="id">_nil</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>} <span class="id">xs</span> (<span class="id">e</span> : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">adds_opt</span>' <span class="id">xs</span> [] <span class="id">e</span> = <span class="id">e</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof182')">Proof.</span></div>
<div class="proofscript" id="proof182">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">adds_opt</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#combine_nil_r">combine_nil_r</a></span>. <span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">adds_opt</span>'<span class="id">_None</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> <span class="id">B</span>} <span class="id">xs</span> <span class="id">vs</span> (<span class="id">e</span> : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">adds_opt</span>' (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> <span class="id">_</span> : <span class="id">B</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) <span class="id">xs</span>) <span class="id">vs</span> <span class="id">e</span> = <span class="id">e</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof183')">Proof.</span></div>
<div class="proofscript" id="proof183">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xs</span>; <span class="tactic">simpl</span>. <span class="id">now</span> <span class="tactic">setoid_rewrite</span> <span class="id">adds_opt</span>'<span class="id">_nil</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">vs</span>. <span class="id">now</span> <span class="tactic">setoid_rewrite</span> <span class="id">adds_opt</span>'<span class="id">_nil</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id">adds_opt</span>'<span class="id">_cons_None</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">find_adds_opt</span>'<span class="id">_disj</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>} (<span class="id">x</span> : <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) <span class="id">xs</span> <span class="id">xs</span>' <span class="id">vs</span> <span class="id">vs</span>' (<span class="id">e</span> : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="Velus.Common.CommonList.html#Ino">Ino</a></span> <span class="id">x</span> <span class="id">xs</span> -&gt; ~ <span class="id"><a href="Velus.Common.CommonList.html#Ino">Ino</a></span> <span class="id">x</span> <span class="id">xs</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#Ino">Ino</a></span> <span class="id">x</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> (<span class="id">adds_opt</span>' <span class="id">xs</span> <span class="id">vs</span> <span class="id">e</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> (<span class="id">adds_opt</span>' <span class="id">xs</span> <span class="id">vs</span> (<span class="id">adds_opt</span>' <span class="id">xs</span>' <span class="id">vs</span>' <span class="id">e</span>)).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof184')">Proof.</span></div>
<div class="proofscript" id="proof184">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hino</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="tactic">dependent</span> <span class="id">x</span>. <span class="id">revert</span> <span class="id">vs</span>. <span class="tactic">induction</span> <span class="id">xs</span>; <span class="tactic">intros</span>; <span class="id">inv</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span> <span class="kwd">as</span> [<span class="id">p</span>|]; <span class="id">take</span> (<span class="id"><a href="Velus.Common.CommonList.html#LiftO">LiftO</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>. <span class="tactic">destruct</span> <span class="id">vs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id">adds_opt</span>'<span class="id">_nil</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id">Hino</span> <span class="id">p</span>). <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hino</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id">Hino</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#or_introl">or_introl</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span> <span class="id">p</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">find_In_gsso_opt</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> 2 <span class="id">find_gsss_opt</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span> <span class="kwd">as</span> [<span class="id">p</span>|], <span class="id">vs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">IHxs</span> <span class="kwd">with</span> (<span class="id">vs</span> := []) <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2: <span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id">Hino</span>; <span class="id">now</span> <span class="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> 2 <span class="id">adds_opt</span>'<span class="id">_nil</span>' <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id"><a href="Velus.Common.Common.html#decidable_eq_ident">decidable_eq_ident</a></span> <span class="id">x</span> <span class="id">p</span>). <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> 2 <span class="id">find_gsss_opt</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> 2 <span class="id">find_gsso_opt</span>'; <span class="tactic">simpl</span>. 2-3: <span class="tactic">intro</span> <span class="id">Heq</span>; <span class="id">inv</span> <span class="id">Heq</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHxs</span>; <span class="tactic">auto</span>. <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">Hino</span>. <span class="id">now</span> <span class="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">IHxs</span> <span class="kwd">with</span> (<span class="id">vs</span> := []) <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2: <span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id">Hino</span>; <span class="id">now</span> <span class="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> 2 <span class="id">adds_opt</span>'<span class="id">_nil</span>' <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> 2 <span class="id">adds_opt</span>'<span class="id">_cons_None</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHxs</span>; <span class="tactic">auto</span>. <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">Hino</span>. <span class="id">now</span> <span class="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">find_permute_adds_opt</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>} (<span class="id">x</span> : <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) <span class="id">xs</span> <span class="id">xs</span>' <span class="id">vs</span> <span class="id">vs</span>' (<span class="id">e</span> : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="Velus.Common.CommonList.html#Ino">Ino</a></span> <span class="id">x</span> <span class="id">xs</span> -&gt; ~ <span class="id"><a href="Velus.Common.CommonList.html#Ino">Ino</a></span> <span class="id">x</span> <span class="id">xs</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> (<span class="id">adds_opt</span>' <span class="id">xs</span> <span class="id">vs</span> (<span class="id">adds_opt</span>' <span class="id">xs</span>' <span class="id">vs</span>' <span class="id">e</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> (<span class="id">adds_opt</span>' <span class="id">xs</span>' <span class="id">vs</span>' (<span class="id">adds_opt</span>' <span class="id">xs</span> <span class="id">vs</span> <span class="id">e</span>)).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof185')">Proof.</span></div>
<div class="proofscript" id="proof185">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hino</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Common.CommonList.html#ino_dec">ino_dec</a></span> <span class="id">x</span> <span class="id">xs</span> (<span class="id"><a href="Velus.Common.Common.html#ident_eq_dec">ident_eq_dec</a></span>)) <span class="kwd">as</span> [<span class="id">Hin</span>|<span class="id">Hin</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">erewrite</span> &lt;- <span class="id">find_adds_opt</span>'<span class="id">_disj</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hino</span> <span class="kwd">in</span> <span class="id">Hin</span>. <span class="tactic">setoid_rewrite</span> <span class="id">find_In_gsso_opt</span>' <span class="tactic">at</span> 2; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">find_In_gsso_opt</span>'; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Common.CommonList.html#ino_dec">ino_dec</a></span> <span class="id">x</span> <span class="id">xs</span>' (<span class="id"><a href="Velus.Common.Common.html#ident_eq_dec">ident_eq_dec</a></span>)) <span class="kwd">as</span> [<span class="id">Hin</span>'|<span class="id">Hin</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id">find_adds_opt</span>'<span class="id">_disj</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> ?? <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">Hino</span> <span class="kwd">in</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> 3 <span class="id">find_In_gsso_opt</span>'; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">find_adds_opt</span>'<span class="id">_ino</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>} (<span class="id">x</span> : <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) <span class="id">xs</span> <span class="id">vs</span> (<span class="id">e</span> : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">xs</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#Ino">Ino</a></span> <span class="id">x</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> (<span class="id">adds_opt</span>' <span class="id">xs</span> <span class="id">vs</span> <span class="id">e</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> (<span class="id">adds_opt</span>' <span class="id">xs</span> <span class="id">vs</span> (<span class="id"><a href="Velus.Environment.html#Env.empty">Env.empty</a></span> <span class="id">A</span>)).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof186')">Proof.</span></div>
<div class="proofscript" id="proof186">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xs</span>. <span class="tactic">inversion</span> 2. <span class="tactic">intros</span> * <span class="id">Hlen</span> <span class="id">Hino</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">vs</span>. <span class="id">inv</span> <span class="id">Hlen</span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Ino_In">Ino_In</a></span> <span class="kwd">in</span> <span class="id">Hino</span>. <span class="id">inv</span> <span class="id">Hino</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">now</span> <span class="tactic">rewrite</span> 2 <span class="id">find_gsss_opt</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">a</span> <span class="kwd">as</span> [<span class="id">p</span>|]. <span class="tactic">destruct</span> (<span class="id"><a href="Velus.Common.Common.html#ident_eq_dec">ident_eq_dec</a></span> <span class="id">x</span> <span class="id">p</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="id">now</span> <span class="tactic">rewrite</span> 2 <span class="id">find_gsss_opt</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> 2 <span class="id">find_gsso_opt</span>'; <span class="tactic">try</span> (<span class="tactic">intro</span> <span class="id">HH</span>; <span class="id">inv</span> <span class="id">HH</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id">IHxs</span>; <span class="tactic">auto</span>. <span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Ino_In">Ino_In</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> 2 <span class="id">adds_opt</span>'<span class="id">_cons_None</span>. <span class="tactic">apply</span> <span class="id">IHxs</span>; <span class="tactic">auto</span>. <span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Ino_In">Ino_In</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">In_find_adds_opt</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>} (<span class="id">x</span> : <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>) (<span class="id">v</span> : <span class="id">A</span>) <span class="id">xs</span> <span class="id">vs</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupo">NoDupo</a></span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span>, <span class="id">v</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#combine">combine</a></span> <span class="id">xs</span> <span class="id">vs</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> (<span class="id">adds_opt</span>' <span class="id">xs</span> <span class="id">vs</span> <span class="id">m</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof187')">Proof.</span></div>
<div class="proofscript" id="proof187">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xs</span>. <span class="tactic">inversion</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hdupo</span> <span class="id">Hino</span>. <span class="tactic">destruct</span> <span class="id">vs</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#combine_nil_r">combine_nil_r</a></span> <span class="kwd">in</span> <span class="id">Hino</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hino</span>. <span class="id">inv</span> <span class="id">Hino</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">find_gsss_opt</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span> <span class="kwd">as</span> [<span class="id">p</span>|]; <span class="id">inv</span> <span class="id">Hdupo</span>; <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">adds_opt</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">x</span> <span class="id">p</span>). <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_combine_l">in_combine_l</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Ino_In">Ino_In</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">find_gsso_opt</span>'; <span class="tactic">auto</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">adds_opt</span>'<span class="id">_cons_None</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">adds_opt</span>'<span class="id">_adds</span>: <span class="kwd">forall</span> {<span class="id">A</span>} <span class="id">xs</span> (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>) <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">xs</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.Equal">Equal</a></span> (<span class="id">adds_opt</span>' (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">xs</span>) <span class="id">vs</span> <span class="id">m</span>) (<span class="id"><a href="Velus.Environment.html#Env.adds">adds</a></span> <span class="id">xs</span> <span class="id">vs</span> <span class="id">m</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof188')">Proof.</span></div>
<div class="proofscript" id="proof188">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xs</span>; <span class="tactic">intros</span> * <span class="id">Hndup</span> <span class="id">Hlen</span>; <span class="tactic">simpl</span>; <span class="tactic">destruct</span> <span class="id">vs</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">adds_opt</span>'<span class="id">_nil</span>, <span class="id"><a href="Velus.Environment.html#Env.adds_nil_l">adds_nil_l</a></span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hndup</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.adds_cons_cons">adds_cons_cons</a></span>, <span class="id">adds_opt</span>'<span class="id">_cons_Some</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.Equal_add_both">Equal_add_both</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">adds_opt</span>'<span class="id">_ignore</span>: <span class="kwd">forall</span> {<span class="id">A</span>} <span class="id">xs1</span> <span class="id">xs2</span> (<span class="id">vs1</span> <span class="id">vs2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>) <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">xs1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">xs2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="Velus.Common.CommonList.html#Ino">Ino</a></span> <span class="id">x</span> <span class="id">xs2</span> -&gt; <span class="id"><a href="Velus.Common.CommonList.html#Ino">Ino</a></span> <span class="id">x</span> <span class="id">xs1</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.Equal">Env.Equal</a></span> (<span class="id">adds_opt</span>' <span class="id">xs1</span> <span class="id">vs1</span> (<span class="id">adds_opt</span>' <span class="id">xs2</span> <span class="id">vs2</span> <span class="id">m</span>)) (<span class="id">adds_opt</span>' <span class="id">xs1</span> <span class="id">vs1</span> <span class="id">m</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof189')">Proof.</span></div>
<div class="proofscript" id="proof189">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hlen1</span> <span class="id">Hlen2</span> <span class="id">Hincl</span> <span class="id">x</span>. <span class="tactic">specialize</span> (<span class="id">Hincl</span> <span class="id">x</span>). <span class="id">revert</span> <span class="id">xs1</span> <span class="id">xs2</span> <span class="id">vs1</span> <span class="id">vs2</span> <span class="id">Hlen1</span> <span class="id">Hlen2</span> <span class="id">Hincl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xs1</span>; <span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">vs1</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">adds_opt</span>'<span class="id">_nil</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">find_In_gsso_opt</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">adds_opt</span>'<span class="id">_cons_Some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Common.Common.html#ident_eqb">ident_eqb</a></span> <span class="id">x</span> <span class="id">p</span>) <span class="id">eqn</span>:<span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#ident_eqb_eq">ident_eqb_eq</a></span> <span class="kwd">in</span> <span class="id">Heq</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.FSets.FMapPositive.html#PositiveMap.gss">PositiveMap.gss</a></span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#ident_eqb_neq">ident_eqb_neq</a></span> <span class="kwd">in</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.FSets.FMapPositive.html#PositiveMap.gso">PositiveMap.gso</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHxs1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hino</span>. <span class="tactic">apply</span> <span class="id">Hincl</span> <span class="kwd">in</span> <span class="id">Hino</span>. <span class="tactic">destruct</span> <span class="id">Hino</span> <span class="kwd">as</span> [<span class="id">Hino</span>|?]; <span class="tactic">auto</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">adds_opt</span>'<span class="id">_cons_None</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHxs1</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hino</span>. <span class="tactic">apply</span> <span class="id">Hincl</span> <span class="kwd">in</span> <span class="id">Hino</span>. <span class="tactic">destruct</span> <span class="id">Hino</span> <span class="kwd">as</span> [<span class="id">Hino</span>|?]; <span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">Hino</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">adds_opt</span>'<span class="id">_refines</span>:  <span class="kwd">forall</span> {<span class="id">A</span>} <span class="id">xs1</span> (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>) <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">xs1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="kwd">forall</span> <span class="id">id</span>, <span class="id">x</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">id</span> -&gt; ~<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">id</span> <span class="id">m</span>) <span class="id">xs1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id">m</span> (<span class="id">adds_opt</span>' <span class="id">xs1</span> <span class="id">vs</span> <span class="id">m</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof190')">Proof.</span></div>
<div class="proofscript" id="proof190">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xs1</span>; <span class="tactic">intros</span> * <span class="id">Hlen</span> <span class="id">Hnin</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">vs</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">adds_opt</span>'<span class="id">_nil</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hnin</span>. <span class="id">inv</span> <span class="id">Hlen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id">IHxs1</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H0</span> <span class="id">H2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">specialize</span> (<span class="id">H1</span> <span class="id">k</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">adds_opt</span>'<span class="id">_cons_Some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> ? ? <span class="id">Hfind</span>. <span class="tactic">specialize</span> (<span class="id">IHxs1</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hfind</span>) <span class="kwd">as</span> (<span class="id">v</span>'&amp;?&amp;<span class="id">Hfind</span>'); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">v</span>'. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.eq_dec">Pos.eq_dec</a></span> <span class="id">k</span> <span class="id">x</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.find_In">find_In</a></span> <span class="kwd">in</span> <span class="id">Hfind</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.FSets.FMapPositive.html#PositiveMap.gso">PositiveMap.gso</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">adds_opt</span>'<span class="id">_cons_None</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">adds_opt</span>'<span class="id">_dom</span> :  <span class="kwd">forall</span> {<span class="id">A</span>} <span class="id">ys</span> <span class="id">xs</span> (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>) <span class="id">m</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">ys</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id">m</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> (<span class="id">adds_opt</span>' <span class="id">ys</span> <span class="id">vs</span> <span class="id">m</span>) (<span class="id">xs</span> ++ <span class="id"><a href="Velus.Common.CommonList.html#map_filter">map_filter</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#id">id</a></span> <span class="id">ys</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof191')">Proof.</span></div>
<div class="proofscript" id="proof191">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">ys</span>; <span class="tactic">intros</span> * <span class="id">Hlen</span> <span class="id">Hdom</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">vs</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">adds_opt</span>'<span class="id">_nil</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hlen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id">IHys</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H0</span> <span class="id">Hdom</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">adds_opt</span>'<span class="id">_cons_Some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.dom_Permutation">dom_Permutation</a></span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_add_cons">dom_add_cons</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_middle">Permutation.Permutation_middle</a></span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">adds_opt</span>'<span class="id">_cons_None</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id">adds_opt</span>'.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="Env.union">union</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">A</span> : <span class="kwd">Type</span>}.<br/>
<br/>
<div class="doc">Union of two environments </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Env.union">union</a></span> (<span class="id">m1</span> : <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.union.A">A</a></span>) (<span class="id">m2</span> : <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.union.A">A</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">adds</span>' (<span class="id"><a href="Velus.Environment.html#Env.elements">elements</a></span> <span class="id">m2</span>) <span class="id">m1</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.union_find_None">union_find_None</a></span> : <span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.union">union</a></span> <span class="id">m1</span> <span class="id">m2</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> /\ <span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof192')">Proof.</span></div>
<div class="proofscript" id="proof192">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> *. <span class="tactic">split</span>; [<span class="tactic">intros</span> <span class="id">Hf</span>|<span class="tactic">intros</span> (<span class="id">Hf1</span>&amp;<span class="id">Hf2</span>)]; <span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.union">union</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">find_adds</span>'<span class="id">_nIn</span> <span class="kwd">in</span> <span class="id">Hf</span> <span class="kwd">as</span> [? ?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="Velus.Environment.html#Env.not_find_in_iff">Props.P.F.not_find_in_iff</a></span>. <span class="tactic">intro</span> <span class="id">contra</span>; <span class="tactic">apply</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.In_Members">In_Members</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">find_adds</span>'<span class="id">_nIn</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">contra</span>. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="Velus.Environment.html#Env.In_Members">In_Members</a></span>, <span class="id"><a href="Velus.Environment.html#Env.In_find">In_find</a></span> <span class="kwd">in</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">contra</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id"><a name="Env.union.R">R</a></span> : <span class="id"><a href="Velus.Environment.html#Env.union.A">A</a></span> -&gt; <span class="id"><a href="Velus.Environment.html#Env.union.A">A</a></span> -&gt; <span class="kwd">Prop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Hypothesis</span> <span class="id"><a name="Env.union.Hequiv">Hequiv</a></span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Equivalence">Equivalence</a></span> <span class="id"><a href="Velus.Environment.html#Env.union.R">R</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.union_find1">union_find1</a></span> : <span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.union">union</a></span> <span class="id">m1</span> <span class="id">m2</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof193')">Proof.</span></div>
<div class="proofscript" id="proof193">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hf1</span> <span class="id">Hf2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">In_find_adds</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.NoDupMembers_elements">NoDupMembers_elements</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.FSets.FMapPositive.html#PositiveMap.elements_correct">PositiveMap.elements_correct</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">union_find1</span>' : <span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">x</span> <span class="id">y1</span> <span class="id">y2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.union">union</a></span> <span class="id">m1</span> <span class="id">m2</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y2</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof194')">Proof.</span></div>
<div class="proofscript" id="proof194">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hf1</span> <span class="id">Hf2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">In_find_adds</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.NoDupMembers_elements">NoDupMembers_elements</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.FSets.FMapPositive.html#PositiveMap.elements_correct">PositiveMap.elements_correct</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.union_find2">union_find2</a></span> : <span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.union">union</a></span> <span class="id">m1</span> <span class="id">m2</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof195')">Proof.</span></div>
<div class="proofscript" id="proof195">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hf1</span> <span class="id">Hf2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.union">union</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">gsso</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="Velus.Environment.html#Env.In_Members">In_Members</a></span> <span class="kwd">in</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="Velus.Environment.html#Env.not_find_in_iff">Props.P.F.not_find_in_iff</a></span> <span class="kwd">in</span> <span class="id">Hf2</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.union_find3">union_find3</a></span> : <span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.union">union</a></span> <span class="id">m1</span> <span class="id">m2</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof196')">Proof.</span></div>
<div class="proofscript" id="proof196">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hf1</span> <span class="id">Hf2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">In_find_adds</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.NoDupMembers_elements">NoDupMembers_elements</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.FSets.FMapPositive.html#PositiveMap.elements_correct">PositiveMap.elements_correct</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id">union_find3</span>' : <span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.union">union</a></span> <span class="id">m1</span> <span class="id">m2</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof197')">Proof.</span></div>
<div class="proofscript" id="proof197">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hfind2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m1</span>) <span class="id">eqn</span>:<span class="id">Hfind1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">union_find1</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.union_find3">union_find3</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.union_find4">union_find4</a></span> : <span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.union">union</a></span> <span class="id">m1</span> <span class="id">m2</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span> \/ <span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof198')">Proof.</span></div>
<div class="proofscript" id="proof198">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">find_adds</span>'<span class="id">_In</span> <span class="kwd">in</span> <span class="id">Hf</span> <span class="kwd">as</span> [?|?]; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.FSets.FMapPositive.html#PositiveMap.elements_complete">PositiveMap.elements_complete</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">union_find4</span>' : <span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.union">union</a></span> <span class="id">m1</span> <span class="id">m2</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span> /\ <span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) \/ <span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof199')">Proof.</span></div>
<div class="proofscript" id="proof199">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m2</span>) <span class="id">eqn</span>:<span class="id">Hfind2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">erewrite</span> <span class="id">union_find3</span>' <span class="kwd">in</span> <span class="id">Hfind</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">left</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">destruct</span> (<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m1</span>) <span class="id">eqn</span>:<span class="id">Hfind1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">erewrite</span> <span class="id"><a href="Velus.Environment.html#Env.union_find2">union_find2</a></span> <span class="kwd">in</span> <span class="id">Hfind</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">symmetry</span>. <span class="tactic">rewrite</span> &lt;-<span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.union_find_None">union_find_None</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.union_refines1">union_refines1</a></span> : <span class="kwd">forall</span> <span class="id">m</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id"><a href="Velus.Environment.html#Env.union.R">R</a></span> <span class="id">m</span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id"><a href="Velus.Environment.html#Env.union.R">R</a></span> <span class="id">m</span> (<span class="id"><a href="Velus.Environment.html#Env.union">union</a></span> <span class="id">m</span> <span class="id">m</span>').<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof200')">Proof.</span></div>
<div class="proofscript" id="proof200">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Href</span> ? ? <span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id">Href</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hfind</span>) <span class="kwd">as</span> (<span class="id">v</span>'&amp;?&amp;?); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">v</span>'. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">union_find1</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.union_refines2">union_refines2</a></span> : <span class="kwd">forall</span> <span class="id">m</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id"><a href="Velus.Environment.html#Env.union.R">R</a></span> <span class="id">m</span> <span class="id">m1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id"><a href="Velus.Environment.html#Env.union.R">R</a></span> <span class="id">m</span> <span class="id">m2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id"><a href="Velus.Environment.html#Env.union.R">R</a></span> <span class="id">m</span> (<span class="id"><a href="Velus.Environment.html#Env.union">union</a></span> <span class="id">m1</span> <span class="id">m2</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof201')">Proof.</span></div>
<div class="proofscript" id="proof201">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Href1</span> <span class="id">Href2</span> ? ? <span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id">Href1</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hfind</span>) <span class="kwd">as</span> (<span class="id">v1</span>&amp;?&amp;?); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id">Href2</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hfind</span>) <span class="kwd">as</span> (<span class="id">v2</span>&amp;?&amp;?); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">v2</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">union_find1</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">union_dom</span>' : <span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">xs</span> <span class="id">ys</span> <span class="id">zs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">m1</span> (<span class="id">xs</span> ++ <span class="id">ys</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">m2</span> (<span class="id">xs</span> ++ <span class="id">zs</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> (<span class="id"><a href="Velus.Environment.html#Env.union">union</a></span> <span class="id">m1</span> <span class="id">m2</span>) (<span class="id">xs</span> ++ <span class="id">ys</span> ++ <span class="id">zs</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof202')">Proof.</span></div>
<div class="proofscript" id="proof202">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hd1</span> <span class="id">Hd2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_intro">dom_intro</a></span>. <span class="tactic">intros</span> <span class="id">x</span>; <span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.In_find">In_find</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">v</span>&amp;<span class="id">Hfind</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.union_find4">union_find4</a></span> <span class="kwd">in</span> <span class="id">Hfind</span> <span class="kwd">as</span> [<span class="id">Hf</span>|<span class="id">Hf</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.find_In">find_In</a></span>, <span class="id"><a href="Velus.Environment.html#Env.dom_use">dom_use</a></span> <span class="kwd">in</span> <span class="id">Hf</span>; [|<span class="tactic">eauto</span>]).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span> <span class="kwd">in</span> *; <span class="tactic">destruct</span> <span class="id">Hf</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.union">union</a></span>. <span class="tactic">rewrite</span> <span class="id">In_adds_spec</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="Velus.Environment.html#Env.In_Members">In_Members</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">H</span>|[<span class="id">H</span>|<span class="id">H</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">right</span>. <span class="id">erewrite</span> <span class="id"><a href="Velus.Environment.html#Env.dom_use">dom_use</a></span>; [|<span class="tactic">eauto</span>]. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">right</span>. <span class="id">erewrite</span> <span class="id"><a href="Velus.Environment.html#Env.dom_use">dom_use</a></span>; [|<span class="tactic">eauto</span>]. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">left</span>. <span class="id">erewrite</span> <span class="id"><a href="Velus.Environment.html#Env.dom_use">dom_use</a></span>; [|<span class="tactic">eauto</span>]. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="Env.dom_In_nIn">dom_In_nIn</a></span> : <span class="kwd">forall</span> (<span class="id">m</span> <span class="id">m</span>' : <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.union.A">A</a></span>) <span class="id">xs</span> <span class="id">ys</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">m</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">m</span>' (<span class="id">xs</span> ++ <span class="id">ys</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> <span class="id">m</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(~<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> <span class="id">x</span> <span class="id">xs</span> /\ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> <span class="id">x</span> <span class="id">ys</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof203')">Proof.</span></div>
<div class="proofscript" id="proof203">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hd1</span> <span class="id">Hd2</span> <span class="id">Hin</span> <span class="id">Hnin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="Velus.Environment.html#Env.dom_use">dom_use</a></span> <span class="kwd">in</span> <span class="id">Hin</span>; [|<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="Velus.Environment.html#Env.dom_use">dom_use</a></span> <span class="kwd">in</span> <span class="id">Hnin</span>; [|<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span> <span class="kwd">in</span> <span class="id">Hin</span> <span class="kwd">as</span> [?|?]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.union_refines3">union_refines3</a></span> : <span class="kwd">forall</span> <span class="id">m</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">xs</span> <span class="id">ys</span> <span class="id">zs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id">ys</span> ++ <span class="id">zs</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">m</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">m1</span> (<span class="id">xs</span> ++ <span class="id">ys</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">m2</span> (<span class="id">xs</span> ++ <span class="id">zs</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id"><a href="Velus.Environment.html#Env.union.R">R</a></span> <span class="id">m</span> <span class="id">m1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id"><a href="Velus.Environment.html#Env.union.R">R</a></span> <span class="id">m</span> <span class="id">m2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id"><a href="Velus.Environment.html#Env.union.R">R</a></span> <span class="id">m1</span> (<span class="id"><a href="Velus.Environment.html#Env.union">union</a></span> <span class="id">m1</span> <span class="id">m2</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof204')">Proof.</span></div>
<div class="proofscript" id="proof204">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hnd</span> <span class="id">Hd</span> <span class="id">Hd1</span> <span class="id">Hd2</span> <span class="id">Hr1</span> <span class="id">Hr2</span> ? ? <span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> <span class="id">m</span>) <span class="id">eqn</span>:<span class="id">Hfind</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">specialize</span> (<span class="id">Hr1</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hfind</span>') <span class="kwd">as</span> (?&amp;?&amp;<span class="id">Hfind</span>''); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hfind</span>'' <span class="kwd">in</span> <span class="id">Hfind</span>. <span class="id">inv</span> <span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id">Hr2</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hfind</span>') <span class="kwd">as</span> (<span class="id">v2</span>&amp;?&amp;?); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">v2</span>. <span class="tactic">split</span>. 2:<span class="tactic">eapply</span> <span class="id">union_find1</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">etransitivity</span>; <span class="tactic">eauto</span>. <span class="tactic">symmetry</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;x&nbsp;∈&nbsp;zs&nbsp;/\&nbsp;x&nbsp;∉&nbsp;xs&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_In_nIn">dom_In_nIn</a></span> <span class="kwd">in</span> <span class="id">Hd1</span> <span class="kwd">as</span> (<span class="id">Hnin</span>&amp;<span class="id">Hin</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.find_In">find_In</a></span> <span class="kwd">in</span> <span class="id">Hfind</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id">erewrite</span> &lt;- <span class="id"><a href="Velus.Environment.html#Env.not_find_in_iff">Props.P.F.not_find_in_iff</a></span> <span class="kwd">in</span> <span class="id">Hfind</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_In">NoDup_app_In</a></span> <span class="kwd">in</span> <span class="id">Hnd</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">v</span>. <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.union_find2">union_find2</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.find_not_In_dom">find_not_In_dom</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">contra</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span> <span class="kwd">in</span> <span class="id">contra</span> <span class="kwd">as</span> [?|?]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.union_refines4">union_refines4</a></span> : <span class="kwd">forall</span> <span class="id">m</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">xs</span> <span class="id">ys</span> <span class="id">zs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id">ys</span> ++ <span class="id">zs</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">m</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">m1</span> (<span class="id">xs</span> ++ <span class="id">ys</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">m2</span> (<span class="id">xs</span> ++ <span class="id">zs</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id"><a href="Velus.Environment.html#Env.union.R">R</a></span> <span class="id">m</span> <span class="id">m1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id"><a href="Velus.Environment.html#Env.union.R">R</a></span> <span class="id">m</span> <span class="id">m2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id"><a href="Velus.Environment.html#Env.union.R">R</a></span> <span class="id">m2</span> (<span class="id"><a href="Velus.Environment.html#Env.union">union</a></span> <span class="id">m1</span> <span class="id">m2</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof205')">Proof.</span></div>
<div class="proofscript" id="proof205">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hnd</span> <span class="id">Hd</span> <span class="id">Hd1</span> <span class="id">Hd2</span> <span class="id">Hr1</span> <span class="id">Hr2</span> ? ? <span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> <span class="id">m</span>) <span class="id">eqn</span>:<span class="id">Hfind</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">specialize</span> (<span class="id">Hr2</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hfind</span>') <span class="kwd">as</span> (?&amp;?&amp;<span class="id">Hfind</span>''); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hfind</span>'' <span class="kwd">in</span> <span class="id">Hfind</span>. <span class="id">inv</span> <span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id">Hr1</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hfind</span>') <span class="kwd">as</span> (?&amp;?&amp;?); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">v</span>. <span class="tactic">split</span>. 2:<span class="tactic">eapply</span> <span class="id">union_find1</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;x&nbsp;∈&nbsp;ys&nbsp;/\&nbsp;x&nbsp;∉&nbsp;xs&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_In_nIn">dom_In_nIn</a></span> <span class="kwd">in</span> <span class="id">Hd2</span> <span class="kwd">as</span> (<span class="id">Hnin</span>&amp;<span class="id">Hin</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.find_In">find_In</a></span> <span class="kwd">in</span> <span class="id">Hfind</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id">erewrite</span> &lt;- <span class="id"><a href="Velus.Environment.html#Env.not_find_in_iff">Props.P.F.not_find_in_iff</a></span> <span class="kwd">in</span> <span class="id">Hfind</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_app_comm">Permutation.Permutation_app_comm</a></span> <span class="kwd">in</span> <span class="id">Hnd</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_In">NoDup_app_In</a></span> <span class="kwd">in</span> <span class="id">Hnd</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">v</span>. <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.union_find3">union_find3</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.find_not_In_dom">find_not_In_dom</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">contra</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span> <span class="kwd">in</span> <span class="id">contra</span> <span class="kwd">as</span> [?|?]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">union_refines4</span>' : <span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id"><a href="Velus.Environment.html#Env.union.R">R</a></span> <span class="id">m2</span> (<span class="id"><a href="Velus.Environment.html#Env.union">union</a></span> <span class="id">m1</span> <span class="id">m2</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof206')">Proof.</span></div>
<div class="proofscript" id="proof206">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * ?? <span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">union_find3</span>' <span class="kwd">in</span> <span class="id">Hfind</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">esplit</span>; <span class="tactic">eauto</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.union_In">union_In</a></span> : <span class="kwd">forall</span> <span class="id">x</span> <span class="id">e1</span> <span class="id">e2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.union">union</a></span> <span class="id">e1</span> <span class="id">e2</span>) &lt;-&gt; <span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> <span class="id">e1</span> \/ <span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> <span class="id">e2</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof207')">Proof.</span></div>
<div class="proofscript" id="proof207">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.In_find">In_find</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">e1</span>) <span class="id">eqn</span>:<span class="id">Hf1</span>, (<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">e2</span>) <span class="id">eqn</span>:<span class="id">Hf2</span>, (<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.union">union</a></span> <span class="id">e1</span> <span class="id">e2</span>)) <span class="id">eqn</span>:<span class="id">Hf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">split</span>; [<span class="tactic">intros</span> (?&amp;<span class="id">Heq</span>); <span class="id">inv</span> <span class="id">Heq</span>|<span class="tactic">intros</span> [(?&amp;<span class="id">Heq</span>)|(?&amp;<span class="id">Heq</span>)]; <span class="id">inv</span> <span class="id">Heq</span>]); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1-5:<span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1-4:<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.union_find_None">union_find_None</a></span> <span class="kwd">in</span> <span class="id">Hf</span> <span class="kwd">as</span> (?&amp;?); <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.union">union</a></span> <span class="id">e1</span> <span class="id">e2</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>); <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.union_find_None">union_find_None</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="Env.union_dom">union_dom</a></span> : <span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">xs</span> <span class="id">ys</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">m1</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> <span class="id">m2</span> <span class="id">ys</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">dom</a></span> (<span class="id"><a href="Velus.Environment.html#Env.union">union</a></span> <span class="id">m1</span> <span class="id">m2</span>) (<span class="id">xs</span> ++ <span class="id">ys</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof208')">Proof.</span></div>
<div class="proofscript" id="proof208">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hd1</span> <span class="id">Hd2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_intro">dom_intro</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_use">Env.dom_use</a></span> <span class="kwd">in</span> <span class="id">Hd1</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_use">Env.dom_use</a></span> <span class="kwd">in</span> <span class="id">Hd2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.union_In">union_In</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span>, <span class="id">Hd1</span>, <span class="id">Hd2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.union_dom_lb">union_dom_lb</a></span> : <span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">xs</span> <span class="id">ys</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_lb">dom_lb</a></span> <span class="id">m1</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_lb">dom_lb</a></span> <span class="id">m2</span> <span class="id">ys</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_lb">dom_lb</a></span> (<span class="id"><a href="Velus.Environment.html#Env.union">union</a></span> <span class="id">m1</span> <span class="id">m2</span>) (<span class="id">xs</span> ++ <span class="id">ys</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof209')">Proof.</span></div>
<div class="proofscript" id="proof209">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hd1</span> <span class="id">Hd2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_lb_intro">dom_lb_intro</a></span>; <span class="tactic">intros</span> ? <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.union_In">union_In</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span> <span class="kwd">in</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Hin</span>|<span class="id">Hin</span>]; [<span class="tactic">left</span>|<span class="tactic">right</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_lb_use">Env.dom_lb_use</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.union_dom_lb2">union_dom_lb2</a></span> : <span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">xs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_lb">dom_lb</a></span> <span class="id">m2</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_lb">dom_lb</a></span> (<span class="id"><a href="Velus.Environment.html#Env.union">union</a></span> <span class="id">m1</span> <span class="id">m2</span>) <span class="id">xs</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof210')">Proof.</span></div>
<div class="proofscript" id="proof210">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hd1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_lb_intro">dom_lb_intro</a></span>; <span class="tactic">intros</span> ? <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.union_In">union_In</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">right</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_lb_use">Env.dom_lb_use</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.union_dom_ub">union_dom_ub</a></span> : <span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">xs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_ub">dom_ub</a></span> <span class="id">m1</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_ub">dom_ub</a></span> <span class="id">m2</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_ub">dom_ub</a></span> (<span class="id"><a href="Velus.Environment.html#Env.union">union</a></span> <span class="id">m1</span> <span class="id">m2</span>) <span class="id">xs</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof211')">Proof.</span></div>
<div class="proofscript" id="proof211">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hd1</span> <span class="id">Hd2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_ub_intro">dom_ub_intro</a></span>; <span class="tactic">intros</span> ? <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.union_In">union_In</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Hin</span>|<span class="id">Hin</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_ub_use">Env.dom_ub_use</a></span>; [|<span class="tactic">eauto</span>]; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.union_dom_ub_app">union_dom_ub_app</a></span> : <span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">xs</span> <span class="id">ys</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_ub">dom_ub</a></span> <span class="id">m1</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_ub">dom_ub</a></span> <span class="id">m2</span> <span class="id">ys</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom_ub">dom_ub</a></span> (<span class="id"><a href="Velus.Environment.html#Env.union">union</a></span> <span class="id">m1</span> <span class="id">m2</span>) (<span class="id">xs</span> ++ <span class="id">ys</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof212')">Proof.</span></div>
<div class="proofscript" id="proof212">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hd1</span> <span class="id">Hd2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_ub_intro">dom_ub_intro</a></span>; <span class="tactic">intros</span> ? <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.union_In">union_In</a></span> <span class="kwd">in</span> <span class="id">Hin</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Hin</span>|<span class="id">Hin</span>]; [<span class="tactic">left</span>|<span class="tactic">right</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_ub_use">Env.dom_ub_use</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="Env.union_mem">union_mem</a></span> : <span class="kwd">forall</span> <span class="id">x</span> <span class="id">e1</span> <span class="id">e2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.mem">mem</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.union">union</a></span> <span class="id">e1</span> <span class="id">e2</span>) = <span class="id"><a href="Velus.Environment.html#Env.mem">mem</a></span> <span class="id">x</span> <span class="id">e1</span> || <span class="id"><a href="Velus.Environment.html#Env.mem">mem</a></span> <span class="id">x</span> <span class="id">e2</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof213')">Proof.</span></div>
<div class="proofscript" id="proof213">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Environment.html#Env.mem">mem</a></span> <span class="id">_</span> <span class="id">_</span>) <span class="id">eqn</span>:<span class="id">Hmem</span>; <span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#orb_true_iff">Bool.orb_true_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> &lt;-<span class="id"><a href="Velus.Environment.html#Env.mem_in_iff">Props.P.F.mem_in_iff</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.union_In">union_In</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#orb_false_iff">Bool.orb_false_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> &lt;-<span class="id"><a href="Velus.Environment.html#Env.not_mem_in_iff">Props.P.F.not_mem_in_iff</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Decidable.html#not_or">Decidable.not_or</a></span>. <span class="tactic">rewrite</span> &lt;-<span class="id"><a href="Velus.Environment.html#Env.union_In">union_In</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.elements_union">elements_union</a></span> : <span class="kwd">forall</span> <span class="id">e1</span> <span class="id">e2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="Velus.Environment.html#Env.In">Env.In</a></span> <span class="id">x</span> <span class="id">e1</span> -&gt; ~<span class="id"><a href="Velus.Environment.html#Env.In">Env.In</a></span> <span class="id">x</span> <span class="id">e2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation">Permutation.Permutation</a></span> (<span class="id"><a href="Velus.Environment.html#Env.elements">elements</a></span> (<span class="id"><a href="Velus.Environment.html#Env.union">union</a></span> <span class="id">e1</span> <span class="id">e2</span>)) (<span class="id"><a href="Velus.Environment.html#Env.elements">elements</a></span> <span class="id">e1</span> ++ <span class="id"><a href="Velus.Environment.html#Env.elements">elements</a></span> <span class="id">e2</span>).<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof214')">Proof.</span></div>
<div class="proofscript" id="proof214">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hnd</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.elements_adds">elements_adds</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers_app">NoDupMembers_app</a></span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Environment.html#Env.NoDupMembers_elements">NoDupMembers_elements</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hin</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.In_Members">In_Members</a></span>, <span class="id">Hnd</span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">Hin</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.In_Members">In_Members</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Env.unions">unions</a></span> (<span class="id">envs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> <span class="id"><a href="Velus.Environment.html#Env.union.A">A</a></span>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_left">List.fold_left</a></span> <span class="id"><a href="Velus.Environment.html#Env.union">union</a></span> <span class="id">envs</span> (<span class="id"><a href="Velus.Environment.html#Env.empty">Env.empty</a></span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="Velus.Environment.html#Env.union">union</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Add</span> <span class="id">Parametric</span> <span class="id">Morphism</span> {<span class="id">A</span>} (<span class="id">R</span> : <span class="id">A</span> -&gt; <span class="id">A</span> -&gt; <span class="kwd">Prop</span>) : <span class="id"><a href="Velus.Environment.html#Env.union">union</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">signature</span> <span class="id"><a href="Velus.Environment.html#Env.Equiv">Env.Equiv</a></span> <span class="id">R</span> ==&gt; <span class="id"><a href="Velus.Environment.html#Env.Equiv">Env.Equiv</a></span> <span class="id">R</span> ==&gt; <span class="id"><a href="Velus.Environment.html#Env.Equiv">Env.Equiv</a></span> <span class="id">R</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> <span class="id">union_Equiv</span>.<br/>
<div>&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof215')">Proof.</span></div>
<div class="proofscript" id="proof215">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * (<span class="id">Hk1</span>&amp;<span class="id">Hv1</span>) * (<span class="id">Hk2</span>&amp;<span class="id">Hv2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">constructor</span>; <span class="tactic">intros</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">now</span> <span class="tactic">rewrite</span> 2 <span class="id"><a href="Velus.Environment.html#Env.union_In">union_In</a></span>, <span class="id">Hk1</span>, <span class="id">Hk2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">Hfind1</span> <span class="id">Hfind2</span>; <span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.MapsTo">MapsTo</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">k</span> <span class="id">x0</span>) <span class="id">eqn</span>:<span class="id">Hfind3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">erewrite</span> <span class="id">union_find3</span>' <span class="kwd">in</span> <span class="id">Hfind1</span>; <span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">Hfind1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hv2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">k</span> <span class="id">x0</span>) <span class="kwd">as</span> <span class="id">Hin</span> <span class="tactic">by</span> (<span class="tactic">econstructor</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hk2</span> <span class="kwd">in</span> <span class="id">Hin</span> <span class="kwd">as</span> (?&amp;<span class="id">Hfind4</span>). <span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.MapsTo">MapsTo</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">union_find3</span>' <span class="kwd">in</span> <span class="id">Hfind2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">k</span> <span class="id">x</span>) <span class="id">eqn</span>:<span class="id">Hfind4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">erewrite</span> <span class="id"><a href="Velus.Environment.html#Env.union_find2">union_find2</a></span> <span class="kwd">in</span> <span class="id">Hfind1</span>; <span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">Hfind1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hv1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (~<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">k</span> <span class="id">x0</span>) <span class="kwd">as</span> <span class="id">Hnin</span> <span class="tactic">by</span> (<span class="tactic">intros</span> (?&amp;?); <span class="tactic">congruence</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hk2</span> <span class="kwd">in</span> <span class="id">Hnin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">k</span> <span class="id">y0</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) <span class="kwd">as</span> <span class="id">Hfind5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> (<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">k</span> <span class="id">y0</span>) <span class="id">eqn</span>:<span class="id">Hfind</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">Hnin</span>. <span class="tactic">econstructor</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">k</span> <span class="id">x</span>) <span class="kwd">as</span> <span class="id">Hin</span> <span class="tactic">by</span> (<span class="tactic">econstructor</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hk1</span> <span class="kwd">in</span> <span class="id">Hin</span> <span class="kwd">as</span> (?&amp;<span class="id">Hfind6</span>). <span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.MapsTo">MapsTo</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="Velus.Environment.html#Env.union_find2">union_find2</a></span> <span class="kwd">in</span> <span class="id">Hfind2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">assert</span> (<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">k</span> (<span class="id"><a href="Velus.Environment.html#Env.union">union</a></span> <span class="id">x</span> <span class="id">x0</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>); <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.union_find_None">union_find_None</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="Env.union_fuse">union_fuse</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">A</span> : <span class="kwd">Type</span>}.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id"><a name="Env.union_fuse.fuse">fuse</a></span> : <span class="id"><a href="Velus.Environment.html#Env.union_fuse.A">A</a></span> -&gt; <span class="id"><a href="Velus.Environment.html#Env.union_fuse.A">A</a></span> -&gt; <span class="id"><a href="Velus.Environment.html#Env.union_fuse.A">A</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Env.union_fuse">union_fuse</a></span> (<span class="id">m1</span> <span class="id">m2</span> : <span class="id"><a href="Velus.Environment.html#Env.t">t</a></span> <span class="id"><a href="Velus.Environment.html#Env.union_fuse.A">A</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.fold">Env.fold</a></span> (<span class="kwd">fun</span> <span class="id">x</span> <span class="id">a1</span> <span class="id">m2</span> =&gt; <span class="id"><a href="Velus.Environment.html#Env.add">add</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Common.Common.html#or_default_with">or_default_with</a></span> <span class="id">a1</span> (<span class="id"><a href="Velus.Environment.html#Env.union_fuse.fuse">fuse</a></span> <span class="id">a1</span>) (<span class="id"><a href="Velus.Environment.html#Env.find">Env.find</a></span> <span class="id">x</span> <span class="id">m2</span>)) <span class="id">m2</span>) <span class="id">m1</span> <span class="id">m2</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.union_fuse_spec">union_fuse_spec</a></span> : <span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.union_fuse">union_fuse</a></span> <span class="id">m1</span> <span class="id">m2</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> (<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m1</span>), (<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m2</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y1</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y2</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Velus.Environment.html#Env.union_fuse.fuse">fuse</a></span> <span class="id">y1</span> <span class="id">y2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y1</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y2</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof216')">Proof.</span></div>
<div class="proofscript" id="proof216">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> *. <span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.union_fuse">union_fuse</a></span>. <span class="id">revert</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.fold_rec">Props.P.fold_rec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> ? <span class="id">Hemp</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m</span>) <span class="id">eqn</span>:<span class="id">Hfind1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exfalso</span>. <span class="tactic">apply</span> <span class="id">Hemp</span> <span class="kwd">in</span> <span class="id">Hfind1</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m2</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> * <span class="id">Hfind1</span> <span class="id">Hnin</span> <span class="id">Hadd</span> <span class="id">Hrec</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hadd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Common.Common.html#ident_eq_dec">ident_eq_dec</a></span> <span class="id">x</span> <span class="id">k</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> 2 <span class="id"><a href="Velus.Environment.html#Env.gss">Env.gss</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hrec</span>; <span class="tactic">clear</span> <span class="id">Hrec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">k</span> <span class="id">m</span>') <span class="id">eqn</span>:<span class="id">Hfind2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exfalso</span>. <span class="tactic">apply</span> <span class="id">Hnin</span>. <span class="tactic">econstructor</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">k</span> <span class="id">m2</span>); <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gso">Env.gso</a></span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="Env.union_fuse_In">union_fuse_In</a></span> : <span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Environment.html#Env.union_fuse">union_fuse</a></span> <span class="id">m1</span> <span class="id">m2</span>) &lt;-&gt; <span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> <span class="id">m1</span> \/ <span class="id"><a href="Velus.Environment.html#Env.In">In</a></span> <span class="id">x</span> <span class="id">m2</span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof217')">Proof.</span></div>
<div class="proofscript" id="proof217">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> *. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.in_find_iff">Props.P.F.in_find_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.union_fuse_spec">union_fuse_spec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m1</span>), (<span class="id"><a href="Velus.Environment.html#Env.find">find</a></span> <span class="id">x</span> <span class="id">m2</span>); <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1-4:(<span class="tactic">split</span>; [<span class="tactic">intros</span>| <span class="tactic">intros</span> [|]]; <span class="tactic">try</span> <span class="tactic">congruence</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="tactic">left</span>; <span class="tactic">congruence</span>. <span class="tactic">right</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="Velus.Environment.html#Env.union_fuse">union_fuse</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="Env.find_pred">find_pred</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">V</span> : <span class="kwd">Type</span>}.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id"><a name="Env.find_pred.P">P</a></span> : <span class="id"><a href="Velus.Environment.html#Env.key">key</a></span> -&gt; <span class="id"><a href="Velus.Environment.html#Env.find_pred.V">V</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>.<br/>
<br/>
<div class="doc">Find a key / value pair that respects P in the environment </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="Env.find_pred">find_pred</a></span> (<span class="id">m</span> : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> <span class="id"><a href="Velus.Environment.html#Env.find_pred.V">V</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> (<span class="id"><a href="Velus.Environment.html#Env.key">key</a></span> * <span class="id"><a href="Velus.Environment.html#Env.find_pred.V">V</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">fold</span> (<span class="kwd">fun</span> <span class="id">k</span> <span class="id">v</span> <span class="id">acc</span> =&gt; <span class="kwd">if</span> <span class="id"><a href="Velus.Environment.html#Env.find_pred.P">P</a></span> <span class="id">k</span> <span class="id">v</span> <span class="kwd">then</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">k</span>, <span class="id">v</span>) <span class="kwd">else</span> <span class="id">acc</span>) <span class="id">m</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Env.find_pred_spec">find_pred_spec</a></span> : <span class="kwd">forall</span> <span class="id">m</span> <span class="id">k</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.find_pred">find_pred</a></span> <span class="id">m</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">k</span>, <span class="id">v</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.MapsTo">MapsTo</a></span> <span class="id">k</span> <span class="id">v</span> <span class="id">m</span> /\ <span class="id"><a href="Velus.Environment.html#Env.find_pred.P">P</a></span> <span class="id">k</span> <span class="id">v</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>.<br/>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="toggleproof" onclick="toggleDisplay('proof218')">Proof.</span></div>
<div class="proofscript" id="proof218">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> *. <span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.find_pred">find_pred</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.fold_rec">Props.P.fold_rec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> * <span class="id">_</span> <span class="id">contra</span>. <span class="id">inv</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> * <span class="id">Hmaps</span> <span class="id">Hnin</span> <span class="id">Hadd</span> <span class="id">Hrec</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Environment.html#Env.MapsTo">MapsTo</a></span>, <span class="id"><a href="Velus.Environment.html#Env.Add">Props.P.Add</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">Hadd</span>; <span class="tactic">clear</span> <span class="id">Hadd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Environment.html#Env.find_pred.P">P</a></span> <span class="id">k0</span> <span class="id">e</span>) <span class="id">eqn</span>:<span class="id">Hpk</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gss">Env.gss</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">specialize</span> (<span class="id">Hrec</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>) <span class="kwd">as</span> (<span class="id">Hfind</span>&amp;<span class="id">Hp</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Environment.html#Env.gso">Env.gso</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">contra</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.find_In">find_In</a></span> <span class="kwd">in</span> <span class="id">Hfind</span>. <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="Velus.Environment.html#Env.find_pred">find_pred</a></span>.<br/>
<br/>
<div class="doc">Notations </div>
<br/>
&nbsp;&nbsp;<span class="id">Declare</span> <span class="kwd">Scope</span> <span class="id">env_scope</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Module</span> <span class="id"><a name="Env.Notations">Notations</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Notation</span> "<span class="id">e1</span> ≈ <span class="id">e2</span>" :=  (<span class="id"><a href="Velus.Environment.html#Env.Equal">Equal</a></span> <span class="id">e1</span> <span class="id">e2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">at</span> <span class="id">level</span> 70, <span class="id">no</span> <span class="id">associativity</span>) : <span class="id">env_scope</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Notation</span> "<span class="id">e1</span> ≈⟨ <span class="id">R</span> ⟩ <span class="id">e2</span>" :=  (<span class="id"><a href="Velus.Environment.html#Env.Equiv">Equiv</a></span> <span class="id">R</span> <span class="id">e1</span> <span class="id">e2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">at</span> <span class="id">level</span> 70, <span class="id">no</span> <span class="id">associativity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">format</span> "<span class="id">e1</span>  '[' ≈⟨ <span class="id">R</span> ⟩ ']'  <span class="id">e2</span>") : <span class="id">env_scope</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Notation</span> "<span class="id">e1</span> ⊑⟨ <span class="id">ee</span> ⟩ <span class="id">e2</span>" := (<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id">ee</span> <span class="id">e1</span> <span class="id">e2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">at</span> <span class="id">level</span> 70, <span class="id">no</span> <span class="id">associativity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">format</span> "<span class="id">e1</span>  '[' ⊑⟨ <span class="id">ee</span> ⟩ ']'  <span class="id">e2</span>") : <span class="id">env_scope</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Notation</span> "<span class="id">e1</span> ⊑ <span class="id">e2</span>" := (<span class="id"><a href="Velus.Environment.html#Env.refines">refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id">e1</span> <span class="id">e2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">at</span> <span class="id">level</span> 70, <span class="id">no</span> <span class="id">associativity</span>) : <span class="id">env_scope</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="Velus.Environment.html#Env.Notations">Notations</a></span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Velus.Environment.html#Env">Env</a></span>.<br/>
<br/>
<span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">env_scope</span>.<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
