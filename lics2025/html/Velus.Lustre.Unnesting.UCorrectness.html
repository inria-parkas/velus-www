
<!DOCTYPE html>
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module UCorrectness</title>
<meta name="description" content="Documentation of Coq module UCorrectness" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
</head>

<body>
<h1 class="title">Module UCorrectness</h1>
<div class="coq">
<span class="kwd">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html">List</a></span>.<br/>
<span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#ListNotations">List.ListNotations</a></span>.<br/>
<span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">list_scope</span>.<br/>
<span class="kwd">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Setoids.Setoid.html">Setoid</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Classes.Morphisms.html">Morphisms</a></span>.<br/>
<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Common.Common.html">Common</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Operators.html">Operators</a></span> <span class="id"><a href="Velus.FunctionalEnvironment.html">FunctionalEnvironment</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Clocks.html">Clocks</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.CoindStreams.html">CoindStreams</a></span> <span class="id"><a href="Velus.IndexedStreams.html">IndexedStreams</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.CoindIndexed.html">CoindIndexed</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Fresh.html">Fresh</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Lustre.StaticEnv.html">Lustre.StaticEnv</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Lustre.LSyntax.html">Lustre.LSyntax</a></span> <span class="id"><a href="Velus.Lustre.LOrdered.html">Lustre.LOrdered</a></span> <span class="id"><a href="Velus.Lustre.LTyping.html">Lustre.LTyping</a></span> <span class="id"><a href="Velus.Lustre.LClocking.html">Lustre.LClocking</a></span> <span class="id"><a href="Velus.Lustre.LSemantics.html">Lustre.LSemantics</a></span> <span class="id"><a href="Velus.Lustre.LClockedSemantics.html">Lustre.LClockedSemantics</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Lustre.Unnesting.Unnesting.html">Lustre.Unnesting.Unnesting</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Lustre.Unnesting.UTyping.html">Lustre.Unnesting.UTyping</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UClocking.html">Lustre.Unnesting.UClocking</a></span>.<br/>
<br/>
<h1> Correctness of the Unnesting </h1>
<br/>
<span class="kwd">Module</span> <span class="kwd">Type</span> <span class="id"><a name="UCORRECTNESS">UCORRECTNESS</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Ids</span> : <span class="id"><a href="Velus.Common.Common.html#IDS">IDS</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Op</span> : <span class="id"><a href="Velus.Operators.html#OPERATORS">OPERATORS</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">OpAux</span> : <span class="id"><a href="Velus.Operators.html#OPERATORS_AUX">OPERATORS_AUX</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Op">Op</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Cks</span> : <span class="id"><a href="Velus.Clocks.html#CLOCKS">CLOCKS</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux">OpAux</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">CStr</span> : <span class="id"><a href="Velus.CoindStreams.html#COINDSTREAMS">COINDSTREAMS</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cks">Cks</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Senv</span> : <span class="id"><a href="Velus.Lustre.StaticEnv.html#STATICENV">STATICENV</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cks">Cks</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Syn</span> : <span class="id"><a href="Velus.Lustre.LSyntax.html#LSYNTAX">LSYNTAX</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv">Senv</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Ty</span> : <span class="id"><a href="Velus.Lustre.LTyping.html#LTYPING">LTYPING</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn">Syn</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Cl</span> : <span class="id"><a href="Velus.Lustre.LClocking.html#LCLOCKING">LCLOCKING</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn">Syn</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Ord</span> : <span class="id"><a href="Velus.Lustre.LOrdered.html#LORDERED">LORDERED</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn">Syn</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Sem</span> : <span class="id"><a href="Velus.Lustre.LSemantics.html#LSEMANTICS">LSEMANTICS</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn">Syn</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ord">Ord</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr">CStr</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">LCS</span> : <span class="id"><a href="Velus.Lustre.LClockedSemantics.html#LCLOCKEDSEMANTICS">LCLOCKEDSEMANTICS</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn">Syn</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl">Cl</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ord">Ord</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr">CStr</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem">Sem</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Un</span>  : <span class="id"><a href="Velus.Lustre.Unnesting.Unnesting.html#UNNESTING">UNNESTING</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn">Syn</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Import</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh">Fresh</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.Tactics">Tactics</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.Unnesting.html">Unnesting</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Module</span> <span class="kwd">Import</span> <span class="id"><a name="UCORRECTNESS.Typing">Typing</a></span> := <span class="id"><a href="Velus.Lustre.Unnesting.UTyping.html#UTypingFun">UTypingFun</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn">Syn</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ty">Ty</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un">Un</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Module</span> <span class="kwd">Import</span> <span class="id"><a name="UCORRECTNESS.Clocking">Clocking</a></span> := <span class="id"><a href="Velus.Lustre.Unnesting.UClocking.html#UClockingFun">UClockingFun</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn">Syn</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl">Cl</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un">Un</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html">List</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">CoFixpoint</span> <span class="id"><a name="UCORRECTNESS.default_stream">default_stream</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux.svalue">svalue</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux.absent">absent</a></span> <span class="id">⋅</span> <span class="id">default_stream</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Sorting.Permutation.html">Permutation</a></span>.<br/>
<br/>
<h3> Relation between state and history </h3>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="UCORRECTNESS.hist_st">hist_st</a></span> {<span class="id">pref</span>} <span class="id">vars</span> <span class="id">b</span> <span class="id">H</span> (<span class="id">st</span>: <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.fresh_st">fresh_st</a></span> <span class="id">pref</span> _) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.dom">dom</a></span> <span class="id">H</span> (<span class="id">vars</span>++<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">st</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sc_vars">LCS.sc_vars</a></span> (<span class="id">vars</span>++<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">st</span>) <span class="id">H</span> <span class="id">b</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="UCORRECTNESS.fresh_ident_refines">fresh_ident_refines</a></span> : <span class="kwd">forall</span> <span class="id">pref</span> <span class="id">prefs</span> <span class="id">vars</span> <span class="id">hint</span> <span class="id">H</span> <span class="id">a</span> <span class="id">id</span> (<span class="id">v</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux.svalue">svalue</a></span>) (<span class="id">st</span> <span class="id">st'</span> : <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.fresh_st">fresh_st</a></span> <span class="id">pref</span> _),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~<span class="id"><a href="Velus.Common.Common.html#PS.In">PS.In</a></span> <span class="id">pref</span> <span class="id">prefs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids.AtomOrGensym">AtomOrGensym</a></span> <span class="id">prefs</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">vars</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.dom">dom</a></span> <span class="id">H</span> (<span class="id">vars</span>++<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">st</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.fresh_ident">fresh_ident</a></span> <span class="id">hint</span> <span class="id">a</span> <span class="id">st</span> = (<span class="id">id</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) <span class="id">H</span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.add">FEnv.add</a></span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">id</span>) <span class="id">v</span> <span class="id">H</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof with</summary>
<div class="proofscript">
 <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hnpref</span> <span class="id">Hat</span> <span class="id">Hdom</span> <span class="id">Hfresh</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.add_refines">FEnv.add_refines</a></span>; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Common.CommonStreams.html#EqStrel_Reflexive">EqStrel_Reflexive</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intro</span> <span class="id">contra</span>. <span class="id">apply</span> <span class="id">Hdom</span>, <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.IsVar_app">IsVar_app</a></span> <span class="kwd">in</span> <span class="id">contra</span> <span class="kwd">as</span> [<span class="id">contra</span>|<span class="id">contra</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.Facts.fresh_ident_In">Facts.fresh_ident_In</a></span> <span class="kwd">in</span> <span class="id">Hfresh</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">contra</span>. <span class="id">simpl_In</span>. <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">id</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.st_ids">st_ids</a></span> <span class="id">st'</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.st_ids">st_ids</a></span>. <span class="id">solve_In</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.Facts.st_valid_AtomOrGensym_nIn">Facts.st_valid_AtomOrGensym_nIn</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">contra</span>. <span class="id">simpl_In</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.Facts.fresh_ident_nIn">Facts.fresh_ident_nIn</a></span> <span class="kwd">in</span> <span class="id">Hfresh</span>; <span class="id">eauto</span>. <span class="id">eapply</span> <span class="id">Hfresh</span>. <span class="id">solve_In</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="UCORRECTNESS.fresh_ident_dom">fresh_ident_dom</a></span> : <span class="kwd">forall</span> <span class="id">pref</span> <span class="id">hint</span> <span class="id">vars</span> <span class="id">H</span> <span class="id">a</span> <span class="id">id</span> <span class="id">v</span> (<span class="id">st</span> <span class="id">st'</span> : <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.fresh_st">fresh_st</a></span> <span class="id">pref</span> _),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.dom">dom</a></span> <span class="id">H</span> (<span class="id">vars</span>++<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">st</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.fresh_ident">fresh_ident</a></span> <span class="id">hint</span> <span class="id">a</span> <span class="id">st</span> = (<span class="id">id</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.dom">dom</a></span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.add">FEnv.add</a></span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">id</span>) <span class="id">v</span> <span class="id">H</span>) (<span class="id">vars</span>++<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">st'</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * (<span class="id">D1</span>&amp;<span class="id">D2</span>) <span class="id">Hfresh</span>. <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct_conjs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.Ker.fresh_ident_anns">Ker.fresh_ident_anns</a></span> <span class="kwd">in</span> <span class="id">Hfresh</span>. <span class="id">rewrite</span> <span class="id">Hfresh</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; <span class="id">intros</span> ?; <span class="id">rewrite</span> <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.add_In">FEnv.add_In</a></span>; [<span class="id">rewrite</span> <span class="id">D1</span>|<span class="id">rewrite</span> <span class="id">D2</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;-<span class="id"><a href="https://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_middle">Permutation_middle</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">split</span>; [<span class="id">intros</span> [<span class="id">Eq</span>|]; <span class="id">try</span> <span class="id">inv</span> <span class="id">Eq</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">senv</span> <span class="id">datatypes</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id">intros</span> <span class="id">Var</span>; <span class="id">inv</span> <span class="id">Var</span>; <span class="id">simpl</span> <span class="kwd">in</span> *]).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">take</span> (_ \/ _) <span class="id">and</span> <span class="id">destruct</span> <span class="id">it</span>; <span class="id">subst</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">senv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">take</span> (_ \/ _) <span class="id">and</span> <span class="id">destruct</span> <span class="id">it</span>; <span class="id">inv_equalities</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="id">econstructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="UCORRECTNESS.fresh_ident_hist_st">fresh_ident_hist_st</a></span> : <span class="kwd">forall</span> <span class="id">pref</span> <span class="id">prefs</span> <span class="id">vars</span> <span class="id">hint</span> <span class="id">b</span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">id</span> <span class="id">v</span> <span class="id">H</span> (<span class="id">st</span> <span class="id">st'</span>: <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.fresh_st">fresh_st</a></span> <span class="id">pref</span> _),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~<span class="id"><a href="Velus.Common.Common.html#PS.In">PS.In</a></span> <span class="id">pref</span> <span class="id">prefs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, _) =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids.AtomOrGensym">AtomOrGensym</a></span> <span class="id">prefs</span> <span class="id">x</span>) <span class="id">vars</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.sem_clock">sem_clock</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.var_history">var_history</a></span> <span class="id">H</span>) <span class="id">b</span> <span class="id">ck</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.abstract_clock">abstract_clock</a></span> <span class="id">v</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.fresh_ident">fresh_ident</a></span> <span class="id">hint</span> (<span class="id">ty</span>, <span class="id">ck</span>) <span class="id">st</span> = (<span class="id">id</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id">vars</span> <span class="id">b</span> <span class="id">H</span> <span class="id">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id">vars</span> <span class="id">b</span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.add">FEnv.add</a></span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">id</span>) <span class="id">v</span> <span class="id">H</span>) <span class="id">st'</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof with</summary>
<div class="proofscript">
 <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hnpref</span> <span class="id">Hat</span> <span class="id">Hsem</span> <span class="id">Hfresh</span> [<span class="id">Hdom</span> <span class="id">Hsc</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (~<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">id</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.st_ids">st_ids</a></span> <span class="id">st</span>)) <span class="kwd">as</span> <span class="id">Hnin</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.Facts.fresh_ident_nIn">Facts.fresh_ident_nIn</a></span> <span class="kwd">in</span> <span class="id">Hfresh</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hfresh'</span>:=<span class="id">Hfresh</span>). <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.fresh_ident_anns">fresh_ident_anns</a></span> <span class="kwd">in</span> <span class="id">Hfresh'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) <span class="id">H</span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.add">FEnv.add</a></span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">id</span>) <span class="id">v</span> <span class="id">H</span>)) <span class="kwd">as</span> <span class="id">Href</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.fresh_ident_refines">fresh_ident_refines</a></span> <span class="kwd">with</span> (<span class="id">vars</span>:=<span class="id">vars</span>) <span class="kwd">in</span> <span class="id">Hfresh</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>; <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hsc</span> <span class="kwd">as</span> (<span class="id">Hsc1</span>&amp;<span class="id">Hsc2</span>). <span class="id">split</span>; [|<span class="id">split</span>]; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.fresh_ident_dom">fresh_ident_dom</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">intros</span> * <span class="id">Hck</span> <span class="id">Hv</span>. <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hfresh'</span> <span class="kwd">in</span> <span class="id">Hck</span>. <span class="id">simpl_app</span>. <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">rewrite</span> &lt;-<span class="id"><a href="https://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_middle">Permutation_middle</a></span> <span class="kwd">in</span> <span class="id">Hck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hck</span>. <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">H1</span>. <span class="id">inv</span> <span class="id">Hv</span>. <span class="id">rewrite</span> <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.gss">FEnv.gss</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">H2</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.sem_clock_refines">sem_clock_refines</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.var_history_refines">var_history_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.sem_clock_refines">sem_clock_refines</a></span>, <span class="id">Hsc1</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.var_history_refines">var_history_refines</a></span> <span class="kwd">with</span> <span class="id">senv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hv</span>. <span class="id">econstructor</span>; <span class="id">eauto</span>. <span class="id">rewrite</span> <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.gso">FEnv.gso</a></span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intro</span> <span class="id">contra</span>; <span class="id">inv</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> _ (_ ++ _)) <span class="id">and</span> <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span> <span class="kwd">in</span> <span class="id">it</span> <span class="kwd">as</span> [<span class="id">Hin</span>|<span class="id">Hin</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id">Facts.fresh_ident_nIn'</span> <span class="kwd">with</span> (<span class="id">aft</span>:=<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">vars</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> <span class="id">Hin</span>. <span class="id">simpl_Forall</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_In</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id">Hnin</span>. <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.st_ids">st_ids</a></span>. <span class="id">solve_In</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">intros</span> * <span class="id">Hck</span> <span class="id">Hla</span> <span class="id">Hv</span>. <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hfresh'</span> <span class="kwd">in</span> <span class="id">Hck</span>, <span class="id">Hla</span>. <span class="id">simpl_app</span>. <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">rewrite</span> &lt;-<span class="id"><a href="https://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_middle">Permutation_middle</a></span> <span class="kwd">in</span> <span class="id">Hck</span>, <span class="id">Hla</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hck</span>. <span class="id">inv</span> <span class="id">Hla</span>. <span class="id">inv</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H1</span>; <span class="id">inv_equalities</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exfalso</span>. <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">Hin</span>|<span class="id">Hin</span>]; [|<span class="id">eapply</span> <span class="id">Hnin</span>; <span class="id">solve_In</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">Facts.fresh_ident_nIn'</span> <span class="kwd">with</span> (<span class="id">aft</span>:=<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">vars</span>); <span class="id">eauto</span>. 2:<span class="id">solve_In</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> <span class="id">Hin</span>. <span class="id">simpl_Forall</span>. <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.sem_clock_refines">sem_clock_refines</a></span>, <span class="id">Hsc2</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.var_history_refines">var_history_refines</a></span> <span class="kwd">with</span> <span class="id">senv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hv</span>. <span class="id">econstructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.add">FEnv.add</a></span> <span class="kwd">in</span> *. <span class="id">cases_eqn</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Eq">Eq</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#equiv_decb_equiv">equiv_decb_equiv</a></span> <span class="kwd">in</span> <span class="id">Eq</span>. <span class="id">inv</span> <span class="id">Eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.sem_clock_refines">sem_clock_refines</a></span>, <span class="id">Hsc2</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.var_history_refines">var_history_refines</a></span> <span class="kwd">with</span> <span class="id">senv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hv</span>. <span class="id">econstructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.add">FEnv.add</a></span> <span class="kwd">in</span> *. <span class="id">cases_eqn</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Eq">Eq</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#equiv_decb_equiv">equiv_decb_equiv</a></span> <span class="kwd">in</span> <span class="id">Eq</span>. <span class="id">inv</span> <span class="id">Eq</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
<h3> Correctness of the first pass </h3>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="UCORRECTNESS.unnest_node_sem">unnest_node_sem</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id"><a name="UCORRECTNESS.unnest_node_sem.G1">G1</a></span> : @<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.global">global</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.nolocal">nolocal</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids.local_prefs">local_prefs</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id"><a name="UCORRECTNESS.unnest_node_sem.G2">G2</a></span> : @<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.global">global</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.unnested">unnested</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids.norm1_prefs">norm1_prefs</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Hypothesis</span> <span class="id"><a name="UCORRECTNESS.unnest_node_sem.HwcG1">HwcG1</a></span> : <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_global">wc_global</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Hypothesis</span> <span class="id"><a name="UCORRECTNESS.unnest_node_sem.HwcG2">HwcG2</a></span> : <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_global">wc_global</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Hypothesis</span> <span class="id"><a name="UCORRECTNESS.unnest_node_sem.Hifaceeq">Hifaceeq</a></span> : <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.global_iface_incl">global_iface_incl</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Hypothesis</span> <span class="id"><a name="UCORRECTNESS.unnest_node_sem.HGref">HGref</a></span> : <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.global_sem_refines">global_sem_refines</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="id">Resolve</span> <span class="id">iface_incl_wc_exp</span> : <span class="id">norm</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="UCORRECTNESS.unnest_node_sem.unnest_block_sem">unnest_block_sem</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Variable</span> <span class="id"><a name="UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> : <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.static_env">static_env</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Hypothesis</span> <span class="id"><a name="UCORRECTNESS.unnest_node_sem.unnest_block_sem.Atoms">Atoms</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, _) =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids.AtomOrGensym">AtomOrGensym</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids.local_prefs">local_prefs</a></span> <span class="id">x</span>) <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Import</span> <span class="id"><a href="Velus.Lustre.Unnesting.Unnesting.html">Unnesting</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="UCORRECTNESS.fresh_ident_refines1">fresh_ident_refines1</a></span> : <span class="kwd">forall</span> <span class="id">hint</span> <span class="id">H</span> <span class="id">a</span> <span class="id">id</span> (<span class="id">v</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux.svalue">svalue</a></span>) (<span class="id">st</span> <span class="id">st'</span>: <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.fresh_st">fresh_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids.norm1">norm1</a></span> _),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.dom">dom</a></span> <span class="id">H</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">st</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.fresh_ident">fresh_ident</a></span> <span class="id">hint</span> <span class="id">a</span> <span class="id">st</span> = (<span class="id">id</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) <span class="id">H</span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.add">FEnv.add</a></span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">id</span>) <span class="id">v</span> <span class="id">H</span>).<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.fresh_ident_refines">fresh_ident_refines</a></span> <span class="kwd">with</span> (<span class="id">vars</span>:=<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span>); <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.norm1_not_in_local_prefs">norm1_not_in_local_prefs</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="UCORRECTNESS.fresh_ident_hist_st1">fresh_ident_hist_st1</a></span> : <span class="kwd">forall</span> <span class="id">hint</span> <span class="id">b</span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">id</span> <span class="id">v</span> <span class="id">H</span> (<span class="id">st</span> <span class="id">st'</span>: <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.fresh_st">fresh_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids.norm1">norm1</a></span> _),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.sem_clock">sem_clock</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.var_history">var_history</a></span> <span class="id">H</span>) <span class="id">b</span> <span class="id">ck</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.abstract_clock">abstract_clock</a></span> <span class="id">v</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.fresh_ident">fresh_ident</a></span> <span class="id">hint</span> (<span class="id">ty</span>, <span class="id">ck</span>) <span class="id">st</span> = (<span class="id">id</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H</span> <span class="id">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.add">FEnv.add</a></span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">id</span>) <span class="id">v</span> <span class="id">H</span>) <span class="id">st'</span>.<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.fresh_ident_hist_st">fresh_ident_hist_st</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.norm1_not_in_local_prefs">norm1_not_in_local_prefs</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="UCORRECTNESS.idents_for_anns_NoDupMembers">idents_for_anns_NoDupMembers</a></span> : <span class="kwd">forall</span> <span class="id">anns</span> <span class="id">ids</span> <span class="id">st</span> <span class="id">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.idents_for_anns">idents_for_anns</a></span> <span class="id">anns</span> <span class="id">st</span> = (<span class="id">ids</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> <span class="id">ids</span>.<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hids</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.idents_for_anns_vars_perm">idents_for_anns_vars_perm</a></span> <span class="kwd">in</span> <span class="id">Hids</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.st_valid_NoDup">st_valid_NoDup</a></span> <span class="id">st'</span>) <span class="kwd">as</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#fst_NoDupMembers">fst_NoDupMembers</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id">Hids</span> <span class="kwd">in</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_l">NoDup_app_l</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="UCORRECTNESS.idents_for_anns_NoDup">idents_for_anns_NoDup</a></span> : <span class="kwd">forall</span> <span class="id">anns</span> <span class="id">ids</span> <span class="id">st</span> <span class="id">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.idents_for_anns">idents_for_anns</a></span> <span class="id">anns</span> <span class="id">st</span> = (<span class="id">ids</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, _) =&gt; <span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">x</span>) <span class="id">ids</span>).<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Ids</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.idents_for_anns_NoDupMembers">idents_for_anns_NoDupMembers</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#fst_NoDupMembers">fst_NoDupMembers</a></span> <span class="kwd">in</span> <span class="id">Ids</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext">map_ext</a></span>, &lt;-<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_map">map_map</a></span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Logic.FinFun.html#Injective_map_NoDup">FinFun.Injective_map_NoDup</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id">intros</span>; <span class="id">destruct_conjs</span>; <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> ?? <span class="id">Eq</span>. <span class="id">now</span> <span class="id">inv</span> <span class="id">Eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="UCORRECTNESS.idents_for_anns_nIn">idents_for_anns_nIn</a></span> : <span class="kwd">forall</span> <span class="id">anns</span> <span class="id">ids</span> <span class="id">st</span> <span class="id">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.idents_for_anns">idents_for_anns</a></span> <span class="id">anns</span> <span class="id">st</span> = (<span class="id">ids</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">id</span> =&gt; ~<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">id</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.st_ids">st_ids</a></span> <span class="id">st</span>)) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">ids</span>).<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hids</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.st_valid_NoDup">st_valid_NoDup</a></span> <span class="id">st'</span>) <span class="kwd">as</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.idents_for_anns_vars_perm">idents_for_anns_vars_perm</a></span> <span class="kwd">in</span> <span class="id">Hids</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.st_ids">st_ids</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id">Hids</span> <span class="kwd">in</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>. <span class="id">intros</span> <span class="id">x</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_In">NoDup_app_In</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="UCORRECTNESS.idents_for_anns_refines">idents_for_anns_refines</a></span> : <span class="kwd">forall</span> <span class="id">H</span> <span class="id">anns</span> <span class="id">ids</span> (<span class="id">vs</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux.svalue">svalue</a></span>)) <span class="id">st</span> <span class="id">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">ids</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.dom">dom</a></span> <span class="id">H</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">st</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.idents_for_anns">idents_for_anns</a></span> <span class="id">anns</span> <span class="id">st</span> = (<span class="id">ids</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H</span> <span class="id">⊑</span> (<span class="id">H</span> + <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.of_list">FEnv.of_list</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#combine">combine</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, _) =&gt; <span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">x</span>) <span class="id">ids</span>) <span class="id">vs</span>)).<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof with</summary>
<div class="proofscript">
 <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hlen</span> <span class="id">Hdom</span> <span class="id">Hids</span> ?? <span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> 2 <span class="id">esplit</span>; <span class="id">try</span> <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.union2">FEnv.union2</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">id</span> =&gt; ~<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">id</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span>)) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">ids</span>)) <span class="kwd">as</span> <span class="id">Hnvar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.idents_for_anns_incl_ids">idents_for_anns_incl_ids</a></span> <span class="kwd">in</span> <span class="id">Hids</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>. <span class="id">intros</span> <span class="id">contra</span>. <span class="id">simpl_In</span>. <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.Facts.st_valid_AtomOrGensym_nIn">Facts.st_valid_AtomOrGensym_nIn</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.norm1_not_in_local_prefs">norm1_not_in_local_prefs</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">Hids</span>. <span class="id">solve_In</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.of_list_None">FEnv.of_list_None</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#fst_InMembers">fst_InMembers</a></span>, <span class="id">combine_map_fst'</span>; <span class="id">auto</span>. 2:<span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.idents_for_anns_nIn">idents_for_anns_nIn</a></span> <span class="kwd">in</span> <span class="id">Hids</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">Hin</span>; <span class="id">simpl_In</span>; <span class="id">simpl_Forall</span>; <span class="id">simpl_In</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.In">FEnv.In</a></span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">i</span>) <span class="id">H</span>) <span class="kwd">as</span> <span class="id">contra</span> <span class="kwd">by</span> (<span class="id">econstructor</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">Hdom</span>, <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.IsVar_app">IsVar_app</a></span> <span class="kwd">in</span> <span class="id">contra</span> <span class="kwd">as</span> [<span class="id">Hv</span>|]; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hv</span>. <span class="id">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#fst_InMembers">fst_InMembers</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">H0</span>. <span class="id">eapply</span> <span class="id">Hids</span>. <span class="id">solve_In</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="UCORRECTNESS.idents_for_anns_hist_st">idents_for_anns_hist_st</a></span> : <span class="kwd">forall</span> <span class="id">b</span> <span class="id">anns</span> <span class="id">H</span> <span class="id">ids</span> <span class="id">vs</span> <span class="id">st</span> <span class="id">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">ck</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.sem_clock">sem_clock</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.var_history">var_history</a></span> <span class="id">H</span>) <span class="id">b</span> <span class="id">ck</span> <span class="id">v</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">anns</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.abstract_clock">abstract_clock</a></span> <span class="id">vs</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.idents_for_anns">idents_for_anns</a></span> <span class="id">anns</span> <span class="id">st</span> = (<span class="id">ids</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H</span> <span class="id">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> (<span class="id">H</span> + <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.of_list">FEnv.of_list</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#combine">combine</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, _) =&gt; <span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">x</span>) <span class="id">ids</span>) <span class="id">vs</span>)) <span class="id">st'</span>.<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_map_1">Forall2_map_1</a></span>. <span class="id">setoid_rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_map_2">Forall2_map_2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.idents_for_anns">idents_for_anns</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">anns</span> <span class="kwd">as</span> [|(?&amp;?)]; <span class="id">intros</span> * <span class="id">Hf</span> <span class="id">Hids</span> <span class="id">Hhist</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hf</span>; <span class="id">repeat</span> <span class="id">inv_bind</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">unfold</span> <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.of_list">FEnv.of_list</a></span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.Equiv">FEnv.Equiv</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) (<span class="id">H</span> + (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)) <span class="id">H</span>) <span class="kwd">as</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">intros</span> ?. <span class="id">unfold</span> <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.union">FEnv.union</a></span>. <span class="id">simpl</span>. <span class="id">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hhist</span> <span class="kwd">as</span> (<span class="id">Hdom</span>&amp;<span class="id">Hsc</span>). <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">split</span>; <span class="id">intros</span> ?; <span class="id">rewrite</span> <span class="id">Heq</span>; <span class="id">apply</span> <span class="id">Hdom</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sc_vars_morph">sc_vars_morph</a></span>. 1,3,4:<span class="id">eauto</span>; <span class="id">reflexivity</span>. <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.fresh_ident_hist_st1">fresh_ident_hist_st1</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> <span class="id">Hhist'</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hids</span>:=<span class="id">H1</span>). <span class="id">eapply</span> <span class="id">IHanns</span> <span class="kwd">with</span> (<span class="id">vs</span>:=<span class="id">l'</span>) <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> (<span class="id">Hdom'</span>&amp;<span class="id">Hsc'</span>). 3:<span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">simpl_Forall</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.sem_clock_refines">sem_clock_refines</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.var_history_refines">var_history_refines</a></span>, <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.fresh_ident_refines1">fresh_ident_refines1</a></span>; <span class="id">eauto</span>. <span class="id">now</span> <span class="id">destruct</span> <span class="id">Hhist</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> <span class="id">Hdom'</span> <span class="kwd">as</span> (<span class="id">D1</span>&amp;<span class="id">D2</span>). <span class="id">split</span>; <span class="id">intros</span> ?; [<span class="id">rewrite</span> &lt;-<span class="id">D1</span>|<span class="id">rewrite</span> &lt;-<span class="id">D2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="id">rewrite</span> 2 <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.union_In">FEnv.union_In</a></span>, <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.add_In">FEnv.add_In</a></span>, 2 <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.of_list_In">FEnv.of_list_In</a></span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="id">split</span>; <span class="id">intros</span>; <span class="id">repeat</span> (<span class="id">take</span> (_ \/ _) <span class="id">and</span> <span class="id">destruct</span> <span class="id">it</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sc_vars_morph">sc_vars_morph</a></span>. 4:<span class="id">eauto</span>. 1,3:<span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> ?; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.union">FEnv.union</a></span>, <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.of_list">FEnv.of_list</a></span>, <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.add">FEnv.add</a></span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">cases_eqn</span> <span class="id">Heq</span>; <span class="id">try</span> <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>:<span class="id">repeat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> _ = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> _ |- _ =&gt; <span class="id">inv</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>:<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#find">find</a></span> _ _ = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> _ |- _ =&gt; <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#find_some">find_some</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> (?<span class="id">In</span>&amp;?<span class="id">F</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>:<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#find">find</a></span> _ _ = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> |- _ =&gt; <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#find_none">find_none</a></span> <span class="kwd">in</span> <span class="id">H</span>; [|<span class="id">now</span> <span class="id">eauto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>:(_ ==<span class="id">b</span> _) = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> |- _ =&gt; <span class="id">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#equiv_decb_equiv">equiv_decb_equiv</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>: _ = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> _ |- _ =&gt; <span class="id">inv_equalities</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="id">try</span> <span class="id">reflexivity</span>; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exfalso</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_combine_l">in_combine_l</a></span> <span class="kwd">in</span> <span class="id">In</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.idents_for_anns_nIn">idents_for_anns_nIn</a></span> <span class="kwd">in</span> <span class="id">Hids</span>. <span class="id">simpl_In</span>. <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.Facts.fresh_ident_Inids">Facts.fresh_ident_Inids</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers_det">NoDupMembers_det</a></span> <span class="kwd">in</span> <span class="id">In0</span>; [<span class="id">subst</span>| |<span class="id">eauto</span>]. <span class="id">subst</span>; <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDup_NoDupMembers_combine">NoDup_NoDupMembers_combine</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.idents_for_anns_NoDup">idents_for_anns_NoDup</a></span> <span class="kwd">in</span> <span class="id">Hids</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exfalso</span>. <span class="id">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#not_equiv_decb_equiv">not_equiv_decb_equiv</a></span> <span class="kwd">in</span> <span class="id">Heq0</span>. <span class="id">eapply</span> <span class="id">Heq0</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Ltac</span> <span class="id">solve_incl</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Hiface</span> : <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.global_iface_incl">global_iface_incl</a></span> ?<span class="id">G1</span> ?<span class="id">G2</span>, <span class="id">H</span> : <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ty.wt_clock">wt_clock</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.types">types</a></span> ?<span class="id">G1</span>) _ ?<span class="id">ck</span> |- <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ty.wt_clock">wt_clock</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.types">types</a></span> ?<span class="id">G2</span>) _ ?<span class="id">ck</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ty.iface_incl_wt_clock">iface_incl_wt_clock</a></span>; <span class="id">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cks.wc_clock">wc_clock</a></span> ?<span class="id">l1</span> ?<span class="id">ck</span> |- <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cks.wc_clock">wc_clock</a></span> ?<span class="id">l2</span> ?<span class="id">ck</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cks.wc_clock_incl">wc_clock_incl</a></span>; [| <span class="id">eauto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Hiface</span> : <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.global_iface_incl">global_iface_incl</a></span> ?<span class="id">G1</span> ?<span class="id">G2</span>, <span class="id">H</span> : <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ty.wt_exp">wt_exp</a></span> ?<span class="id">G1</span> _ ?<span class="id">e</span> |- <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ty.wt_exp">wt_exp</a></span> ?<span class="id">G2</span> _ ?<span class="id">e</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ty.iface_incl_wt_exp">iface_incl_wt_exp</a></span>; <span class="id">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ty.wt_exp">wt_exp</a></span> ?<span class="id">G</span> ?<span class="id">l1</span> ?<span class="id">e</span> |- <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ty.wt_exp">wt_exp</a></span> ?<span class="id">G</span> ?<span class="id">l2</span> ?<span class="id">e</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ty.wt_exp_incl">wt_exp_incl</a></span>; [| |<span class="id">eauto</span>]; <span class="id">intros</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_exp">wc_exp</a></span> ?<span class="id">G</span> ?<span class="id">l1</span> ?<span class="id">e</span> |- <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_exp">wc_exp</a></span> ?<span class="id">G</span> ?<span class="id">l2</span> ?<span class="id">e</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_exp_incl">wc_exp_incl</a></span>; [| |<span class="id">eauto</span>]; <span class="id">intros</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ty.wt_equation">wt_equation</a></span> ?<span class="id">G</span> ?<span class="id">l1</span> ?<span class="id">eq</span> |- <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ty.wt_equation">wt_equation</a></span> ?<span class="id">G</span> ?<span class="id">l2</span> ?<span class="id">eq</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ty.wt_equation_incl">wt_equation_incl</a></span>; [| |<span class="id">eauto</span>]; <span class="id">intros</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ty.wt_block">wt_block</a></span> ?<span class="id">G</span> ?<span class="id">l1</span> ?<span class="id">eq</span> |- <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ty.wt_block">wt_block</a></span> ?<span class="id">G</span> ?<span class="id">l2</span> ?<span class="id">eq</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ty.wt_block_incl">wt_block_incl</a></span>; [| |<span class="id">eauto</span>]; <span class="id">intros</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_equation">wc_equation</a></span> ?<span class="id">G</span> ?<span class="id">l1</span> ?<span class="id">eq</span> |- <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_equation">wc_equation</a></span> ?<span class="id">G</span> ?<span class="id">l2</span> ?<span class="id">eq</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_equation_incl">wc_equation_incl</a></span>; [| |<span class="id">eauto</span>]; <span class="id">intros</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_block">wc_block</a></span> ?<span class="id">G</span> ?<span class="id">l1</span> ?<span class="id">eq</span> |- <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_block">wc_block</a></span> ?<span class="id">G</span> ?<span class="id">l2</span> ?<span class="id">eq</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_block_incl">wc_block_incl</a></span>; [| |<span class="id">eauto</span>]; <span class="id">intros</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> ?<span class="id">l1</span> ?<span class="id">l1</span> =&gt; <span class="id">reflexivity</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> ?<span class="id">f</span> ?<span class="id">l1</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> ?<span class="id">f</span> ?<span class="id">l2</span>) =&gt; <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl_map">incl_map</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> ?<span class="id">l1</span> (?<span class="id">l1</span> ++ ?<span class="id">l2</span>) =&gt; <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl_appl">incl_appl</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> (?<span class="id">l1</span> ++ ?<span class="id">l2</span>) (?<span class="id">l1</span> ++ ?<span class="id">l3</span>) =&gt; <span class="id">apply</span> <span class="id">incl_appr'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> ?<span class="id">l1</span> (?<span class="id">l2</span> ++ ?<span class="id">l3</span>) =&gt; <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl_appr">incl_appr</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> ?<span class="id">l1</span> (?<span class="id">a</span>::?<span class="id">l2</span>) =&gt; <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl_tl">incl_tl</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.st_anns">st_anns</a></span> ?<span class="id">st1</span>) (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.st_anns">st_anns</a></span> _) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.st_follows_incl">st_follows_incl</a></span>; <span class="id">repeat</span> <span class="id">solve_st_follows</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> ?<span class="id">st1</span>) (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> _) =&gt; <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#incl_map">incl_map</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.HasType">HasType</a></span> ?<span class="id">l1</span> ?<span class="id">x</span> ?<span class="id">ty</span> |- <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.HasType">HasType</a></span> ?<span class="id">l2</span> ?<span class="id">x</span> ?<span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.HasType_incl">HasType_incl</a></span>; [|<span class="id">eauto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.HasClock">HasClock</a></span> ?<span class="id">l1</span> ?<span class="id">x</span> ?<span class="id">ty</span> |- <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.HasClock">HasClock</a></span> ?<span class="id">l2</span> ?<span class="id">x</span> ?<span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.HasClock_incl">HasClock_incl</a></span>; [|<span class="id">eauto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.IsLast">IsLast</a></span> ?<span class="id">l1</span> ?<span class="id">x</span> |- <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.IsLast">IsLast</a></span> ?<span class="id">l2</span> ?<span class="id">x</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.IsLast_incl">IsLast_incl</a></span>; [|<span class="id">eauto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="id">auto</span>.<br/>
<br/>
<h2> Conservation of sem_exp </h2>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="UCORRECTNESS.unnest_reset_sem">unnest_reset_sem</a></span> : <span class="kwd">forall</span> <span class="id">b</span> <span class="id">e</span> <span class="id">H</span> <span class="id">v</span> <span class="id">e'</span> <span class="id">eqs'</span> <span class="id">st</span> <span class="id">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">e'</span> <span class="id">eqs'</span> <span class="id">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_exp">unnest_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> <span class="id">e</span> <span class="id">st</span> = ([<span class="id">e'</span>], <span class="id">eqs'</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) <span class="id">H</span> <span class="id">H'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H'</span> <span class="id">st'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span> <span class="id">e'</span> [<span class="id">v</span>] /\ <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_ck">sem_equation_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span>) <span class="id">eqs'</span>)  -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">st</span>) <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.numstreams">numstreams</a></span> <span class="id">e</span> = 1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H</span> <span class="id">b</span> <span class="id">e</span> [<span class="id">v</span>] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H</span> <span class="id">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_reset">unnest_reset</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_exp">unnest_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>) <span class="id">e</span> <span class="id">st</span> = (<span class="id">e'</span>, <span class="id">eqs'</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">exists</span> <span class="id">H'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) <span class="id">H</span> <span class="id">H'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H'</span> <span class="id">st'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span> <span class="id">e'</span> [<span class="id">v</span>] /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_ck">sem_equation_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span>) <span class="id">eqs'</span>).<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof with</summary>
<div class="proofscript">
 <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hun</span> <span class="id">Hwc</span> <span class="id">Hnum</span> <span class="id">Hsem</span> <span class="id">Histst</span> <span class="id">Hnorm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unnest_reset_spec</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l</span> = 1) <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_exp_length">unnest_exp_length</a></span> <span class="kwd">in</span> <span class="id">Hk0</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span> <span class="id">norm</span>; <span class="id">congruence</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="id">singleton_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">Hun</span> _ _ _ <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>) <span class="kwd">as</span> (<span class="id">H'</span>&amp;<span class="id">Href</span>&amp;<span class="id">Histst1</span>&amp;<span class="id">Hsem1</span>&amp;<span class="id">Hsem2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H'</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">Hun</span> _ _ _ <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>) <span class="kwd">as</span> (<span class="id">H'</span>&amp;<span class="id">Href</span>&amp;<span class="id">Histst1</span>&amp;<span class="id">Hsem1</span>&amp;<span class="id">Hsem2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Href'</span>:=<span class="id">Hfresh</span>); <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.fresh_ident_refines1">fresh_ident_refines1</a></span> <span class="kwd">in</span> <span class="id">Href'</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:(<span class="id">destruct</span> <span class="id">Histst1</span> <span class="kwd">as</span> (<span class="id">Hdom1</span>&amp;_); <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.add">FEnv.add</a></span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">x1</span>) <span class="id">v</span> <span class="id">H'</span>). <span class="id">split</span>;[|<span class="id">split</span>;[|<span class="id">split</span>]]; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">fresh</span> <span class="id">norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etransitivity</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.fresh_ident_hist_st1">fresh_ident_hist_st1</a></span> <span class="kwd">in</span> <span class="id">Hfresh</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hk</span>:=<span class="id">Hk0</span>). <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_exp_annot">unnest_exp_annot</a></span> <span class="kwd">in</span> <span class="id">Hk0</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;-<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.length_annot_numstreams">length_annot_numstreams</a></span>, &lt;-<span class="id">Hk0</span> <span class="kwd">in</span> <span class="id">Hnum</span>. <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hnum</span>; <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span> <span class="kwd">in</span> <span class="id">Hnum</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">singleton_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sc_exp">sc_exp</a></span> <span class="kwd">with</span> (<span class="id">Γ</span>:=<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">f</span>) <span class="kwd">in</span> <span class="id">Hsem1</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">env</span> <span class="id">fresh</span> <span class="id">norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.clockof_annot">clockof_annot</a></span>, <span class="id">Hsingl</span> <span class="kwd">in</span> <span class="id">Hsem1</span>. <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hsem1</span>. <span class="id">inv</span> <span class="id">Hsem1</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">destruct</span> <span class="id">Histst1</span>. <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_exp_wc">unnest_exp_wc</a></span> <span class="kwd">in</span> <span class="id">Hwc</span> <span class="kwd">as</span> (<span class="id">Hwc'</span>&amp;_). 2-3:<span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_singl">Forall_singl</a></span> <span class="kwd">in</span> <span class="id">Hwc'</span>. <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">repeat</span> <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.gss">FEnv.gss</a></span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.Seq">Seq</a></span> <span class="kwd">with</span> (<span class="id">ss</span>:=[[<span class="id">v</span>]]); <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="id">repeat</span> <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">econstructor</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.gss">FEnv.gss</a></span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_refines">sem_equation_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="UCORRECTNESS.unnest_resets_sem">unnest_resets_sem</a></span> : <span class="kwd">forall</span> <span class="id">b</span> <span class="id">es</span> <span class="id">H</span> <span class="id">vs</span> <span class="id">es'</span> <span class="id">eqs'</span> <span class="id">st</span> <span class="id">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">st</span>)) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.numstreams">numstreams</a></span> <span class="id">e</span> = 1) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H</span> <span class="id">b</span> <span class="id">e</span> <span class="id">v</span>) <span class="id">es</span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H</span> <span class="id">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="kwd">forall</span> <span class="id">H</span> <span class="id">e'</span> <span class="id">eqs'</span> <span class="id">st</span> <span class="id">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">st</span>) <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H</span> <span class="id">b</span> <span class="id">e</span> [<span class="id">v</span>] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H</span> <span class="id">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_exp">unnest_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> <span class="id">e</span> <span class="id">st</span> = ([<span class="id">e'</span>], <span class="id">eqs'</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">exists</span> <span class="id">H'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) <span class="id">H</span> <span class="id">H'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H'</span> <span class="id">st'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span> <span class="id">e'</span> [<span class="id">v</span>] /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_ck">sem_equation_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span>) <span class="id">eqs'</span>)) <span class="id">es</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">vs</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.mmap2">mmap2</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_reset">unnest_reset</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_exp">unnest_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>)) <span class="id">es</span> <span class="id">st</span> = (<span class="id">es'</span>, <span class="id">eqs'</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">exists</span> <span class="id">H'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) <span class="id">H</span> <span class="id">H'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H'</span> <span class="id">st'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span> <span class="id">e</span> <span class="id">v</span>) <span class="id">es'</span> <span class="id">vs</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_ck">sem_equation_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">eqs'</span>)).<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof with</summary>
<div class="proofscript">
 <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">es</span>; <span class="id">intros</span> * <span class="id">Hwt</span> <span class="id">Hnum</span> <span class="id">Hsem</span> <span class="id">Histst</span> <span class="id">Hf</span> <span class="id">Hmap</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hwt</span>; <span class="id">inv</span> <span class="id">Hnum</span>; <span class="id">inv</span> <span class="id">Hsem</span>; <span class="id">inv</span> <span class="id">Hf</span>; <span class="id">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="kwd">exists</span> <span class="id">H</span>; <span class="id">simpl</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">eauto</span>). <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">assert</span> (<span class="id">Hr</span>:=<span class="id">H0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H</span> <span class="id">b</span> <span class="id">a</span> <span class="id">y</span>) <span class="id">and</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck_numstreams">sem_exp_ck_numstreams</a></span> <span class="kwd">in</span> <span class="id">it</span> <span class="kwd">as</span> <span class="id">Num</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.numstreams">numstreams</a></span> <span class="id">a</span> = 1) <span class="id">and</span> <span class="id">rewrite</span> <span class="id">it</span> <span class="kwd">in</span> <span class="id">Num</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">singleton_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (_ :: _ = _ :: _) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_reset_sem">unnest_reset_sem</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> (<span class="id">H'</span>&amp;<span class="id">Href1</span>&amp;<span class="id">Histst1</span>&amp;<span class="id">Hsem1</span>&amp;<span class="id">Hsem1'</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H'</span> <span class="id">b</span> <span class="id">e</span> <span class="id">v</span>) <span class="id">es</span> <span class="id">l'</span>) <span class="kwd">as</span> <span class="id">Hsem'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_impl_In">Forall2_impl_In</a></span>; [|<span class="id">eapply</span> <span class="id">H8</span>]; <span class="id">intros</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">IHes</span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> (<span class="id">H''</span>&amp;<span class="id">Href2</span>&amp;<span class="id">Histst2</span>&amp;<span class="id">Hsem2</span>&amp;<span class="id">Hsem2'</span>)...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id">simpl_Forall</span>; <span class="id">repeat</span> <span class="id">solve_incl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> <span class="id">IHes</span> <span class="id">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H''</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etransitivity</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_app">Forall_app</a></span>. <span class="id">split</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_refines">sem_equation_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Forall3">Forall3</a></span> : <span class="id">datatypes</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="UCORRECTNESS.unnest_arrow_sem">unnest_arrow_sem</a></span> : <span class="kwd">forall</span> <span class="id">H</span> <span class="id">bs</span> <span class="id">e0s</span> <span class="id">es</span> <span class="id">anns</span> <span class="id">s0s</span> <span class="id">ss</span> <span class="id">os</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">e0s</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">anns</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">es</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">anns</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H</span> <span class="id">bs</span> <span class="id">e</span> [<span class="id">s</span>]) <span class="id">e0s</span> <span class="id">s0s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H</span> <span class="id">bs</span> <span class="id">e</span> [<span class="id">s</span>]) <span class="id">es</span> <span class="id">ss</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#Forall3">Forall3</a></span> (<span class="kwd">fun</span> <span class="id">s0</span> <span class="id">s</span> <span class="id">o</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.arrow">arrow</a></span> <span class="id">s0</span> <span class="id">s</span> <span class="id">o</span>) <span class="id">s0s</span> <span class="id">ss</span> <span class="id">os</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H</span> <span class="id">bs</span> <span class="id">e</span> [<span class="id">s</span>]) (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_arrow">unnest_arrow</a></span> <span class="id">e0s</span> <span class="id">es</span> <span class="id">anns</span>) <span class="id">os</span>.<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof with</summary>
<div class="proofscript">
 <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">datatypes</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hlen1</span> <span class="id">Hlen2</span> <span class="id">Hsem1</span> <span class="id">Hsem2</span> <span class="id">Hfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_arrow">unnest_arrow</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_swap_args">Forall2_swap_args</a></span> <span class="kwd">in</span> <span class="id">Hsem1</span>, <span class="id">Hsem2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall3_trans_ex1">Forall3_trans_ex1</a></span> <span class="kwd">in</span> <span class="id">Hfby</span>; <span class="id">eauto</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall3_trans_ex2">Forall3_trans_ex2</a></span> <span class="kwd">in</span> <span class="id">Hfby</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>. <span class="id">apply</span> <span class="id">Forall3_combine'1</span>, <span class="id">Forall3_ignore2''</span>, <span class="id">Forall3_combine'1</span>. <span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall3_impl_In">Forall3_impl_In</a></span>; [|<span class="id">eauto</span>]. <span class="id">intros</span>; <span class="id">destruct_conjs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>... <span class="id">econstructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="UCORRECTNESS.unnest_fby_sem">unnest_fby_sem</a></span> : <span class="kwd">forall</span> <span class="id">H</span> <span class="id">bs</span> <span class="id">e0s</span> <span class="id">es</span> <span class="id">anns</span> <span class="id">s0s</span> <span class="id">ss</span> <span class="id">os</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">e0s</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">anns</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">es</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">anns</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H</span> <span class="id">bs</span> <span class="id">e</span> [<span class="id">s</span>]) <span class="id">e0s</span> <span class="id">s0s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H</span> <span class="id">bs</span> <span class="id">e</span> [<span class="id">s</span>]) <span class="id">es</span> <span class="id">ss</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#Forall3">Forall3</a></span> (<span class="kwd">fun</span> <span class="id">s0</span> <span class="id">s</span> <span class="id">o</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.fby">fby</a></span> <span class="id">s0</span> <span class="id">s</span> <span class="id">o</span>) <span class="id">s0s</span> <span class="id">ss</span> <span class="id">os</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H</span> <span class="id">bs</span> <span class="id">e</span> [<span class="id">s</span>]) (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_fby">unnest_fby</a></span> <span class="id">e0s</span> <span class="id">es</span> <span class="id">anns</span>) <span class="id">os</span>.<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof with</summary>
<div class="proofscript">
 <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">datatypes</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hlen1</span> <span class="id">Hlen2</span> <span class="id">Hsem1</span> <span class="id">Hsem2</span> <span class="id">Hfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_fby">unnest_fby</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_swap_args">Forall2_swap_args</a></span> <span class="kwd">in</span> <span class="id">Hsem1</span>, <span class="id">Hsem2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall3_trans_ex1">Forall3_trans_ex1</a></span> <span class="kwd">in</span> <span class="id">Hfby</span>; <span class="id">eauto</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall3_trans_ex2">Forall3_trans_ex2</a></span> <span class="kwd">in</span> <span class="id">Hfby</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>. <span class="id">apply</span> <span class="id">Forall3_combine'1</span>, <span class="id">Forall3_ignore2''</span>, <span class="id">Forall3_combine'1</span>. <span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall3_impl_In">Forall3_impl_In</a></span>; [|<span class="id">eauto</span>]. <span class="id">intros</span>; <span class="id">destruct_conjs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>... <span class="id">econstructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="UCORRECTNESS.unnest_when_sem">unnest_when_sem</a></span> : <span class="kwd">forall</span> <span class="id">H</span> <span class="id">bs</span> <span class="id">es</span> <span class="id">tys</span> <span class="id">ckid</span> <span class="id">tx</span> <span class="id">b</span> <span class="id">ck</span> <span class="id">s</span> <span class="id">ss</span> <span class="id">os</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">es</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">tys</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H</span> <span class="id">bs</span> <span class="id">e</span> [<span class="id">s</span>]) <span class="id">es</span> <span class="id">ss</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.sem_var">sem_var</a></span> <span class="id">H</span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">ckid</span>) <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">s'</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.when">when</a></span> <span class="id">b</span> <span class="id">s'</span> <span class="id">s</span>) <span class="id">ss</span> <span class="id">os</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H</span> <span class="id">bs</span> <span class="id">e</span> [<span class="id">s</span>]) (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_when">unnest_when</a></span> (<span class="id">ckid</span>, <span class="id">tx</span>) <span class="id">b</span> <span class="id">es</span> <span class="id">tys</span> <span class="id">ck</span>) <span class="id">os</span>.<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof with</summary>
<div class="proofscript">
 <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hlen</span> <span class="id">Hsem</span> <span class="id">Hvar</span> <span class="id">Hwhen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_when">unnest_when</a></span>. <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">Forall3_combine'1</span>, <span class="id">Forall3_ignore2''</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_trans_ex">Forall2_trans_ex</a></span> <span class="kwd">in</span> <span class="id">Hwhen</span>; <span class="id">eauto</span>. <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.Swhen">Swhen</a></span> <span class="kwd">with</span> (<span class="id">ss</span>:=[[_]])...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>. <span class="id">repeat</span> <span class="id">constructor</span>. <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="UCORRECTNESS.Forall2Brs_hd_inv">Forall2Brs_hd_inv</a></span> (<span class="id">P</span> : _ -&gt; _ -&gt; <span class="kwd">Prop</span>) : <span class="kwd">forall</span> <span class="id">es</span> <span class="id">v</span> <span class="id">vs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span> <span class="id">v</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists">List.Exists</a></span> (<span class="kwd">fun</span> <span class="id">es</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">es</span>)) <span class="id">es</span> -&gt; <span class="id">P</span> <span class="id">x</span> <span class="id">v</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">v</span> = 1) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.Forall2Brs">Forall2Brs</a></span> <span class="id">P</span> <span class="id">es</span> (<span class="id">v</span> :: <span class="id">vs</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.Forall2Brs">Forall2Brs</a></span> <span class="id">P</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> '(<span class="id">i</span>, <span class="id">es</span>) =&gt; (<span class="id">i</span>, [<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.hd_default">hd_default</a></span> <span class="id">es</span>])) <span class="id">es</span>) [<span class="id">v</span>].<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">es</span>; <span class="id">intros</span> * <span class="id">Hp</span> <span class="id">Hf</span>; <span class="id">inv</span> <span class="id">Hf</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">H</span>. <span class="id">constructor</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">vs2</span>; [<span class="id">inv</span> <span class="id">H4</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">vs1</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; [<span class="id">inv</span> <span class="id">H4</span>|]. <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hp'</span>:=<span class="id">H5</span>). <span class="id">eapply</span> <span class="id">Hp</span> <span class="kwd">in</span> <span class="id">Hp'</span>; <span class="id">eauto</span>. 2:<span class="id">left</span>; <span class="id">left</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">singleton_length</span>. <span class="id">inv</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">eauto</span>; <span class="id">simpl</span>. <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">datatypes</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="UCORRECTNESS.Forall2Brs_tl_inv">Forall2Brs_tl_inv</a></span> (<span class="id">P</span> : _ -&gt; _ -&gt; <span class="kwd">Prop</span>) : <span class="kwd">forall</span> <span class="id">es</span> <span class="id">v</span> <span class="id">vs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span> <span class="id">v</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists">List.Exists</a></span> (<span class="kwd">fun</span> <span class="id">es</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">es</span>)) <span class="id">es</span> -&gt; <span class="id">P</span> <span class="id">x</span> <span class="id">v</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">v</span> = 1) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.Forall2Brs">Forall2Brs</a></span> <span class="id">P</span> <span class="id">es</span> (<span class="id">v</span> :: <span class="id">vs</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.Forall2Brs">Forall2Brs</a></span> <span class="id">P</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> '(<span class="id">i</span>, <span class="id">es</span>) =&gt; (<span class="id">i</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#tl">List.tl</a></span> <span class="id">es</span>)) <span class="id">es</span>) <span class="id">vs</span>.<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">es</span>; <span class="id">intros</span> * <span class="id">Hp</span> <span class="id">Hf</span>; <span class="id">inv</span> <span class="id">Hf</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">H</span>. <span class="id">constructor</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">vs2</span>; [<span class="id">inv</span> <span class="id">H4</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">vs1</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; [<span class="id">inv</span> <span class="id">H4</span>|]. <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id">Hp</span> <span class="kwd">in</span> <span class="id">H5</span>; <span class="id">eauto</span>. 2:<span class="id">left</span>; <span class="id">left</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">singleton_length</span>. <span class="id">inv</span> <span class="id">H4</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="UCORRECTNESS.unnest_merge_sem">unnest_merge_sem</a></span> : <span class="kwd">forall</span> <span class="id">vars</span> <span class="id">H</span> <span class="id">bs</span> <span class="id">tys</span> <span class="id">x</span> <span class="id">tx</span> <span class="id">es</span> <span class="id">ck</span> <span class="id">s</span> <span class="id">vs</span> <span class="id">os</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">es</span> &lt;&gt; [] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">es</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">vars</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">es</span>)) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">es</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.annots">annots</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">es</span>)) = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">tys</span>) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">es</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.numstreams">numstreams</a></span> <span class="id">e</span> = 1) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">es</span>)) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.sem_var">sem_var</a></span> <span class="id">H</span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">x</span>) <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.Forall2Brs">Forall2Brs</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H</span> <span class="id">bs</span>) <span class="id">es</span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.merge">merge</a></span> <span class="id">s</span>) <span class="id">vs</span> <span class="id">os</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H</span> <span class="id">bs</span> <span class="id">e</span> [<span class="id">s</span>]) (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_merge">unnest_merge</a></span> (<span class="id">x</span>, <span class="id">tx</span>) <span class="id">es</span> <span class="id">tys</span> <span class="id">ck</span>) <span class="id">os</span>.<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof with</summary>
<div class="proofscript">
 <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">tys</span>; <span class="id">intros</span> * <span class="id">Hnnil</span> <span class="id">Hwc</span> <span class="id">Hlen</span> <span class="id">Hnum</span> <span class="id">Hvar</span> <span class="id">Hsem</span> <span class="id">Hmerge</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.Forall2Brs_length1">Forall2Brs_length1</a></span> <span class="kwd">in</span> <span class="id">Hsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">simpl_Forall</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck_numstreams">sem_exp_ck_numstreams</a></span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsem</span>; <span class="id">try</span> <span class="id">congruence</span>. <span class="id">inv</span> <span class="id">Hlen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="id">destruct</span> <span class="id">vs</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hmerge</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">tys</span>)) <span class="kwd">as</span> <span class="id">Hlen'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.Forall2Brs_length1">Forall2Brs_length1</a></span> <span class="kwd">in</span> <span class="id">Hsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">simpl_Forall</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck_numstreams">sem_exp_ck_numstreams</a></span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsem</span>; <span class="id">try</span> <span class="id">congruence</span>. <span class="id">inv</span> <span class="id">Hlen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">vs</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">inv</span> <span class="id">Hlen'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="kwd">forall</span> <span class="id">x</span> <span class="id">v</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists">Exists</a></span> (<span class="kwd">fun</span> <span class="id">es0</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">es0</span>)) <span class="id">es</span> -&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H</span> <span class="id">bs</span> <span class="id">x</span> <span class="id">v</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">v</span> = 1) <span class="kwd">as</span> <span class="id">Hlv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">intros</span> ?? <span class="id">Hex</span> <span class="id">Hse</span>. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span> <span class="kwd">in</span> <span class="id">Hex</span> <span class="kwd">as</span> (?&amp;<span class="id">Hin1</span>&amp;<span class="id">Hin2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> 2 (<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hwc</span>; <span class="id">eauto</span>). <span class="id">do</span> 2 (<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hnum</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck_numstreams">sem_exp_ck_numstreams</a></span> <span class="kwd">in</span> <span class="id">Hse</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hmerge</span>; <span class="id">simpl</span>. <span class="id">constructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">econstructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.Forall2Brs_hd_inv">Forall2Brs_hd_inv</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id">IHtys</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">contradict</span> <span class="id">Hnnil</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_eq_nil">map_eq_nil</a></span> <span class="kwd">in</span> <span class="id">Hnnil</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_map">Forall_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eapply</span> <span class="id">Hwc</span>]; <span class="id">intros</span> (?&amp;?) ?; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">simpl</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_map">Forall_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_impl_In">Forall_impl_In</a></span>; [|<span class="id">eapply</span> <span class="id">Hlen</span>]; <span class="id">intros</span> (?&amp;?) <span class="id">Hin</span> <span class="id">Hl</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">l0</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hnum</span>; <span class="id">eauto</span>. <span class="id">inv</span> <span class="id">Hnum</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_app">length_app</a></span>, <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.length_annot_numstreams">length_annot_numstreams</a></span>, <span class="id">H4</span> <span class="kwd">in</span> <span class="id">Hl</span>. <span class="id">inv</span> <span class="id">Hl</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_map">Forall_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eapply</span> <span class="id">Hnum</span>]; <span class="id">intros</span> (?&amp;?) <span class="id">Hf</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hf</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.Forall2Brs_tl_inv">Forall2Brs_tl_inv</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="UCORRECTNESS.unnest_case_sem">unnest_case_sem</a></span> : <span class="kwd">forall</span> <span class="id">vars</span> <span class="id">H</span> <span class="id">bs</span> <span class="id">tys</span> <span class="id">ec</span> <span class="id">es</span> <span class="id">d</span> <span class="id">ck</span> <span class="id">s</span> <span class="id">vs</span> <span class="id">vd</span> <span class="id">os</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">es</span> &lt;&gt; [] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">es</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">vars</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">es</span>)) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">es</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.annots">annots</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">es</span>)) = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">tys</span>) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">es</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.numstreams">numstreams</a></span> <span class="id">e</span> = 1) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">es</span>)) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H</span> <span class="id">bs</span> <span class="id">ec</span> [<span class="id">s</span>] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#LiftO">LiftO</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span> (<span class="kwd">fun</span> _ =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.wt_streams">wt_streams</a></span> [<span class="id">s</span>] (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.typeof">typeof</a></span> <span class="id">ec</span>)) <span class="id">d</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.Forall2Brs">Forall2Brs</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H</span> <span class="id">bs</span>) <span class="id">es</span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#LiftO">LiftO</a></span> (<span class="id">vd</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> _ =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) <span class="id">tys</span>) (<span class="kwd">fun</span> <span class="id">d</span> =&gt; <span class="kwd">exists</span> <span class="id">vd'</span>, <span class="id">vd</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">vd'</span> /\ <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">d</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H</span> <span class="id">bs</span> <span class="id">d</span> [<span class="id">v</span>]) <span class="id">d</span> <span class="id">vd'</span>) <span class="id">d</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#Forall3">Forall3</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.case">case</a></span> <span class="id">s</span>) <span class="id">vs</span> <span class="id">vd</span> <span class="id">os</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H</span> <span class="id">bs</span> <span class="id">e</span> [<span class="id">s</span>]) (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_case">unnest_case</a></span> <span class="id">ec</span> <span class="id">es</span> <span class="id">d</span> <span class="id">tys</span> <span class="id">ck</span>) <span class="id">os</span>.<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof with</summary>
<div class="proofscript">
 <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">tys</span>; <span class="id">intros</span> * <span class="id">Hnnil</span> <span class="id">Hwc</span> <span class="id">Hlen</span> <span class="id">Hnum</span> <span class="id">Hec</span> <span class="id">Hwt</span> <span class="id">Hsem</span> <span class="id">Hsd</span> <span class="id">Hmerge</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.Forall2Brs_length1">Forall2Brs_length1</a></span> <span class="kwd">in</span> <span class="id">Hsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">simpl_Forall</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck_numstreams">sem_exp_ck_numstreams</a></span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsem</span>; <span class="id">try</span> <span class="id">congruence</span>. <span class="id">inv</span> <span class="id">Hlen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="id">destruct</span> <span class="id">vs</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hmerge</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">tys</span>)) <span class="kwd">as</span> <span class="id">Hlen'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.Forall2Brs_length1">Forall2Brs_length1</a></span> <span class="kwd">in</span> <span class="id">Hsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">simpl_Forall</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck_numstreams">sem_exp_ck_numstreams</a></span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsem</span>; <span class="id">try</span> <span class="id">congruence</span>. <span class="id">inv</span> <span class="id">Hlen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">vs</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">inv</span> <span class="id">Hlen'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="kwd">forall</span> <span class="id">x</span> <span class="id">v</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists">Exists</a></span> (<span class="kwd">fun</span> <span class="id">es0</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">es0</span>)) <span class="id">es</span> -&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H</span> <span class="id">bs</span> <span class="id">x</span> <span class="id">v</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">v</span> = 1) <span class="kwd">as</span> <span class="id">Hlv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">intros</span> ?? <span class="id">Hex</span> <span class="id">Hse</span>. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span> <span class="kwd">in</span> <span class="id">Hex</span> <span class="kwd">as</span> (?&amp;<span class="id">Hin1</span>&amp;<span class="id">Hin2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck_numstreams">sem_exp_ck_numstreams</a></span> <span class="kwd">in</span> <span class="id">Hse</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hmerge</span>; <span class="id">simpl</span>. <span class="id">constructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> <span class="id">d</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">destruct</span> <span class="id">Hsd</span> <span class="kwd">as</span> (?&amp;<span class="id">Hsome</span>&amp;<span class="id">Hf</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">x</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">inv</span> <span class="id">Hsome</span>. <span class="id">inv</span> <span class="id">Hf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">eauto</span>; <span class="id">simpl</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">datatypes</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.Forall2Brs_hd_inv">Forall2Brs_hd_inv</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">inv</span> <span class="id">Hsd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">eauto</span>; <span class="id">simpl</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">datatypes</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.Forall2Brs_hd_inv">Forall2Brs_hd_inv</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id">IHtys</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">contradict</span> <span class="id">Hnnil</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_eq_nil">map_eq_nil</a></span> <span class="kwd">in</span> <span class="id">Hnnil</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_map">Forall_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eapply</span> <span class="id">Hwc</span>]; <span class="id">intros</span> (?&amp;?) ?; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="id">simpl</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_map">Forall_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_impl_In">Forall_impl_In</a></span>; [|<span class="id">eapply</span> <span class="id">Hlen</span>]; <span class="id">intros</span> (?&amp;?) <span class="id">Hin</span> <span class="id">Hl</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">l0</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hnum</span>; <span class="id">eauto</span>. <span class="id">inv</span> <span class="id">Hnum</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_app">length_app</a></span>, <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.length_annot_numstreams">length_annot_numstreams</a></span>, <span class="id">H4</span> <span class="kwd">in</span> <span class="id">Hl</span>. <span class="id">inv</span> <span class="id">Hl</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_map">Forall_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eapply</span> <span class="id">Hnum</span>]; <span class="id">intros</span> (?&amp;?) <span class="id">Hf</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hf</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">destruct</span> <span class="id">d</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.Forall2Brs_tl_inv">Forall2Brs_tl_inv</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">destruct</span> <span class="id">d</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">destruct</span> <span class="id">Hsd</span> <span class="kwd">as</span> (?&amp;<span class="id">Hsome</span>&amp;<span class="id">Hf</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">x</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">inv</span> <span class="id">Hsome</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">esplit</span>; <span class="id">eauto</span>. <span class="id">inv</span> <span class="id">Hf</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">inv</span> <span class="id">Hsd</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="UCORRECTNESS.sem_new_vars">sem_new_vars</a></span> : <span class="kwd">forall</span> <span class="id">H</span> <span class="id">xs</span> <span class="id">vs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">xs</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.sem_var">sem_var</a></span> (<span class="id">H</span> + <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.of_list">FEnv.of_list</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#combine">combine</a></span> <span class="id">xs</span> <span class="id">vs</span>))) <span class="id">xs</span> <span class="id">vs</span>.<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hlen</span> <span class="id">Hndup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_forall2">Forall2_forall2</a></span>; <span class="id">split</span>; <span class="id">auto</span>; <span class="id">intros</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">sem_var_union3'</span>, <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.sem_var_of_list">sem_var_of_list</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDup_NoDupMembers_combine">NoDup_NoDupMembers_combine</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;-<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#combine_nth">combine_nth</a></span>; <span class="id">auto</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_In">nth_In</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_combine">length_combine</a></span>, &lt;-<span class="id">Hlen</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.min_id">Nat.min_id</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="UCORRECTNESS.mmap2_sem">mmap2_sem</a></span> : <span class="kwd">forall</span> <span class="id">b</span> <span class="id">is_control</span> <span class="id">es</span> <span class="id">H</span> <span class="id">vs</span> <span class="id">es'</span> <span class="id">eqs'</span> <span class="id">st</span> <span class="id">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">st</span>)) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H</span> <span class="id">b</span>) <span class="id">es</span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H</span> <span class="id">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="kwd">forall</span> <span class="id">H</span> <span class="id">vs</span> <span class="id">is_control</span> <span class="id">es'</span> <span class="id">eqs'</span> <span class="id">st</span> <span class="id">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">st</span>) <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H</span> <span class="id">b</span> <span class="id">e</span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H</span> <span class="id">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_exp">unnest_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">is_control</span> <span class="id">e</span> <span class="id">st</span> = (<span class="id">es'</span>, <span class="id">eqs'</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H'</span> : <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.t">FEnv.t</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux.svalue">svalue</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) <span class="id">H</span> <span class="id">H'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H'</span> <span class="id">st'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> (<span class="id">e0</span> : <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.exp">exp</a></span>) (<span class="id">v</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux.svalue">svalue</a></span>) =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span> <span class="id">e0</span> [<span class="id">v</span>]) <span class="id">es'</span> <span class="id">vs</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_ck">sem_equation_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span>) <span class="id">eqs'</span>) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.mmap2">mmap2</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_exp">unnest_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">is_control</span>) <span class="id">es</span> <span class="id">st</span> = (<span class="id">es'</span>, <span class="id">eqs'</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">exists</span> <span class="id">H'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) <span class="id">H</span> <span class="id">H'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H'</span> <span class="id">st'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">es</span> <span class="id">vs</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span> <span class="id">e</span> [<span class="id">v</span>]) <span class="id">es</span> <span class="id">vs</span>) <span class="id">es'</span> <span class="id">vs</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_ck">sem_equation_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">eqs'</span>)).<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof with</summary>
<div class="proofscript">
 <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">es</span>; <span class="id">intros</span> * <span class="id">Hwc</span> <span class="id">Hsem</span> <span class="id">Histst</span> <span class="id">Hf</span> <span class="id">Hmap</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hwc</span>; <span class="id">inv</span> <span class="id">Hsem</span>; <span class="id">inv</span> <span class="id">Hf</span>; <span class="id">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="kwd">exists</span> <span class="id">H</span>; <span class="id">simpl</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">env</span>). <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">assert</span> (<span class="id">Hun1</span>:=<span class="id">H0</span>). <span class="id">eapply</span> <span class="id">H5</span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> (<span class="id">H'</span>&amp;<span class="id">Href1</span>&amp;<span class="id">Histst1</span>&amp;<span class="id">Hsem1</span>&amp;<span class="id">Hsem1'</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H'</span> <span class="id">b</span>) <span class="id">es</span> <span class="id">l'</span>) <span class="kwd">as</span> <span class="id">Hsem'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_impl_In">Forall2_impl_In</a></span>; [|<span class="id">eauto</span>]; <span class="id">intros</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">IHes</span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> (<span class="id">H''</span>&amp;<span class="id">Href2</span>&amp;<span class="id">Histst2</span>&amp;<span class="id">Hsem2</span>&amp;<span class="id">Hsem2'</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:(<span class="id">simpl_Forall</span>; <span class="id">repeat</span> <span class="id">solve_incl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> <span class="id">IHes</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H''</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etransitivity</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="id">eauto</span>. <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x</span> = <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.numstreams">numstreams</a></span> <span class="id">a</span>) <span class="kwd">as</span> <span class="id">Hlength1</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_exp_length">unnest_exp_length</a></span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">y</span> = <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.numstreams">numstreams</a></span> <span class="id">a</span>) <span class="kwd">as</span> <span class="id">Hlength2</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck_numstreams">sem_exp_ck_numstreams</a></span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_app">Forall_app</a></span>. <span class="id">split</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_refines">sem_equation_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Forall2Brs">Forall2Brs</a></span> : <span class="id">norm</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="UCORRECTNESS.mmap2_mmap2_sem">mmap2_mmap2_sem</a></span> : <span class="kwd">forall</span> <span class="id">b</span> <span class="id">is_control</span> <span class="id">es</span> <span class="id">H</span> <span class="id">vs</span> <span class="id">es'</span> <span class="id">eqs'</span> <span class="id">st</span> <span class="id">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">es</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">st</span>)) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">es</span>)) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.Forall2Brs">Forall2Brs</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H</span> <span class="id">b</span>) <span class="id">es</span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H</span> <span class="id">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">es</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="kwd">forall</span> <span class="id">H</span> <span class="id">vs</span> <span class="id">is_control</span> <span class="id">es'</span> <span class="id">eqs'</span> <span class="id">st</span> <span class="id">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">st</span>) <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H</span> <span class="id">b</span> <span class="id">e</span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H</span> <span class="id">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_exp">unnest_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">is_control</span> <span class="id">e</span> <span class="id">st</span> = (<span class="id">es'</span>, <span class="id">eqs'</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H'</span> : <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.t">FEnv.t</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux.svalue">svalue</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) <span class="id">H</span> <span class="id">H'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H'</span> <span class="id">st'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e0</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span> <span class="id">e0</span> [<span class="id">v</span>]) <span class="id">es'</span> <span class="id">vs</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_ck">sem_equation_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span>) <span class="id">eqs'</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">es</span>)) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.mmap2">mmap2</a></span> (<span class="kwd">fun</span> '(<span class="id">i</span>, <span class="id">es</span>) =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.bind2">bind2</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.mmap2">mmap2</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_exp">unnest_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">is_control</span>) <span class="id">es</span>) (<span class="kwd">fun</span> <span class="id">es'</span> <span class="id">eqs'</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.ret">ret</a></span> ((<span class="id">i</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">es'</span>), <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">eqs'</span>))) <span class="id">es</span> <span class="id">st</span> = (<span class="id">es'</span>, <span class="id">eqs'</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">exists</span> <span class="id">H'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) <span class="id">H</span> <span class="id">H'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H'</span> <span class="id">st'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.Forall2Brs">Forall2Brs</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span>) <span class="id">es'</span> <span class="id">vs</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_ck">sem_equation_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">eqs'</span>)).<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof with</summary>
<div class="proofscript">
 <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">es</span>; <span class="id">intros</span> * <span class="id">Hwc</span> <span class="id">Hsem</span> <span class="id">Histst</span> <span class="id">Hf</span> <span class="id">Hmap</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hwc</span>; <span class="id">inv</span> <span class="id">Hsem</span>; <span class="id">inv</span> <span class="id">Hf</span>; <span class="id">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="kwd">exists</span> <span class="id">H</span>; <span class="id">simpl</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">env</span> <span class="id">norm</span>). <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_sem">mmap2_sem</a></span> <span class="kwd">in</span> <span class="id">H6</span> <span class="kwd">as</span> (<span class="id">H'</span>&amp;<span class="id">Href1</span>&amp;<span class="id">Histst1</span>&amp;<span class="id">Hsem1</span>&amp;<span class="id">Hsem1'</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.Forall2Brs">Forall2Brs</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H'</span> <span class="id">b</span>) <span class="id">es</span> <span class="id">vs2</span>) <span class="kwd">as</span> <span class="id">Hsem'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.Forall2Brs_impl_In">Forall2Brs_impl_In</a></span>; [|<span class="id">eauto</span>]; <span class="id">intros</span> ?? _ ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">IHes</span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> (<span class="id">H''</span>&amp;<span class="id">Href2</span>&amp;<span class="id">Histst2</span>&amp;<span class="id">Hsem2</span>&amp;<span class="id">Hsem2'</span>)... <span class="id">clear</span> <span class="id">IHes</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:(<span class="id">simpl_Forall</span>; <span class="id">repeat</span> <span class="id">solve_incl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H''</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etransitivity</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">econstructor</span>. <span class="id">instantiate</span> (1:=<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; [<span class="id">x</span>])) <span class="id">vs1</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span>. <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">rewrite</span> &lt;-<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat_map">concat_map</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#concat_map_singl1">concat_map_singl1</a></span>; <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_app">Forall_app</a></span>. <span class="id">split</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_refines">sem_equation_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="UCORRECTNESS.unnest_noops_exp_sem">unnest_noops_exp_sem</a></span> : <span class="kwd">forall</span> <span class="id">b</span> <span class="id">cki</span> <span class="id">e</span> <span class="id">H</span> <span class="id">v</span> <span class="id">e'</span> <span class="id">eqs'</span> <span class="id">st</span> <span class="id">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H</span> <span class="id">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.normalized_lexp">normalized_lexp</a></span> <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">st</span>) <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H</span> <span class="id">b</span> <span class="id">e</span> [<span class="id">v</span>] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_noops_exp">unnest_noops_exp</a></span> <span class="id">cki</span> <span class="id">e</span> <span class="id">st</span> = (<span class="id">e'</span>, <span class="id">eqs'</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">exists</span> <span class="id">H'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) <span class="id">H</span> <span class="id">H'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H'</span> <span class="id">st'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span> <span class="id">e'</span> [<span class="id">v</span>] /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_ck">sem_equation_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span>) <span class="id">eqs'</span>).<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_noops_exp">unnest_noops_exp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hdom</span> <span class="id">Hnormed</span> <span class="id">Hwc</span> <span class="id">Hsem</span> <span class="id">Hunt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.numstreams">numstreams</a></span> <span class="id">e</span> = 1) <span class="kwd">as</span> <span class="id">Hnum</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.normalized_lexp_numstreams">normalized_lexp_numstreams</a></span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;-<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.length_annot_numstreams">length_annot_numstreams</a></span> <span class="kwd">in</span> <span class="id">Hnum</span>. <span class="id">singleton_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">p</span> <span class="kwd">as</span> (?&amp;?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.is_noops_exp">is_noops_exp</a></span> _ _); <span class="id">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="kwd">exists</span> <span class="id">H</span>; <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">auto</span>). <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">assert</span> (<span class="id">Hfresh</span>:=<span class="id">H0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> (<span class="id">A</span>:=<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux.svalue">svalue</a></span>)) <span class="id">H</span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.add">FEnv.add</a></span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">x</span>) <span class="id">v</span> <span class="id">H</span>)) <span class="kwd">as</span> <span class="id">Href</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.fresh_ident_refines1">fresh_ident_refines1</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hdom</span> <span class="kwd">as</span> (<span class="id">Hdom</span>&amp;_); <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.add">FEnv.add</a></span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">x</span>) <span class="id">v</span> <span class="id">H</span>). <span class="id">split</span>;[|<span class="id">split</span>;[|<span class="id">split</span>]]; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.fresh_ident_hist_st1">fresh_ident_hist_st1</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sc_exp">sc_exp</a></span> <span class="kwd">in</span> <span class="id">Hsem</span>; <span class="id">eauto</span>. 2:<span class="id">destruct</span> <span class="id">Hdom</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.clockof_annot">clockof_annot</a></span>, <span class="id">Hsingl</span> <span class="kwd">in</span> <span class="id">Hsem</span>; <span class="id">inv</span> <span class="id">Hsem</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>. <span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.gss">FEnv.gss</a></span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.Seq">Seq</a></span> <span class="kwd">with</span> (<span class="id">ss</span>:=[[<span class="id">v</span>]]); <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">constructor</span>; <span class="id">auto</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">constructor</span>; <span class="id">auto</span>. <span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.gss">FEnv.gss</a></span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="UCORRECTNESS.unnest_noops_exps_sem">unnest_noops_exps_sem</a></span> : <span class="kwd">forall</span> <span class="id">b</span> <span class="id">cks</span> <span class="id">es</span> <span class="id">H</span> <span class="id">vs</span> <span class="id">es'</span> <span class="id">eqs'</span> <span class="id">st</span> <span class="id">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">es</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">cks</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H</span> <span class="id">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.normalized_lexp">normalized_lexp</a></span> <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">st</span>)) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H</span> <span class="id">b</span> <span class="id">e</span> [<span class="id">v</span>]) <span class="id">es</span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_noops_exps">unnest_noops_exps</a></span> <span class="id">cks</span> <span class="id">es</span> <span class="id">st</span> = (<span class="id">es'</span>, <span class="id">eqs'</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">exists</span> <span class="id">H'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) <span class="id">H</span> <span class="id">H'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H'</span> <span class="id">st'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span> <span class="id">e</span> [<span class="id">v</span>]) <span class="id">es'</span> <span class="id">vs</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_ck">sem_equation_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span>) <span class="id">eqs'</span>).<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_noops_exps">unnest_noops_exps</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">cks</span>; <span class="id">intros</span> * <span class="id">Hlen</span> <span class="id">Hdom</span> <span class="id">Hnormed</span> <span class="id">Hwc</span> <span class="id">Hsem</span> <span class="id">Hunt</span>; <span class="id">repeat</span> <span class="id">inv_bind</span>; <span class="id">simpl</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="id">destruct</span> <span class="id">es</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">inv</span> <span class="id">Hlen</span>; <span class="id">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hsem</span>. <span class="kwd">exists</span> <span class="id">H</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">auto</span>). <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hsem</span>. <span class="id">inv</span> <span class="id">Hnormed</span>. <span class="id">inv</span> <span class="id">Hwc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hnoops</span>:=<span class="id">H0</span>). <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_noops_exp_sem">unnest_noops_exp_sem</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> (<span class="id">H'</span>&amp;?&amp;?&amp;?&amp;?); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span> <span class="id">e</span> [<span class="id">v</span>]) <span class="id">es</span> <span class="id">l'</span>) <span class="kwd">as</span> <span class="id">Hsem'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_impl_In">Forall2_impl_In</a></span>; [|<span class="id">eauto</span>]; <span class="id">intros</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>; <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">IHcks</span> <span class="kwd">with</span> (<span class="id">st</span>:=<span class="id">x2</span>) <span class="kwd">in</span> <span class="id">Hsem'</span> <span class="kwd">as</span> (<span class="id">H''</span>&amp;?&amp;?&amp;?&amp;?); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id">simpl_Forall</span>; <span class="id">repeat</span> <span class="id">solve_incl</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_noops_exp_st_follows">unnest_noops_exp_st_follows</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id">inv_bind</span>; <span class="id">repeat</span> <span class="id">eexists</span>; <span class="id">eauto</span>; <span class="id">inv_bind</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H''</span>. <span class="id">split</span>;[|<span class="id">split</span>;[|<span class="id">split</span>]]; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etransitivity</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_app">Forall_app</a></span>; <span class="id">split</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_refines">sem_equation_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="id">Resolve</span> <span class="id">sem_ref_sem_exp</span> : <span class="id">lcsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#sem_exp_ck">sem_exp_ck</a></span> : <span class="id">lcsem</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="UCORRECTNESS.unnest_exp_sem">unnest_exp_sem</a></span> : <span class="kwd">forall</span> <span class="id">b</span> <span class="id">e</span> <span class="id">H</span> <span class="id">vs</span> <span class="id">is_control</span> <span class="id">es'</span> <span class="id">eqs'</span> <span class="id">st</span> <span class="id">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">st</span>) <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H</span> <span class="id">b</span> <span class="id">e</span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H</span> <span class="id">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_exp">unnest_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">is_control</span> <span class="id">e</span> <span class="id">st</span> = (<span class="id">es'</span>, <span class="id">eqs'</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">exists</span> <span class="id">H'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H</span> <span class="id">⊑</span> <span class="id">H'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H'</span> <span class="id">st'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span> <span class="id">e</span> [<span class="id">v</span>]) <span class="id">es'</span> <span class="id">vs</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_ck">sem_equation_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span>) <span class="id">eqs'</span>).<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof with</summary>
<div class="proofscript">
 <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">norm</span> <span class="id">lclocking</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">e</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.exp_ind2">exp_ind2</a></span>; <span class="id">intros</span> * <span class="id">Hwc</span> <span class="id">Hsem</span> <span class="id">Histst</span> <span class="id">Hnorm</span>; <span class="id">repeat</span> <span class="id">inv_bind</span>. 12,13:<span class="id">inv</span> <span class="id">Hwc</span>; <span class="id">inv</span> <span class="id">Hsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;const&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsem</span>. <span class="kwd">exists</span> <span class="id">H</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">auto</span> <span class="kwd">with</span> <span class="id">lcsem</span>). <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;enum&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsem</span>. <span class="kwd">exists</span> <span class="id">H</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">auto</span> <span class="kwd">with</span> <span class="id">lcsem</span>). <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;var&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsem</span>. <span class="kwd">exists</span> <span class="id">H</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">auto</span> <span class="kwd">with</span> <span class="id">lcsem</span>). <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;last&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsem</span>. <span class="kwd">exists</span> <span class="id">H</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">auto</span> <span class="kwd">with</span> <span class="id">lcsem</span>). <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;unop&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsem</span>. <span class="id">inv</span> <span class="id">Hwc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Htypeof</span>:=<span class="id">H0</span>). <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_exp_typeof">unnest_exp_typeof</a></span> <span class="kwd">in</span> <span class="id">Htypeof</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hnorm</span>:=<span class="id">H0</span>). <span class="id">eapply</span> <span class="id">IHe</span> <span class="kwd">in</span> <span class="id">Hnorm</span> <span class="kwd">as</span> [<span class="id">H'</span> [<span class="id">Href1</span> [<span class="id">Hhistst1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1'</span>]]]]...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_exp_length">unnest_exp_length</a></span> <span class="kwd">in</span> <span class="id">H0</span>... <span class="id">rewrite</span> &lt;-<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.length_clockof_numstreams">length_clockof_numstreams</a></span>, <span class="id">H5</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">singleton_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsem1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H'</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">econstructor</span>... <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;binop&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsem</span>; <span class="id">inv</span> <span class="id">Hwc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Htypeof1</span>:=<span class="id">H0</span>). <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_exp_typeof">unnest_exp_typeof</a></span> <span class="kwd">in</span> <span class="id">Htypeof1</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Htypeof2</span>:=<span class="id">H1</span>). <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_exp_typeof">unnest_exp_typeof</a></span> <span class="kwd">in</span> <span class="id">Htypeof2</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hun1</span>:=<span class="id">H0</span>). <span class="id">eapply</span> <span class="id">IHe1</span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">H'</span> [<span class="id">Href1</span> [<span class="id">Histst1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1'</span>]]]]... <span class="id">clear</span> <span class="id">IHe1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span> <span class="kwd">in</span> <span class="id">H10</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">IHe2</span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">H''</span> [<span class="id">Href2</span> [<span class="id">Histst2</span> [<span class="id">Hsem2</span> <span class="id">Hsem2'</span>]]]]... <span class="id">clear</span> <span class="id">IHe2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id">repeat</span> <span class="id">solve_incl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsem1</span>; <span class="id">inv</span> <span class="id">H4</span>. <span class="id">inv</span> <span class="id">Hsem2</span>; <span class="id">inv</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H''</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etransitivity</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">repeat</span> <span class="id">econstructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_app">Forall_app</a></span>. <span class="id">split</span>; <span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_refines">sem_equation_refines</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;extcall&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct_conjs</span>; <span class="id">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sc_exp">sc_exp</a></span> <span class="kwd">in</span> <span class="id">Hsem</span> <span class="kwd">as</span> <span class="id">Hsck</span>... 2:<span class="id">destruct</span> <span class="id">Histst</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hwc</span>; <span class="id">inv</span> <span class="id">Hsem</span>. <span class="id">simpl_Forall</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hnorm1</span>:=<span class="id">H1</span>). <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_sem">mmap2_sem</a></span> <span class="kwd">in</span> <span class="id">H1</span>... <span class="id">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">H'</span> [<span class="id">Href1</span> [<span class="id">Histst1</span> [<span class="id">Hsem1'</span> <span class="id">Hsem1''</span>]]]]. <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span> <span class="kwd">in</span> <span class="id">Hsem1'</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hnorm2</span>:=<span class="id">H2</span>). <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.fresh_ident_refines1">fresh_ident_refines1</a></span> <span class="kwd">in</span> <span class="id">H2</span>... 2:<span class="id">destruct</span> <span class="id">Histst1</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.fresh_ident_hist_st1">fresh_ident_hist_st1</a></span> <span class="kwd">with</span> (<span class="id">H</span>:=<span class="id">H'</span>) <span class="kwd">in</span> <span class="id">Hnorm2</span> <span class="kwd">as</span> <span class="id">Histst2</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.sem_clock_refines">sem_clock_refines</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.var_history_refines">var_history_refines</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.sem_var">sem_var</a></span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.add">FEnv.add</a></span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">x2</span>) <span class="id">vs0</span> <span class="id">H'</span>) (<span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">x2</span>) <span class="id">vs0</span>) <span class="kwd">as</span> <span class="id">Hv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">repeat</span> <span class="id">constructor</span>. <span class="id">econstructor</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.gss">FEnv.gss</a></span>; <span class="id">eauto</span>. <span class="id">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.add">FEnv.add</a></span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">x2</span>) <span class="id">vs0</span> <span class="id">H'</span>). <span class="id">split</span>;[|<span class="id">split</span>;[|<span class="id">split</span>]]; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etransitivity</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">repeat</span> <span class="id">constructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">repeat</span> <span class="id">constructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_refines">sem_equation_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">econstructor</span>; <span class="id">eauto</span>. 1,2:<span class="id">simpl</span>; <span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id">instantiate</span> (1:=<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; [<span class="id">x</span>]) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">ss</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>:<span class="id">try</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#concat_map_singl1">concat_map_singl1</a></span>; <span class="id">eauto</span>; <span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_unnest_exp_typesof">mmap2_unnest_exp_typesof</a></span> <span class="kwd">in</span> <span class="id">Hnorm1</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">congruence</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;fby&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion_clear</span> <span class="id">Hwc</span> <span class="kwd">as</span> [| | | | | | |??? <span class="id">Hwc1</span> <span class="id">Hwc2</span> <span class="id">Hl1</span> <span class="id">Hl2</span> | | | | |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion_clear</span> <span class="id">Hsem</span> <span class="kwd">as</span> [| | | | | | |???????? <span class="id">Hsem1</span> <span class="id">Hsem2</span> <span class="id">Fby</span>| | | | | |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x2</span>) = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.annots">annots</a></span> <span class="id">e0s</span>)) <span class="kwd">as</span> <span class="id">Hlength1</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mmap2_unnest_exp_length">mmap2_unnest_exp_length</a></span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x6</span>) = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.annots">annots</a></span> <span class="id">es</span>)) <span class="kwd">as</span> <span class="id">Hlength2</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mmap2_unnest_exp_length">mmap2_unnest_exp_length</a></span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.numstreams">numstreams</a></span> <span class="id">e</span> = 1) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x2</span>)) <span class="kwd">as</span> <span class="id">Hnumstreams</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mmap2_unnest_exp_numstreams">mmap2_unnest_exp_numstreams</a></span> <span class="kwd">in</span> <span class="id">H2</span>... }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">s0ss</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">e0s</span>) <span class="kwd">as</span> <span class="id">Hlen1</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">Hsem1</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">H2'</span>:=<span class="id">H2</span>). <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_sem">mmap2_sem</a></span> <span class="kwd">in</span> <span class="id">H2</span>... <span class="id">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [<span class="id">H'</span> [<span class="id">Href1</span> [<span class="id">Histst1</span> [<span class="id">Hsem1'</span> <span class="id">Hsem1''</span>]]]]. <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span> <span class="kwd">in</span> <span class="id">Hsem1'</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H'</span> <span class="id">b</span>) <span class="id">es</span> <span class="id">sss</span>) <span class="kwd">as</span> <span class="id">Hsem'</span> <span class="kwd">by</span> (<span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">sss</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">es</span>) <span class="kwd">as</span> <span class="id">Hlen2</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">Hsem2</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">H3'</span>:=<span class="id">H3</span>). <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_sem">mmap2_sem</a></span> <span class="kwd">in</span> <span class="id">H3</span>... <span class="id">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id">simpl_Forall</span>; <span class="id">repeat</span> <span class="id">solve_incl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> [<span class="id">H''</span> [<span class="id">Href2</span> [<span class="id">Histst2</span> [<span class="id">Hsem2'</span> <span class="id">Hsem2''</span>]]]]. <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span> <span class="kwd">in</span> <span class="id">Hsem2'</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H''</span> <span class="id">b</span> <span class="id">e</span> [<span class="id">v</span>]) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x2</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">s0ss</span>)) <span class="kwd">as</span> <span class="id">Hsem''</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_impl_In">Forall2_impl_In</a></span>; [|<span class="id">eauto</span>]; <span class="id">intros</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.idents_for_anns_length">idents_for_anns_length</a></span> _ _ _ _ <span class="id">H4</span>) <span class="kwd">as</span> <span class="id">Hlength</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">a</span>) <span class="kwd">as</span> <span class="id">Hlength'''</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall3_length">Forall3_length</a></span> <span class="kwd">in</span> <span class="id">Fby</span> <span class="kwd">as</span> [_ ?]. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">Hsem2'</span>. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">Hl2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_length</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">H''</span> + <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.of_list">FEnv.of_list</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#combine">combine</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, _) =&gt; <span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">x</span>) <span class="id">x5</span>) <span class="id">vs</span>)) <span class="kwd">as</span> <span class="id">H''''</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x5</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hlength''''</span> <span class="kwd">by</span> (<span class="id">rewrite</span> <span class="id">Hlength</span>, <span class="id">Hlength'''</span>; <span class="id">auto</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.sem_var">sem_var</a></span> <span class="id">H''''</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, _) =&gt; <span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">x</span>) <span class="id">x5</span>) <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hsemvars</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">rewrite</span> <span class="id">HeqH''''</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.sem_new_vars">sem_new_vars</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.idents_for_anns_NoDup">idents_for_anns_NoDup</a></span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="id">eauto</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) <span class="id">H''</span> <span class="id">H''''</span>) <span class="kwd">as</span> <span class="id">Href4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">subst</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.idents_for_anns_refines">idents_for_anns_refines</a></span> <span class="kwd">in</span> <span class="id">H4</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Histst2</span> <span class="kwd">as</span> (<span class="id">Hdom2</span>&amp;_)... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> <span class="id">Hlength'''</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H''''</span> <span class="id">b</span> <span class="id">e</span> [<span class="id">v</span>]) (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_fby">unnest_fby</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x2</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x6</span>) <span class="id">a</span>) <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hsemf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_fby_sem">unnest_fby_sem</a></span>; <span class="id">simpl</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mmap2_unnest_exp_length">mmap2_unnest_exp_length</a></span> <span class="kwd">in</span> <span class="id">H2'</span>... <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">Hl1</span>. <span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mmap2_unnest_exp_length">mmap2_unnest_exp_length</a></span> <span class="kwd">in</span> <span class="id">H3'</span>... <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">Hl2</span>. <span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">clear</span> - <span class="id">Hsem1'</span> <span class="id">Href2</span> <span class="id">Href4</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_impl_In">Forall2_impl_In</a></span>... <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">clear</span> - <span class="id">Hsem2'</span> <span class="id">Href2</span> <span class="id">Href4</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_impl_In">Forall2_impl_In</a></span>... <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>; <span class="id">eauto</span>). }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H''''</span>. <span class="id">split</span>;[|<span class="id">split</span>;[|<span class="id">split</span>]];<span class="id">eauto</span> <span class="kwd">with</span> <span class="id">norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">repeat</span> (<span class="id">etransitivity</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">subst</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.idents_for_anns_hist_st">idents_for_anns_hist_st</a></span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sc_exps2">sc_exps2</a></span> <span class="kwd">in</span> <span class="id">Hsem1'</span>; <span class="id">eauto</span>. 2:<span class="id">destruct</span> <span class="id">Histst1</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_unnest_exp_wc">mmap2_unnest_exp_wc</a></span>. 1,3:<span class="id">eauto</span>. <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_unnest_exp_clocksof">mmap2_unnest_exp_clocksof</a></span> <span class="kwd">in</span> <span class="id">Hsem1'</span>. 3:<span class="id">eauto</span>. 2:<span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_eq">Forall2_eq</a></span> <span class="kwd">in</span> <span class="id">Hl1</span>. <span class="id">rewrite</span> <span class="id">Hl1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> - <span class="id">Hsem1'</span> <span class="id">Fby</span> <span class="id">Href2</span>. <span class="id">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_map_2">Forall2_map_2</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Fby</span> <span class="id">Hsem1'</span>. <span class="id">generalize</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.clocksof">clocksof</a></span> <span class="id">e0s</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">s0ss</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">sss</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">vs</span>; <span class="id">intros</span> * <span class="id">Fby</span> <span class="id">Hsem1'</span>; <span class="id">inv</span> <span class="id">Fby</span>; <span class="id">inv</span> <span class="id">Hsem1'</span>; <span class="id">constructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.ac_fby1">ac_fby1</a></span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">rewrite</span> &lt;-<span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.sem_clock_refines">sem_clock_refines</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.var_history_refines">var_history_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">clear</span> - <span class="id">Hsemvars</span>. <span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lcsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">repeat</span> <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_app">Forall_app</a></span>. <span class="id">repeat</span> <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mk_equations_Forall">mk_equations_Forall</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2-3:(<span class="id">simpl_Forall</span>; <span class="id">repeat</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_refines">sem_equation_refines</a></span>; <span class="id">eauto</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> - <span class="id">Hsemvars</span> <span class="id">Hsemf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_fby">unnest_fby</a></span> _ _ _) <span class="kwd">as</span> <span class="id">fby</span>. <span class="id">clear</span> <span class="id">Heqfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_swap_args">Forall2_swap_args</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_trans_ex">Forall2_trans_ex</a></span> <span class="kwd">in</span> <span class="id">Hsemf</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">repeat</span> <span class="id">constructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">simpl</span>. <span class="id">repeat</span> <span class="id">constructor</span>; <span class="id">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;arrow&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion_clear</span> <span class="id">Hwc</span> <span class="kwd">as</span> [| | | | | | | |??? <span class="id">Hwc1</span> <span class="id">Hwc2</span> <span class="id">Hl1</span> <span class="id">Hl2</span>| | | |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion_clear</span> <span class="id">Hsem</span> <span class="kwd">as</span> [| | | | | | | |???????? <span class="id">Hsem1</span> <span class="id">Hsem2</span> <span class="id">Arrow</span>| | | | |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x2</span>) = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.annots">annots</a></span> <span class="id">e0s</span>)) <span class="kwd">as</span> <span class="id">Hlength1</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mmap2_unnest_exp_length">mmap2_unnest_exp_length</a></span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x6</span>) = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.annots">annots</a></span> <span class="id">es</span>)) <span class="kwd">as</span> <span class="id">Hlength2</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mmap2_unnest_exp_length">mmap2_unnest_exp_length</a></span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.numstreams">numstreams</a></span> <span class="id">e</span> = 1) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x2</span>)) <span class="kwd">as</span> <span class="id">Hnumstreams</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mmap2_unnest_exp_numstreams">mmap2_unnest_exp_numstreams</a></span> <span class="kwd">in</span> <span class="id">H2</span>... }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">s0ss</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">e0s</span>) <span class="kwd">as</span> <span class="id">Hlen1</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">Hsem1</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">H2'</span>:=<span class="id">H2</span>). <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_sem">mmap2_sem</a></span> <span class="kwd">in</span> <span class="id">H2</span>... <span class="id">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [<span class="id">H'</span> [<span class="id">Href1</span> [<span class="id">Histst1</span> [<span class="id">Hsem1'</span> <span class="id">Hsem1''</span>]]]]. <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span> <span class="kwd">in</span> <span class="id">Hsem1'</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H'</span> <span class="id">b</span>) <span class="id">es</span> <span class="id">sss</span>) <span class="kwd">as</span> <span class="id">Hsem'</span> <span class="kwd">by</span> (<span class="id">simpl_Forall</span>; <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">sss</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">es</span>) <span class="kwd">as</span> <span class="id">Hlen2</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">Hsem2</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">H3'</span>:=<span class="id">H3</span>). <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_sem">mmap2_sem</a></span> <span class="kwd">in</span> <span class="id">H3</span>... <span class="id">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id">simpl_Forall</span>; <span class="id">repeat</span> <span class="id">solve_incl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> [<span class="id">H''</span> [<span class="id">Href2</span> [<span class="id">Histst2</span> [<span class="id">Hsem2'</span> <span class="id">Hsem2''</span>]]]]. <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span> <span class="kwd">in</span> <span class="id">Hsem2'</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H''</span> <span class="id">b</span> <span class="id">e</span> [<span class="id">v</span>]) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x2</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">s0ss</span>)) <span class="kwd">as</span> <span class="id">Hsem''</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_impl_In">Forall2_impl_In</a></span>; [|<span class="id">eauto</span>]; <span class="id">intros</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.idents_for_anns_length">idents_for_anns_length</a></span> _ _ _ _ <span class="id">H4</span>) <span class="kwd">as</span> <span class="id">Hlength</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">a</span>) <span class="kwd">as</span> <span class="id">Hlength'''</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall3_length">Forall3_length</a></span> <span class="kwd">in</span> <span class="id">Arrow</span> <span class="kwd">as</span> [_ ?]. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">Hsem2'</span>. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">Hl2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_length</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">H''</span> + <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.of_list">FEnv.of_list</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#combine">combine</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, _) =&gt; <span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">x</span>) <span class="id">x5</span>) <span class="id">vs</span>)) <span class="kwd">as</span> <span class="id">H''''</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x5</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hlength''''</span> <span class="kwd">by</span> (<span class="id">rewrite</span> <span class="id">Hlength</span>, <span class="id">Hlength'''</span>; <span class="id">auto</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.sem_var">sem_var</a></span> <span class="id">H''''</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, _) =&gt; <span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">x</span>) <span class="id">x5</span>) <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hsemvars</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">rewrite</span> <span class="id">HeqH''''</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.sem_new_vars">sem_new_vars</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.idents_for_anns_NoDup">idents_for_anns_NoDup</a></span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="id">eauto</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) <span class="id">H''</span> <span class="id">H''''</span>) <span class="kwd">as</span> <span class="id">Href4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">subst</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.idents_for_anns_refines">idents_for_anns_refines</a></span> <span class="kwd">in</span> <span class="id">H4</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Histst2</span> <span class="kwd">as</span> (<span class="id">Hdom2</span>&amp;_)... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> <span class="id">Hlength'''</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H''''</span> <span class="id">b</span> <span class="id">e</span> [<span class="id">v</span>]) (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_arrow">unnest_arrow</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x2</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x6</span>) <span class="id">a</span>) <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hsemf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_arrow_sem">unnest_arrow_sem</a></span>; <span class="id">simpl</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mmap2_unnest_exp_length">mmap2_unnest_exp_length</a></span> <span class="kwd">in</span> <span class="id">H2'</span>... <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">Hl1</span>. <span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mmap2_unnest_exp_length">mmap2_unnest_exp_length</a></span> <span class="kwd">in</span> <span class="id">H3'</span>... <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">Hl2</span>. <span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">clear</span> - <span class="id">Hsem1'</span> <span class="id">Href2</span> <span class="id">Href4</span>. <span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">clear</span> - <span class="id">Hsem2'</span> <span class="id">Href2</span> <span class="id">Href4</span>. <span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H''''</span>. <span class="id">split</span>;[|<span class="id">split</span>;[|<span class="id">split</span>]];<span class="id">eauto</span> <span class="kwd">with</span> <span class="id">norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">repeat</span> (<span class="id">etransitivity</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">subst</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.idents_for_anns_hist_st">idents_for_anns_hist_st</a></span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sc_exps2">sc_exps2</a></span> <span class="kwd">in</span> <span class="id">Hsem1'</span>; <span class="id">eauto</span>. 2:<span class="id">destruct</span> <span class="id">Histst1</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_unnest_exp_wc">mmap2_unnest_exp_wc</a></span>. 1,3:<span class="id">eauto</span>. <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_unnest_exp_clocksof">mmap2_unnest_exp_clocksof</a></span> <span class="kwd">in</span> <span class="id">Hsem1'</span>. 3:<span class="id">eauto</span>. 2:<span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_eq">Forall2_eq</a></span> <span class="kwd">in</span> <span class="id">Hl1</span>. <span class="id">rewrite</span> <span class="id">Hl1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> - <span class="id">Hsem1'</span> <span class="id">Arrow</span> <span class="id">Href2</span>. <span class="id">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_map_2">Forall2_map_2</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Arrow</span> <span class="id">Hsem1'</span>. <span class="id">generalize</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.clocksof">clocksof</a></span> <span class="id">e0s</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">s0ss</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">sss</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">vs</span>; <span class="id">intros</span> * <span class="id">Arrow</span> <span class="id">Hsem1'</span>; <span class="id">inv</span> <span class="id">Arrow</span>; <span class="id">inv</span> <span class="id">Hsem1'</span>; <span class="id">constructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.ac_arrow1">ac_arrow1</a></span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">rewrite</span> &lt;-<span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.sem_clock_refines">sem_clock_refines</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.var_history_refines">var_history_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">clear</span> - <span class="id">Hsemvars</span>. <span class="id">simpl_Forall</span>; <span class="id">auto</span> <span class="kwd">with</span> <span class="id">lcsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">repeat</span> <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_app">Forall_app</a></span>. <span class="id">repeat</span> <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mk_equations_Forall">mk_equations_Forall</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2-3:(<span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_refines">sem_equation_refines</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> - <span class="id">Hsemvars</span> <span class="id">Hsemf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_arrow">unnest_arrow</a></span> _ _ _) <span class="kwd">as</span> <span class="id">arrow</span>. <span class="id">clear</span> <span class="id">Heqarrow</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_swap_args">Forall2_swap_args</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_trans_ex">Forall2_trans_ex</a></span> <span class="kwd">in</span> <span class="id">Hsemf</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">repeat</span> <span class="id">constructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">simpl</span>. <span class="id">repeat</span> <span class="id">constructor</span>; <span class="id">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;when&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hwc</span>. <span class="id">inv</span> <span class="id">Hsem</span>. <span class="id">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x1</span>) = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.annots">annots</a></span> <span class="id">es</span>)) <span class="kwd">as</span> <span class="id">Hlength</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mmap2_unnest_exp_length">mmap2_unnest_exp_length</a></span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">es</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">ss</span>) <span class="kwd">by</span> (<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H14</span>; <span class="id">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_sem">mmap2_sem</a></span> <span class="kwd">in</span> <span class="id">H1</span>... <span class="id">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">H'</span> [<span class="id">Href1</span> [<span class="id">Hhistst1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1'</span>]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span> <span class="kwd">in</span> <span class="id">Hsem1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H'</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">simpl</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_when_sem">unnest_when_sem</a></span>... <span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.sem_var_refines">sem_var_refines</a></span>...<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;merge&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hwc</span>. <span class="id">inv</span> <span class="id">Hsem</span>. <span class="id">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_mmap2_sem">mmap2_mmap2_sem</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">Hi1</span>&amp;<span class="id">Href1</span>&amp;<span class="id">Histst1</span>&amp;<span class="id">Hsem1</span>&amp;<span class="id">Hsem1'</span>)...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">Hi1</span> <span class="id">b</span> <span class="id">e</span> [<span class="id">v</span>])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_merge">unnest_merge</a></span> (<span class="id">x0</span>, <span class="id">tx</span>) <span class="id">x</span> <span class="id">tys</span> <span class="id">ck</span>) <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hsem'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_merge_sem">unnest_merge_sem</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.mmap2_length_1">mmap2_length_1</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">es</span>, <span class="id">x</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">try</span> <span class="id">congruence</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_mmap2_unnest_exp_wc">mmap2_mmap2_unnest_exp_wc</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mmap2_mmap2_unnest_exp_annots">mmap2_mmap2_unnest_exp_annots</a></span> <span class="kwd">in</span> <span class="id">H1</span>. 2:<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eapply</span> <span class="id">H6</span>]; <span class="id">intros</span> (?&amp;?); <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore1">Forall2_ignore1</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> ((?&amp;?)&amp;<span class="id">Hin2</span>&amp;?); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H8</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">H1</span>, <span class="id">H8</span>, <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.length_clocksof_annots">length_clocksof_annots</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mmap2_mmap2_unnest_exp_numstreams">mmap2_mmap2_unnest_exp_numstreams</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.sem_var_refines">sem_var_refines</a></span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">is_control</span>; <span class="id">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;control&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">Hi1</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">simpl</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;exp&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">Hi1</span> + <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.of_list">FEnv.of_list</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#combine">combine</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, _) =&gt; <span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">x</span>) <span class="id">x3</span>) <span class="id">vs</span>)) <span class="kwd">as</span> <span class="id">Hi2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x3</span>) <span class="kwd">as</span> <span class="id">Hlength'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.idents_for_anns_length">idents_for_anns_length</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">repeat</span> <span class="id">simpl_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.Forall2Brs_length1">Forall2Brs_length1</a></span> <span class="kwd">in</span> <span class="id">H15</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">simpl_Forall</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck_numstreams">sem_exp_ck_numstreams</a></span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H15</span>; <span class="id">try</span> <span class="id">congruence</span>. <span class="id">inv</span> <span class="id">H8</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H16</span>. <span class="id">solve_length</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) <span class="id">Hi1</span> <span class="id">Hi2</span>) <span class="kwd">as</span> <span class="id">Href3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">subst</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.idents_for_anns_refines">idents_for_anns_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Histst1</span> <span class="kwd">as</span> (<span class="id">Hdom1</span>&amp;_)... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.sem_var">sem_var</a></span> <span class="id">Hi2</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, _) =&gt; <span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">x</span>) <span class="id">x3</span>) <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hvars</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">rewrite</span> <span class="id">HeqHi2</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.sem_new_vars">sem_new_vars</a></span>... 1:<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.idents_for_anns_NoDup">idents_for_anns_NoDup</a></span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">Hi2</span>. <span class="id">split</span>;[|<span class="id">split</span>;[|<span class="id">split</span>]]; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">repeat</span> (<span class="id">etransitivity</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">subst</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.idents_for_anns_hist_st">idents_for_anns_hist_st</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_map">map_map</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext">map_ext</a></span>, &lt;-<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_merge_clocksof">unnest_merge_clocksof</a></span> <span class="kwd">with</span> (<span class="id">nck</span>:=<span class="id">ck</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sc_exps2">sc_exps2</a></span>; <span class="id">eauto</span>. <span class="id">destruct</span> <span class="id">Histst1</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_merge_wc_exp">unnest_merge_wc_exp</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">repeat</span> <span class="id">solve_incl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.mmap2_length_1">mmap2_length_1</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">H5</span>; <span class="id">subst</span>; <span class="id">destruct</span> <span class="id">es</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mmap2_mmap2_unnest_exp_length">mmap2_mmap2_unnest_exp_length</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore1">Forall2_ignore1</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">H3</span>, <span class="id">H8</span>. <span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_mmap2_unnest_exp_wc">mmap2_mmap2_unnest_exp_wc</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_mmap2_unnest_exp_clocksof1">mmap2_mmap2_unnest_exp_clocksof1</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">clear</span> - <span class="id">Hvars</span>. <span class="id">simpl_Forall</span>. <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lcsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">repeat</span> <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_app">Forall_app</a></span>; <span class="id">repeat</span> <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">remember</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_merge">unnest_merge</a></span> _ _ _ _) <span class="kwd">as</span> <span class="id">merge</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">merge</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x3</span>) <span class="kwd">as</span> <span class="id">Hlength''</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.idents_for_anns_length">idents_for_anns_length</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subst</span>. <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_merge_length">unnest_merge_length</a></span>. <span class="id">solve_length</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> - <span class="id">Hvars</span> <span class="id">Hsem'</span> <span class="id">Href3</span> <span class="id">Hlength''</span>. <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mk_equations_Forall">mk_equations_Forall</a></span>. <span class="id">simpl_forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_swap_args">Forall2_swap_args</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_trans_ex">Forall2_trans_ex</a></span> <span class="kwd">in</span> <span class="id">Hsem'</span>; [|<span class="id">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.Seq">Seq</a></span> <span class="kwd">with</span> (<span class="id">ss</span>:=[[<span class="id">x</span>]]); <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="id">repeat</span> <span class="id">constructor</span>... <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">simpl_Forall</span>. <span class="id">repeat</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_refines">sem_equation_refines</a></span>; <span class="id">eauto</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;case&nbsp;(total)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x</span> = 1). 2:<span class="id">singleton_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_exp_length">unnest_exp_length</a></span> <span class="kwd">in</span> <span class="id">H2</span>... <span class="id">rewrite</span> <span class="id">H2</span>, &lt;-<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.length_clockof_numstreams">length_clockof_numstreams</a></span>, <span class="id">H7</span>; <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hun1</span>:=<span class="id">H2</span>). <span class="id">eapply</span> <span class="id">IHe</span> <span class="kwd">in</span> <span class="id">H2</span> <span class="kwd">as</span> (<span class="id">Hi1</span>&amp;<span class="id">Href1</span>&amp;<span class="id">Histst1</span>&amp;<span class="id">Hsem1</span>&amp;<span class="id">Hsem1'</span>)... <span class="id">clear</span> <span class="id">IHe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_singl">Forall2_singl</a></span> <span class="kwd">in</span> <span class="id">Hsem1</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">es</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> ++ <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">x1</span>)) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">es</span>)) <span class="id">es</span>) <span class="kwd">as</span> <span class="id">Hwces</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">simpl_Forall</span>. <span class="id">repeat</span> <span class="id">solve_incl</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.Forall2Brs">Forall2Brs</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">Hi1</span> <span class="id">b</span>) <span class="id">es</span> <span class="id">vs0</span>) <span class="kwd">as</span> <span class="id">Hses</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.Forall2Brs_impl_In">Forall2Brs_impl_In</a></span>; [|<span class="id">eauto</span>]; <span class="id">intros</span> ?? _ <span class="id">Hse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_mmap2_sem">mmap2_mmap2_sem</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">Hi2</span>&amp;<span class="id">Href2</span>&amp;<span class="id">Histst2</span>&amp;<span class="id">Hsem2</span>&amp;<span class="id">Hsem2'</span>)...<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">Hi2</span> <span class="id">b</span> <span class="id">e</span> [<span class="id">v</span>])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_case">unnest_case</a></span> <span class="id">e0</span> <span class="id">x2</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> <span class="id">tys</span> <span class="id">ck</span>) <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hsem'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_case_sem">unnest_case_sem</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.mmap2_length_1">mmap2_length_1</a></span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">es</span>, <span class="id">x2</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">try</span> <span class="id">congruence</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_mmap2_unnest_exp_wc">mmap2_mmap2_unnest_exp_wc</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mmap2_mmap2_unnest_exp_annots">mmap2_mmap2_unnest_exp_annots</a></span> <span class="kwd">in</span> <span class="id">H3</span>. 2:<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eapply</span> <span class="id">H9</span>]; <span class="id">intros</span> (?&amp;?); <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore1">Forall2_ignore1</a></span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">H3</span>, <span class="id">H11</span>, <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.length_clocksof_annots">length_clocksof_annots</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mmap2_mmap2_unnest_exp_numstreams">mmap2_mmap2_unnest_exp_numstreams</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_forall2">Forall2_forall2</a></span> <span class="kwd">in</span> <span class="id">H22</span> <span class="kwd">as</span> (<span class="id">Len</span>&amp;<span class="id">Case</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs0</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">tys</span>) <span class="kwd">as</span> <span class="id">Len1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.Forall2Brs_length1">Forall2Brs_length1</a></span> <span class="kwd">in</span> <span class="id">H21</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id">simpl_Forall</span>; <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck_numstreams">sem_exp_ck_numstreams</a></span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H21</span>; <span class="id">try</span> <span class="id">congruence</span>. <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_length</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall3_forall3">Forall3_forall3</a></span>. <span class="id">repeat</span> <span class="id">split</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span> * <span class="id">N</span> <span class="id">Nth1</span> <span class="id">Nth2</span> <span class="id">Nth3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">map_nth'</span> <span class="kwd">with</span> (<span class="id">d'</span>:=<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux.bool_velus_type">OpAux.bool_velus_type</a></span>) <span class="kwd">in</span> <span class="id">Nth2</span>; [|<span class="id">congruence</span>]; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">Case</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">is_control</span>; <span class="id">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;control&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">Hi2</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">simpl</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">etransitivity</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_app">Forall_app</a></span>; <span class="id">split</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_refines">sem_equation_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;exp&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">Hi2</span> + <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.of_list">FEnv.of_list</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#combine">combine</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, _) =&gt; <span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">x</span>) <span class="id">x</span>) <span class="id">vs</span>)) <span class="kwd">as</span> <span class="id">Hi3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x</span>) <span class="kwd">as</span> <span class="id">Hlength'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.idents_for_anns_length">idents_for_anns_length</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">repeat</span> <span class="id">simpl_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.Forall2Brs_length1">Forall2Brs_length1</a></span> <span class="kwd">in</span> <span class="id">H21</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">simpl_Forall</span>; <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck_numstreams">sem_exp_ck_numstreams</a></span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H21</span>; <span class="id">try</span> <span class="id">congruence</span>. <span class="id">inv</span> <span class="id">H11</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H22</span> <span class="kwd">as</span> ?. <span class="id">solve_length</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) <span class="id">Hi2</span> <span class="id">Hi3</span>) <span class="kwd">as</span> <span class="id">Href3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">subst</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.idents_for_anns_refines">idents_for_anns_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Histst2</span> <span class="kwd">as</span> (<span class="id">Hdom1</span>&amp;_)... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.sem_var">sem_var</a></span> <span class="id">Hi3</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, _) =&gt; <span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">x</span>) <span class="id">x</span>) <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hvars</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">rewrite</span> <span class="id">HeqHi3</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.sem_new_vars">sem_new_vars</a></span>... 1:<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.idents_for_anns_NoDup">idents_for_anns_NoDup</a></span>; <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">Hi3</span>. <span class="id">split</span>;[|<span class="id">split</span>;[|<span class="id">split</span>]]; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">repeat</span> (<span class="id">etransitivity</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">subst</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.idents_for_anns_hist_st">idents_for_anns_hist_st</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_map">map_map</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext">map_ext</a></span>, &lt;-<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_case_clocksof">unnest_case_clocksof</a></span> <span class="kwd">with</span> (<span class="id">nck</span>:=<span class="id">ck</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sc_exps2">sc_exps2</a></span>; <span class="id">eauto</span>. <span class="id">destruct</span> <span class="id">Histst2</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_case_wc_exp">unnest_case_wc_exp</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_exp_wc">unnest_exp_wc</a></span> <span class="kwd">in</span> <span class="id">Hun1</span> <span class="kwd">as</span> (<span class="id">Hwc</span>&amp;_); <span class="id">eauto</span>. <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_singl">Forall_singl</a></span> <span class="kwd">in</span> <span class="id">Hwc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">solve_incl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_exp_clockof">unnest_exp_clockof</a></span> <span class="kwd">in</span> <span class="id">Hun1</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>. <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hun1</span>; <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span> <span class="kwd">in</span> <span class="id">Hun1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.mmap2_length_1">mmap2_length_1</a></span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">H8</span>; <span class="id">subst</span>; <span class="id">destruct</span> <span class="id">es</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mmap2_mmap2_unnest_exp_length">mmap2_mmap2_unnest_exp_length</a></span> <span class="kwd">in</span> <span class="id">H3</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore1">Forall2_ignore1</a></span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">H4</span>, <span class="id">H11</span>. <span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_mmap2_unnest_exp_wc">mmap2_mmap2_unnest_exp_wc</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_mmap2_unnest_exp_clocksof2">mmap2_mmap2_unnest_exp_clocksof2</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">clear</span> - <span class="id">Hvars</span>. <span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lcsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">repeat</span> <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_app">Forall_app</a></span>; <span class="id">repeat</span> <span class="id">split</span>. 2,3:<span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_refines">sem_equation_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_case">unnest_case</a></span> _ _ _ _ _) <span class="kwd">as</span> <span class="id">merge</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">merge</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x</span>) <span class="kwd">as</span> <span class="id">Hlength''</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.idents_for_anns_length">idents_for_anns_length</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subst</span>. <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_case_length">unnest_case_length</a></span>. <span class="id">solve_length</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> - <span class="id">Hvars</span> <span class="id">Hsem'</span> <span class="id">Href3</span> <span class="id">Hlength''</span>. <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mk_equations_Forall">mk_equations_Forall</a></span>. <span class="id">simpl_forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_swap_args">Forall2_swap_args</a></span> <span class="kwd">in</span> <span class="id">Hsem'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_trans_ex">Forall2_trans_ex</a></span> <span class="kwd">in</span> <span class="id">Hsem'</span>; [|<span class="id">eauto</span>]. <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.Seq">Seq</a></span> <span class="kwd">with</span> (<span class="id">ss</span>:=[[<span class="id">x0</span>]]); <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="id">repeat</span> <span class="id">constructor</span>... <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>...<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;case&nbsp;(default)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">inv_bind</span>. <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x</span> = 1). 2:<span class="id">singleton_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_exp_length">unnest_exp_length</a></span> <span class="kwd">in</span> <span class="id">H2</span>... <span class="id">rewrite</span> <span class="id">H2</span>, &lt;-<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.length_clockof_numstreams">length_clockof_numstreams</a></span>, <span class="id">H7</span>; <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hun1</span>:=<span class="id">H2</span>). <span class="id">eapply</span> <span class="id">IHe</span> <span class="kwd">in</span> <span class="id">H2</span> <span class="kwd">as</span> (<span class="id">Hi1</span>&amp;<span class="id">Href1</span>&amp;<span class="id">Histst1</span>&amp;<span class="id">Hsem1</span>&amp;<span class="id">Hsem1'</span>)... <span class="id">clear</span> <span class="id">IHe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_singl">Forall2_singl</a></span> <span class="kwd">in</span> <span class="id">Hsem1</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">es</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> ++ <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">x1</span>)) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">es</span>)) <span class="id">es</span>) <span class="kwd">as</span> <span class="id">Hwces</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">simpl_Forall</span>. <span class="id">repeat</span> <span class="id">solve_incl</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.Forall2Brs">Forall2Brs</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">Hi1</span> <span class="id">b</span>) <span class="id">es</span> <span class="id">vs0</span>) <span class="kwd">as</span> <span class="id">Hses</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.Forall2Brs_impl_In">Forall2Brs_impl_In</a></span>; [|<span class="id">eauto</span>]; <span class="id">intros</span> ?? _ <span class="id">Hse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_mmap2_sem">mmap2_mmap2_sem</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">Hi2</span>&amp;<span class="id">Href2</span>&amp;<span class="id">Histst2</span>&amp;<span class="id">Hsem2</span>&amp;<span class="id">Hsem2'</span>)...<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> ++ <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">x4</span>)) <span class="id">d0</span>) <span class="kwd">as</span> <span class="id">Hwd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H12</span> _ <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>). <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H12</span>... <span class="id">repeat</span> <span class="id">solve_incl</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">Hi2</span> <span class="id">b</span>) <span class="id">d0</span> <span class="id">vd</span>) <span class="kwd">as</span> <span class="id">Hsd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_sem">mmap2_sem</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> (<span class="id">Hi3</span>&amp;<span class="id">Href3</span>&amp;<span class="id">Histst3</span>&amp;<span class="id">Hsem3</span>&amp;<span class="id">Hsem3'</span>)...<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">Hi3</span> <span class="id">b</span> <span class="id">e</span> [<span class="id">v</span>])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_case">unnest_case</a></span> <span class="id">e0</span> <span class="id">x2</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x5</span>)) <span class="id">tys</span> <span class="id">ck</span>) <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hsem'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_case_sem">unnest_case_sem</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.mmap2_length_1">mmap2_length_1</a></span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">es</span>, <span class="id">x2</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">try</span> <span class="id">congruence</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_mmap2_unnest_exp_wc">mmap2_mmap2_unnest_exp_wc</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mmap2_mmap2_unnest_exp_annots">mmap2_mmap2_unnest_exp_annots</a></span> <span class="kwd">in</span> <span class="id">H3</span>. 2:<span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore1">Forall2_ignore1</a></span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">H2</span>, <span class="id">H11</span>, <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.length_clocksof_annots">length_clocksof_annots</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mmap2_mmap2_unnest_exp_numstreams">mmap2_mmap2_unnest_exp_numstreams</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">repeat</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_exp_typeof">unnest_exp_typeof</a></span> <span class="kwd">in</span> <span class="id">Hun1</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span> <span class="kwd">in</span> *. <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.Forall2Brs_impl_In">Forall2Brs_impl_In</a></span>; [|<span class="id">eauto</span>]; <span class="id">intros</span> ?? _ <span class="id">Hse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">repeat</span> <span class="id">esplit</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span>; <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">is_control</span>; <span class="id">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;control&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">Hi3</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">simpl</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">do</span> 2 (<span class="id">etransitivity</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">repeat</span> <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_app">Forall_app</a></span>; <span class="id">repeat</span> <span class="id">split</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_refines">sem_equation_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;exp&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">Hi3</span> + <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.of_list">FEnv.of_list</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#combine">combine</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, _) =&gt; <span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">x</span>) <span class="id">x</span>) <span class="id">vs</span>)) <span class="kwd">as</span> <span class="id">Hi4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x</span>) <span class="kwd">as</span> <span class="id">Hlength'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.idents_for_anns_length">idents_for_anns_length</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">repeat</span> <span class="id">simpl_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.Forall2Brs_length1">Forall2Brs_length1</a></span> <span class="kwd">in</span> <span class="id">H21</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">simpl_Forall</span>; <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck_numstreams">sem_exp_ck_numstreams</a></span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H21</span>; <span class="id">try</span> <span class="id">congruence</span>. <span class="id">inv</span> <span class="id">H11</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall3_length">Forall3_length</a></span> <span class="kwd">in</span> <span class="id">H23</span> <span class="kwd">as</span> (?&amp;?). <span class="id">solve_length</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) <span class="id">Hi3</span> <span class="id">Hi4</span>) <span class="kwd">as</span> <span class="id">Href4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">subst</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.idents_for_anns_refines">idents_for_anns_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Histst3</span> <span class="kwd">as</span> (<span class="id">Hdom1</span>&amp;_)... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.sem_var">sem_var</a></span> <span class="id">Hi4</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, _) =&gt; <span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">x</span>) <span class="id">x</span>) <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hvars</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">rewrite</span> <span class="id">HeqHi4</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.sem_new_vars">sem_new_vars</a></span>... 1:<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.idents_for_anns_NoDup">idents_for_anns_NoDup</a></span>; <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">Hi4</span>. <span class="id">split</span>;[|<span class="id">split</span>;[|<span class="id">split</span>]]; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">repeat</span> (<span class="id">etransitivity</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">subst</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.idents_for_anns_hist_st">idents_for_anns_hist_st</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_map">map_map</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext">map_ext</a></span>, &lt;-<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_case_clocksof">unnest_case_clocksof</a></span> <span class="kwd">with</span> (<span class="id">nck</span>:=<span class="id">ck</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sc_exps2">sc_exps2</a></span>; <span class="id">eauto</span>. <span class="id">destruct</span> <span class="id">Histst3</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_case_wc_exp">unnest_case_wc_exp</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_exp_wc">unnest_exp_wc</a></span> <span class="kwd">in</span> <span class="id">Hun1</span> <span class="kwd">as</span> (<span class="id">Hwc</span>&amp;_); <span class="id">eauto</span>. <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_singl">Forall_singl</a></span> <span class="kwd">in</span> <span class="id">Hwc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">solve_incl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_exp_clockof">unnest_exp_clockof</a></span> <span class="kwd">in</span> <span class="id">Hun1</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>. <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hun1</span>; <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span> <span class="kwd">in</span> <span class="id">Hun1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.mmap2_length_1">mmap2_length_1</a></span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradict</span> <span class="id">H8</span>; <span class="id">subst</span>; <span class="id">destruct</span> <span class="id">es</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mmap2_mmap2_unnest_exp_length">mmap2_mmap2_unnest_exp_length</a></span> <span class="kwd">in</span> <span class="id">H3</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore1">Forall2_ignore1</a></span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">H3</span>, <span class="id">H11</span>. <span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_mmap2_unnest_exp_wc">mmap2_mmap2_unnest_exp_wc</a></span> <span class="kwd">in</span> <span class="id">H3</span> <span class="kwd">as</span> (<span class="id">Hwc</span>&amp;_)...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>. <span class="id">repeat</span> <span class="id">solve_incl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_mmap2_unnest_exp_clocksof2">mmap2_mmap2_unnest_exp_clocksof2</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl</span>. <span class="id">erewrite</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.length_clocksof_annots">length_clocksof_annots</a></span>, <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mmap2_unnest_exp_annots_length">mmap2_unnest_exp_annots_length</a></span>. 3:<span class="id">eauto</span>. 2:<span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H14</span> _ <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>). <span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_unnest_exp_wc">mmap2_unnest_exp_wc</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl</span>. <span class="id">eapply</span> <span class="id">mmap2_unnest_exp_clocksof'''</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">clear</span> - <span class="id">Hvars</span>. <span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lcsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">repeat</span> <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_app">Forall_app</a></span>; <span class="id">repeat</span> <span class="id">split</span>. 2-4:<span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_refines">sem_equation_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_case">unnest_case</a></span> _ _ _ _ _) <span class="kwd">as</span> <span class="id">merge</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">merge</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x</span>) <span class="kwd">as</span> <span class="id">Hlength''</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.idents_for_anns_length">idents_for_anns_length</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subst</span>. <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_case_length">unnest_case_length</a></span>. <span class="id">solve_length</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> - <span class="id">Hvars</span> <span class="id">Hsem'</span> <span class="id">Href4</span> <span class="id">Hlength''</span>. <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mk_equations_Forall">mk_equations_Forall</a></span>. <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_swap_args">Forall2_swap_args</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_trans_ex">Forall2_trans_ex</a></span> <span class="kwd">in</span> <span class="id">Hsem'</span>; [|<span class="id">eauto</span>]. <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.Seq">Seq</a></span> <span class="kwd">with</span> (<span class="id">ss</span>:=[[<span class="id">x0</span>]]); <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="id">repeat</span> <span class="id">constructor</span>... <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>...<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;app&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">a</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">x8</span>) <span class="kwd">as</span> <span class="id">Hanns</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.idents_for_anns_values">idents_for_anns_values</a></span> <span class="kwd">in</span> <span class="id">H5</span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.idents_for_anns_length">idents_for_anns_length</a></span> _ _ _ _ <span class="id">H5</span>) <span class="kwd">as</span> <span class="id">Hlength1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.n_out">n_out</a></span> <span class="id">n</span>) = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hlength2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">specialize</span> (<span class="id">H23</span> 0). <span class="id">inv</span> <span class="id">H23</span>. <span class="id">rewrite</span> <span class="id">H12</span> <span class="kwd">in</span> <span class="id">H7</span>; <span class="id">inv</span> <span class="id">H7</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.idents">idents</a></span> <span class="kwd">in</span> *. <span class="id">repeat</span> <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span> <span class="kwd">in</span> <span class="id">H9</span>. <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">es</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">ss</span>) <span class="kwd">as</span> <span class="id">Hlength3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H19</span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x6</span>) = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="kwd">as</span> <span class="id">Hlength4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mmap2_unnest_exp_length">mmap2_unnest_exp_length</a></span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H13</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span> <span class="kwd">in</span> <span class="id">H13</span>. <span class="id">rewrite</span> <span class="id">H13</span>. <span class="id">subst_length</span>. <span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.length_nclocksof_annots">length_nclocksof_annots</a></span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hun1</span>:=<span class="id">H2</span>). <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_sem">mmap2_sem</a></span> <span class="kwd">in</span> <span class="id">H2</span>... <span class="id">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [<span class="id">H'</span> [<span class="id">Href1</span> [<span class="id">Histst1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1'</span>]]]].<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hun2</span>:=<span class="id">H3</span>). <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_noops_exps_sem">unnest_noops_exps_sem</a></span> <span class="kwd">in</span> <span class="id">H3</span> <span class="kwd">as</span> (<span class="id">H''</span>&amp;<span class="id">Href2</span>&amp;<span class="id">Histst2</span>&amp;<span class="id">Hsem2</span>&amp;<span class="id">Hsem2'</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3:{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mmap2_normalized_lexp">mmap2_normalized_lexp</a></span> <span class="kwd">in</span> <span class="id">Hun1</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4:<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.find_node_incks">find_node_incks</a></span>. <span class="id">now</span> <span class="id">rewrite</span> <span class="id">H12</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_unnest_exp_wc">mmap2_unnest_exp_wc</a></span> <span class="kwd">in</span> <span class="id">Hun1</span> <span class="kwd">as</span> (?&amp;?); <span class="id">eauto</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">rs</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">er</span>) <span class="kwd">as</span> <span class="id">Hlen3</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H21</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">er</span> <span class="id">sr</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H''</span> <span class="id">b</span> <span class="id">er</span> <span class="id">sr</span>) <span class="id">er</span> <span class="id">rs</span>) <span class="kwd">as</span> <span class="id">Hsemr'</span> <span class="kwd">by</span> (<span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hl</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.numstreams">numstreams</a></span> <span class="id">e</span> = 1) <span class="id">er</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eapply</span> <span class="id">H15</span>]; <span class="id">intros</span> ? <span class="id">Hck</span>. <span class="id">destruct</span> <span class="id">Hck</span> <span class="kwd">as</span> (?&amp;<span class="id">Hck</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;-<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.length_clockof_numstreams">length_clockof_numstreams</a></span>, <span class="id">Hck</span>; <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hun3</span>:=<span class="id">H4</span>). <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_resets_sem">unnest_resets_sem</a></span> <span class="kwd">in</span> <span class="id">H4</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:(<span class="id">simpl_Forall</span>; <span class="id">repeat</span> <span class="id">solve_incl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">assert</span> (<span class="kwd">exists</span> <span class="id">r</span>, <span class="id">rs</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; [<span class="id">x</span>]) <span class="id">r</span>) <span class="kwd">as</span> (<span class="id">r</span> &amp; <span class="id">Hr</span>); <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">clear</span> - <span class="id">H11</span> <span class="id">Hsemr'</span> <span class="id">Hl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore1">Forall2_ignore1</a></span> <span class="kwd">in</span> <span class="id">Hsemr'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">rs</span>; <span class="id">intros</span>. <span class="kwd">exists</span> []; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id">IHrs</span> <span class="kwd">as</span> (?&amp;?); <span class="id">subst</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck_numstreams">sem_exp_ck_numstreams</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> <span class="id">Num</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hl</span> <span class="kwd">in</span> <span class="id">Num</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">singleton_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span> (_::_); <span class="id">simpl</span>; <span class="id">f_equal</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#concat_map_singl1">concat_map_singl1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>. <span class="id">eapply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H9</span> <span class="kwd">as</span> (<span class="id">H'''</span>&amp;?&amp;?&amp;?&amp;?); <span class="id">eauto</span>. <span class="kwd">exists</span> <span class="id">H'''</span>; <span class="id">split</span>;[|<span class="id">split</span>;[|<span class="id">split</span>]]; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>; <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H4</span> <span class="kwd">as</span> (<span class="id">H'''</span>&amp;<span class="id">Href3</span>&amp;<span class="id">Histst3</span>&amp;<span class="id">Hsem3</span>&amp;<span class="id">Hsem3'</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'''</span> <span class="id">b</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.Eapp">Eapp</a></span> <span class="id">f</span> <span class="id">x2</span> <span class="id">x5</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">x8</span>)) <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hsem'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.Sapp">Sapp</a></span> <span class="kwd">with</span> (<span class="id">ss</span>:=(<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; [<span class="id">x</span>]) <span class="id">x</span>) <span class="id">ss</span>)))...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> &lt;- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat_map">concat_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span> <span class="id">k</span>. <span class="id">specialize</span> (<span class="id">H23</span> <span class="id">k</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#concat_map_singl2">concat_map_singl2</a></span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.HGref">HGref</a></span>; <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">H'''</span> + <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.of_list">FEnv.of_list</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#combine">combine</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, _) =&gt; <span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">x</span>) <span class="id">x8</span>) <span class="id">vs</span>)) <span class="kwd">as</span> <span class="id">H''''</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x8</span>) <span class="kwd">as</span> <span class="id">Hlen'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H14</span>. <span class="id">rewrite</span> 2 <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span> <span class="kwd">in</span> <span class="id">H14</span>. <span class="id">solve_length</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) <span class="id">H'''</span> <span class="id">H''''</span>) <span class="kwd">as</span> <span class="id">Href4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">subst</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.idents_for_anns_refines">idents_for_anns_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Histst3</span> <span class="kwd">as</span> (<span class="id">Hdom3</span>&amp;_); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.sem_var">sem_var</a></span> <span class="id">H''''</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, _) =&gt; <span class="id"><a href="Velus.FunctionalEnvironment.html#Var">Var</a></span> <span class="id">x</span>) <span class="id">x8</span>) <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hvars</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">rewrite</span> <span class="id">HeqH''''</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.sem_new_vars">sem_new_vars</a></span>... 1:<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.idents_for_anns_NoDup">idents_for_anns_NoDup</a></span>; <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H''''</span>. <span class="id">split</span>;[|<span class="id">split</span>;[|<span class="id">split</span>]]...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">repeat</span> (<span class="id">etransitivity</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">subst</span>. <span class="id">assert</span> (<span class="id">Hids</span>:=<span class="id">H5</span>). <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.idents_for_anns_hist_st">idents_for_anns_hist_st</a></span> <span class="kwd">in</span> <span class="id">H5</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hwc</span>:=<span class="id">H10</span>). <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_unnest_exp_wc">mmap2_unnest_exp_wc</a></span> <span class="kwd">in</span> <span class="id">H10</span> <span class="kwd">as</span> (<span class="id">Hwc'</span>&amp;_); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span> <span class="kwd">in</span> <span class="id">Hsem1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext">map_ext</a></span>, &lt;-<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_map">map_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">sc_outside_mask'</span> <span class="kwd">with</span> (<span class="id">es</span>:=<span class="id">es</span>) (<span class="id">G</span>:=<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4:<span class="id">intros</span> (?&amp;?); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">simpl_Forall</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sc_exps">sc_exps</a></span> <span class="kwd">in</span> <span class="id">H19</span>; <span class="id">eauto</span>. 2:<span class="id">destruct</span> <span class="id">Histst</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>; <span class="id">eauto</span> 7 <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.sem_clock_refines">sem_clock_refines</a></span>, <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.var_history_refines">var_history_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">clear</span> - <span class="id">Hvars</span>. <span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lcsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; [| <span class="id">repeat</span> <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_app">Forall_app</a></span>; <span class="id">repeat</span> <span class="id">split</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2-4:<span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_refines">sem_equation_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.Seq">Seq</a></span> <span class="kwd">with</span> (<span class="id">ss</span>:=[<span class="id">vs</span>]).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">repeat</span> <span class="id">constructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>; <span class="id">simpl_Forall</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="UCORRECTNESS.unnest_exps_sem">unnest_exps_sem</a></span> : <span class="kwd">forall</span> <span class="id">b</span> <span class="id">es</span> <span class="id">H</span> <span class="id">vs</span> <span class="id">es'</span> <span class="id">eqs'</span> <span class="id">st</span> <span class="id">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">st</span>)) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H</span> <span class="id">b</span>) <span class="id">es</span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H</span> <span class="id">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.mmap2">mmap2</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_exp">unnest_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>) <span class="id">es</span> <span class="id">st</span> = (<span class="id">es'</span>, <span class="id">eqs'</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">exists</span> <span class="id">H'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) <span class="id">H</span> <span class="id">H'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H'</span> <span class="id">st'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> (<span class="id">es</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.exp">exp</a></span>) (<span class="id">vs</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux.svalue">svalue</a></span>)) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span> <span class="id">e</span> [<span class="id">v</span>]) <span class="id">es</span> <span class="id">vs</span>) <span class="id">es'</span> <span class="id">vs</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_ck">sem_equation_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">eqs'</span>)).<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hwt</span> <span class="id">Hsem</span> <span class="id">Hhistst</span> <span class="id">Hnorm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_sem">mmap2_sem</a></span> <span class="kwd">in</span> <span class="id">Hnorm</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_exp_sem">unnest_exp_sem</a></span> <span class="kwd">in</span> <span class="id">H5</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="UCORRECTNESS.unnest_rhs_sem">unnest_rhs_sem</a></span> : <span class="kwd">forall</span> <span class="id">b</span> <span class="id">e</span> <span class="id">H</span> <span class="id">vs</span> <span class="id">es'</span> <span class="id">eqs'</span> <span class="id">st</span> <span class="id">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">st</span>) <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H</span> <span class="id">b</span> <span class="id">e</span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H</span> <span class="id">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_rhs">unnest_rhs</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">e</span> <span class="id">st</span> = (<span class="id">es'</span>, <span class="id">eqs'</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">exists</span> <span class="id">H'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) <span class="id">H</span> <span class="id">H'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H'</span> <span class="id">st'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span> <span class="id">e</span> [<span class="id">v</span>]) <span class="id">es'</span> <span class="id">vs</span> \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">e'</span>, (<span class="id">es'</span> = [<span class="id">e'</span>] /\ <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span> <span class="id">e'</span> <span class="id">vs</span>)) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_ck">sem_equation_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span>) <span class="id">eqs'</span>).<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof with</summary>
<div class="proofscript">
 <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">norm</span> <span class="id">lclocking</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hwt</span> <span class="id">Hsem</span> <span class="id">Histst</span> <span class="id">Hnorm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">e</span>; <span class="id">try</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_exp_sem">unnest_exp_sem</a></span> <span class="kwd">in</span> <span class="id">Hnorm</span> <span class="kwd">as</span> [<span class="id">H'</span> [<span class="id">Href1</span> [<span class="id">Histst1</span> [<span class="id">Hsem1</span> <span class="id">Hsem2</span>]]]]; <span class="id">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H'</span>; <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">eauto</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1-4:<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_rhs">unnest_rhs</a></span> <span class="kwd">in</span> <span class="id">Hnorm</span>; <span class="id">repeat</span> <span class="id">inv_bind</span>. 4:<span class="id">inv</span> <span class="id">Hwt</span>; <span class="id">inv</span> <span class="id">Hsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;extcall&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hwt</span>. <span class="id">inv</span> <span class="id">Hsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_exps">unnest_exps</a></span> <span class="kwd">in</span> *; <span class="id">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hnorm1</span>:=<span class="id">H0</span>). <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_exps_sem">unnest_exps_sem</a></span> <span class="kwd">in</span> <span class="id">H0</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">H'</span> [<span class="id">Href1</span> [<span class="id">Histst1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1'</span>]]]]. <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span> <span class="kwd">in</span> <span class="id">Hsem1</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H'</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">constructor</span>. <span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id">instantiate</span> (1:=<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; [<span class="id">x</span>]) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">ss</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>:<span class="id">try</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#concat_map_singl1">concat_map_singl1</a></span>; <span class="id">eauto</span>; <span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_unnest_exp_typesof">mmap2_unnest_exp_typesof</a></span> <span class="kwd">in</span> <span class="id">Hnorm1</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">congruence</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;fby&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion_clear</span> <span class="id">Hwt</span> <span class="kwd">as</span> [| | | | | | |??? <span class="id">Hwc1</span> <span class="id">Hwc2</span> <span class="id">Hl1</span> <span class="id">Hl2</span> | | | | |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion_clear</span> <span class="id">Hsem</span> <span class="kwd">as</span> [| | | | | | |???????? <span class="id">Hsem1</span> <span class="id">Hsem2</span> <span class="id">Fby</span>| | | | | |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.annots">annots</a></span> <span class="id">l</span>)) <span class="kwd">as</span> <span class="id">Hlength1</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_exps_length">unnest_exps_length</a></span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x2</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.annots">annots</a></span> <span class="id">l0</span>)) <span class="kwd">as</span> <span class="id">Hlength2</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_exps_length">unnest_exps_length</a></span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_exps">unnest_exps</a></span> <span class="kwd">in</span> *. <span class="id">repeat</span> <span class="id">inv_bind</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hun1</span>:=<span class="id">H0</span>). <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_exps_sem">unnest_exps_sem</a></span> <span class="kwd">in</span> <span class="id">H0</span>... <span class="id">clear</span> <span class="id">Hsem1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">H'</span> [<span class="id">Href1</span> [<span class="id">Histst1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1'</span>]]]]. <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span> <span class="kwd">in</span> <span class="id">Hsem1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H'</span> <span class="id">b</span>) <span class="id">l0</span> <span class="id">sss</span>) <span class="kwd">as</span> <span class="id">Hsem'</span> <span class="kwd">by</span> (<span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_exps_sem">unnest_exps_sem</a></span> <span class="kwd">in</span> <span class="id">H1</span>... <span class="id">clear</span> <span class="id">Hsem2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:(<span class="id">simpl_Forall</span>; <span class="id">repeat</span> <span class="id">solve_incl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">H''</span> [<span class="id">Href2</span> [<span class="id">Histst2</span> [<span class="id">Hsem2</span> <span class="id">Hsem2'</span>]]]]. <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span> <span class="kwd">in</span> <span class="id">Hsem2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H''</span> <span class="id">b</span> <span class="id">e</span> [<span class="id">v</span>]) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x2</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">s0ss</span>)) <span class="kwd">as</span> <span class="id">Hsem''</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">by</span> (<span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H''</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">repeat</span> (<span class="id">etransitivity</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">left</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_fby_sem">unnest_fby_sem</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">Hl1</span>; <span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">Hl2</span>; <span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">repeat</span> <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_app">Forall_app</a></span>. <span class="id">repeat</span> <span class="id">split</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_refines">sem_equation_refines</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;arrow&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion_clear</span> <span class="id">Hwt</span> <span class="kwd">as</span> [| | | | | | | |??? <span class="id">Hwc1</span> <span class="id">Hwc2</span> <span class="id">Hl1</span> <span class="id">Hl2</span>| | | |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion_clear</span> <span class="id">Hsem</span> <span class="kwd">as</span> [| | | | | | | |???????? <span class="id">Hsem1</span> <span class="id">Hsem2</span> <span class="id">Fby</span>| | | | |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.annots">annots</a></span> <span class="id">l</span>)) <span class="kwd">as</span> <span class="id">Hlength1</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_exps_length">unnest_exps_length</a></span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x2</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.annots">annots</a></span> <span class="id">l0</span>)) <span class="kwd">as</span> <span class="id">Hlength2</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_exps_length">unnest_exps_length</a></span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_exps">unnest_exps</a></span> <span class="kwd">in</span> *. <span class="id">repeat</span> <span class="id">inv_bind</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hun1</span>:=<span class="id">H0</span>). <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_exps_sem">unnest_exps_sem</a></span> <span class="kwd">in</span> <span class="id">H0</span>... <span class="id">clear</span> <span class="id">Hsem1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">H'</span> [<span class="id">Href1</span> [<span class="id">Histst1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1'</span>]]]]. <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span> <span class="kwd">in</span> <span class="id">Hsem1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H'</span> <span class="id">b</span>) <span class="id">l0</span> <span class="id">sss</span>) <span class="kwd">as</span> <span class="id">Hsem'</span> <span class="kwd">by</span> (<span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_exps_sem">unnest_exps_sem</a></span> <span class="kwd">in</span> <span class="id">H1</span>... <span class="id">clear</span> <span class="id">Hsem2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:(<span class="id">simpl_Forall</span>; <span class="id">repeat</span> <span class="id">solve_incl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">H''</span> [<span class="id">Href2</span> [<span class="id">Histst2</span> [<span class="id">Hsem2</span> <span class="id">Hsem2'</span>]]]]. <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span> <span class="kwd">in</span> <span class="id">Hsem2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H''</span> <span class="id">b</span> <span class="id">e</span> [<span class="id">v</span>]) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x2</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">s0ss</span>)) <span class="kwd">as</span> <span class="id">Hsem''</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">by</span> (<span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H''</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">repeat</span> (<span class="id">etransitivity</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">left</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_arrow_sem">unnest_arrow_sem</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">Hl1</span>; <span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">Hl2</span>; <span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">repeat</span> <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_app">Forall_app</a></span>. <span class="id">repeat</span> <span class="id">split</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_refines">sem_equation_refines</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;app&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_exps">unnest_exps</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x6</span>) = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="kwd">as</span> <span class="id">Hlength4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mmap2_unnest_exp_length">mmap2_unnest_exp_length</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H10</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span> <span class="kwd">in</span> <span class="id">H10</span>. <span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.length_nclocksof_annots">length_nclocksof_annots</a></span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hun1</span>:=<span class="id">H0</span>). <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_exps_sem">unnest_exps_sem</a></span> <span class="kwd">in</span> <span class="id">H0</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">H'</span> [<span class="id">Href1</span> [<span class="id">Histst1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1'</span>]]]].<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hun2</span>:=<span class="id">H1</span>). <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_noops_exps_sem">unnest_noops_exps_sem</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> (<span class="id">H''</span>&amp;<span class="id">Href2</span>&amp;<span class="id">Histst2</span>&amp;<span class="id">Hsem2</span>&amp;<span class="id">Hsem2'</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3:{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mmap2_normalized_lexp">mmap2_normalized_lexp</a></span> <span class="kwd">in</span> <span class="id">Hun1</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4:<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.find_node_incks">find_node_incks</a></span>. <span class="id">rewrite</span> <span class="id">H9</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span>; <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_unnest_exp_wc">mmap2_unnest_exp_wc</a></span>. 1,3:<span class="id">eauto</span>. <span class="id">simpl_Forall</span>; <span class="id">repeat</span> <span class="id">solve_incl</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">rs</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l0</span>) <span class="kwd">as</span> <span class="id">Hlen3</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H18</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">er</span> <span class="id">sr</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H''</span> <span class="id">b</span> <span class="id">er</span> <span class="id">sr</span>) <span class="id">l0</span> <span class="id">rs</span>) <span class="kwd">as</span> <span class="id">Hsemr'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">by</span> (<span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hl</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.numstreams">numstreams</a></span> <span class="id">e</span> = 1) <span class="id">l0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;-<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.length_clockof_numstreams">length_clockof_numstreams</a></span>, <span class="id">H1</span>; <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hr</span>:=<span class="id">H2</span>). <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_resets_sem">unnest_resets_sem</a></span> <span class="kwd">in</span> <span class="id">H2</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:(<span class="id">simpl_Forall</span>; <span class="id">repeat</span> <span class="id">solve_incl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">assert</span> (<span class="kwd">exists</span> <span class="id">r</span>, <span class="id">rs</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; [<span class="id">x</span>]) <span class="id">r</span>) <span class="kwd">as</span> (<span class="id">r</span> &amp; ?); <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">clear</span> - <span class="id">H8</span> <span class="id">Hsemr'</span> <span class="id">Hl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore1">Forall2_ignore1</a></span> <span class="kwd">in</span> <span class="id">Hsemr'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">rs</span>; <span class="id">intros</span>. <span class="kwd">exists</span> []; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id">IHrs</span> <span class="kwd">as</span> (?&amp;?); <span class="id">subst</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck_numstreams">sem_exp_ck_numstreams</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> <span class="id">Num</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hl</span> <span class="kwd">in</span> <span class="id">Num</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">singleton_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span> (_::_); <span class="id">simpl</span>; <span class="id">f_equal</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#concat_map_singl1">concat_map_singl1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_exp_sem">unnest_exp_sem</a></span> <span class="kwd">in</span> <span class="id">H14</span> <span class="kwd">as</span> (<span class="id">H'''</span>&amp;?&amp;?&amp;<span class="id">Sem1</span>&amp;?)... <span class="id">inv</span> <span class="id">Sem1</span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> (<span class="id">H'''</span>&amp;<span class="id">Href3</span>&amp;<span class="id">Hhistst3</span>&amp;<span class="id">Hsem3</span>&amp;<span class="id">Hsem3'</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H'''</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">repeat</span> (<span class="id">etransitivity</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>. <span class="id">eexists</span>; <span class="id">split</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.Sapp">Sapp</a></span> <span class="kwd">with</span> (<span class="id">ss</span>:=(<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; [<span class="id">x</span>]) <span class="id">x</span>) <span class="id">ss</span>))) (<span class="id">rs</span>:=<span class="id">rs</span>) (<span class="id">bs</span>:=<span class="id">bs</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">rewrite</span> &lt;- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat_map">concat_map</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_map_2">Forall2_map_2</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#concat_map_singl2">concat_map_singl2</a></span>. <span class="id">intros</span> <span class="id">k</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.HGref">HGref</a></span>, <span class="id">H20</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">repeat</span> <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_app">Forall_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>; <span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_refines">sem_equation_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="UCORRECTNESS.mmap2_unnest_rhs_sem">mmap2_unnest_rhs_sem</a></span> : <span class="kwd">forall</span> <span class="id">b</span> <span class="id">es</span> <span class="id">H</span> <span class="id">vs</span> <span class="id">es'</span> <span class="id">eqs'</span> <span class="id">st</span> <span class="id">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">st</span>)) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H</span> <span class="id">b</span>) <span class="id">es</span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H</span> <span class="id">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.mmap2">mmap2</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_rhs">unnest_rhs</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span>) <span class="id">es</span> <span class="id">st</span> = (<span class="id">es'</span>, <span class="id">eqs'</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">exists</span> <span class="id">H'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) <span class="id">H</span> <span class="id">H'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H'</span> <span class="id">st'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">es'</span> <span class="id">vs</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span> <span class="id">e</span> [<span class="id">v</span>]) <span class="id">es'</span> <span class="id">vs</span> \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">e'</span>, (<span class="id">es'</span> = [<span class="id">e'</span>] /\ <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span> <span class="id">e'</span> <span class="id">vs</span>)) <span class="id">es'</span> <span class="id">vs</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_ck">sem_equation_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">eqs'</span>)).<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof with</summary>
<div class="proofscript">
 <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">es</span>; <span class="id">intros</span> * <span class="id">Hwt</span> <span class="id">Hsem</span> <span class="id">Histst</span> <span class="id">Hmap</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="kwd">exists</span> <span class="id">H</span>; <span class="id">simpl</span>. <span class="id">inv</span> <span class="id">Hsem</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">auto</span>). <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hwt</span>. <span class="id">inv</span> <span class="id">Hsem</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.st_follows">st_follows</a></span> <span class="id">st</span> <span class="id">x1</span>) <span class="kwd">as</span> <span class="id">Hfollows1</span> <span class="kwd">by</span> <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_rhs_sem">unnest_rhs_sem</a></span> <span class="kwd">in</span> <span class="id">H0</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">H'</span> [<span class="id">Href1</span> [<span class="id">Histst1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1'</span>]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H'</span> <span class="id">b</span>) <span class="id">es</span> <span class="id">l'</span>) <span class="kwd">as</span> <span class="id">Hsem'</span> <span class="kwd">by</span> (<span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">IHes</span> <span class="kwd">in</span> <span class="id">H1</span>... <span class="id">clear</span> <span class="id">IHes</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:(<span class="id">simpl_Forall</span>; <span class="id">repeat</span> <span class="id">solve_incl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">H''</span> [<span class="id">Href2</span> [<span class="id">Histst2</span> [<span class="id">Hsem2</span> <span class="id">Hsem2'</span>]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H''</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etransitivity</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hsem1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">left</span>. <span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">right</span>. <span class="id">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">e'</span> [? <span class="id">H0</span>]]; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">e'</span>. <span class="id">split</span>... <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_app">Forall_app</a></span>. <span class="id">split</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_refines">sem_equation_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="UCORRECTNESS.unnest_rhss_sem">unnest_rhss_sem</a></span> : <span class="kwd">forall</span> <span class="id">b</span> <span class="id">es</span> <span class="id">H</span> <span class="id">vs</span> <span class="id">es'</span> <span class="id">eqs'</span> <span class="id">st</span> <span class="id">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">st</span>)) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H</span> <span class="id">b</span>) <span class="id">es</span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H</span> <span class="id">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_rhss">unnest_rhss</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">es</span> <span class="id">st</span> = (<span class="id">es'</span>, <span class="id">eqs'</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">exists</span> <span class="id">H'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) <span class="id">H</span> <span class="id">H'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H'</span> <span class="id">st'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> '(<span class="id">e</span>, <span class="id">v</span>) =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span> <span class="id">e</span> <span class="id">v</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.combine_for_numstreams">combine_for_numstreams</a></span> <span class="id">es'</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">vs</span>)) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_ck">sem_equation_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span>) <span class="id">eqs'</span>).<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof with</summary>
<div class="proofscript">
 <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hwt</span> <span class="id">Hsem</span> <span class="id">Histst</span> <span class="id">Hnorm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">st'</span>)) <span class="id">es'</span>) <span class="kwd">as</span> <span class="id">Hwt'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_rhss_wc">unnest_rhss_wc</a></span> <span class="kwd">in</span> <span class="id">Hnorm</span> <span class="kwd">as</span> [? ?]... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_rhss">unnest_rhss</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_unnest_rhs_sem">mmap2_unnest_rhs_sem</a></span> <span class="kwd">in</span> <span class="id">H0</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">H'</span> [<span class="id">Href1</span> [<span class="id">Histst1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1'</span>]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H'</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> <span class="id">Hsem</span>. <span class="id">induction</span> <span class="id">Hsem1</span>; <span class="id">simpl</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>. <span class="id">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">induction</span> <span class="id">H0</span>; <span class="id">simpl</span> <span class="kwd">in</span> *...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hwt'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.numstreams">numstreams</a></span> <span class="id">x</span> = 1) <span class="kwd">as</span> <span class="id">Hnumstreams</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck_numstreams">sem_exp_ck_numstreams</a></span> <span class="kwd">in</span> <span class="id">H0</span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id">Hnumstreams</span>; <span class="id">simpl</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id">Hnumstreams</span>; <span class="id">simpl</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [? [? <span class="id">H0</span>]]; <span class="id">subst</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hwt'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.numstreams">numstreams</a></span> <span class="id">x1</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">y</span>) <span class="kwd">as</span> <span class="id">Hnumstreams</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck_numstreams">sem_exp_ck_numstreams</a></span> <span class="kwd">in</span> <span class="id">H0</span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Eq">Eq</a></span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> &lt;-<span class="id">Eq</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#firstn_app">firstn_app</a></span>, <span class="id">Hnumstreams</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#firstn_all">firstn_all</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.sub_diag">Nat.sub_diag</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#firstn_O">firstn_O</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> &lt;-<span class="id">Eq</span>, <span class="id"><a href="Velus.Common.CommonList.html#skipn_app">CommonList.skipn_app</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="UCORRECTNESS.combine_for_numstreams_numstreams">combine_for_numstreams_numstreams</a></span> {<span class="id">V</span>} : <span class="kwd">forall</span> <span class="id">es</span> (<span class="id">vs</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.annots">annots</a></span> <span class="id">es</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> '(<span class="id">e</span>, <span class="id">v</span>) =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.numstreams">numstreams</a></span> <span class="id">e</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">v</span>) (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.combine_for_numstreams">combine_for_numstreams</a></span> <span class="id">es</span> <span class="id">vs</span>).<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof with</summary>
<div class="proofscript">
 <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">es</span>; <span class="id">intros</span> <span class="id">vs</span> <span class="id">Hlen</span>; <span class="id">simpl</span> <span class="kwd">in</span> *...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">vs</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">auto</span>; <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_app">length_app</a></span> <span class="kwd">in</span> <span class="id">Hlen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.length_annot_numstreams">length_annot_numstreams</a></span> <span class="kwd">in</span> <span class="id">Hlen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">vs</span>; <span class="id">constructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_firstn">length_firstn</a></span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHes</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_skipn">length_skipn</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="UCORRECTNESS.combine_for_numstreams_proj">combine_for_numstreams_proj</a></span> {<span class="id">V1</span> <span class="id">V2</span>} : <span class="kwd">forall</span> <span class="id">es</span> (<span class="id">v1s</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">V1</span>) (<span class="id">v2s</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">V2</span>) <span class="id">n</span> <span class="id">e</span> <span class="id">v1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">v1s</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">v2s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.combine_for_numstreams">combine_for_numstreams</a></span> <span class="id">es</span> <span class="id">v1s</span>) <span class="id">n</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">e</span>, <span class="id">v1</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">v2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.combine_for_numstreams">combine_for_numstreams</a></span> <span class="id">es</span> <span class="id">v2s</span>) <span class="id">n</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">e</span>, <span class="id">v2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">v1</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">v2</span>.<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">es</span>; <span class="id">intros</span> * <span class="id">Len</span> <span class="id">Nth</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_map">nth_error_map</a></span> <span class="kwd">in</span> *. <span class="id">inv_equalities</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="kwd">exists</span> <span class="id">v2</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">v2s</span> <span class="id">n</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v2</span>) <span class="kwd">as</span> (?&amp;<span class="id">Nth2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">edestruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">v2s</span> <span class="id">n</span>) <span class="id">eqn</span>:<span class="id">Eq</span>; <span class="id">eauto</span>. <span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span> <span class="kwd">in</span> <span class="id">Eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">v1s</span> <span class="id">n</span> &lt;&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) <span class="kwd">as</span> <span class="id">NNone</span> <span class="kwd">by</span> <span class="id">congruence</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_Some">nth_error_Some</a></span> <span class="kwd">in</span> <span class="id">NNone</span>. <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">esplit</span>. <span class="id">rewrite</span> <span class="id">Nth2</span>. <span class="id">simpl</span>. <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">v1s</span>, <span class="id">v2s</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">inv</span> <span class="id">Len</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="id">destruct</span> <span class="id">n</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">inv</span> <span class="id">Nth</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">do</span> 2 <span class="id">esplit</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> 2 <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_firstn">length_firstn</a></span>. <span class="id">simpl</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id">IHes</span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> (?&amp;?); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> 2 <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_skipn">length_skipn</a></span>. <span class="id">simpl</span>. <span class="id">cases</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="UCORRECTNESS.combine_for_numstreams_nth_2">combine_for_numstreams_nth_2</a></span> {<span class="id">V1</span> <span class="id">V2</span>} <span class="id">d1</span> <span class="id">d2</span> : <span class="kwd">forall</span> <span class="id">es</span> (<span class="id">v1s</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">V1</span>) (<span class="id">v2s</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">V2</span>) <span class="id">n</span> <span class="id">n'</span> <span class="id">e</span> <span class="id">v1</span> <span class="id">v2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">v1s</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">v2s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.combine_for_numstreams">combine_for_numstreams</a></span> <span class="id">es</span> <span class="id">v1s</span>) <span class="id">n</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">e</span>, <span class="id">v1</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.combine_for_numstreams">combine_for_numstreams</a></span> <span class="id">es</span> <span class="id">v2s</span>) <span class="id">n</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">e</span>, <span class="id">v2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">n'</span> &lt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">v1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">n'</span> &lt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">v2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id">n'</span> <span class="id">v1</span> <span class="id">d1</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id">n'</span> <span class="id">v2</span> <span class="id">d2</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#combine">combine</a></span> <span class="id">v1s</span> <span class="id">v2s</span>).<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">es</span>; <span class="id">intros</span> * <span class="id">Len</span> <span class="id">Nth1</span> <span class="id">Nth2</span> <span class="id">Len1</span> <span class="id">Len2</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_map">nth_error_map</a></span> <span class="kwd">in</span> *. <span class="id">inv_equalities</span>. <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">n'</span>; <span class="id">try</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_In">nth_error_In</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#combine_nth_error">combine_nth_error</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">v1s</span>, <span class="id">v2s</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">inv</span> <span class="id">Len</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> <span class="id">n</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">inv</span> <span class="id">Nth1</span>; <span class="id">inv</span> <span class="id">Nth2</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> <span class="id">n</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">inv</span> <span class="id">Nth1</span>. <span class="id">inv</span> <span class="id">Nth2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">n'</span> &lt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.numstreams">numstreams</a></span> <span class="id">e</span>) <span class="kwd">as</span> <span class="id">Lt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_firstn">length_firstn</a></span> <span class="kwd">in</span> <span class="id">Len1</span>. <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> ? <span class="id"><a href="Velus.Common.CommonList.html#nth_firstn_1">nth_firstn_1</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">n'</span>; <span class="id">simpl</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="id">rewrite</span> &lt;-<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#combine_nth">combine_nth</a></span>; <span class="id">auto</span>. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_In">nth_In</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_combine">length_combine</a></span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_firstn">length_firstn</a></span> <span class="kwd">in</span> *. <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id">IHes</span> <span class="kwd">in</span> <span class="id">Nth1</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id">rewrite</span> ? <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_skipn">length_skipn</a></span>; <span class="id">simpl</span>; <span class="id">cases</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.numstreams">numstreams</a></span> <span class="id">a</span>); <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">auto</span>. <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In_nth_error">In_nth_error</a></span> <span class="kwd">in</span> <span class="id">Nth1</span> <span class="kwd">as</span> (?&amp;<span class="id">Nth3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#combine_nth_error">combine_nth_error</a></span> <span class="kwd">in</span> <span class="id">Nth3</span> <span class="kwd">as</span> (<span class="id">NthL</span>&amp;<span class="id">NthR</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_skipn">nth_error_skipn</a></span> <span class="kwd">in</span> <span class="id">NthL</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_skipn">nth_error_skipn</a></span> <span class="kwd">in</span> <span class="id">NthR</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_In">nth_error_In</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#combine_nth_error">combine_nth_error</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="UCORRECTNESS.unnest_equation_sem">unnest_equation_sem</a></span> : <span class="kwd">forall</span> <span class="id">H</span> <span class="id">b</span> <span class="id">equ</span> <span class="id">eqs'</span> <span class="id">st</span> <span class="id">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_equation">wc_equation</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">st</span>) <span class="id">equ</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_ck">sem_equation_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H</span> <span class="id">b</span> <span class="id">equ</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H</span> <span class="id">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_equation">unnest_equation</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">equ</span> <span class="id">st</span> = (<span class="id">eqs'</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">exists</span> <span class="id">H'</span>, <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) <span class="id">H</span> <span class="id">H'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H'</span> <span class="id">st'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_ck">sem_equation_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span>) <span class="id">eqs'</span>).<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof with</summary>
<div class="proofscript">
 <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">norm</span> <span class="id">lclocking</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hwt</span> <span class="id">Hsem</span> <span class="id">Histst</span> <span class="id">Hnorm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_equation">unnest_equation</a></span> <span class="kwd">in</span> <span class="id">Hnorm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">equ</span> <span class="kwd">as</span> [<span class="id">xs</span> <span class="id">es</span>]. <span class="id">inv</span> <span class="id">Hwt</span>; <span class="id">inv</span> <span class="id">Hsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;app&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">xs</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">anns</span>) <span class="kwd">as</span> <span class="id">Hlen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall3_length">Forall3_length</a></span> <span class="kwd">in</span> <span class="id">H6</span> <span class="kwd">as</span> (_&amp;<span class="id">Hlen</span>). <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span> <span class="kwd">in</span> <span class="id">Hlen</span>; <span class="id">auto</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_rhss">unnest_rhss</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">inv_bind</span>. <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_exps">unnest_exps</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H12</span>; <span class="id">inv</span> <span class="id">H16</span>. <span class="id">inv</span> <span class="id">H14</span>. <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x</span>) = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="kwd">as</span> <span class="id">Hlength4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mmap2_unnest_exp_length">mmap2_unnest_exp_length</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H5</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span> <span class="kwd">in</span> <span class="id">H5</span>. <span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.length_nclocksof_annots">length_nclocksof_annots</a></span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hun1</span>:=<span class="id">H0</span>). <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_exps_sem">unnest_exps_sem</a></span> <span class="kwd">in</span> <span class="id">H0</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">H'</span> [<span class="id">Href1</span> [<span class="id">Histst1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1'</span>]]]].<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hun2</span>:=<span class="id">H1</span>). <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_noops_exps_sem">unnest_noops_exps_sem</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> (<span class="id">H''</span>&amp;<span class="id">Href2</span>&amp;<span class="id">Histst2</span>&amp;<span class="id">Hsem2</span>&amp;<span class="id">Hsem2'</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3:{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.mmap2_normalized_lexp">mmap2_normalized_lexp</a></span> <span class="kwd">in</span> <span class="id">Hun1</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4:<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.find_node_incks">find_node_incks</a></span>. <span class="id">rewrite</span> <span class="id">H4</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span>; <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap2_unnest_exp_wc">mmap2_unnest_exp_wc</a></span>. 1,3:<span class="id">eauto</span>. <span class="id">simpl_Forall</span>; <span class="id">repeat</span> <span class="id">solve_incl</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">rs</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">er</span>) <span class="kwd">as</span> <span class="id">Hlen3</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H21</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">er</span> <span class="id">sr</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck">sem_exp_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H''</span> <span class="id">b</span> <span class="id">er</span> <span class="id">sr</span>) <span class="id">er</span> <span class="id">rs</span>) <span class="kwd">as</span> <span class="id">Hsemr'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">by</span> (<span class="id">simpl_Forall</span>; <span class="id">repeat</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>; <span class="id">eauto</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hl</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.numstreams">numstreams</a></span> <span class="id">e</span> = 1) <span class="id">er</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;-<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.length_clockof_numstreams">length_clockof_numstreams</a></span>, <span class="id">H1</span>; <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hr</span>:=<span class="id">H9</span>). <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_resets_sem">unnest_resets_sem</a></span> <span class="kwd">in</span> <span class="id">H9</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:(<span class="id">simpl_Forall</span>; <span class="id">repeat</span> <span class="id">solve_incl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">assert</span> (<span class="kwd">exists</span> <span class="id">r</span>, <span class="id">rs</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; [<span class="id">x</span>]) <span class="id">r</span>) <span class="kwd">as</span> (<span class="id">r</span> &amp; ?); <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">clear</span> - <span class="id">H3</span> <span class="id">Hsemr'</span> <span class="id">Hl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore1">Forall2_ignore1</a></span> <span class="kwd">in</span> <span class="id">Hsemr'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">rs</span>; <span class="id">intros</span>. <span class="kwd">exists</span> []; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id">IHrs</span> <span class="kwd">as</span> (?&amp;?); <span class="id">subst</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_ck_numstreams">sem_exp_ck_numstreams</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> <span class="id">Num</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hl</span> <span class="kwd">in</span> <span class="id">Num</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">singleton_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span> (_::_); <span class="id">simpl</span>; <span class="id">f_equal</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#concat_map_singl1">concat_map_singl1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_exp_sem">unnest_exp_sem</a></span> <span class="kwd">in</span> <span class="id">H16</span> <span class="kwd">as</span> (<span class="id">H'''</span>&amp;?&amp;?&amp;<span class="id">Sem1</span>&amp;?)... <span class="id">inv</span> <span class="id">Sem1</span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H9</span> <span class="kwd">as</span> (<span class="id">H'''</span>&amp;<span class="id">Href3</span>&amp;<span class="id">Hhistst3</span>&amp;<span class="id">Hsem3</span>&amp;<span class="id">Hsem3'</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H'''</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">auto</span>). 2:<span class="id">repeat</span> <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_app">Forall_app</a></span>; <span class="id">repeat</span> <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id">destruct</span> <span class="id">xs</span>; <span class="id">repeat</span> <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">repeat</span> (<span class="id">etransitivity</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">econstructor</span>. <span class="id">econstructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.Sapp">Sapp</a></span> <span class="kwd">with</span> (<span class="id">ss</span>:=(<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; [<span class="id">x</span>]) <span class="id">x</span>) <span class="id">ss</span>))) (<span class="id">rs</span>:=<span class="id">rs</span>) (<span class="id">bs</span>:=<span class="id">bs</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">rewrite</span> &lt;- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat_map">concat_map</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_map_2">Forall2_map_2</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>. <span class="id">repeat</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#concat_map_singl2">concat_map_singl2</a></span>. <span class="id">intros</span> <span class="id">k</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.HGref">HGref</a></span>, <span class="id">H23</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">simpl</span>; <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#firstn_all2">firstn_all2</a></span>; [|<span class="id">rewrite</span> <span class="id">Hlen</span>; <span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.sem_var_refines">sem_var_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#skipn_all2">skipn_all2</a></span>; [|<span class="id">rewrite</span> <span class="id">Hlen</span>; <span class="id">reflexivity</span>]; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_refines">sem_equation_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_refines">sem_equation_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_equation_refines">sem_equation_refines</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;general&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.annots">annots</a></span> <span class="id">x</span> = <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.annots">annots</a></span> <span class="id">es</span>) <span class="kwd">as</span> <span class="id">Hannots</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_rhss_annots">unnest_rhss_annots</a></span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hun</span>:=<span class="id">H2</span>). <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_rhss_sem">unnest_rhss_sem</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> (<span class="id">H'</span>&amp;<span class="id">Href1</span>&amp;<span class="id">Histst1</span>&amp;<span class="id">Hsem1</span>&amp;<span class="id">Hsem1'</span>)...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H'</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_app">Forall_app</a></span>. <span class="id">split</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">ss</span>) = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.annots">annots</a></span> <span class="id">es</span>)) <span class="kwd">as</span> <span class="id">Hlen1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exps_ck_numstreams">sem_exps_ck_numstreams</a></span> <span class="kwd">in</span> <span class="id">H7</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">xs</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.annots">annots</a></span> <span class="id">x</span>)) <span class="kwd">as</span> <span class="id">Hlen2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">rewrite</span> <span class="id">Hannots</span>, &lt;-<span class="id">Hlen1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite_Forall_forall</span>. <span class="id">simpl_length</span>. <span class="id">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In_nth_error">In_nth_error</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> (?&amp;<span class="id">Nth</span>). <span class="id">assert</span> (<span class="id">Nth1</span>:=<span class="id">Nth</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.combine_for_numstreams_proj">combine_for_numstreams_proj</a></span> <span class="kwd">with</span> (<span class="id">v2s</span>:=<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">ss</span>) <span class="kwd">in</span> <span class="id">Nth</span> <span class="kwd">as</span> (?&amp;<span class="id">Nth2</span>&amp;<span class="id">L</span>); [|<span class="id">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_In">nth_error_In</a></span> <span class="kwd">in</span> <span class="id">Nth2</span> <span class="kwd">as</span> <span class="id">In2</span>. <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">repeat</span> <span class="id">constructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_forall2">Forall2_forall2</a></span>. <span class="id">split</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">N</span> <span class="id">Nth3</span> <span class="id">Nth4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_combine">Forall2_combine</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H8</span>. <span class="id">instantiate</span> (1:=(_, _)) <span class="kwd">in</span> <span class="id">H8</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.sem_var_refines">sem_var_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.combine_for_numstreams_nth_2">combine_for_numstreams_nth_2</a></span>; <span class="id">eauto</span>. 1,2:<span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="UCORRECTNESS.hist_st_mask">hist_st_mask</a></span> {<span class="id">pref</span>} : <span class="kwd">forall</span> <span class="id">vars</span> <span class="id">bs</span> <span class="id">H</span> (<span class="id">st</span>: <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.fresh_st">fresh_st</a></span> <span class="id">pref</span> _) <span class="id">r</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id">vars</span> <span class="id">bs</span> <span class="id">H</span> <span class="id">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id">vars</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.maskb">maskb</a></span> <span class="id">k</span> <span class="id">r</span> <span class="id">bs</span>) (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.mask_hist">mask_hist</a></span> <span class="id">k</span> <span class="id">r</span> <span class="id">H</span>) <span class="id">st</span>.<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * (?&amp;?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.dom_map">dom_map</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sc_vars_mask">LCS.sc_vars_mask</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="UCORRECTNESS.hist_st_unmask">hist_st_unmask</a></span> {<span class="id">pref</span>} : <span class="kwd">forall</span> <span class="id">vars</span> <span class="id">bs</span> <span class="id">H</span> (<span class="id">st</span>: <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.fresh_st">fresh_st</a></span> <span class="id">pref</span> _) <span class="id">r</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">k</span>, <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id">vars</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.maskb">maskb</a></span> <span class="id">k</span> <span class="id">r</span> <span class="id">bs</span>) (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.mask_hist">mask_hist</a></span> <span class="id">k</span> <span class="id">r</span> <span class="id">H</span>) <span class="id">st</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id">vars</span> <span class="id">bs</span> <span class="id">H</span> <span class="id">st</span>.<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hk</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.dom_map">dom_map</a></span>. <span class="id">eapply</span> (<span class="id">Hk</span> 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sc_vars_unmask">sc_vars_unmask</a></span>. <span class="id">intros</span>. <span class="id">eapply</span> <span class="id">Hk</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="UCORRECTNESS.mmap_unnest_block_sem">mmap_unnest_block_sem</a></span> : <span class="kwd">forall</span> <span class="id">b</span> <span class="id">blocks</span> <span class="id">H</span> <span class="id">blocks'</span> <span class="id">st</span> <span class="id">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">d</span> : <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.block">block</a></span> =&gt; <span class="kwd">forall</span> <span class="id">H</span> <span class="id">b</span> <span class="id">blocks'</span> <span class="id">st</span> <span class="id">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_block">wc_block</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> ++ <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">st</span>) <span class="id">d</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_block_ck">sem_block_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H</span> <span class="id">b</span> <span class="id">d</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H</span> <span class="id">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_block">unnest_block</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">d</span> <span class="id">st</span> = (<span class="id">blocks'</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H'</span> : <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.t">FEnv.t</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux.svalue">svalue</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> (<span class="id">A</span>:=<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux.svalue">svalue</a></span>)) <span class="id">H</span> <span class="id">H'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H'</span> <span class="id">st'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_block_ck">sem_block_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span>) <span class="id">blocks'</span>) <span class="id">blocks</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_block">wc_block</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> ++ <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">st</span>)) <span class="id">blocks</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_block_ck">sem_block_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H</span> <span class="id">b</span>) <span class="id">blocks</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H</span> <span class="id">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.mmap">mmap</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_block">unnest_block</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span>) <span class="id">blocks</span> <span class="id">st</span> = (<span class="id">blocks'</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">exists</span> <span class="id">H'</span>, <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) <span class="id">H</span> <span class="id">H'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H'</span> <span class="id">st'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_block_ck">sem_block_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">blocks'</span>)).<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof with</summary>
<div class="proofscript">
 <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">blocks</span>; <span class="id">intros</span> * <span class="id">Hf</span> <span class="id">Hwc</span> <span class="id">Hsem</span> <span class="id">Histst</span> <span class="id">Hnorm</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hf</span>; <span class="id">inv</span> <span class="id">Hwc</span>; <span class="id">inv</span> <span class="id">Hsem</span>; <span class="id">repeat</span> <span class="id">inv_bind</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="kwd">exists</span> <span class="id">H</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">auto</span>). <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_block">wc_block</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> ++ <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">x0</span>)) <span class="id">blocks</span>) <span class="kwd">as</span> <span class="id">Hwc'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">simpl_Forall</span>. <span class="id">repeat</span> <span class="id">solve_incl</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> (<span class="id">H'</span>&amp;<span class="id">Href1</span>&amp;<span class="id">Histst1</span>&amp;<span class="id">Hsem1</span>)...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_block_ck">sem_block_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H'</span> <span class="id">b</span>) <span class="id">blocks</span>) <span class="kwd">by</span> (<span class="id">simpl_Forall</span>; <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_block_refines">sem_block_refines</a></span>; <span class="id">eauto</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">IHblocks</span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> (<span class="id">H''</span>&amp;<span class="id">Href2</span>&amp;<span class="id">Histst2</span>&amp;<span class="id">Hsem2</span>)...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H''</span>. <span class="id">split</span>;[|<span class="id">split</span>]...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etransitivity</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_app">Forall_app</a></span>. <span class="id">split</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_block_refines">sem_block_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="UCORRECTNESS.unnest_block_sem">unnest_block_sem</a></span> : <span class="kwd">forall</span> <span class="id">d</span> <span class="id">H</span> <span class="id">b</span> <span class="id">blocks'</span> <span class="id">st</span> <span class="id">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_block">wc_block</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">st</span>) <span class="id">d</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_block_ck">sem_block_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H</span> <span class="id">b</span> <span class="id">d</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H</span> <span class="id">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_block">unnest_block</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">d</span> <span class="id">st</span> = (<span class="id">blocks'</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">exists</span> <span class="id">H'</span>, <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) <span class="id">H</span> <span class="id">H'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H'</span> <span class="id">st'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_block_ck">sem_block_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span>) <span class="id">blocks'</span>).<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof with</summary>
<div class="proofscript">
 <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">d</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.block_ind2">block_ind2</a></span>; <span class="id">intros</span> * <span class="id">Hwc</span> <span class="id">Hsem</span> <span class="id">Histst</span> <span class="id">Hnorm</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hwc</span>; <span class="id">inv</span> <span class="id">Hsem</span>; <span class="id">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;Equation&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_equation_sem">unnest_equation_sem</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> (<span class="id">H'</span>&amp;?&amp;?&amp;?); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H'</span>. <span class="id">split</span>;[|<span class="id">split</span>]; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;last&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_exp_length">unnest_exp_length</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> <span class="id">Len</span>; <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">lclocking</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;-<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.length_clockof_numstreams">length_clockof_numstreams</a></span>, <span class="id">H6</span> <span class="kwd">in</span> <span class="id">Len</span>. <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">singleton_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_exp_sem">unnest_exp_sem</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> (<span class="id">H'</span>&amp;?&amp;?&amp;?&amp;?); <span class="id">eauto</span>. <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H'</span>. <span class="id">split</span>; [|<span class="id">split</span>]; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; [|<span class="id">simpl_Forall</span>]; <span class="id">econstructor</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.sem_var_refines">sem_var_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;Reset&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="kwd">forall</span> <span class="id">k</span>, <span class="kwd">exists</span> <span class="id">H'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.mask_hist">CStr.mask_hist</a></span> <span class="id">k</span> <span class="id">r</span> <span class="id">H0</span>) (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.mask_hist">CStr.mask_hist</a></span> <span class="id">k</span> <span class="id">r</span> <span class="id">H'</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.maskb">maskb</a></span> <span class="id">k</span> <span class="id">r</span> <span class="id">b</span>) (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.mask_hist">mask_hist</a></span> <span class="id">k</span> <span class="id">r</span> <span class="id">H'</span>) <span class="id">x0</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_block_ck">sem_block_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.mask_hist">mask_hist</a></span> <span class="id">k</span> <span class="id">r</span> <span class="id">H'</span>) (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.maskb">maskb</a></span> <span class="id">k</span> <span class="id">r</span> <span class="id">b</span>)) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x</span>)) <span class="kwd">as</span> <span class="id">Hbck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">intros</span> <span class="id">k</span>. <span class="id">specialize</span> (<span class="id">H11</span> <span class="id">k</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap_unnest_block_sem">mmap_unnest_block_sem</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> (<span class="id">H'</span>&amp;<span class="id">Href1</span>&amp;<span class="id">Histst1</span>&amp;<span class="id">Hsem1</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st_mask">hist_st_mask</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Histst1</span> <span class="kwd">as</span> (<span class="id">Hdom1</span>&amp;<span class="id">Hsc1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.Equiv">FEnv.Equiv</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) <span class="id">H'</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.mask_hist">CStr.mask_hist</a></span> <span class="id">k</span> <span class="id">r</span> <span class="id">H'</span>)) <span class="kwd">as</span> <span class="id">Heqmask</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.st_ids">st_ids</a></span> <span class="kwd">in</span> <span class="id">Hdom1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.slower_mask_hist">slower_mask_hist</a></span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sc_vars_slower_hist">sc_vars_slower_hist</a></span> <span class="kwd">in</span> <span class="id">Hsc1</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.dom_dom_ub">dom_dom_ub</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H'</span>. <span class="id">split</span>; [|<span class="id">split</span>; [<span class="id">split</span>|]]; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1:<span class="id">rewrite</span> &lt;-<span class="id">Heqmask</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.dom_map">dom_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.mask_hist">mask_hist</a></span>. <span class="id">simpl</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sc_vars_morph">sc_vars_morph</a></span>. 1,3,4:<span class="id">eauto</span>; <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">Heqmask</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">simpl_Forall</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_block_ck_morph">sem_block_ck_morph</a></span>; <span class="id">eauto</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.consolidate_mask_hist">consolidate_mask_hist</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id">P</span> := <span class="kwd">fun</span> <span class="id">k</span> <span class="id">H'k</span> =&gt; <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.mask_hist">CStr.mask_hist</a></span> <span class="id">k</span> <span class="id">r</span> <span class="id">H0</span>) <span class="id">H'k</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.maskb">maskb</a></span> <span class="id">k</span> <span class="id">r</span> <span class="id">b</span>) <span class="id">H'k</span> <span class="id">x0</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_block_ck">sem_block_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'k</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.maskb">maskb</a></span> <span class="id">k</span> <span class="id">r</span> <span class="id">b</span>)) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span> <span class="id">Hbck</span> <span class="kwd">as</span> (<span class="id">H'</span>&amp;<span class="id">HH'</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">intros</span> ????? <span class="id">Heq</span> (?&amp;(?&amp;<span class="id">Hsc1</span>)&amp;?); <span class="id">subst</span>. <span class="id">split</span>; [|<span class="id">split</span>; [<span class="id">split</span>|]]; <span class="id">intros</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id">split</span>; <span class="id">intros</span> ?. 1-3:<span class="id">rewrite</span> &lt;-<span class="id">Heq</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="id">eapply</span> <span class="id">H9</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sc_vars_morph">sc_vars_morph</a></span>; <span class="id">eauto</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">simpl_Forall</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_block_ck_morph">sem_block_ck_morph</a></span>; <span class="id">eauto</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">intros</span> ?? (_&amp;(<span class="id">Hdom1</span>&amp;_)&amp;_); <span class="id">simpl</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.dom_fenv_dom">dom_fenv_dom</a></span>; <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) <span class="id">H0</span> <span class="id">H'</span>) <span class="kwd">as</span> <span class="id">Href1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.refines_unmask">refines_unmask</a></span>; <span class="id">intros</span>. <span class="id">eapply</span> <span class="id">HH'</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_reset_sem">unnest_reset_sem</a></span> <span class="kwd">with</span> (<span class="id">H</span>:=<span class="id">H'</span>) <span class="kwd">in</span> <span class="id">H2</span> <span class="kwd">as</span> (<span class="id">H''</span>&amp;<span class="id">Href2</span>&amp;<span class="id">Histst2</span>&amp;<span class="id">Hsem2</span>&amp;<span class="id">Hsem2'</span>)...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3:(<span class="id">simpl_Forall</span>; <span class="id">repeat</span> <span class="id">solve_incl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3:<span class="id">now</span> <span class="id">rewrite</span> &lt;-<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.length_clockof_numstreams">length_clockof_numstreams</a></span>, <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3:(<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3:{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st_unmask">hist_st_unmask</a></span>; <span class="id">intros</span>. <span class="id">eapply</span> <span class="id">HH'</span>; <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">intros</span> * <span class="id">Hun</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_exp_sem">unnest_exp_sem</a></span> <span class="kwd">with</span> (<span class="id">H</span>:=<span class="id">H'</span>) (<span class="id">vs</span>:=[<span class="id">sr</span>]) <span class="kwd">in</span> <span class="id">Hun</span> <span class="kwd">as</span> (<span class="id">H''</span>&amp;<span class="id">Href'</span>&amp;<span class="id">Histst'</span>&amp;<span class="id">Hsem'</span>&amp;<span class="id">Hsem''</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H''</span>. <span class="id">split</span>;[|<span class="id">split</span>;[|<span class="id">split</span>]]; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsem'</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">solve_incl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_exp_refines">sem_exp_refines</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st_unmask">hist_st_unmask</a></span>; <span class="id">intros</span>. <span class="id">eapply</span> <span class="id">HH'</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">H''</span>. <span class="id">split</span>;[|<span class="id">split</span>]; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etransitivity</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_app">Forall_app</a></span>. <span class="id">split</span>; <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">econstructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">k</span>. <span class="id">constructor</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">HH'</span> <span class="id">k</span>) <span class="kwd">as</span> (_&amp;_&amp;<span class="id">Hsem'</span>). <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_block_refines">sem_block_refines</a></span>; [|<span class="id">eauto</span>]. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.refines_mask">refines_mask</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">constructor</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="kwd">exists</span> <span class="id">H0</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">auto</span>). <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">eauto</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_ref_sem_block">sem_ref_sem_block</a></span>; <span class="id">eauto</span>. <span class="id">econstructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="kwd">exists</span> <span class="id">H0</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">auto</span>). <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">eauto</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_ref_sem_block">sem_ref_sem_block</a></span>; <span class="id">eauto</span>. <span class="id">econstructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="kwd">exists</span> <span class="id">H0</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">auto</span>). <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">eauto</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_ref_sem_block">sem_ref_sem_block</a></span>; <span class="id">eauto</span>. <span class="id">econstructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="kwd">exists</span> <span class="id">H0</span>. <span class="id">repeat</span> (<span class="id">split</span>; <span class="id">auto</span>). <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">eauto</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_ref_sem_block">sem_ref_sem_block</a></span>; <span class="id">eauto</span>. <span class="id">econstructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="UCORRECTNESS.unnest_blocks_sem">unnest_blocks_sem</a></span> : <span class="kwd">forall</span> <span class="id">b</span> <span class="id">blocks</span> <span class="id">H</span> <span class="id">blocks'</span> <span class="id">st</span> <span class="id">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_block">wc_block</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> ++ <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span> <span class="id">st</span>)) <span class="id">blocks</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_block_ck">sem_block_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">H</span> <span class="id">b</span>) <span class="id">blocks</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H</span> <span class="id">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_blocks">unnest_blocks</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">blocks</span> <span class="id">st</span> = (<span class="id">blocks'</span>, <span class="id">st'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">exists</span> <span class="id">H'</span>, <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.refines">FEnv.refines</a></span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> _) <span class="id">H</span> <span class="id">H'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem.vars">vars</a></span> <span class="id">b</span> <span class="id">H'</span> <span class="id">st'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_block_ck">sem_block_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span> <span class="id">H'</span> <span class="id">b</span>) <span class="id">blocks'</span>).<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof with</summary>
<div class="proofscript">
 <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hwc</span> <span class="id">Hsem</span> <span class="id">Histst</span> <span class="id">Hnorm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_blocks">unnest_blocks</a></span> <span class="kwd">in</span> <span class="id">Hnorm</span>. <span class="id">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.mmap_unnest_block_sem">mmap_unnest_block_sem</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_block_sem">unnest_block_sem</a></span> <span class="kwd">in</span> <span class="id">H6</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.unnest_block_sem">unnest_block_sem</a></span>.<br/>
<br/>
<h3> Preservation of sem_node </h3>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="UCORRECTNESS.unnest_node_sem">unnest_node_sem</a></span> : <span class="kwd">forall</span> <span class="id">f</span> <span class="id">n</span> <span class="id">ins</span> <span class="id">outs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_global">wc_global</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.Global">Global</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span>.(<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.types">types</a></span>) <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span>.(<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.externs">externs</a></span>) (<span class="id">n</span>::<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span>.(<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.nodes">nodes</a></span>))) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ord.Ordered_nodes">Ordered_nodes</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.Global">Global</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span>.(<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.types">types</a></span>) <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span>.(<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.externs">externs</a></span>) (<span class="id">n</span>::<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span>.(<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.nodes">nodes</a></span>))) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ord.Ordered_nodes">Ordered_nodes</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.Global">Global</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span>.(<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.types">types</a></span>) <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span>.(<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.externs">externs</a></span>) ((<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_node">unnest_node</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">n</span>)::<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span>.(<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.nodes">nodes</a></span>))) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_node_ck">sem_node_ck</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.Global">Global</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span>.(<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.types">types</a></span>) <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span>.(<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.externs">externs</a></span>) (<span class="id">n</span>::<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span>.(<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.nodes">nodes</a></span>))) <span class="id">f</span> <span class="id">ins</span> <span class="id">outs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_node_ck">sem_node_ck</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.Global">Global</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span>.(<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.types">types</a></span>) <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span>.(<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.externs">externs</a></span>) ((<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_node">unnest_node</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">n</span>)::<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span>.(<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.nodes">nodes</a></span>))) <span class="id">f</span> <span class="id">ins</span> <span class="id">outs</span>.<br/>
<details>
&nbsp;&nbsp;&nbsp;&nbsp;<summary class="toggleproof">Proof with</summary>
<div class="proofscript">
 <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">HwcG</span> <span class="id">Hord1</span> <span class="id">Hord2</span> <span class="id">Hsem</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsem</span>; <span class="id">rename</span> <span class="id">H0</span> <span class="id">into</span> <span class="id">Hfind</span>; <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hfind</span>. <span class="id">destruct</span> (<span class="id"><a href="Velus.Common.Common.html#ident_eq_dec">ident_eq_dec</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.n_name">n_name</a></span> <span class="id">n</span>) <span class="id">f</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">erewrite</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.find_node_now">find_node_now</a></span> <span class="kwd">in</span> <span class="id">Hfind</span>; <span class="id">eauto</span>. <span class="id">inv</span> <span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*The&nbsp;semantics&nbsp;of&nbsp;equations&nbsp;can&nbsp;be&nbsp;given&nbsp;according&nbsp;to&nbsp;G&nbsp;only&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (~<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ord.Is_node_in_block">Is_node_in_block</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.n_name">n_name</a></span> <span class="id">n0</span>) (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.n_block">n_block</a></span> <span class="id">n0</span>)) <span class="kwd">as</span> <span class="id">Blk</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">Hord1</span>. <span class="id">destruct</span> <span class="id">H6</span> <span class="kwd">as</span> (<span class="id">Hisin</span>&amp;_). <span class="id">intro</span> <span class="id">contra</span>. <span class="id">eapply</span> <span class="id">Hisin</span> <span class="kwd">in</span> <span class="id">contra</span> <span class="kwd">as</span> [? _]; <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_block_ck_cons1">sem_block_ck_cons1</a></span> <span class="kwd">in</span> <span class="id">Blk</span>; <span class="id">eauto</span>. <span class="id">clear</span> <span class="id">H3</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">HwcG</span>. <span class="id">take</span> (_ /\ _) <span class="id">and</span> <span class="id">destruct</span> <span class="id">it</span> <span class="kwd">as</span> (<span class="id">Hwc</span>&amp;_). <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">replace</span> {| <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.types">types</a></span> := <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.types">types</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span>; <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.nodes">nodes</a></span> := <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.nodes">nodes</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> |} <span class="kwd">with</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="kwd">in</span> <span class="id">Blk</span>, <span class="id">Hwc</span> <span class="kwd">by</span> (<span class="id">destruct</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span>; <span class="id">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_node">unnest_node</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> <span class="id">n0</span>) <span class="kwd">as</span> <span class="id">n'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_node">unnest_node</a></span> <span class="kwd">in</span> <span class="id">Heqn'</span>; <span class="id">inv</span> <span class="id">Heqn'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.n_nodup">n_nodup</a></span> <span class="id">n0</span>) <span class="kwd">as</span> (<span class="id">Hnd1</span>&amp;<span class="id">Hnd2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.n_good">n_good</a></span> <span class="id">n0</span>) <span class="kwd">as</span> (<span class="id">Hgood1</span>&amp;<span class="id">Hgood2</span>&amp;_).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.n_syn">n_syn</a></span> <span class="id">n0</span>) <span class="kwd">as</span> <span class="id">Hsyn</span>. <span class="id">inversion_clear</span> <span class="id">Hsyn</span> <span class="kwd">as</span> [?? <span class="id">Hsyn2</span> _]. <span class="id">inv</span> <span class="id">Hsyn2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;-<span class="id">H0</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">Blk</span>. <span class="id">inv_scope</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">repeat</span> <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion_clear</span> <span class="id">Hwc</span> <span class="kwd">as</span> [? _ _ <span class="id">Hwc'</span>]. <span class="id">rewrite</span> &lt;-<span class="id">H0</span> <span class="kwd">in</span> <span class="id">Hwc'</span>. <span class="id">inv</span> <span class="id">Hwc'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">inv_scope'</span>. <span class="id">subst</span> <span class="id">Γ'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_block_ck">sem_block_ck</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span> (<span class="id">H</span> + <span class="id">Hi'</span>) (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr.clocks_of">clocks_of</a></span> <span class="id">ins</span>)) <span class="id">blks</span>) <span class="kwd">as</span> <span class="id">Hsem</span> <span class="kwd">by</span> <span class="id">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_blocks_sem">unnest_blocks_sem</a></span> <span class="kwd">with</span> (<span class="id">vars</span>:=<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.senv_of_ins">senv_of_ins</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.n_in">n_in</a></span> <span class="id">n0</span>) ++ <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.senv_of_decls">senv_of_decls</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.n_out">n_out</a></span> <span class="id">n0</span>) ++ <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.senv_of_decls">senv_of_decls</a></span> <span class="id">locs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span> <span class="id">Hsem</span> <span class="kwd">as</span> (<span class="id">Hf</span>&amp;<span class="id">Href</span>&amp;(<span class="id">Hdom</span>&amp;<span class="id">Hsc</span>)&amp;<span class="id">Hsem</span>); <span class="id">eauto</span>. 5:<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#surjective_pairing">surjective_pairing</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">inv</span> <span class="id">Hgood2</span>. <span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.GoodLocalsScope">GoodLocalsScope</a></span> _ _ _) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_app">Forall_app</a></span>; <span class="id">split</span>; <span class="id">simpl_Forall</span>; <span class="id">simpl_In</span>; <span class="id">simpl_Forall</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hgood1</span>; <span class="id">eauto</span>. <span class="id">rewrite</span> &lt;-<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.map_fst_senv_of_ins">map_fst_senv_of_ins</a></span>, &lt;-<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.map_fst_senv_of_decls">map_fst_senv_of_decls</a></span>, &lt;-<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>. <span class="id">solve_In</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span>. <span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.init_st_anns">init_st_anns</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.clocked_node">clocked_node</a></span> _ _ _) <span class="id">and</span> <span class="id">destruct</span> <span class="id">it</span> <span class="kwd">as</span> (<span class="id">Hdom</span>&amp;<span class="id">Hsc</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span>. <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.init_st_anns">init_st_anns</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.local_hist_dom">local_hist_dom</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv">st_senv</a></span>. <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.init_st_anns">init_st_anns</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.local_hist_sc_vars">local_hist_sc_vars</a></span> <span class="kwd">with</span> (<span class="id">H</span>:=<span class="id">H</span>); <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem.dom_dom_ub">dom_dom_ub</a></span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hnd2</span>. <span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.NoDupScope">NoDupScope</a></span> _ _ _) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> ?? <span class="id">contra</span>; <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.IsVar_fst">IsVar_fst</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>, <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.map_fst_senv_of_ins">map_fst_senv_of_ins</a></span>, <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.map_fst_senv_of_decls">map_fst_senv_of_decls</a></span> <span class="kwd">in</span> <span class="id">contra</span>. <span class="id">eapply</span> <span class="id">H15</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Href'</span>:=<span class="id">Href</span>). <span class="id">eapply</span> <span class="id"><a href="Velus.FunctionalEnvironment.html#FEnv.union_refines_inv">FEnv.union_refines_inv</a></span> <span class="kwd">in</span> <span class="id">Href'</span> <span class="kwd">as</span> (<span class="id">Hi''</span>&amp;<span class="id">Heq</span>&amp;<span class="id">Href'</span>&amp;<span class="id">Hdom'</span>); <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Common.CommonStreams.html#EqStrel_Reflexive">EqStrel_Reflexive</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">intros</span> * <span class="id">Hin</span> <span class="id">Hin2</span>. <span class="id">destruct</span> <span class="id">x</span>; <span class="id">apply</span> <span class="id">H4</span> <span class="kwd">in</span> <span class="id">Hin</span>; <span class="id">apply</span> <span class="id">H8</span> <span class="kwd">in</span> <span class="id">Hin2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hnd2</span>. <span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.NoDupScope">NoDupScope</a></span> _ _ _) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="Velus.Common.CommonList.html#InMembers">InMembers</a></span> <span class="id">x</span> <span class="id">locs</span> -&gt; ~ _) <span class="id">and</span> <span class="id">eapply</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.IsVar_senv_of_decls">IsVar_senv_of_decls</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.IsVar_fst">IsVar_fst</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>, <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.map_fst_senv_of_ins">map_fst_senv_of_ins</a></span>, <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.map_fst_senv_of_decls">map_fst_senv_of_decls</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hnd2</span>. <span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.NoDupScope">NoDupScope</a></span> _ _ _) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="Velus.Common.CommonList.html#InMembers">InMembers</a></span> <span class="id">x</span> <span class="id">locs</span> -&gt; ~ _) <span class="id">and</span> <span class="id">eapply</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.IsLast_senv_of_decls">IsLast_senv_of_decls</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">Hin</span>. <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.map_fst_senv_of_ins">map_fst_senv_of_ins</a></span>, &lt;- <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.map_fst_senv_of_decls">map_fst_senv_of_decls</a></span>, &lt;-<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>. <span class="id">solve_In</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.Snode">Snode</a></span> <span class="kwd">with</span> (<span class="id">H</span>:=<span class="id">H</span>); <span class="id">simpl</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">erewrite</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.find_node_now">find_node_now</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_block_ck_cons2">sem_block_ck_cons2</a></span>; <span class="id">simpl</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ord.find_node_not_Is_node_in">find_node_not_Is_node_in</a></span> <span class="kwd">in</span> <span class="id">Hord2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id">erewrite</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.find_node_now">find_node_now</a></span>; <span class="id">eauto</span>. <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;-<span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> 2 <span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3:<span class="id">destruct</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span>; <span class="id">simpl_Forall</span>; <span class="id">rewrite</span> <span class="id">Heq</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*{ <span class="id">destruct</span> <span class="id">Hdom</span> <span class="kwd">as</span> (<span class="id">D1</span>&amp;<span class="id">DL1</span>). <span class="id">destruct</span> <span class="id">H4</span> <span class="kwd">as</span> ((<span class="id">D2</span>&amp;<span class="id">DL2</span>)&amp;_).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; <span class="id">intros</span> *; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id">Hdom'</span>, <span class="id">D1</span>, <span class="id">D2</span>. <span class="id">setoid_rewrite</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.senv_of_decls_app">senv_of_decls_app</a></span>. <span class="id">rewrite</span> &lt;-<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv_senv_of_decls">st_senv_senv_of_decls</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.IsVar_app">IsVar_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; [<span class="id">intros</span> ([[<span class="id">In</span>|[<span class="id">In</span>|<span class="id">In</span>]]|<span class="id">In</span>]&amp;<span class="id">Hnin</span>)|<span class="id">intros</span> [<span class="id">In</span>|<span class="id">In</span>]]; <span class="id">try</span> <span class="id">congruence</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exfalso</span>. <span class="id">eapply</span> <span class="id">Hnin</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exfalso</span>. <span class="id">eapply</span> <span class="id">Hnin</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">split</span>; <span class="id">auto</span>. <span class="id">intros</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hnd2</span>. <span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.NoDupScope">NoDupScope</a></span> _ _ _) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">H15</span>; <span class="id">eauto</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.IsVar_senv_of_decls">IsVar_senv_of_decls</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> 2 <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.IsVar_fst">IsVar_fst</a></span>, <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.map_fst_senv_of_ins">map_fst_senv_of_ins</a></span>, <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.map_fst_senv_of_decls">map_fst_senv_of_decls</a></span>, &lt;-<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span> <span class="kwd">in</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">split</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">contra</span>. <span class="id">rewrite</span> 2 <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.IsVar_fst">IsVar_fst</a></span>, <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.map_fst_senv_of_ins">map_fst_senv_of_ins</a></span>, <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.map_fst_senv_of_decls">map_fst_senv_of_decls</a></span>, &lt;-<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span> <span class="kwd">in</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">In</span>. <span class="id">simpl_In</span>. <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.Facts.st_valid_AtomOrGensym_nIn">Facts.st_valid_AtomOrGensym_nIn</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.norm1_not_in_local_prefs">norm1_not_in_local_prefs</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.st_ids">st_ids</a></span>. <span class="id">solve_In</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id">Hdom'</span>, <span class="id">DL1</span>, <span class="id">DL2</span>. <span class="id">setoid_rewrite</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.senv_of_decls_app">senv_of_decls_app</a></span>. <span class="id">rewrite</span> &lt;-<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv_senv_of_decls">st_senv_senv_of_decls</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.IsLast_app">IsLast_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; [<span class="id">intros</span> ([[<span class="id">In</span>|[<span class="id">In</span>|<span class="id">In</span>]]|<span class="id">In</span>]&amp;<span class="id">Hnin</span>)|<span class="id">intros</span> [<span class="id">In</span>|<span class="id">In</span>]]; <span class="id">try</span> <span class="id">congruence</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exfalso</span>. <span class="id">eapply</span> <span class="id">Hnin</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exfalso</span>. <span class="id">eapply</span> <span class="id">Hnin</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">split</span>; <span class="id">auto</span>. <span class="id">intros</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hnd2</span>. <span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.NoDupScope">NoDupScope</a></span> _ _ _) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">H15</span>; <span class="id">eauto</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.IsLast_senv_of_decls">IsLast_senv_of_decls</a></span>; <span class="id">eauto</span>. <span class="id">rewrite</span> &lt;-<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.IsLast_app">IsLast_app</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">contra</span>. <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.map_fst_senv_of_ins">map_fst_senv_of_ins</a></span>, &lt;- <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.map_fst_senv_of_decls">map_fst_senv_of_decls</a></span>, &lt;-<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>. <span class="id">solve_In</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">split</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">contra</span>. <span class="id">rewrite</span> &lt;-<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.IsLast_app">IsLast_app</a></span> <span class="kwd">in</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> <span class="id">x</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.n_in">n_in</a></span> <span class="id">n0</span>) ++ <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.n_out">n_out</a></span> <span class="id">n0</span>))) <span class="kwd">as</span> <span class="id">InM</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">contra</span>. <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.map_fst_senv_of_ins">map_fst_senv_of_ins</a></span>, &lt;- <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.map_fst_senv_of_decls">map_fst_senv_of_decls</a></span>, &lt;-<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>. <span class="id">solve_In</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.Fresh.Facts.st_valid_AtomOrGensym_nIn">Facts.st_valid_AtomOrGensym_nIn</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.norm1_not_in_local_prefs">norm1_not_in_local_prefs</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">In</span>. <span class="id">simpl_In</span>. <span class="id">solve_In</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sc_vars_morph">sc_vars_morph</a></span>, <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sc_vars_incl">sc_vars_incl</a></span>; [<span class="id">reflexivity</span>| |<span class="id">reflexivity</span>| |<span class="id">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">symmetry</span>. <span class="id">setoid_rewrite</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv.senv_of_decls_app">senv_of_decls_app</a></span>. <span class="id">rewrite</span> &lt;-<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.st_senv_senv_of_decls">st_senv_senv_of_decls</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_incl_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl</span>. <span class="id">now</span> <span class="id">subst</span> <span class="id">bs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">erewrite</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.find_node_other">find_node_other</a></span> <span class="kwd">in</span> <span class="id">Hfind</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_node_ck_cons2">sem_node_ck_cons2</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G2">G2</a></span>; <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.HGref">HGref</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem.G1">G1</a></span>; <span class="id">econstructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_block_ck_cons1">sem_block_ck_cons1</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ord.find_node_later_not_Is_node_in">find_node_later_not_Is_node_in</a></span> <span class="kwd">in</span> <span class="id">Hord1</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem">unnest_node_sem</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">Local</span> <span class="kwd">Hint</span> <span class="id">Resolve</span> <span class="id">wc_global_Ordered_nodes</span> : <span class="id">norm</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="UCORRECTNESS.unnest_global_refines">unnest_global_refines</a></span> : <span class="kwd">forall</span> <span class="id">G</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_global">wc_global</a></span> <span class="id">G</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.global_sem_refines">global_sem_refines</a></span> <span class="id">G</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_global">unnest_global</a></span> <span class="id">G</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof with</summary>
<div class="proofscript">
 <span class="id">eauto</span> <span class="kwd">with</span> <span class="id">norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">nodes0</span>; <span class="id">intros</span> * <span class="id">Hwc</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.global_sem_ref_nil">global_sem_ref_nil</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">assert</span> (<span class="id">Hwc'</span>:=<span class="id">Hwc</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_global_wc">unnest_global_wc</a></span>, <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.wc_global_Ordered_nodes">wc_global_Ordered_nodes</a></span> <span class="kwd">in</span> <span class="id">Hwc'</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_global">unnest_global</a></span> <span class="kwd">in</span> <span class="id">Hwc'</span>; <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hwc'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.global_sem_ref_cons">global_sem_ref_cons</a></span> <span class="kwd">with</span> (<span class="id">f</span>:=<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.n_name">n_name</a></span> <span class="id">a</span>)...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">Hwc</span>. <span class="id">eapply</span> <span class="id">IHnodes0</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span> <span class="id">ins</span> <span class="id">outs</span> <span class="id">Hsem</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> <span class="id">types0</span> <span class="kwd">with</span> ((<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.Global">Global</a></span> <span class="id">types0</span> <span class="id">externs0</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_nodes">unnest_nodes</a></span> <span class="id">types0</span> <span class="id">externs0</span> <span class="id">nodes0</span>)).(<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.types">types</a></span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_node_sem">unnest_node_sem</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">inv</span> <span class="id">Hwc</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">change</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.Global">Global</a></span> <span class="id">types0</span> <span class="id">externs0</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_nodes">unnest_nodes</a></span> <span class="id">types0</span> <span class="id">externs0</span> <span class="id">nodes0</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_global">unnest_global</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.Global">Global</a></span> <span class="id">types0</span> <span class="id">externs0</span> <span class="id">nodes0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_global_wc">unnest_global_wc</a></span>. <span class="id">inv</span> <span class="id">Hwc</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn.iface_eq_iface_incl">iface_eq_iface_incl</a></span>, <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_nodes_eq">unnest_nodes_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">inv</span> <span class="id">Hwc</span>. <span class="id">eapply</span> <span class="id">IHnodes0</span>...<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Theorem</span> <span class="id"><a name="UCORRECTNESS.unnest_global_sem">unnest_global_sem</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">f</span> <span class="id">ins</span> <span class="id">outs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cl.wc_global">wc_global</a></span> <span class="id">G</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_node_ck">sem_node_ck</a></span> <span class="id">G</span> <span class="id">f</span> <span class="id">ins</span> <span class="id">outs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LCS.sem_node_ck">sem_node_ck</a></span> (<span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un.unnest_global">unnest_global</a></span> <span class="id">G</span>) <span class="id">f</span> <span class="id">ins</span> <span class="id">outs</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS.unnest_global_refines">unnest_global_refines</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> <span class="id">f</span> <span class="id">ins</span> <span class="id">outs</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS">UCORRECTNESS</a></span>.<br/>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="UCorrectnessFun">UCorrectnessFun</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ids</span> : <span class="id"><a href="Velus.Common.Common.html#IDS">IDS</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Op</span> : <span class="id"><a href="Velus.Operators.html#OPERATORS">OPERATORS</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">OpAux</span> : <span class="id"><a href="Velus.Operators.html#OPERATORS_AUX">OPERATORS_AUX</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Op">Op</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Cks</span> : <span class="id"><a href="Velus.Clocks.html#CLOCKS">CLOCKS</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux">OpAux</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">CStr</span> : <span class="id"><a href="Velus.CoindStreams.html#COINDSTREAMS">COINDSTREAMS</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cks">Cks</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Senv</span> : <span class="id"><a href="Velus.Lustre.StaticEnv.html#STATICENV">STATICENV</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cks">Cks</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Syn</span> : <span class="id"><a href="Velus.Lustre.LSyntax.html#LSYNTAX">LSYNTAX</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv">Senv</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ty</span> : <span class="id"><a href="Velus.Lustre.LTyping.html#LTYPING">LTYPING</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn">Syn</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Clo</span> : <span class="id"><a href="Velus.Lustre.LClocking.html#LCLOCKING">LCLOCKING</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn">Syn</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Lord</span> : <span class="id"><a href="Velus.Lustre.LOrdered.html#LORDERED">LORDERED</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn">Syn</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Sem</span> : <span class="id"><a href="Velus.Lustre.LSemantics.html#LSEMANTICS">LSEMANTICS</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn">Syn</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Lord">Lord</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr">CStr</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">LClockSem</span> : <span class="id"><a href="Velus.Lustre.LClockedSemantics.html#LCLOCKEDSEMANTICS">LCLOCKEDSEMANTICS</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn">Syn</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Clo">Clo</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Lord">Lord</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr">CStr</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem">Sem</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Un</span>  : <span class="id"><a href="Velus.Lustre.Unnesting.Unnesting.html#UNNESTING">UNNESTING</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn">Syn</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;: <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS">UCORRECTNESS</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr">CStr</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn">Syn</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ty">Ty</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Clo">Clo</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Lord">Lord</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem">Sem</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LClockSem">LClockSem</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un">Un</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Include</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCORRECTNESS">UCORRECTNESS</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#CStr">CStr</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Syn">Syn</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Ty">Ty</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Clo">Clo</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Lord">Lord</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Sem">Sem</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#LClockSem">LClockSem</a></span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#Un">Un</a></span>.<br/>
<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.Unnesting.UCorrectness.html#UCorrectnessFun">UCorrectnessFun</a></span>.<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
