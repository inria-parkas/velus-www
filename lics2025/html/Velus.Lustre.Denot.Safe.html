
<!DOCTYPE html>
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Safe</title>
<meta name="description" content="Documentation of Coq module Safe" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
</head>

<body>
<h1 class="title">Module Safe</h1>
<div class="coq">
<span class="kwd">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html">String</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Classes.Morphisms.html">Morphisms</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Sorting.Permutation.html">Permutation</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html">Datatypes</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html">List</a></span>.<br/>
<span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#ListNotations">List.ListNotations</a></span>.<br/>
<span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">list_scope</span>.<br/>
<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Common.Common.html">Common</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Common.CommonList.html">CommonList</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Common.CommonTyping.html">CommonTyping</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Environment.html">Environment</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.FunctionalEnvironment.html">FunctionalEnvironment</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Operators.html">Operators</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.CoindStreams.html">CoindStreams</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Clocks.html">Clocks</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Lustre.StaticEnv.html">Lustre.StaticEnv</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Lustre.LSyntax.html">Lustre.LSyntax</a></span> <span class="id"><a href="Velus.Lustre.LTyping.html">Lustre.LTyping</a></span> <span class="id"><a href="Velus.Lustre.LClocking.html">Lustre.LClocking</a></span> <span class="id"><a href="Velus.Lustre.LSemantics.html">Lustre.LSemantics</a></span> <span class="id"><a href="Velus.Lustre.LOrdered.html">Lustre.LOrdered</a></span>.<br/>
<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.html">Lustre.Denot.Cpo</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html">CommonDS</a></span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html">SDfuns</a></span> <span class="id"><a href="Velus.Lustre.Denot.SD.html">SD</a></span> <span class="id"><a href="Velus.Lustre.Denot.CheckOp.html">CheckOp</a></span> <span class="id"><a href="Velus.Lustre.Denot.OpErr.html">OpErr</a></span> <span class="id"><a href="Velus.Lustre.Denot.Restr.html">Restr</a></span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html">CommonList2</a></span> <span class="id"><a href="Velus.Lustre.Denot.ResetMask.html">ResetMask</a></span>.<br/>
<br/>
<br/>
<span class="kwd">Module</span> <span class="kwd">Type</span> <span class="id"><a name="LDENOTSAFE">LDENOTSAFE</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Ids</span>   : <span class="id"><a href="Velus.Common.Common.html#IDS">IDS</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Op</span>    : <span class="id"><a href="Velus.Operators.html#OPERATORS">OPERATORS</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">OpAux</span> : <span class="id"><a href="Velus.Operators.html#OPERATORS_AUX">OPERATORS_AUX</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op">Op</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Cks</span>   : <span class="id"><a href="Velus.Clocks.html#CLOCKS">CLOCKS</a></span>        <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpAux">OpAux</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Senv</span>  : <span class="id"><a href="Velus.Lustre.StaticEnv.html#STATICENV">STATICENV</a></span>     <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks">Cks</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Syn</span>   : <span class="id"><a href="Velus.Lustre.LSyntax.html#LSYNTAX">LSYNTAX</a></span>       <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv">Senv</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Typ</span>   : <span class="id"><a href="Velus.Lustre.LTyping.html#LTYPING">LTYPING</a></span>       <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn">Syn</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Restr</span> : <span class="id"><a href="Velus.Lustre.Denot.Restr.html#LRESTR">LRESTR</a></span>        <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn">Syn</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Cl</span>    : <span class="id"><a href="Velus.Lustre.LClocking.html#LCLOCKING">LCLOCKING</a></span>     <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn">Syn</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Lord</span>  : <span class="id"><a href="Velus.Lustre.LOrdered.html#LORDERED">LORDERED</a></span>      <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn">Syn</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Den</span>   : <span class="id"><a href="Velus.Lustre.Denot.SD.html#SD">SD</a></span>        <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn">Syn</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Lord">Lord</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Ckop</span>  : <span class="id"><a href="Velus.Lustre.Denot.CheckOp.html#CHECKOP">CHECKOP</a></span>       <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn">Syn</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">OpErr</span> : <span class="id"><a href="Velus.Lustre.Denot.OpErr.html#OP_ERR">OP_ERR</a></span>        <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn">Syn</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ">Typ</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Restr">Restr</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Lord">Lord</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den">Den</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Ckop">Ckop</a></span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.typeof_same">typeof_same</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">es</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.typeof">typeof</a></span> <span class="id">e</span> = [<span class="id">ty</span>]) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id">ty</span>) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.typesof">typesof</a></span> <span class="id">es</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">es</span>; <span class="id">simpl</span>; <span class="id">intros</span> * <span class="id">Hf</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hf</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_app">Forall_app</a></span>; <span class="id">split</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.typeof">typeof</a></span> _ = _) <span class="id">and</span> <span class="id">rewrite</span> <span class="id">it</span>; <span class="id">auto</span>.<br/>
Qed.</div></details>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="LDENOTSAFE.find_node_in_nodes">find_node_in_nodes</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">PSyn</span> <span class="id">Prefs</span>} (<span class="id">G</span> : @<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.global">global</a></span> <span class="id">PSyn</span> <span class="id">Prefs</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.find_node">find_node</a></span> <span class="id">f</span> <span class="id">G</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">n</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">n</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.nodes">nodes</a></span> <span class="id">G</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">intros</span>  * <span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.find_node">find_node</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonTactics.html#option_map_inv">option_map_inv</a></span> <span class="kwd">in</span> <span class="id">Hfind</span> <span class="kwd">as</span> ((?&amp;?)&amp; <span class="id">Hfind</span> &amp; ?); <span class="id">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonProgram.html#find_unit_In">find_unit_In</a></span> <span class="kwd">in</span> <span class="id">Hfind</span> <span class="kwd">as</span> []; <span class="id">subst</span>; <span class="id">simpl</span>; <span class="id">auto</span>.<br/>
Qed.</div></details>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="LDENOTSAFE.find_node_name">find_node_name</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">PSyn</span> <span class="id">Prefs</span>} (<span class="id">G</span> : @<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.global">global</a></span> <span class="id">PSyn</span> <span class="id">Prefs</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.find_node">find_node</a></span> <span class="id">f</span> <span class="id">G</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">n</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span> = <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_name">n_name</a></span> <span class="id">n</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">intros</span>  * <span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.find_node">find_node</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonTactics.html#option_map_inv">option_map_inv</a></span> <span class="kwd">in</span> <span class="id">Hfind</span> <span class="kwd">as</span> ((?&amp;?)&amp; <span class="id">Hfind</span> &amp; ?); <span class="id">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonProgram.html#find_unit_In">find_unit_In</a></span> <span class="kwd">in</span> <span class="id">Hfind</span> <span class="kwd">as</span> []; <span class="id">subst</span>; <span class="id">simpl</span>; <span class="id">auto</span>.<br/>
Qed.</div></details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.wc_env_in">wc_env_in</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">PSyn</span> <span class="id">Prefs</span>} (<span class="id">G</span> : @<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.global">global</a></span> <span class="id">PSyn</span> <span class="id">Prefs</span>),<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> (<span class="id">n</span> : <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.node">node</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_global">wc_global</a></span> <span class="id">G</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.find_node">find_node</a></span> <span class="id">f</span> <span class="id">G</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">n</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.wc_env">wc_env</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, (_, <span class="id">ck</span>, _)) =&gt; (<span class="id">x</span>, <span class="id">ck</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hwc</span> <span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_find_node">wc_find_node</a></span> <span class="kwd">in</span> <span class="id">Hfind</span> <span class="kwd">as</span> (? &amp; <span class="id">Hc</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="id">inv</span> <span class="id">Hc</span>.<br/>
Qed.</div></details>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="LDENOTSAFE.Static_env_node">Static_env_node</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.NoDup_senv">NoDup_senv</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">PSyn</span> <span class="id">Prefs</span>} (<span class="id">nd</span> : @<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.node">node</a></span> <span class="id">PSyn</span> <span class="id">Prefs</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">nd</span>) ++ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">nd</span>)).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#fst_NoDupMembers">fst_NoDupMembers</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.map_fst_senv_of_ins">map_fst_senv_of_ins</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.map_fst_senv_of_decls">map_fst_senv_of_decls</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_nodup">n_nodup</a></span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.Ty_senv">Ty_senv</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">PSyn</span> <span class="id">Prefs</span>} (<span class="id">n</span> : @<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.node">node</a></span> <span class="id">PSyn</span> <span class="id">Prefs</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasType">HasType</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="id">x</span> <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id">x</span>,<span class="id">ty</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, (<span class="id">ty</span>, _, _)) =&gt; (<span class="id">x</span>, <span class="id">ty</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hty</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.NoDup_senv">NoDup_senv</a></span> <span class="id">n</span>) <span class="kwd">as</span> <span class="id">ND</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers_app_l">NoDupMembers_app_l</a></span> <span class="kwd">in</span> <span class="id">ND</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hty</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) <span class="kwd">as</span> [| (?&amp;((?&amp;?)&amp;?)) <span class="id">nins</span>]. <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">ND</span>. <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">subst</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [|<span class="id">Hxin</span>]; <span class="id">subst</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.HasType_ins_app">HasType_ins_app</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">PSyn</span> <span class="id">Prefs</span>} (<span class="id">n</span> : @<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.node">node</a></span> <span class="id">PSyn</span> <span class="id">Prefs</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">Γ</span> <span class="id">x</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) ++ <span class="id">Γ</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasType">HasType</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) ++ <span class="id">Γ</span>) <span class="id">x</span> <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasType">HasType</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> <span class="id">n</span>.(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span>)) <span class="id">x</span> <span class="id">ty</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">ND</span> <span class="id">Hin</span> <span class="id">Hty</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hty</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#not_In2_app">not_In2_app</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Common.CommonList.html#in_app_weak">in_app_weak</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">Hin2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#fst_InMembers">fst_InMembers</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#In_InMembers">In_InMembers</a></span> <span class="kwd">in</span> <span class="id">Hin2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> (<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers_app_InMembers">NoDupMembers_app_InMembers</a></span> _ _ _ <span class="id">ND</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#fst_InMembers">fst_InMembers</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.map_fst_senv_of_ins">map_fst_senv_of_ins</a></span>, &lt;- <span class="id"><a href="Velus.Common.CommonList.html#fst_InMembers">fst_InMembers</a></span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.HasClock_ins_app">HasClock_ins_app</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">PSyn</span> <span class="id">Prefs</span>} (<span class="id">n</span> : @<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.node">node</a></span> <span class="id">PSyn</span> <span class="id">Prefs</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">Γ</span> <span class="id">x</span> <span class="id">ck</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) ++ <span class="id">Γ</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasClock">HasClock</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) ++ <span class="id">Γ</span>) <span class="id">x</span> <span class="id">ck</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasClock">HasClock</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> <span class="id">n</span>.(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span>)) <span class="id">x</span> <span class="id">ck</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">ND</span> <span class="id">Hin</span> <span class="id">Hck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#not_In2_app">not_In2_app</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Common.CommonList.html#in_app_weak">in_app_weak</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">Hin2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#fst_InMembers">fst_InMembers</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#In_InMembers">In_InMembers</a></span> <span class="kwd">in</span> <span class="id">Hin2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> (<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers_app_InMembers">NoDupMembers_app_InMembers</a></span> _ _ _ <span class="id">ND</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#fst_InMembers">fst_InMembers</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.map_fst_senv_of_ins">map_fst_senv_of_ins</a></span>, &lt;- <span class="id"><a href="Velus.Common.CommonList.html#fst_InMembers">fst_InMembers</a></span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.HasClock_senv">HasClock_senv</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">PSyn</span> <span class="id">Prefs</span>} (<span class="id">n</span> : @<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.node">node</a></span> <span class="id">PSyn</span> <span class="id">Prefs</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">ck</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasClock">HasClock</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="id">x</span> <span class="id">ck</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id">x</span>,<span class="id">ck</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, (_, <span class="id">ck</span>, _)) =&gt; (<span class="id">x</span>, <span class="id">ck</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.NoDup_senv">NoDup_senv</a></span> <span class="id">n</span>) <span class="kwd">as</span> <span class="id">ND</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers_app_l">NoDupMembers_app_l</a></span> <span class="kwd">in</span> <span class="id">ND</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hck</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) <span class="kwd">as</span> [| (?&amp;((?&amp;?)&amp;?)) <span class="id">nins</span>]. <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">ND</span>. <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">subst</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [|<span class="id">Hxin</span>]; <span class="id">subst</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.HasType_app_r">HasType_app_r</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l1</span> <span class="id">l2</span> <span class="id">x</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasType">HasType</a></span> <span class="id">l2</span> <span class="id">x</span> <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasType">HasType</a></span> (<span class="id">l1</span> ++ <span class="id">l2</span>) <span class="id">x</span> <span class="id">ty</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">eauto</span>; <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#in_app">in_app</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.HasClock_app_r">HasClock_app_r</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l1</span> <span class="id">l2</span> <span class="id">x</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasClock">HasClock</a></span> <span class="id">l2</span> <span class="id">x</span> <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasClock">HasClock</a></span> (<span class="id">l1</span> ++ <span class="id">l2</span>) <span class="id">x</span> <span class="id">ty</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">eauto</span>; <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#in_app">in_app</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.HasType_app_l">HasType_app_l</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l1</span> <span class="id">l2</span> <span class="id">x</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasType">HasType</a></span> <span class="id">l1</span> <span class="id">x</span> <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasType">HasType</a></span> (<span class="id">l1</span> ++ <span class="id">l2</span>) <span class="id">x</span> <span class="id">ty</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">eauto</span>; <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#in_app">in_app</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.HasClock_app_l">HasClock_app_l</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l1</span> <span class="id">l2</span> <span class="id">x</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasClock">HasClock</a></span> <span class="id">l1</span> <span class="id">x</span> <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasClock">HasClock</a></span> (<span class="id">l1</span> ++ <span class="id">l2</span>) <span class="id">x</span> <span class="id">ty</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">eauto</span>; <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#in_app">in_app</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">In_HasType'</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">l</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">l</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">ty</span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasType">HasType</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span> <span class="id">l</span>) <span class="id">x</span> <span class="id">ty</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span> <span class="kwd">in</span> <span class="id">Hin</span> <span class="kwd">as</span> ((?&amp;((<span class="id">ty</span>,?),?)&amp;?)&amp;?&amp;?); <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">esplit</span>; <span class="id">split</span>; <span class="id">now</span> <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.In_HasClock">In_HasClock</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">l</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">l</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">ck</span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasClock">HasClock</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span> <span class="id">l</span>) <span class="id">x</span> <span class="id">ck</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span> <span class="kwd">in</span> <span class="id">Hin</span> <span class="kwd">as</span> ((?&amp;((?,<span class="id">ck</span>),?)&amp;?)&amp;?&amp;?); <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">ck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">esplit</span>; <span class="id">split</span>; <span class="id">now</span> <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">senv_HasClock'</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span> <span class="id">x</span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">i</span> <span class="id">o</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id">x</span>,(<span class="id">ty</span>,<span class="id">ck</span>,<span class="id">i</span>,<span class="id">o</span>)) <span class="id">l</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasClock">HasClock</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span> <span class="id">l</span>) <span class="id">x</span> <span class="id">ck</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id">x</span>,(<span class="id">ty</span>,<span class="id">ck</span>,<span class="id">i</span>,<span class="id">o</span>)); <span class="id">auto</span>. <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Static_env_node">Static_env_node</a></span>.<br/>
<br/>
<br/>
<h2> Safety properties of synchronous streams </h2>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="LDENOTSAFE.Safe_DS">Safe_DS</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id"><a name="LDENOTSAFE.Safe_DS.A">A</a></span> : <span class="kwd">Type</span>}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="LDENOTSAFE.safe_DS">safe_DS</a></span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Safe_DS.A">A</a></span>) -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall">DSForall</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="kwd">match</span> <span class="id">v</span> <span class="kwd">with</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#err">err</a></span> _ =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span> | _ =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span> <span class="kwd">end</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="LDENOTSAFE.safe_ty">safe_ty</a></span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Safe_DS.A">A</a></span>) -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall">DSForall</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="kwd">match</span> <span class="id">v</span> <span class="kwd">with</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#err">err</a></span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#error_Ty">error_Ty</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span> | _ =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span> <span class="kwd">end</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="LDENOTSAFE.safe_cl">safe_cl</a></span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Safe_DS.A">A</a></span>) -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall">DSForall</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="kwd">match</span> <span class="id">v</span> <span class="kwd">with</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#err">err</a></span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#error_Cl">error_Cl</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span> | _ =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span> <span class="kwd">end</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="LDENOTSAFE.safe_op">safe_op</a></span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Safe_DS.A">A</a></span>) -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall">DSForall</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="kwd">match</span> <span class="id">v</span> <span class="kwd">with</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#err">err</a></span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#error_Op">error_Op</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span> | _ =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span> <span class="kwd">end</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.safe_DS_compose">safe_DS_compose</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_ty">safe_ty</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_cl">safe_cl</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_op">safe_op</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">s</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_ty">safe_ty</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_cl">safe_cl</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_op">safe_op</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">Cof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">s</span>; <span class="id">intros</span> <span class="id">Hty</span> <span class="id">Hcl</span> <span class="id">Hop</span>; <span class="id">inv</span> <span class="id">Hty</span>; <span class="id">inv</span> <span class="id">Hcl</span>; <span class="id">inv</span> <span class="id">Hop</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">cases</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.safe_DS_decompose">safe_DS_decompose</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_ty">safe_ty</a></span> <span class="id">s</span> /\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_cl">safe_cl</a></span> <span class="id">s</span> /\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_op">safe_op</a></span> <span class="id">s</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_ty">safe_ty</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_cl">safe_cl</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_op">safe_op</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>; <span class="id">revert_all</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">destruct</span> <span class="id">s</span>; <span class="id">intros</span>; <span class="id">inv</span> <span class="id">Hs</span>; <span class="id">constructor</span>; <span class="id">cases</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Safe_DS">Safe_DS</a></span>.<br/>
<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="LDENOTSAFE.SDfuns_safe">SDfuns_safe</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id"><a name="LDENOTSAFE.SDfuns_safe.PSyn">PSyn</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.decl">decl</a></span> -&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.block">block</a></span> -&gt; <span class="kwd">Prop</span>}.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id"><a name="LDENOTSAFE.SDfuns_safe.Prefs">Prefs</a></span> : <span class="id"><a href="Velus.Common.Common.html#PS.t">PS.t</a></span>}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Variables</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a name="LDENOTSAFE.SDfuns_safe.Γ">Γ</a></span> : <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.static_env">static_env</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a name="LDENOTSAFE.SDfuns_safe.G">G</a></span> : @<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.global">global</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.PSyn">PSyn</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.Prefs">Prefs</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a name="LDENOTSAFE.SDfuns_safe.ins">ins</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a name="LDENOTSAFE.SDfuns_safe.envG">envG</a></span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#Dprodi">Dprodi</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.FI">FI</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a name="LDENOTSAFE.SDfuns_safe.envI">envI</a></span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo.Systems.html#DS_prod">DS_prod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.SI">SI</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a name="LDENOTSAFE.SDfuns_safe.bs">bs</a></span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a name="LDENOTSAFE.SDfuns_safe.env">env</a></span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo.Systems.html#DS_prod">DS_prod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.SI">SI</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="LDENOTSAFE.sample">sample</a></span> (<span class="id">k</span> : <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.enumtag">enumtag</a></span>) (<span class="id">x</span> : <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>) (<span class="id">c</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#pres">pres</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.Venum">Venum</a></span> <span class="id">e</span>) =&gt; (<span class="id">k</span> =? <span class="id">e</span>) &amp;&amp; <span class="id">c</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| _ =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ck</span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ck</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.Cbase">Cbase</a></span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.bs">bs</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.Con">Con</a></span> <span class="id">ck</span> <span class="id">x</span> (_, <span class="id">k</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">sx</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.ins">ins</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.envI">envI</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.env">env</a></span> <span class="id">x</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">cks</span> := <span class="id">denot_clock</span> <span class="id">ck</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#ZIP">ZIP</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sample">sample</a></span> <span class="id">k</span>) <span class="id">sx</span> <span class="id">cks</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">A stream of values of type ty </div>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="LDENOTSAFE.ty_DS">ty_DS</a></span> (<span class="id">ty</span> : <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.type">type</a></span>) (<span class="id">s</span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>)) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.DSForall_pres">DSForall_pres</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.wt_value">wt_value</a></span> <span class="id">v</span> <span class="id">ty</span>) <span class="id">s</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">Add</span> <span class="id">Parametric</span> <span class="id">Morphism</span> : <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">signature</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> ==&gt; @<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#Oeq">Oeq</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>)) ==&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#iff">iff</a></span> <span class="kwd">as</span> <span class="id">ty_DS_Morph</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">setoid_rewrite</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
<div class="doc">A stream that respects its clock (≃ alignment).
      Because the stream might not yet be fully computed, we use
      an inequality. This predicate holds in the denotational
      model because the computation of an expression denotation
      implicitly depends on the clock stream, and thus cannot
      exceed it. See <span class="bracket"><span class="id">safe_exp</span></span> below.
   </div>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="LDENOTSAFE.cl_DS">cl_DS</a></span> (<span class="id">ck</span> : <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.clock">clock</a></span>) (<span class="id">s</span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> <span class="id">s</span> &lt;= <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ck</span>.<br/>
<br/>
<div class="doc">Global well-formedness hypothesis on the environment </div>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="LDENOTSAFE.wf_env">wf_env</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">ty</span> <span class="id">ck</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasType">HasType</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.Γ">Γ</a></span> <span class="id">x</span> <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasClock">HasClock</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.Γ">Γ</a></span> <span class="id">x</span> <span class="id">ck</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">s</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.ins">ins</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.envI">envI</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.env">env</a></span> <span class="id">x</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">ty</span> <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">s</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="LDENOTSAFE.ty_env">ty_env</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span> <span class="id">ty</span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasType">HasType</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.Γ">Γ</a></span> <span class="id">x</span> <span class="id">ty</span> -&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">ty</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.ins">ins</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.envI">envI</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.env">env</a></span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="LDENOTSAFE.cl_env">cl_env</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span> <span class="id">ck</span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasClock">HasClock</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.Γ">Γ</a></span> <span class="id">x</span> <span class="id">ck</span> -&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.ins">ins</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.envI">envI</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.env">env</a></span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="LDENOTSAFE.ef_env">ef_env</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span> <span class="id">ty</span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasType">HasType</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.Γ">Γ</a></span> <span class="id">x</span> <span class="id">ty</span> -&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.ins">ins</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.envI">envI</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.env">env</a></span> <span class="id">x</span>)).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.wf_env_decompose">wf_env_decompose</a></span> : (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_env">ty_env</a></span> /\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_env">cl_env</a></span> /\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ef_env">ef_env</a></span>) &lt;-&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_env">ty_env</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_env">cl_env</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ef_env">ef_env</a></span>. <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">intros</span> * (<span class="id">Ty</span> &amp; <span class="id">Cl</span>&amp;  <span class="id">Ef</span> ) * <span class="id">Hty</span> <span class="id">Hcl</span>. <span class="id">repeat</span> <span class="id">split</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">intro</span> <span class="id">H</span>. <span class="id">repeat</span> <span class="id">split</span>; <span class="id">intros</span> * <span class="id">HH</span>; <span class="id">inv</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">edestruct</span> <span class="id">H</span> <span class="kwd">as</span> (?&amp;?&amp;?); <span class="id">eauto</span>; <span class="id">econstructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
<div class="doc">Quelques résultats du type : qui peut le plus, peut le moins </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.ty_DS_le">ty_DS_le</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">x</span> &lt;= <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">ty</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">ty</span> <span class="id">x</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_le">DSForall_le</a></span> <span class="kwd">with</span> <span class="id">y</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.cl_DS_le">cl_DS_le</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ck</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">x</span> &lt;= <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">x</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#Ole_trans">Ole_trans</a></span> <span class="kwd">with</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> <span class="id">y</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.safe_DS_le">safe_DS_le</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>} (<span class="id">x</span> <span class="id">y</span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id">A</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">x</span> &lt;= <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">x</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_le">DSForall_le</a></span> <span class="kwd">with</span> <span class="id">y</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.Forall2_ty_DS_le">Forall2_ty_DS_le</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">tys</span> (<span class="id">xs</span> <span class="id">ys</span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#nprod">nprod</a></span> <span class="id">n</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">xs</span> &lt;= <span class="id">ys</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">tys</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">ys</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">tys</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">xs</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">n</span> <span class="kwd">as</span> [|[]]; <span class="id">intros</span> * <span class="id">Hle</span> <span class="id">Hf</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hf</span>; <span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS_le">ty_DS_le</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">Hle</span>; <span class="id">inv</span> <span class="id">Hf</span>; <span class="id">constructor</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS_le">ty_DS_le</a></span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.Forall2_cl_DS_le">Forall2_cl_DS_le</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">cks</span> (<span class="id">xs</span> <span class="id">ys</span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#nprod">nprod</a></span> <span class="id">n</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">xs</span> &lt;= <span class="id">ys</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">cks</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">ys</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">cks</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">xs</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">n</span> <span class="kwd">as</span> [|[]]; <span class="id">intros</span> * <span class="id">Hle</span> <span class="id">Hf</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hf</span>; <span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS_le">cl_DS_le</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">Hle</span>; <span class="id">inv</span> <span class="id">Hf</span>; <span class="id">constructor</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS_le">cl_DS_le</a></span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.forall_safe_le">forall_safe_le</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>} <span class="id">n</span> (<span class="id">xs</span> <span class="id">ys</span> : @<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#nprod">nprod</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id">A</span>)) <span class="id">n</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">xs</span> &lt;= <span class="id">ys</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">ys</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">xs</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_k_iff">forall_nprod_k_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hle</span> <span class="id">Hf</span> <span class="id">k</span> <span class="id">d</span> <span class="id">Hk</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS_le">safe_DS_le</a></span>, <span class="id">Hf</span>, <span class="id">Hk</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
<h2> Faits sur sconst  </h2>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.cl_sconst">cl_sconst</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">bs'</span>, <span class="id">bs'</span> &lt;= <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.bs">bs</a></span> -&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.Cbase">Cbase</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sconst">sconst</a></span> <span class="id">c</span> <span class="id">bs'</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_sconst">AC_sconst</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.ty_sconst">ty_sconst</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.wt_value">wt_value</a></span> <span class="id">v</span> <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">ty</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sconst">sconst</a></span> <span class="id">v</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.bs">bs</a></span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hty</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.DSForall_pres">DSForall_pres</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sconst">sconst</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_map">DSForall_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">bs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">Cof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">bs</span>; <span class="id">constructor</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">b</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.safe_sconst">safe_sconst</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> (<span class="id">c</span>:<span class="id">A</span>), <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sconst">sconst</a></span> <span class="id">c</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.bs">bs</a></span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sconst">sconst</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_map">DSForall_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">bs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">Cof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">bs</span>; <span class="id">constructor</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">b</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
<h2> Faits sur sunop </h2>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.ty_sunop">ty_sunop</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">op</span> <span class="id">s</span> <span class="id">ty</span> <span class="id">tye</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.type_unop">type_unop</a></span> <span class="id">op</span> <span class="id">tye</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">tye</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">ty</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sunop">sunop</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.sem_unop">sem_unop</a></span> <span class="id">op</span> <span class="id">v</span> <span class="id">tye</span>) <span class="id">s</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hop</span> <span class="id">Hwt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.DSForall_pres">DSForall_pres</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sunop">sunop</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_map">DSForall_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> <span class="id">dependent</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">Cof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">s</span>; <span class="id">intro</span> <span class="id">Hs</span>; <span class="id">constructor</span>; <span class="id">inv</span> <span class="id">Hs</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id">HH</span>; <span class="id">inv</span> <span class="id">HH0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.pres_sem_unop">pres_sem_unop</a></span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.safe_ty_sunop">safe_ty_sunop</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">op</span> <span class="id">s</span> <span class="id">ty</span> <span class="id">tye</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.type_unop">type_unop</a></span> <span class="id">op</span> <span class="id">tye</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">tye</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_ty">safe_ty</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_ty">safe_ty</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sunop">sunop</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.sem_unop">sem_unop</a></span> <span class="id">op</span> <span class="id">v</span> <span class="id">tye</span>) <span class="id">s</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hop</span> <span class="id">Hwt</span> <span class="id">Hsf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_ty">safe_ty</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sunop">sunop</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_map">DSForall_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> <span class="id">dependent</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">Cof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">s</span>; <span class="id">intro</span> <span class="id">Hs</span>; <span class="id">constructor</span>; <span class="id">inv</span> <span class="id">Hsf</span>; <span class="id">inv</span> <span class="id">Hs</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.safe_cl_sunop">safe_cl_sunop</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">op</span> <span class="id">s</span> <span class="id">tye</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_cl">safe_cl</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_cl">safe_cl</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sunop">sunop</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.sem_unop">sem_unop</a></span> <span class="id">op</span> <span class="id">v</span> <span class="id">tye</span>) <span class="id">s</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hsf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_cl">safe_cl</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sunop">sunop</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_map">DSForall_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> <span class="id">dependent</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">Cof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">s</span>; <span class="id">intro</span> <span class="id">Hs</span>; <span class="id">constructor</span>; <span class="id">inv</span> <span class="id">Hs</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.safe_op_sunop">safe_op_sunop</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">op</span> <span class="id">s</span> <span class="id">tye</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_op">safe_op</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.DSForall_pres">DSForall_pres</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.sem_unop">sem_unop</a></span> <span class="id">op</span> <span class="id">v</span> <span class="id">tye</span> &lt;&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_op">safe_op</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sunop">sunop</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.sem_unop">sem_unop</a></span> <span class="id">op</span> <span class="id">v</span> <span class="id">tye</span>) <span class="id">s</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hsf</span> <span class="id">Hop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_op">safe_op</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sunop">sunop</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_map">DSForall_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> <span class="id">dependent</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">Cof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">s</span>; <span class="id">intro</span> <span class="id">Hs</span>; <span class="id">constructor</span>; <span class="id">inv</span> <span class="id">Hs</span>; <span class="id">inv</span> <span class="id">Hop</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.cl_sunop">cl_sunop</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">op</span> <span class="id">s</span> <span class="id">ck</span> <span class="id">tye</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.DSForall_pres">DSForall_pres</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.sem_unop">sem_unop</a></span> <span class="id">op</span> <span class="id">v</span> <span class="id">tye</span> &lt;&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sunop">sunop</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.sem_unop">sem_unop</a></span> <span class="id">op</span> <span class="id">v</span> <span class="id">tye</span>) <span class="id">s</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.DSForall_pres">DSForall_pres</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hck</span> <span class="id">Hop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hck</span>. <span class="id">generalize</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ck</span>) <span class="kwd">as</span> <span class="id">C</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember_ds</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sunop">sunop</a></span> _ <span class="id">s</span>)) <span class="kwd">as</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hop</span> <span class="id">Ht</span> <span class="id">Hck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">t</span> <span class="id">s</span> <span class="id">C</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">Cof</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">destruct</span> (@<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> _ <span class="id">s</span>) <span class="kwd">as</span> (<span class="id">vs</span> &amp; <span class="id">S</span> &amp; <span class="id">Hs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#map_is_cons">map_is_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#map_is_cons">map_is_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_eq_compat">is_cons_eq_compat</a></span>; <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (@<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#uncons">uncons</a></span> _ <span class="id">C</span>) <span class="kwd">as</span> (<span class="id">vc</span> &amp; <span class="id">C'</span> &amp; <span class="id">Hc</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_le_compat">is_cons_le_compat</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_is_cons">AC_is_cons</a></span>; <span class="id">eauto</span>; <span class="id">now</span> <span class="id">rewrite</span> <span class="id">Hs</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#decomp_eqCon">decomp_eqCon</a></span> <span class="kwd">in</span> <span class="id">Hc</span> <span class="kwd">as</span> <span class="id">Heqc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hs</span>, <span class="id">Heqc</span> <span class="kwd">in</span> * |-.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sunop_eq">sunop_eq</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span> <span class="kwd">in</span> <span class="id">Hck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_eq_simpl">Con_eq_simpl</a></span> <span class="kwd">in</span> <span class="id">Ht</span> <span class="kwd">as</span> []; <span class="id">inv</span> <span class="id">Hop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_le_simpl">Con_le_simpl</a></span> <span class="kwd">in</span> <span class="id">Hck</span> <span class="kwd">as</span> []; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id">HH</span>; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DSleCon">DSleCon</a></span> <span class="kwd">with</span> (<span class="id">t</span> := <span class="id">C'</span>), <span class="id">Cof</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
<h2> Faits sur sbinop </h2>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.ty_sbinop">ty_sbinop</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">op</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">ty</span> <span class="id">tye1</span> <span class="id">tye2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.type_binop">type_binop</a></span> <span class="id">op</span> <span class="id">tye1</span> <span class="id">tye2</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">tye1</span> <span class="id">s1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">tye2</span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">ty</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sbinop">sbinop</a></span> (<span class="kwd">fun</span> <span class="id">v1</span> <span class="id">v2</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.sem_binop">sem_binop</a></span> <span class="id">op</span> <span class="id">v1</span> <span class="id">tye1</span> <span class="id">v2</span> <span class="id">tye2</span>) <span class="id">s1</span> <span class="id">s2</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hop</span> <span class="id">Hwt1</span> <span class="id">Hwt2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.DSForall_pres">DSForall_pres</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sbinop">sbinop</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_zip">DSForall_zip</a></span>; <span class="id">intros</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id">HH</span>; <span class="id">inv</span> <span class="id">HH</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.pres_sem_binop">pres_sem_binop</a></span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.safe_ty_sbinop">safe_ty_sbinop</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">op</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">tye1</span> <span class="id">tye2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_ty">safe_ty</a></span> <span class="id">s1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_ty">safe_ty</a></span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_ty">safe_ty</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sbinop">sbinop</a></span> (<span class="kwd">fun</span> <span class="id">v1</span> <span class="id">v2</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.sem_binop">sem_binop</a></span> <span class="id">op</span> <span class="id">v1</span> <span class="id">tye1</span> <span class="id">v2</span> <span class="id">tye2</span>) <span class="id">s1</span> <span class="id">s2</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hsf1</span> <span class="id">Hsf2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_ty">safe_ty</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sbinop">sbinop</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_zip">DSForall_zip</a></span>; <span class="id">intros</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.safe_cl_sbinop">safe_cl_sbinop</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">op</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">tye1</span> <span class="id">tye2</span> <span class="id">ck</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_cl">safe_cl</a></span> <span class="id">s1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_cl">safe_cl</a></span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">s1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_cl">safe_cl</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sbinop">sbinop</a></span> (<span class="kwd">fun</span> <span class="id">v1</span> <span class="id">v2</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.sem_binop">sem_binop</a></span> <span class="id">op</span> <span class="id">v1</span> <span class="id">tye1</span> <span class="id">v2</span> <span class="id">tye2</span>) <span class="id">s1</span> <span class="id">s2</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hsf1</span> <span class="id">Hsf2</span> <span class="id">Hcl1</span> <span class="id">Hcl2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_cl">safe_cl</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sbinop">sbinop</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember_ds</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#ZIP">ZIP</a></span> _ <span class="id">s1</span> <span class="id">s2</span>) <span class="kwd">as</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hsf1</span> <span class="id">Hsf2</span> <span class="id">Hcl1</span> <span class="id">Hcl2</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ck</span>) <span class="kwd">as</span> <span class="id">C</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">t</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">apply</span> (<span class="id">Cof</span> <span class="id">s1</span> <span class="id">s2</span> _ <span class="id">C</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Classes.RelationClasses.html#symmetry">symmetry</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#zip_uncons">zip_uncons</a></span> <span class="kwd">in</span> <span class="id">Ht</span> <span class="kwd">as</span> (?&amp;?&amp;?&amp;?&amp; <span class="id">Hs1</span> &amp; <span class="id">Hs2</span> &amp; <span class="id">Ht</span> &amp; <span class="id">Hp</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hs1</span>, <span class="id">Hs2</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsf1</span>. <span class="id">inv</span> <span class="id">Hsf2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (@<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> _ <span class="id">C</span>) <span class="kwd">as</span> (<span class="id">vc</span> &amp; <span class="id">C'</span> &amp; <span class="id">Hc</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_le_compat">is_cons_le_compat</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_is_cons">AC_is_cons</a></span>; <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hc</span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_le_simpl">Con_le_simpl</a></span> <span class="kwd">in</span> <span class="id">Hcl1</span> <span class="kwd">as</span> [], <span class="id">Hcl2</span> <span class="kwd">as</span> []; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">cases_eqn</span> <span class="id">HH</span>; <span class="id">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id">Cof</span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.safe_op_sbinop">safe_op_sbinop</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">op</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">tye1</span> <span class="id">tye2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_op">safe_op</a></span> <span class="id">s1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_op">safe_op</a></span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.DSForall_2pres">DSForall_2pres</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">v1</span> <span class="id">v2</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.sem_binop">sem_binop</a></span> <span class="id">op</span> <span class="id">v1</span> <span class="id">tye1</span> <span class="id">v2</span> <span class="id">tye2</span> &lt;&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#ZIP">ZIP</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#pair">pair</a></span> <span class="id">s1</span> <span class="id">s2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_op">safe_op</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sbinop">sbinop</a></span> (<span class="kwd">fun</span> <span class="id">v1</span> <span class="id">v2</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.sem_binop">sem_binop</a></span> <span class="id">op</span> <span class="id">v1</span> <span class="id">tye1</span> <span class="id">v2</span> <span class="id">tye2</span>) <span class="id">s1</span> <span class="id">s2</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hsf1</span> <span class="id">Hsf2</span> <span class="id">Hop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_op">safe_op</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sbinop">sbinop</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember_ds</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#ZIP">ZIP</a></span> (<span class="kwd">fun</span> _ _ =&gt; _) <span class="id">s1</span> <span class="id">s2</span>) <span class="kwd">as</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hsf1</span> <span class="id">Hsf2</span> <span class="id">Hop</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">t</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">apply</span> (<span class="id">Cof</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">t</span>); <span class="id">eauto</span> 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Classes.RelationClasses.html#symmetry">symmetry</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#zip_uncons">zip_uncons</a></span> <span class="kwd">in</span> <span class="id">Ht</span> <span class="kwd">as</span> (?&amp;?&amp;?&amp;?&amp; <span class="id">Hs1</span> &amp; <span class="id">Hs2</span> &amp;?&amp; <span class="id">Hp</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hs1</span>, <span class="id">Hs2</span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#zip_cons">zip_cons</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsf1</span>. <span class="id">inv</span> <span class="id">Hsf2</span>. <span class="id">inv</span> <span class="id">Hop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">eauto</span> 2; <span class="id">cases_eqn</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.cl_sbinop">cl_sbinop</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">op</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">ck</span> <span class="id">tye1</span> <span class="id">tye2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">s1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.DSForall_2pres">DSForall_2pres</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">v1</span> <span class="id">v2</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.sem_binop">sem_binop</a></span> <span class="id">op</span> <span class="id">v1</span> <span class="id">tye1</span> <span class="id">v2</span> <span class="id">tye2</span> &lt;&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#ZIP">ZIP</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#pair">pair</a></span> <span class="id">s1</span> <span class="id">s2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sbinop">sbinop</a></span> (<span class="kwd">fun</span> <span class="id">v1</span> <span class="id">v2</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.sem_binop">sem_binop</a></span> <span class="id">op</span> <span class="id">v1</span> <span class="id">tye1</span> <span class="id">v2</span> <span class="id">tye2</span>) <span class="id">s1</span> <span class="id">s2</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ck</span>) <span class="kwd">as</span> <span class="id">C</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember_ds</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sbinop">sbinop</a></span> _ <span class="id">s1</span> <span class="id">s2</span>)) <span class="kwd">as</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Ht</span>. <span class="id">revert</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span> * <span class="id">Ht</span> * <span class="id">Hcl1</span> <span class="id">Hcl2</span> <span class="id">Hop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">apply</span> (<span class="id">Cof</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">t</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">destruct</span> (@<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> _ <span class="id">s1</span>) <span class="kwd">as</span> (<span class="id">v1</span> &amp; <span class="id">s1'</span> &amp; <span class="id">Hs1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj1">proj1</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sbinop_is_cons">sbinop_is_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_is_cons">AC_is_cons</a></span>; <span class="id">now</span> <span class="id">rewrite</span> &lt;- <span class="id">Ht</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (@<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> _ <span class="id">s2</span>) <span class="kwd">as</span> (<span class="id">v2</span> &amp; <span class="id">s2'</span> &amp; <span class="id">Hs2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sbinop_is_cons">sbinop_is_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_is_cons">AC_is_cons</a></span>; <span class="id">now</span> <span class="id">rewrite</span> &lt;- <span class="id">Ht</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (@<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#uncons">uncons</a></span> _ <span class="id">C</span>) <span class="kwd">as</span> (<span class="id">vc</span> &amp; <span class="id">C'</span> &amp; <span class="id">Hdec</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_le_compat">is_cons_le_compat</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_is_cons">AC_is_cons</a></span>; <span class="id">eauto</span>; <span class="id">now</span> <span class="id">rewrite</span> <span class="id">Hs2</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#decomp_eqCon">decomp_eqCon</a></span> <span class="kwd">in</span> <span class="id">Hdec</span> <span class="kwd">as</span> <span class="id">Hc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hc</span>, <span class="id">Hs1</span>, <span class="id">Hs2</span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sbinop_eq">sbinop_eq</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#zip_cons">zip_cons</a></span> <span class="kwd">in</span> *|-.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_eq_simpl">Con_eq_simpl</a></span> <span class="kwd">in</span> <span class="id">Ht</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_le_simpl">Con_le_simpl</a></span> <span class="kwd">in</span> <span class="id">Hcl1</span> <span class="kwd">as</span> [], <span class="id">Hcl2</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DSleCon">DSleCon</a></span> <span class="kwd">with</span> <span class="id">C'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">cases_eqn</span> <span class="id">HH</span>; <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> (<span class="id">Cof</span> <span class="id">s1'</span> <span class="id">s2'</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
<h2> Faits sur fby1/fby </h2>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.ty_fby1">ty_fby1</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty</span> <span class="id">b</span> <span class="id">ov</span> <span class="id">xs</span> <span class="id">ys</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">match</span> <span class="id">ov</span> <span class="kwd">with</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.wt_value">wt_value</a></span> <span class="id">v</span> <span class="id">ty</span> | _ =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span> <span class="kwd">end</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">ty</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">ty</span> <span class="id">ys</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">ty</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1s">fby1s</a></span> <span class="id">b</span> <span class="id">ov</span> <span class="id">xs</span> <span class="id">ys</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Wtv</span> <span class="id">Wt0</span> <span class="id">Wt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.DSForall_pres">DSForall_pres</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember_ds</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1s">fby1s</a></span> _ _ _ _) <span class="kwd">as</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert_all</span>; <span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>; <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> *; <span class="id">now</span> <span class="id">eauto</span> 2. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons">is_cons</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1s">fby1s</a></span> <span class="id">b</span> <span class="id">ov</span> <span class="id">xs</span> <span class="id">ys</span>)) <span class="kwd">as</span> <span class="id">Hc</span> <span class="kwd">by</span> (<span class="id">rewrite</span> &lt;- <span class="id">Ht</span>; <span class="id">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;fby1AP&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1AP_cons">fby1AP_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Hc</span> <span class="kwd">as</span> (<span class="id">y</span> &amp; <span class="id">ys'</span> &amp; <span class="id">Hy</span>); <span class="id">rewrite</span> <span class="id">Hy</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fold</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1AP">fby1AP</a></span> <span class="id">ov</span>) <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1AP_eq">fby1AP_eq</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (@<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> _ <span class="id">xs</span>) <span class="kwd">as</span> (<span class="id">x</span> &amp; <span class="id">xs'</span> &amp; <span class="id">Hx</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">cases</span>; <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Classes.RelationClasses.html#symmetry">symmetry</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#cons_is_cons">cons_is_cons</a></span> <span class="kwd">in</span> <span class="id">Ht</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eauto</span> 2 <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1_cons">fby1_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#map_is_cons">map_is_cons</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>; <span class="id">rewrite</span> <span class="id">Hx</span>, ?<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#map_eq_cons">map_eq_cons</a></span>, ?<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1_eq">fby1_eq</a></span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="id">cases</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;cas&nbsp;d'erreur&nbsp;(regarder&nbsp;Ht)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3,4,5,6,9,10: <span class="id">rewrite</span> <span class="id">Ht</span>, ?<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#map_comp">map_comp</a></span>; <span class="id">constructor</span>; <span class="id">auto</span>; <span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_map">DSForall_map</a></span>, <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_all">DSForall_all</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;les&nbsp;autres&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_eq_simpl">Con_eq_simpl</a></span> <span class="kwd">in</span> <span class="id">Ht</span> <span class="kwd">as</span> [? <span class="id">Ht</span>]; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">rewrite</span> <span class="id">Hx</span> <span class="kwd">in</span> <span class="id">Wt0</span>; <span class="id">inv</span> <span class="id">Wt0</span>; <span class="id">inv</span> <span class="id">Wt</span>; <span class="id">constructor</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1AP">fby1AP</a></span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="id">eapply</span> <span class="id">Cof</span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;fby1&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1_cons">fby1_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Hc</span> <span class="kwd">as</span> (<span class="id">x</span> &amp; <span class="id">xs'</span> &amp; <span class="id">Hx</span>); <span class="id">rewrite</span> <span class="id">Hx</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fold</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1">fby1</a></span> <span class="id">ov</span>) <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1_eq">fby1_eq</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>; <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_eq_simpl">Con_eq_simpl</a></span> <span class="kwd">in</span> <span class="id">Ht</span> <span class="kwd">as</span> [? <span class="id">Ht</span>]; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;cas&nbsp;d'erreur&nbsp;(regarder&nbsp;Ht)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3-6: <span class="id">rewrite</span> <span class="id">Ht</span>; <span class="id">constructor</span>; <span class="id">auto</span>; <span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_map">DSForall_map</a></span>, <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_all">DSForall_all</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;les&nbsp;autres&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">inv</span> <span class="id">Wt0</span>; <span class="id">constructor</span>; <span class="id">auto</span>; <span class="id">eapply</span> <span class="id">Cof</span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.ty_fby">ty_fby</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty</span> <span class="id">xs</span> <span class="id">ys</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">ty</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">ty</span> <span class="id">ys</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">ty</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby">fby</a></span> <span class="id">xs</span> <span class="id">ys</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Wt0</span> <span class="id">Wt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.DSForall_pres">DSForall_pres</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby">fby</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> <span class="kwd">as</span> <span class="id">b</span>; <span class="id">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember_ds</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fbys">fbys</a></span> _ _ _) <span class="kwd">as</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert_all</span>; <span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>; <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> *; <span class="id">now</span> <span class="id">eauto</span> 2. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons">is_cons</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fbys">fbys</a></span> <span class="id">b</span> <span class="id">xs</span> <span class="id">ys</span>)) <span class="kwd">as</span> <span class="id">Hc</span> <span class="kwd">by</span> (<span class="id">rewrite</span> &lt;- <span class="id">Ht</span>; <span class="id">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;fbyA&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fbyA_cons">fbyA_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Hc</span> <span class="kwd">as</span> (<span class="id">y</span> &amp; <span class="id">ys'</span> &amp; <span class="id">Hy</span>); <span class="id">rewrite</span> <span class="id">Hy</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fold</span> (@<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fbyA">fbyA</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>) <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fbyA_eq">fbyA_eq</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (@<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> _ <span class="id">xs</span>) <span class="kwd">as</span> (<span class="id">x</span> &amp; <span class="id">xs'</span> &amp; <span class="id">Hx</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">cases</span>; <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Classes.RelationClasses.html#symmetry">symmetry</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#cons_is_cons">cons_is_cons</a></span> <span class="kwd">in</span> <span class="id">Ht</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eauto</span> 2 <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby_cons">fby_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#map_is_cons">map_is_cons</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>; <span class="id">rewrite</span> <span class="id">Hx</span>, ?<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#map_eq_cons">map_eq_cons</a></span>, ?<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby_eq">fby_eq</a></span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="id">cases</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;cas&nbsp;d'erreur&nbsp;(regarder&nbsp;Ht)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3,4,5: <span class="id">rewrite</span> <span class="id">Ht</span>, ?<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#map_comp">map_comp</a></span>; <span class="id">constructor</span>; <span class="id">auto</span>; <span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_map">DSForall_map</a></span>, <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_all">DSForall_all</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_eq_simpl">Con_eq_simpl</a></span> <span class="kwd">in</span> <span class="id">Ht</span> <span class="kwd">as</span> [? <span class="id">Ht</span>]; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">rewrite</span> <span class="id">Hx</span> <span class="kwd">in</span> <span class="id">Wt0</span>; <span class="id">inv</span> <span class="id">Wt0</span>; <span class="id">inv</span> <span class="id">Wt</span>; <span class="id">constructor</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fbyA">fbyA</a></span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="id">eapply</span> <span class="id">Cof</span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id">Ht</span>; <span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_fby1">ty_fby1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;fby&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby_cons">fby_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Hc</span> <span class="kwd">as</span> (?&amp;?&amp; <span class="id">Hx</span>); <span class="id">rewrite</span> <span class="id">Hx</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fold</span> (@<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby">fby</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>) <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby_eq">fby_eq</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>; <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_eq_simpl">Con_eq_simpl</a></span> <span class="kwd">in</span> <span class="id">Ht</span> <span class="kwd">as</span> [? <span class="id">Ht</span>]; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;cas&nbsp;d'erreur&nbsp;(regarder&nbsp;Ht)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3: <span class="id">rewrite</span> <span class="id">Ht</span>; <span class="id">constructor</span>; <span class="id">auto</span>; <span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_map">DSForall_map</a></span>, <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_all">DSForall_all</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;les&nbsp;autres&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">inv</span> <span class="id">Wt0</span>; <span class="id">constructor</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fbyA">fbyA</a></span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="id">eapply</span> <span class="id">Cof</span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id">Ht</span>; <span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_fby1">ty_fby1</a></span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.cl_fby1">cl_fby1</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>} <span class="id">cs</span> <span class="id">v</span> (<span class="id">xs</span> <span class="id">ys</span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id">A</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> <span class="id">xs</span> &lt;= <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">ys</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> <span class="id">ys</span> &lt;= <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1">fby1</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>) <span class="id">xs</span> <span class="id">ys</span>) &lt;= <span class="id">cs</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember_ds</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1">fby1</a></span> _ _ _)) <span class="kwd">as</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert_all</span>; <span class="id">intro</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span> * <span class="id">Sx</span> <span class="id">Cx</span> <span class="id">Sy</span> <span class="id">Cy</span> [| <span class="id">b</span> <span class="id">t</span>] <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>. <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> <span class="id">Ht</span>. <span class="id">eapply</span> <span class="id">Cof</span> <span class="kwd">with</span> _ <span class="id">xs</span> <span class="id">ys</span>; <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons">is_cons</a></span> <span class="id">xs</span>) <span class="kwd">as</span> <span class="id">Hcx</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1_cons">fby1_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_is_cons">AC_is_cons</a></span>; <span class="id">now</span> <span class="id">rewrite</span> &lt;- <span class="id">Ht</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons">is_cons</a></span> <span class="id">cs</span>) <span class="kwd">as</span> <span class="id">Hcc</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#isCon_le">isCon_le</a></span>, <span class="id">Cx</span>; <span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_is_cons">AC_is_cons</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#uncons">uncons</a></span> <span class="kwd">in</span> <span class="id">Hcc</span> <span class="kwd">as</span> (<span class="id">vc</span> &amp; <span class="id">cs'</span> &amp; <span class="id">Hdec</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#decomp_eqCon">decomp_eqCon</a></span> <span class="kwd">in</span> <span class="id">Hdec</span> <span class="kwd">as</span> <span class="id">Hc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Hcx</span> <span class="kwd">as</span> (<span class="id">vx</span> &amp; <span class="id">xs'</span> &amp; <span class="id">Hx</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hx</span>, <span class="id">Hc</span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span> <span class="kwd">in</span> * |-; <span class="id">clear</span> <span class="id">Hc</span> <span class="id">Hx</span>; <span class="id">clear</span> <span class="id">xs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1_eq">fby1_eq</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>; <span class="id">inv</span> <span class="id">Sx</span>; <span class="id">try</span> <span class="id">tauto</span>; <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_le_simpl">Con_le_simpl</a></span> <span class="kwd">in</span> <span class="id">Cx</span> <span class="kwd">as</span> []; <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_eq_simpl">Con_eq_simpl</a></span> <span class="kwd">in</span> <span class="id">Ht</span> <span class="kwd">as</span> []; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">econstructor</span>; <span class="id">eauto</span>; <span class="id">clear</span> <span class="id">Hdec</span> <span class="id">cs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">revert_all</span>; <span class="id">intros</span> <span class="id">A</span> <span class="id">Cof</span>; <span class="kwd">cofix</span> <span class="id">Cof'</span>. <span class="id">intros</span> <span class="id">v</span> <span class="id">ys</span> <span class="id">xs'</span> <span class="id">cs'</span> ? <span class="id">Sy</span> ? [] <span class="id">Ht</span> ? ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>. <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> *. <span class="id">eapply</span> <span class="id">Cof'</span> <span class="kwd">with</span> _ <span class="id">ys</span> <span class="id">xs'</span>; <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (@<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> _ <span class="id">ys</span>) <span class="kwd">as</span> (<span class="id">vy</span> &amp; <span class="id">ys'</span> &amp; <span class="id">Hy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1AP_cons">fby1AP_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_is_cons">AC_is_cons</a></span>; <span class="id">now</span> <span class="id">rewrite</span> &lt;- <span class="id">Ht</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hy</span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span> <span class="kwd">in</span> *; <span class="id">clear</span> <span class="id">Hy</span> <span class="id">ys</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1AP_eq">fby1AP_eq</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>; <span class="id">inv</span> <span class="id">Sy</span>; <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_le_simpl">Con_le_simpl</a></span> <span class="kwd">in</span> <span class="id">Cy</span> <span class="kwd">as</span> []; <span class="id">try</span> <span class="id">tauto</span> || <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">Cof</span> <span class="kwd">with</span> _ <span class="id">xs'</span> <span class="id">ys'</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">revert_all</span>; <span class="id">intros</span> <span class="id">A</span> <span class="id">Cof</span>; <span class="kwd">cofix</span> <span class="id">Cof'</span>. <span class="id">intros</span> ? <span class="id">ys</span> ? <span class="id">xs'</span> <span class="id">cs'</span> ? <span class="id">Sy</span> ? [] <span class="id">Ht</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>. <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> *. <span class="id">eapply</span> <span class="id">Cof'</span> <span class="kwd">with</span> <span class="id">ys</span> <span class="id">xs'</span>; <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (@<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> _ <span class="id">ys</span>) <span class="kwd">as</span> (<span class="id">vy</span> &amp; <span class="id">ys'</span> &amp; <span class="id">Hy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1AP_cons">fby1AP_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_is_cons">AC_is_cons</a></span>; <span class="id">now</span> <span class="id">rewrite</span> &lt;- <span class="id">Ht</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hy</span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span> <span class="kwd">in</span> *; <span class="id">clear</span> <span class="id">Hy</span> <span class="id">ys</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1AP_eq">fby1AP_eq</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>; <span class="id">inv</span> <span class="id">Sy</span>; <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_le_simpl">Con_le_simpl</a></span> <span class="kwd">in</span> <span class="id">Cy</span> <span class="kwd">as</span> []; <span class="id">try</span> <span class="id">tauto</span> || <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> (<span class="id">Cof</span> _ <span class="id">a0</span> <span class="id">xs'</span> <span class="id">ys'</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.cl_fby">cl_fby</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ck</span> <span class="id">xs</span> <span class="id">ys</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">xs</span> /\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">xs</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">ys</span> /\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">ys</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby">fby</a></span> <span class="id">xs</span> <span class="id">ys</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>; <span class="id">intro</span> <span class="id">ck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ck</span>); <span class="id">clear</span> <span class="id">ck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>; <span class="id">intros</span> <span class="id">cs</span> ??  [<span class="id">Sx</span> <span class="id">Cx</span>][<span class="id">Sy</span> <span class="id">Cy</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember_ds</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby">fby</a></span> _ _)) <span class="kwd">as</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert_all</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span> * <span class="id">Sx</span> <span class="id">Cx</span> <span class="id">Sy</span> <span class="id">Cy</span> [| <span class="id">b</span> <span class="id">t</span>] <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>. <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> <span class="id">Ht</span>. <span class="id">eapply</span> <span class="id">Cof</span> <span class="kwd">with</span> <span class="id">xs</span> <span class="id">ys</span>; <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons">is_cons</a></span> <span class="id">xs</span>) <span class="kwd">as</span> <span class="id">Hcx</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby_cons">fby_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_is_cons">AC_is_cons</a></span>; <span class="id">now</span> <span class="id">rewrite</span> &lt;- <span class="id">Ht</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons">is_cons</a></span> <span class="id">cs</span>) <span class="kwd">as</span> <span class="id">Hcc</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#isCon_le">isCon_le</a></span>, <span class="id">Cx</span>; <span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_is_cons">AC_is_cons</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#uncons">uncons</a></span> <span class="kwd">in</span> <span class="id">Hcc</span> <span class="kwd">as</span> (<span class="id">vc</span> &amp; <span class="id">cs'</span> &amp; <span class="id">Hdec</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#decomp_eqCon">decomp_eqCon</a></span> <span class="kwd">in</span> <span class="id">Hdec</span> <span class="kwd">as</span> <span class="id">Hc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Hcx</span> <span class="kwd">as</span> (<span class="id">vx</span> &amp; <span class="id">xs'</span> &amp; <span class="id">Hx</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hx</span>, <span class="id">Hc</span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span> <span class="kwd">in</span> * |-; <span class="id">clear</span> <span class="id">Hc</span> <span class="id">Hx</span>; <span class="id">clear</span> <span class="id">xs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby_eq">fby_eq</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>; <span class="id">inv</span> <span class="id">Sx</span>; <span class="id">try</span> <span class="id">tauto</span>; <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_le_simpl">Con_le_simpl</a></span> <span class="kwd">in</span> <span class="id">Cx</span> <span class="kwd">as</span> []; <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_eq_simpl">Con_eq_simpl</a></span> <span class="kwd">in</span> <span class="id">Ht</span> <span class="kwd">as</span> [? <span class="id">Ht</span>]; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">econstructor</span>; <span class="id">eauto</span>; <span class="id">clear</span> <span class="id">Hdec</span> <span class="id">cs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">revert_all</span>; <span class="id">intro</span> <span class="id">Cof</span>; <span class="kwd">cofix</span> <span class="id">Cof'</span>. <span class="id">intros</span> <span class="id">ys</span> <span class="id">xs'</span> <span class="id">cs'</span> ? <span class="id">Sy</span> ? [] <span class="id">Ht</span> _ ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>. <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> *. <span class="id">eapply</span> <span class="id">Cof'</span> <span class="kwd">with</span> <span class="id">ys</span> <span class="id">xs'</span>; <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons">is_cons</a></span> <span class="id">ys</span>) <span class="kwd">as</span> <span class="id">Hcy</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fbyA_cons">fbyA_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_is_cons">AC_is_cons</a></span>; <span class="id">now</span> <span class="id">rewrite</span> &lt;- <span class="id">Ht</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Hcy</span> <span class="kwd">as</span> (<span class="id">vy</span> &amp; <span class="id">ys'</span> &amp; <span class="id">Hy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hy</span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span> <span class="kwd">in</span> *; <span class="id">clear</span> <span class="id">Hy</span> <span class="id">ys</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fbyA_eq">fbyA_eq</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>; <span class="id">inv</span> <span class="id">Sy</span>; <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_le_simpl">Con_le_simpl</a></span> <span class="kwd">in</span> <span class="id">Cy</span> <span class="kwd">as</span> []; <span class="id">try</span> <span class="id">tauto</span> || <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">Cof</span> <span class="kwd">with</span> <span class="id">xs'</span> <span class="id">ys'</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">revert_all</span>; <span class="id">intro</span> <span class="id">Cof</span>; <span class="kwd">cofix</span> <span class="id">Cof'</span>. <span class="id">intros</span> <span class="id">ys</span> ? <span class="id">xs'</span> <span class="id">cs'</span> ? <span class="id">Sy</span> ? [] <span class="id">Ht</span> _ ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>. <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> *. <span class="id">eapply</span> <span class="id">Cof'</span> <span class="kwd">with</span> <span class="id">ys</span> <span class="id">xs'</span>; <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons">is_cons</a></span> <span class="id">ys</span>) <span class="kwd">as</span> <span class="id">Hcy</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1AP_cons">fby1AP_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_is_cons">AC_is_cons</a></span>; <span class="id">now</span> <span class="id">rewrite</span> &lt;- <span class="id">Ht</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#uncons">uncons</a></span> <span class="kwd">in</span> <span class="id">Hcy</span> <span class="kwd">as</span> (<span class="id">vy</span> &amp; <span class="id">ys'</span> &amp; <span class="id">Hdec</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#decomp_eqCon">decomp_eqCon</a></span> <span class="kwd">in</span> <span class="id">Hdec</span> <span class="kwd">as</span> <span class="id">Hy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hy</span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1AP_eq">fby1AP_eq</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>; <span class="id">inv</span> <span class="id">Sy</span>; <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_le_simpl">Con_le_simpl</a></span> <span class="kwd">in</span> <span class="id">Cy</span> <span class="kwd">as</span> []; <span class="id">try</span> <span class="id">tauto</span> || <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#cons">cons</a></span> <span class="id">b</span> <span class="id">d</span> &lt;= <span class="id">cs'</span>). <span class="comment">(*&nbsp;sinon&nbsp;rewrite&nbsp;Ht&nbsp;ne&nbsp;marche&nbsp;pas&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Ht</span>; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_fby1">cl_fby1</a></span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.safe_fby1">safe_fby1</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>} <span class="id">v</span> <span class="id">cs</span> (<span class="id">xs</span> <span class="id">ys</span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id">A</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> <span class="id">xs</span> &lt;= <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">ys</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> <span class="id">ys</span> &lt;= <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1">fby1</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>) <span class="id">xs</span> <span class="id">ys</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>; <span class="id">intros</span> * <span class="id">Sx</span> <span class="id">Cx</span> <span class="id">Sy</span> <span class="id">Cy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember_ds</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1">fby1</a></span> _ _ _) <span class="kwd">as</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert_all</span>; <span class="id">intro</span> <span class="id">A</span>; <span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">t</span> <span class="kwd">as</span> [| <span class="id">b</span> <span class="id">t</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>. <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> <span class="id">Ht</span>. <span class="id">apply</span> <span class="id">Cof</span> <span class="kwd">with</span> <span class="id">v</span> <span class="id">cs</span> <span class="id">xs</span> <span class="id">ys</span>; <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons">is_cons</a></span> <span class="id">xs</span>) <span class="kwd">as</span> <span class="id">Hcx</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1_cons">fby1_cons</a></span>; <span class="id">now</span> <span class="id">rewrite</span> &lt;- <span class="id">Ht</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Hcx</span> <span class="kwd">as</span> (<span class="id">vx</span> &amp; <span class="id">xs'</span> &amp; <span class="id">Hx</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hx</span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span> <span class="kwd">in</span> *; <span class="id">clear</span> <span class="id">Hx</span> <span class="id">xs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1_eq">fby1_eq</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>; <span class="id">inv</span> <span class="id">Sx</span>; <span class="id">try</span> <span class="id">tauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_eq_simpl">Con_eq_simpl</a></span> <span class="kwd">in</span> <span class="id">Ht</span> <span class="kwd">as</span> [? <span class="id">Ht</span>]; <span class="id">subst</span>; <span class="id">constructor</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">revert_all</span>; <span class="id">intros</span> <span class="id">A</span> <span class="id">Cof</span>; <span class="kwd">cofix</span> <span class="id">Cof'</span>. <span class="id">intros</span> <span class="id">v</span> <span class="id">cs</span> <span class="id">ys</span> <span class="id">xs'</span> <span class="id">Cx'</span> <span class="id">Sy</span> ? [] <span class="id">Ht</span> _ ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>. <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> <span class="id">Ht</span>. <span class="id">apply</span> <span class="id">Cof'</span> <span class="kwd">with</span> <span class="id">v</span> <span class="id">cs</span> <span class="id">ys</span> <span class="id">xs'</span>; <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons">is_cons</a></span> <span class="id">ys</span>) <span class="kwd">as</span> <span class="id">Hcy</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1AP_cons">fby1AP_cons</a></span>; <span class="id">now</span> <span class="id">rewrite</span> &lt;- <span class="id">Ht</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Hcy</span> <span class="kwd">as</span> (<span class="id">vy</span> &amp; <span class="id">ys'</span> &amp; <span class="id">Hy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hy</span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span> <span class="kwd">in</span> *; <span class="id">clear</span> <span class="id">Hy</span> <span class="id">ys</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1AP_eq">fby1AP_eq</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>; <span class="id">inv</span> <span class="id">Sy</span>; <span class="id">try</span> <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2: <span class="id">now</span> <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_le_le">Con_le_le</a></span> <span class="kwd">in</span> <span class="id">Cx'</span>; <span class="id">eauto</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_le_compat">rem_le_compat</a></span> <span class="kwd">in</span> <span class="id">Cx'</span>, <span class="id">Cy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_cons">rem_cons</a></span> <span class="kwd">in</span> <span class="id">Cx'</span>, <span class="id">Cy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">Cof</span> <span class="kwd">with</span> <span class="id">v</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem">rem</a></span> <span class="id">cs</span>) <span class="id">xs'</span> <span class="id">ys'</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">revert_all</span>; <span class="id">intros</span> <span class="id">A</span> <span class="id">Cof</span>; <span class="kwd">cofix</span> <span class="id">Cof'</span>. <span class="id">intros</span> ? <span class="id">cs</span> <span class="id">ys</span> ? <span class="id">xs'</span> <span class="id">Cx'</span> <span class="id">Sy</span> ? [] <span class="id">Ht</span> _ ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>. <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> <span class="id">Ht</span>. <span class="id">apply</span> <span class="id">Cof'</span> <span class="kwd">with</span> <span class="id">cs</span> <span class="id">ys</span> <span class="id">xs'</span>; <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons">is_cons</a></span> <span class="id">ys</span>) <span class="kwd">as</span> <span class="id">Hcy</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1AP_cons">fby1AP_cons</a></span>; <span class="id">now</span> <span class="id">rewrite</span> &lt;- <span class="id">Ht</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Hcy</span> <span class="kwd">as</span> (<span class="id">vy</span> &amp; <span class="id">ys'</span> &amp; <span class="id">Hy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hy</span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span> <span class="kwd">in</span> *; <span class="id">clear</span> <span class="id">Hy</span> <span class="id">ys</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1AP_eq">fby1AP_eq</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>; <span class="id">inv</span> <span class="id">Sy</span>; <span class="id">try</span> <span class="id">tauto</span>. <span class="id">now</span> <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_le_le">Con_le_le</a></span> <span class="kwd">in</span> <span class="id">Cx'</span>; <span class="id">eauto</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_le_compat">rem_le_compat</a></span> <span class="kwd">in</span> <span class="id">Cx'</span>, <span class="id">Cy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_cons">rem_cons</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">Cof</span> <span class="kwd">with</span> <span class="id">a0</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem">rem</a></span> <span class="id">cs</span>) <span class="id">xs'</span> <span class="id">ys'</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.safe_fby">safe_fby</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ck</span> <span class="id">xs</span> <span class="id">ys</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">xs</span> /\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">ys</span> /\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">ys</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby">fby</a></span> <span class="id">xs</span> <span class="id">ys</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>; <span class="id">intro</span> <span class="id">ck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ck</span>); <span class="id">clear</span> <span class="id">ck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>; <span class="id">intros</span> <span class="id">cs</span> * [<span class="id">Sx</span> <span class="id">Cx</span>] [<span class="id">Sy</span> <span class="id">Cy</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember_ds</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby">fby</a></span> _ _) <span class="kwd">as</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert_all</span>; <span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">t</span> <span class="kwd">as</span> [| <span class="id">b</span> <span class="id">t</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>. <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> <span class="id">Ht</span>. <span class="id">apply</span> <span class="id">Cof</span> <span class="kwd">with</span> <span class="id">cs</span> <span class="id">xs</span> <span class="id">ys</span>; <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons">is_cons</a></span> <span class="id">xs</span>) <span class="kwd">as</span> <span class="id">Hcx</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby_cons">fby_cons</a></span>; <span class="id">now</span> <span class="id">rewrite</span> &lt;- <span class="id">Ht</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Hcx</span> <span class="kwd">as</span> (<span class="id">vx</span> &amp; <span class="id">xs'</span> &amp; <span class="id">Hx</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hx</span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span> <span class="kwd">in</span> *; <span class="id">clear</span> <span class="id">Hx</span> <span class="id">xs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby_eq">fby_eq</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>; <span class="id">inv</span> <span class="id">Sx</span>; <span class="id">try</span> <span class="id">tauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_eq_simpl">Con_eq_simpl</a></span> <span class="kwd">in</span> <span class="id">Ht</span> <span class="kwd">as</span> [? <span class="id">Ht</span>]; <span class="id">subst</span>; <span class="id">constructor</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">revert_all</span>; <span class="id">intro</span> <span class="id">Cof</span>; <span class="kwd">cofix</span> <span class="id">Cof'</span>. <span class="id">intros</span> <span class="id">cs</span> <span class="id">ys</span> <span class="id">xs'</span> <span class="id">Cx'</span> <span class="id">Sy</span> <span class="id">Cy</span> [] <span class="id">Ht</span> ? <span class="id">Sx'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>. <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> <span class="id">Ht</span>. <span class="id">apply</span> <span class="id">Cof'</span> <span class="kwd">with</span> <span class="id">cs</span> <span class="id">ys</span> <span class="id">xs'</span>; <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons">is_cons</a></span> <span class="id">ys</span>) <span class="kwd">as</span> <span class="id">Hcy</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fbyA_cons">fbyA_cons</a></span>; <span class="id">now</span> <span class="id">rewrite</span> &lt;- <span class="id">Ht</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Hcy</span> <span class="kwd">as</span> (<span class="id">vy</span> &amp; <span class="id">ys'</span> &amp; <span class="id">Hy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hy</span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span> <span class="kwd">in</span> *; <span class="id">clear</span> <span class="id">Hy</span> <span class="id">ys</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fbyA_eq">fbyA_eq</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>; <span class="id">inv</span> <span class="id">Sy</span>; <span class="id">try</span> <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2: <span class="id">now</span> <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_le_le">Con_le_le</a></span> <span class="kwd">in</span> <span class="id">Cx'</span>; <span class="id">eauto</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_le_compat">rem_le_compat</a></span> <span class="kwd">in</span> <span class="id">Cx'</span>, <span class="id">Cy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_cons">rem_cons</a></span> <span class="kwd">in</span> <span class="id">Cx'</span>, <span class="id">Cy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">Cof</span> <span class="kwd">with</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem">rem</a></span> <span class="id">cs</span>) <span class="id">xs'</span> <span class="id">ys'</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">revert_all</span>; <span class="id">intro</span> <span class="id">Cof</span>; <span class="kwd">cofix</span> <span class="id">Cof'</span>. <span class="id">intros</span> <span class="id">cs</span> <span class="id">ys</span> ? <span class="id">xs'</span> <span class="id">Cx'</span> <span class="id">Sy</span> ? [] <span class="id">Ht</span> _ ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>. <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> <span class="id">Ht</span>. <span class="id">apply</span> <span class="id">Cof'</span> <span class="kwd">with</span> <span class="id">cs</span> <span class="id">ys</span> <span class="id">xs'</span>; <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons">is_cons</a></span> <span class="id">ys</span>) <span class="kwd">as</span> <span class="id">Hcy</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1AP_cons">fby1AP_cons</a></span>; <span class="id">now</span> <span class="id">rewrite</span> &lt;- <span class="id">Ht</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Hcy</span> <span class="kwd">as</span> (<span class="id">vy</span> &amp; <span class="id">ys'</span> &amp; <span class="id">Hy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hy</span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span> <span class="kwd">in</span> *; <span class="id">clear</span> <span class="id">Hy</span> <span class="id">ys</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fby1AP_eq">fby1AP_eq</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>; <span class="id">inv</span> <span class="id">Sy</span>; <span class="id">try</span> <span class="id">tauto</span>. <span class="id">now</span> <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_le_le">Con_le_le</a></span> <span class="kwd">in</span> <span class="id">Cx'</span>; <span class="id">eauto</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_le_compat">rem_le_compat</a></span> <span class="kwd">in</span> <span class="id">Cx'</span>, <span class="id">Cy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Ht</span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_cons">rem_cons</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_fby1">safe_fby1</a></span> <span class="kwd">with</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem">rem</a></span> <span class="id">cs</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
<br/>
<h2> Faits sur swhenv </h2>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.ty_swhenv">ty_swhenv</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty</span> <span class="id">xs</span> <span class="id">tx</span> <span class="id">tn</span> <span class="id">k</span> <span class="id">cs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">k</span> &lt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">tn</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">ty</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.Tenum">Tenum</a></span> <span class="id">tx</span> <span class="id">tn</span>) <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">ty</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.swhenv">swhenv</a></span> <span class="id">k</span> <span class="id">xs</span> <span class="id">cs</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hk</span> <span class="id">Wtx</span> <span class="id">Wtc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.DSForall_pres">DSForall_pres</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.swhenv">swhenv</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember_ds</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#swhen">swhen</a></span> _ _ _ _ _ _) <span class="kwd">as</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> <span class="id">dependent</span> <span class="id">cs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> <span class="id">dependent</span> <span class="id">xs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>; <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> *; <span class="id">now</span> <span class="id">eauto</span> 2. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons">is_cons</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#swhen">swhen</a></span> _ _ _ <span class="id">k</span> <span class="id">xs</span> <span class="id">cs</span>)) <span class="kwd">as</span> <span class="id">Hc</span> <span class="kwd">by</span> (<span class="id">rewrite</span> &lt;- <span class="id">Ht</span>; <span class="id">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#swhen_cons">swhen_cons</a></span> <span class="kwd">in</span> <span class="id">Hc</span> <span class="kwd">as</span> [<span class="id">Hx</span> <span class="id">Hc</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Hc</span> <span class="kwd">as</span> (?&amp;?&amp;<span class="id">Hc</span>), <span class="id">Hx</span> <span class="kwd">as</span> (?&amp;?&amp;<span class="id">Hx</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hx</span>, <span class="id">Hc</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Wtx</span>. <span class="id">inv</span> <span class="id">Wtc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#swhen_eq">swhen_eq</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_eq_simpl">Con_eq_simpl</a></span> <span class="kwd">in</span> <span class="id">Ht</span> <span class="kwd">as</span> (? &amp; <span class="id">Ht</span>); <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">constructor</span>; <span class="id">auto</span>; <span class="id">eapply</span> <span class="id">Cof</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.cl_swhenv">cl_swhenv</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">xs</span> <span class="id">ck</span> <span class="id">x</span> <span class="id">ty</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">cs</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.ins">ins</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.envI">envI</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.env">env</a></span> <span class="id">x</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">xs</span> /\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">xs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">cs</span> /\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.Con">Con</a></span> <span class="id">ck</span> <span class="id">x</span> (<span class="id">ty</span>, <span class="id">k</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.swhenv">swhenv</a></span> <span class="id">k</span> <span class="id">xs</span> <span class="id">cs</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.swhenv">swhenv</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * (<span class="id">Sx</span> &amp; <span class="id">Cx</span> &amp; <span class="id">Sc</span> &amp; <span class="id">Cc</span>); <span class="id">simpl</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> _).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DSle_rec_eq">DSle_rec_eq</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">R</span> := <span class="kwd">fun</span> <span class="id">U</span> <span class="id">V</span> =&gt; <span class="kwd">exists</span> <span class="id">xs</span> <span class="id">cs</span> <span class="id">cks</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">cs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">xs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> <span class="id">cs</span> &lt;= <span class="id">cks</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> <span class="id">xs</span> &lt;= <span class="id">cks</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">U</span> == <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#swhen">swhen</a></span> _ _ _ <span class="id">k</span> <span class="id">xs</span> <span class="id">cs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">V</span> == <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#ZIP">ZIP</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sample">sample</a></span> <span class="id">k</span>) <span class="id">cs</span> <span class="id">cks</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;3: <span class="id">eauto</span> 9.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">intros</span> * ? <span class="id">J</span> <span class="id">K</span>. <span class="id">setoid_rewrite</span> &lt;- <span class="id">J</span>. <span class="id">setoid_rewrite</span> &lt;- <span class="id">K</span>. <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">u</span> <span class="id">U</span> <span class="id">V</span> (<span class="id">xs</span> &amp; <span class="id">cs</span> &amp; <span class="id">cks</span> &amp; <span class="id">Sc</span> &amp; <span class="id">Sx</span> &amp; <span class="id">Cc</span> &amp; <span class="id">Cx</span> &amp; <span class="id">HU</span> &amp; <span class="id">HV</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (@<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> _ <span class="id">xs</span>) <span class="kwd">as</span> (<span class="id">x</span> &amp; <span class="id">xs'</span> &amp;<span class="id">Hx</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj1">proj1</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#swhen_cons">swhen_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_is_cons">AC_is_cons</a></span>; <span class="id">now</span> <span class="id">rewrite</span> &lt;- <span class="id">HU</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (@<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> _ <span class="id">cs</span>) <span class="kwd">as</span> (<span class="id">c</span> &amp; <span class="id">cs'</span> &amp;<span class="id">Hc</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#swhen_cons">swhen_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_is_cons">AC_is_cons</a></span>; <span class="id">now</span> <span class="id">rewrite</span> &lt;- <span class="id">HU</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hc</span>, <span class="id">Hx</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">Sx</span>. <span class="id">inv</span> <span class="id">Sc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#swhen_eq">swhen_eq</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#DSle_cons_elim">DSle_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Cx</span> <span class="kwd">as</span> <span class="id">HH</span>; <span class="id">destruct</span> <span class="id">HH</span> <span class="kwd">as</span> (? &amp; <span class="id">Hcs</span> &amp;?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hcs</span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#zip_cons">zip_cons</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_eq_simpl">Con_eq_simpl</a></span> <span class="kwd">in</span> <span class="id">HU</span> <span class="kwd">as</span> (?&amp; <span class="id">Hu</span>); <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_le_simpl">Con_le_simpl</a></span> <span class="kwd">in</span> <span class="id">Cx</span> <span class="kwd">as</span> (?&amp; <span class="id">Cx</span>), <span class="id">Cc</span> <span class="kwd">as</span> (?&amp; <span class="id">Cc</span>); <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id">HH</span>; <span class="id">subst</span>; <span class="id">try</span> <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">simpl</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sample">sample</a></span> _ _ _) <span class="kwd">in</span> <span class="id">HV</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">try</span> <span class="id">take</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> _ = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> _) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">try</span> <span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#err">err</a></span> _ = <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#err">err</a></span> _) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">try</span> <span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#pres">pres</a></span> _ = <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#pres">pres</a></span> _) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">try</span> (<span class="id">take</span> ((_ =? _) = _) <span class="id">and</span> <span class="id">rewrite</span> <span class="id">it</span> <span class="kwd">in</span> * ).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">esplit</span>; <span class="id">split</span>; [ | <span class="kwd">exists</span> <span class="id">xs'</span>, <span class="id">cs'</span>; <span class="id">eauto</span> 8 ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">rewrite</span> <span class="id">HV</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#cons_eq_compat">cons_eq_compat</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">a</span>; [ <span class="id">reflexivity</span> | ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html#andb_false_r">Bool.andb_false_r</a></span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.safe_swhenv">safe_swhenv</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">k</span> <span class="id">tx</span> <span class="id">tn</span> <span class="id">ck</span> <span class="id">xs</span> <span class="id">cs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.Tenum">Tenum</a></span> <span class="id">tx</span> <span class="id">tn</span>) <span class="id">cs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">xs</span> /\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">xs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">cs</span> /\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.swhenv">swhenv</a></span> <span class="id">k</span> <span class="id">xs</span> <span class="id">cs</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.swhenv">swhenv</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> ????.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ck</span>); <span class="id">clear</span> <span class="id">ck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>; <span class="id">intros</span> <span class="id">cks</span> * (<span class="id">Tx</span> &amp; <span class="id">Sx</span> &amp; <span class="id">Cx</span> &amp; <span class="id">Sc</span> &amp; <span class="id">Cc</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember_ds</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#swhen">swhen</a></span> _ _ _ <span class="id">k</span> _ _) <span class="kwd">as</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert_all</span>; <span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">t</span> <span class="kwd">as</span> [| <span class="id">b</span> <span class="id">t</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>. <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> <span class="id">Ht</span>. <span class="id">apply</span> <span class="id">Cof</span> <span class="kwd">with</span> <span class="id">k</span> <span class="id">tx</span> <span class="id">tn</span> <span class="id">cks</span> <span class="id">xs</span> <span class="id">cs</span>; <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons">is_cons</a></span> <span class="id">xs</span>) <span class="kwd">as</span> <span class="id">Hcx</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj1">proj1</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#swhen_cons">swhen_cons</a></span>; <span class="id">now</span> <span class="id">rewrite</span> &lt;- <span class="id">Ht</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons">is_cons</a></span> <span class="id">cs</span>) <span class="kwd">as</span> <span class="id">Hcc</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#swhen_cons">swhen_cons</a></span>; <span class="id">now</span> <span class="id">rewrite</span> &lt;- <span class="id">Ht</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Hcx</span> <span class="kwd">as</span> (<span class="id">vx</span> &amp; <span class="id">xs'</span> &amp; <span class="id">Hx</span>), <span class="id">Hcc</span> <span class="kwd">as</span> (<span class="id">vc</span> &amp; <span class="id">cs'</span> &amp; <span class="id">Hc</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hx</span>, <span class="id">Hc</span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span> <span class="kwd">in</span> *; <span class="id">clear</span> <span class="id">Hx</span> <span class="id">xs</span> <span class="id">Hc</span> <span class="id">cs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.swhenv">swhenv</a></span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#swhen_eq">swhen_eq</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id">HH</span>; <span class="id">inv</span> <span class="id">Sx</span>; <span class="id">inv</span> <span class="id">Sc</span>; <span class="id">inv</span> <span class="id">Tx</span>; <span class="id">try</span> <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_le_le">Con_le_le</a></span> _ _ _ _ _ _ <span class="id">Cx</span> <span class="id">Cc</span>); <span class="id">try</span> <span class="id">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_eq_simpl">Con_eq_simpl</a></span> <span class="kwd">in</span> <span class="id">Ht</span> <span class="kwd">as</span> [? <span class="id">Ht</span>]; <span class="id">subst</span>; <span class="id">constructor</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_le_compat">rem_le_compat</a></span> <span class="kwd">in</span> <span class="id">Cx</span>, <span class="id">Cc</span>; <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_cons">rem_cons</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">eapply</span> <span class="id">Cof</span> <span class="kwd">with</span> <span class="id">k</span> <span class="id">tx</span> <span class="id">tn</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem">rem</a></span> <span class="id">cks</span>) <span class="id">xs'</span> <span class="id">cs'</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
<h2> Faits sur smergev </h2>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.zip_ac_le">zip_ac_le</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> <span class="id">B</span> (<span class="id">f</span> : <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id">A</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> -&gt; <span class="id">B</span>) (<span class="id">X</span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id">A</span>)) <span class="id">Y</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> <span class="id">X</span> &lt;= <span class="id">Y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#ZIP">ZIP</a></span> <span class="id">f</span> <span class="id">X</span> <span class="id">Y</span> &lt;= <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#ZIP">ZIP</a></span> <span class="id">f</span> <span class="id">X</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> <span class="id">X</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>; <span class="id">intros</span> * <span class="id">Hle</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#DSle_rec_eq2">DSle_rec_eq2</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">R</span> := <span class="kwd">fun</span> <span class="id">U</span> <span class="id">V</span> =&gt; <span class="kwd">exists</span> <span class="id">X</span> <span class="id">Y</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> <span class="id">X</span> &lt;= <span class="id">Y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">U</span> == <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#ZIP">ZIP</a></span> <span class="id">f</span> <span class="id">X</span> <span class="id">Y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">V</span> == <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#ZIP">ZIP</a></span> <span class="id">f</span> <span class="id">X</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> <span class="id">X</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;3: <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">intros</span> * (?&amp;?&amp;?&amp;?&amp;?) <span class="id">Eq1</span> <span class="id">Eq2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> &lt;- <span class="id">Eq1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> &lt;- <span class="id">Eq2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>; <span class="id">intros</span> <span class="id">U</span> <span class="id">V</span> <span class="id">Hc</span> (<span class="id">X</span>&amp; <span class="id">Y</span> &amp; <span class="id">Le</span> &amp; <span class="id">Hu</span> &amp; <span class="id">Hv</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hu</span>, <span class="id">Hv</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#zip_is_cons">zip_is_cons</a></span> <span class="kwd">in</span> <span class="id">Hc</span> <span class="kwd">as</span> [<span class="id">Cx</span> <span class="id">Cy</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Cx</span> <span class="kwd">as</span> (<span class="id">x</span> &amp; <span class="id">X'</span> &amp; <span class="id">Hx</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Cy</span> <span class="kwd">as</span> (<span class="id">y</span> &amp; <span class="id">Y'</span> &amp; <span class="id">Hy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hx</span>, <span class="id">Hy</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id">Hu</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id">Hv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">rewrite</span> ?<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#zip_cons">zip_cons</a></span>, ?<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span>, ?<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#first_cons">first_cons</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_le_simpl">Con_le_simpl</a></span> <span class="kwd">in</span> <span class="id">Le</span> <span class="kwd">as</span> [? <span class="id">Le</span>]; <span class="id">subst</span>; <span class="id">split</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">X'</span>, <span class="id">Y'</span>; <span class="id">split</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>; <span class="id">repeat</span> <span class="id">rewrite</span> ?<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#zip_cons">zip_cons</a></span>, ?<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_cons">rem_cons</a></span>, ?<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.ty_smergev">ty_smergev</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty</span> <span class="id">tx</span> <span class="id">tn</span> <span class="id">l</span> <span class="id">cs</span> <span class="id">np</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.Tenum">Tenum</a></span> <span class="id">tx</span> <span class="id">tn</span>) <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">ty</span>) <span class="id">np</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">ty</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.smergev">smergev</a></span> <span class="id">l</span> <span class="id">cs</span> <span class="id">np</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Wtx</span> <span class="id">Wtnp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.DSForall_pres">DSForall_pres</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.smergev">smergev</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#smerge_eq">smerge_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Wtnp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">np</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">l</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Foldi_nil">Foldi_nil</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_map">DSForall_map</a></span>, <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_impl">DSForall_impl</a></span>; <span class="id">eauto</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> []; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Foldi_cons">Foldi_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_hd">forall_nprod_hd</a></span> <span class="kwd">in</span> <span class="id">Wtnp</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_zip3">DSForall_zip3</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_tl">forall_nprod_tl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fmerge">fmerge</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">cases_eqn</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="LDENOTSAFE.value_belongs">value_belongs</a></span> (<span class="id">l</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.enumtag">enumtag</a></span>) (<span class="id">v</span> : <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#pres">pres</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.Venum">Venum</a></span> <span class="id">v</span>) =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> <span class="id">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#abs">abs</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| _ =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.cl_smergev_">cl_smergev_</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">tx</span> <span class="id">ck</span> <span class="id">l</span> <span class="id">np</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">cs</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.ins">ins</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.envI">envI</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.env">env</a></span> <span class="id">x</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">l</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l</span> &lt;&gt; [] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall">DSForall</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.value_belongs">value_belongs</a></span> <span class="id">l</span>) <span class="id">cs</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">np</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">i</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.Con">Con</a></span> <span class="id">ck</span> <span class="id">x</span> (<span class="id">tx</span>,<span class="id">i</span>)) <span class="id">s</span>) <span class="id">l</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">np</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.smergev">smergev</a></span> <span class="id">l</span> <span class="id">cs</span> <span class="id">np</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Nd</span> <span class="id">Nnil</span> <span class="id">Tc</span> <span class="id">Cc</span> <span class="id">Sn</span> <span class="id">Cn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Cn</span> <span class="id">Cc</span> <span class="id">Tc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.Con">Con</a></span> _ _ _)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fold</span> <span class="id">cs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> <span class="id">dependent</span> <span class="id">cs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ck</span>) <span class="kwd">as</span> <span class="id">sck</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> <span class="id">ck</span> <span class="id">x</span> <span class="id">tx</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.smergev">smergev</a></span> <span class="id">l</span> <span class="id">cs</span> <span class="id">np</span>) &lt;= <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> <span class="id">cs</span>); <span class="id">eauto</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_impl_In">Forall2_impl_In</a></span> <span class="kwd">with</span> (<span class="id">Q</span> := <span class="kwd">fun</span> <span class="id">i</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> <span class="id">s</span> &lt;= <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#ZIP">ZIP</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sample">sample</a></span> <span class="id">i</span>) <span class="id">cs</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> <span class="id">cs</span>)) <span class="kwd">in</span> <span class="id">Cn</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">eauto</span> 3 <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.zip_ac_le">zip_ac_le</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> <span class="id">Cc</span> <span class="id">sck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;fin&nbsp;de&nbsp;la&nbsp;préparation,&nbsp;début&nbsp;du&nbsp;raisonnement&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#DSle_rec_eq2">DSle_rec_eq2</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">R</span> := <span class="kwd">fun</span> <span class="id">U</span> <span class="id">V</span> =&gt; <span class="kwd">exists</span> <span class="id">np</span> <span class="id">cs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">np</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">i</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> <span class="id">s</span> &lt;= <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#ZIP">ZIP</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sample">sample</a></span> <span class="id">i</span>) <span class="id">cs</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> <span class="id">cs</span>)) <span class="id">l</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">np</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall">DSForall</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.value_belongs">value_belongs</a></span> <span class="id">l</span>) <span class="id">cs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">U</span> == <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.smergev">smergev</a></span> <span class="id">l</span> <span class="id">cs</span> <span class="id">np</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">V</span> == <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> <span class="id">cs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;3: <span class="id">eauto</span> 7.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">intros</span> * ? <span class="id">J</span> <span class="id">K</span>. <span class="id">setoid_rewrite</span> &lt;- <span class="id">J</span>. <span class="id">setoid_rewrite</span> &lt;- <span class="id">K</span>. <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> - <span class="id">Nd</span> <span class="id">Nnil</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">U</span> <span class="id">V</span> <span class="id">Hc</span> (<span class="id">np</span> &amp; <span class="id">cs</span> &amp; <span class="id">Sn</span> &amp; <span class="id">Cn</span> &amp; <span class="id">Tc</span> &amp; <span class="id">Hu</span> &amp; <span class="id">Hv</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hu</span> <span class="kwd">in</span> <span class="id">Hc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_is_cons">AC_is_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#smerge_is_cons">smerge_is_cons</a></span> <span class="kwd">in</span> <span class="id">Hc</span> <span class="kwd">as</span> [<span class="id">Icc</span> <span class="id">Icn</span>]; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (@<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> _ <span class="id">cs</span>) <span class="kwd">as</span> (<span class="id">c</span> &amp; <span class="id">cs'</span> &amp; <span class="id">Heqc</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Heqc</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id">Heqc</span> <span class="kwd">in</span> <span class="id">Cn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.smergev">smergev</a></span> <span class="kwd">in</span> <span class="id">Hu</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Tc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unshelve</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#smerge_cons">smerge_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span> <span class="kwd">in</span> <span class="id">Hu</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span> <span class="kwd">in</span> <span class="id">Hv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id">Hu</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id">Hv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> <span class="id">Hu</span> <span class="id">Hv</span> <span class="id">Heqc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;first&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> 2 <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#first_cons">first_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#cons_eq_compat">cons_eq_compat</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id">HH</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fmerge_abs">fmerge_abs</a></span> <span class="kwd">in</span> <span class="id">HH</span> <span class="kwd">as</span> []; <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2: <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fmerge_pres">fmerge_pres</a></span> <span class="kwd">in</span> <span class="id">HH</span> <span class="kwd">as</span> (?&amp;?&amp;?&amp;?&amp;?); <span class="id">try</span> <span class="id">congruence</span>; <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eqb_eq">Nat.eqb_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;montrons&nbsp;qu'il&nbsp;ne&nbsp;peut&nbsp;pas&nbsp;y&nbsp;avoir&nbsp;d'erreur&nbsp;dans&nbsp;ce&nbsp;cas&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">a</span> <span class="kwd">as</span> [|<span class="id">j</span>]; <span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.value_belongs">value_belongs</a></span> _ _) <span class="id">and</span> <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">it</span>; <span class="id">try</span> <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> (@<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fmerge_pres_ok">fmerge_pres_ok</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>) <span class="kwd">as</span> [? -&gt;]; <span class="id">try</span> <span class="id">congruence</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eqb_eq">Nat.eqb_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_Forall">forall_nprod_Forall</a></span>, <span class="id">Forall2_ignore1'</span> <span class="kwd">in</span> <span class="id">Sn</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_length">list_of_nprod_length</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_Forall2">Forall2_Forall2</a></span> <span class="kwd">with</span> (2 := <span class="id">Cn</span>), <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall2_hds">Forall2_hds</a></span> <span class="kwd">in</span> <span class="id">Sn</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cbn</span> <span class="id">beta</span>; <span class="id">intros</span> * -&gt;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> 2 <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#zip_cons">zip_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">Hs</span>  [<span class="id">HU</span>%<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_sym">eq_sym</a></span>]%<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_le_simpl">Con_le_simpl</a></span>]; <span class="id">inv</span> <span class="id">Hs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> <span class="kwd">in</span> <span class="id">HU</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_r">Bool.andb_true_r</a></span> <span class="kwd">in</span> <span class="id">HU</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>; <span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eqb_neq">Nat.eqb_neq</a></span> <span class="kwd">in</span> <span class="id">HU</span> || <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eqb_eq">Nat.eqb_eq</a></span> <span class="kwd">in</span> <span class="id">HU</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;rem&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#lift">lift</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#REM">REM</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>)) <span class="id">np</span>), <span class="id">cs'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_lift">forall_nprod_lift</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_impl">forall_nprod_impl</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_rem">DSForall_rem</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#lift_map">lift_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_map_2">Forall2_map_2</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_impl_In">Forall2_impl_In</a></span>; <span class="id">eauto</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cbv</span> <span class="id">beta</span>; <span class="id">intros</span> * _ _ <span class="id">Le</span> % <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_le_compat">rem_le_compat</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#rem_zip">rem_zip</a></span>, 2 <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#rem_AC">rem_AC</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_cons">rem_cons</a></span> <span class="kwd">in</span> <span class="id">Le</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.ty_belongs">ty_belongs</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tid</span> <span class="id">tn</span> <span class="id">xs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.Tenum">Tenum</a></span> <span class="id">tid</span> <span class="id">tn</span>) <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall">DSForall</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.value_belongs">value_belongs</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq">seq</a></span> 0 (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">tn</span>))) <span class="id">xs</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.DSForall_pres">DSForall_pres</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> ??.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span> * <span class="id">Hs</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">xs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> *; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.wt_value">wt_value</a></span> _ _) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_seq">in_seq</a></span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.Permutation_belongs">Permutation_belongs</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span> <span class="id">l'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation">Permutation</a></span> <span class="id">l</span> <span class="id">l'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.value_belongs">value_belongs</a></span> <span class="id">l</span> <span class="id">v</span> &lt;-&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.value_belongs">value_belongs</a></span> <span class="id">l'</span> <span class="id">v</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">v</span> <span class="kwd">as</span> [|[]|]; <span class="id">simpl</span>; <span class="id">try</span> <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> <span class="id">Hp</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.cl_smergev">cl_smergev</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">tid</span> <span class="id">tn</span> <span class="id">ck</span> <span class="id">l</span> <span class="id">np</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">cs</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.ins">ins</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.envI">envI</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.env">env</a></span> <span class="id">x</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l</span> &lt;&gt; [] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation">Permutation</a></span> <span class="id">l</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq">seq</a></span> 0 (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">tn</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.Tenum">Tenum</a></span> <span class="id">tid</span> <span class="id">tn</span>) <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">i</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">s</span> /\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.Con">Con</a></span> <span class="id">ck</span> <span class="id">x</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.Tenum">Tenum</a></span> <span class="id">tid</span> <span class="id">tn</span>,<span class="id">i</span>)) <span class="id">s</span>) <span class="id">l</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">np</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.smergev">smergev</a></span> <span class="id">l</span> <span class="id">cs</span> <span class="id">np</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Nnil</span> <span class="id">Hperm</span> <span class="id">Sc</span> <span class="id">Tc</span> <span class="id">Cc</span> <span class="id">Hf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_belongs">ty_belongs</a></span> <span class="kwd">in</span> <span class="id">Tc</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_smergev_">cl_smergev_</a></span> <span class="kwd">with</span> (<span class="id">tx</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.Tenum">Tenum</a></span> <span class="id">tid</span> <span class="id">tn</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id">Hperm</span>; <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq_NoDup">seq_NoDup</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_impl">DSForall_impl</a></span> <span class="kwd">in</span> <span class="id">Tc</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">setoid_rewrite</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Permutation_belongs">Permutation_belongs</a></span> _ _ <span class="id">Hperm</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall_forall_nprod">Forall_forall_nprod</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_in_right">Forall2_in_right</a></span> <span class="kwd">in</span> <span class="id">Hf</span> <span class="kwd">as</span> (?&amp;?&amp;?&amp;?); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_impl_In">Forall2_impl_In</a></span> <span class="kwd">in</span> <span class="id">Hf</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">intros</span> * ?? [].<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.safe_smergev_">safe_smergev_</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">tx</span> <span class="id">ck</span> <span class="id">l</span> <span class="id">np</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">cs</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.ins">ins</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.envI">envI</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.env">env</a></span> <span class="id">x</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">l</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l</span> &lt;&gt; [] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall">DSForall</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.value_belongs">value_belongs</a></span> <span class="id">l</span>) <span class="id">cs</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">np</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">i</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.Con">Con</a></span> <span class="id">ck</span> <span class="id">x</span> (<span class="id">tx</span>,<span class="id">i</span>)) <span class="id">s</span>) <span class="id">l</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">np</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.smergev">smergev</a></span> <span class="id">l</span> <span class="id">cs</span> <span class="id">np</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Nd</span> <span class="id">Nnil</span> <span class="id">Tc</span> <span class="id">Cc</span> <span class="id">Sn</span> <span class="id">Cn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Cn</span> <span class="id">Cc</span> <span class="id">Tc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.Con">Con</a></span> _ _ _)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fold</span> <span class="id">cs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> <span class="id">dependent</span> <span class="id">cs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ck</span>) <span class="kwd">as</span> <span class="id">sck</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> <span class="id">ck</span> <span class="id">x</span> <span class="id">tx</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_impl_In">Forall2_impl_In</a></span> <span class="kwd">with</span> (<span class="id">Q</span> := <span class="kwd">fun</span> <span class="id">i</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> <span class="id">s</span> &lt;= <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#ZIP">ZIP</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sample">sample</a></span> <span class="id">i</span>) <span class="id">cs</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> <span class="id">cs</span>)) <span class="kwd">in</span> <span class="id">Cn</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">eauto</span> 3 <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.zip_ac_le">zip_ac_le</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> <span class="id">Cc</span> <span class="id">sck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember_ds</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.smergev">smergev</a></span> <span class="id">l</span> <span class="id">cs</span> <span class="id">np</span>) <span class="kwd">as</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert_all</span>; <span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">t</span> <span class="kwd">as</span> [| <span class="id">b</span> <span class="id">t</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>; <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.smergev">smergev</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">clear</span> <span class="id">Cof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Classes.RelationClasses.html#symmetry">symmetry</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#cons_is_cons">cons_is_cons</a></span> <span class="kwd">in</span> <span class="id">Ht</span> <span class="kwd">as</span> <span class="id">Hc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#smerge_is_cons">smerge_is_cons</a></span> <span class="kwd">in</span> <span class="id">Hc</span> <span class="kwd">as</span> [<span class="id">Icc</span> <span class="id">Icn</span>]; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (@<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> _ <span class="id">cs</span>) <span class="kwd">as</span> (<span class="id">c</span> &amp; <span class="id">cs'</span> &amp; <span class="id">Heqc</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Heqc</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id">Heqc</span> <span class="kwd">in</span> <span class="id">Cn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unshelve</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#smerge_cons">smerge_cons</a></span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_eq_simpl">Con_eq_simpl</a></span> <span class="kwd">in</span> <span class="id">Ht</span> <span class="kwd">as</span> [<span class="id">Hb</span> _]; <span class="id">cases</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Tc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;comme&nbsp;dans&nbsp;[cl_smergev_],&nbsp;montrons&nbsp;qu'il&nbsp;y&nbsp;a&nbsp;contradiction&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">c</span> <span class="kwd">as</span> [|[] |]; <span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.value_belongs">value_belongs</a></span> _ _) <span class="id">and</span> <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">it</span>; <span class="id">try</span> <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;c&nbsp;=&nbsp;abs&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fmerge_abs_ok">fmerge_abs_ok</a></span> <span class="kwd">in</span> <span class="id">Hb</span>; [ <span class="id">congruence</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_Forall">forall_nprod_Forall</a></span>, <span class="id">Forall2_ignore1'</span> <span class="kwd">in</span> <span class="id">Sn</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_length">list_of_nprod_length</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_Forall2">Forall2_Forall2</a></span> <span class="kwd">with</span> (2 := <span class="id">Cn</span>) <span class="kwd">in</span> <span class="id">Sn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">Forall2_ignore1''</span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall2_hds">Forall2_hds</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cbn</span> <span class="id">beta</span>; <span class="id">intros</span> * -&gt;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> 2 <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#zip_cons">zip_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">Hs</span>  [<span class="id">HU</span>%<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_sym">eq_sym</a></span>]%<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_le_simpl">Con_le_simpl</a></span>]; <span class="id">inv</span> <span class="id">Hs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>; <span class="id">now</span> <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;c&nbsp;=&nbsp;pres&nbsp;_&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> (@<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fmerge_pres_ok">fmerge_pres_ok</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>) <span class="kwd">as</span> [? -&gt;]; <span class="id">try</span> <span class="id">congruence</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eqb_eq">Nat.eqb_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_Forall">forall_nprod_Forall</a></span>, <span class="id">Forall2_ignore1'</span> <span class="kwd">in</span> <span class="id">Sn</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_length">list_of_nprod_length</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_Forall2">Forall2_Forall2</a></span> <span class="kwd">with</span> (2 := <span class="id">Cn</span>), <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall2_hds">Forall2_hds</a></span> <span class="kwd">in</span> <span class="id">Sn</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cbn</span> <span class="id">beta</span>; <span class="id">intros</span> * -&gt;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> 2 <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#zip_cons">zip_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">Hs</span>  [<span class="id">HU</span>%<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_sym">eq_sym</a></span>]%<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_le_simpl">Con_le_simpl</a></span>]; <span class="id">inv</span> <span class="id">Hs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> <span class="kwd">in</span> <span class="id">HU</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_r">Bool.andb_true_r</a></span> <span class="kwd">in</span> <span class="id">HU</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>; <span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eqb_neq">Nat.eqb_neq</a></span> <span class="kwd">in</span> <span class="id">HU</span> || <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eqb_eq">Nat.eqb_eq</a></span> <span class="kwd">in</span> <span class="id">HU</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_eq_compat">rem_eq_compat</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_cons">rem_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#rem_smerge">rem_smerge</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">Cof</span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_rem">DSForall_rem</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_lift">forall_nprod_lift</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_impl">forall_nprod_impl</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_rem">DSForall_rem</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#lift_map">lift_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_map_2">Forall2_map_2</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_impl_In">Forall2_impl_In</a></span>; <span class="id">eauto</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cbv</span> <span class="id">beta</span>; <span class="id">intros</span> * _ _ <span class="id">Le</span> % <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_le_compat">rem_le_compat</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#rem_zip">rem_zip</a></span>, 2 <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#rem_AC">rem_AC</a></span> <span class="kwd">in</span> <span class="id">Le</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.safe_smergev">safe_smergev</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">tid</span> <span class="id">tn</span> <span class="id">ck</span> <span class="id">l</span> <span class="id">np</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">cs</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.ins">ins</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.envI">envI</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.env">env</a></span> <span class="id">x</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l</span> &lt;&gt; [] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation">Permutation</a></span> <span class="id">l</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq">seq</a></span> 0 (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">tn</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.Tenum">Tenum</a></span> <span class="id">tid</span> <span class="id">tn</span>) <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">i</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">s</span> /\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.Con">Con</a></span> <span class="id">ck</span> <span class="id">x</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.Tenum">Tenum</a></span> <span class="id">tid</span> <span class="id">tn</span>,<span class="id">i</span>)) <span class="id">s</span>) <span class="id">l</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">np</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.smergev">smergev</a></span> <span class="id">l</span> <span class="id">cs</span> <span class="id">np</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Nnil</span> <span class="id">Hperm</span> <span class="id">Sc</span> <span class="id">Tc</span> <span class="id">Cc</span> <span class="id">Hf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_belongs">ty_belongs</a></span> <span class="kwd">in</span> <span class="id">Tc</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_smergev_">safe_smergev_</a></span> <span class="kwd">with</span> (<span class="id">tx</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.Tenum">Tenum</a></span> <span class="id">tid</span> <span class="id">tn</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id">Hperm</span>; <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq_NoDup">seq_NoDup</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_impl">DSForall_impl</a></span> <span class="kwd">in</span> <span class="id">Tc</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">setoid_rewrite</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Permutation_belongs">Permutation_belongs</a></span> _ _ <span class="id">Hperm</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall_forall_nprod">Forall_forall_nprod</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_in_right">Forall2_in_right</a></span> <span class="kwd">in</span> <span class="id">Hf</span> <span class="kwd">as</span> (?&amp;?&amp;?&amp;?); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_impl_In">Forall2_impl_In</a></span> <span class="kwd">in</span> <span class="id">Hf</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">intros</span> * ?? [].<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
<br/>
<h2> Faits sur scasev </h2>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.ty_scasev">ty_scasev</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty</span> <span class="id">tx</span> <span class="id">tn</span> <span class="id">l</span> <span class="id">cs</span> <span class="id">np</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.Tenum">Tenum</a></span> <span class="id">tx</span> <span class="id">tn</span>) <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">ty</span>) <span class="id">np</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">ty</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.scasev">scasev</a></span> <span class="id">l</span> <span class="id">cs</span> <span class="id">np</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Wtc</span> <span class="id">Wtnp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.DSForall_pres">DSForall_pres</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.scasev">scasev</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#scase_eq">scase_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Wtnp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">np</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">l</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Foldi_nil">Foldi_nil</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_map">DSForall_map</a></span>, <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_impl">DSForall_impl</a></span>; <span class="id">eauto</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> []; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Foldi_cons">Foldi_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_hd">forall_nprod_hd</a></span> <span class="kwd">in</span> <span class="id">Wtnp</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_zip3">DSForall_zip3</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_tl">forall_nprod_tl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fcase">fcase</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">cases_eqn</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.cl_scasev_">cl_scasev_</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ck</span> <span class="id">l</span> <span class="id">cs</span> <span class="id">np</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l</span> &lt;&gt; [] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall">DSForall</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.value_belongs">value_belongs</a></span> <span class="id">l</span>) <span class="id">cs</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">np</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span>) <span class="id">np</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.scasev">scasev</a></span> <span class="id">l</span> <span class="id">cs</span> <span class="id">np</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.scasev">scasev</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ck</span>) <span class="kwd">as</span> <span class="id">cks</span>; <span class="id">clear</span> <span class="id">ck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">cks</span> <span class="id">Nnil</span> <span class="id">Tc</span> <span class="id">Cc</span> <span class="id">Sn</span> <span class="id">Cn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#DSle_rec_eq2">DSle_rec_eq2</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">R</span> := <span class="kwd">fun</span> <span class="id">U</span> <span class="id">V</span> =&gt; <span class="kwd">exists</span> <span class="id">np</span> <span class="id">cs</span> <span class="id">cks</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall">DSForall</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.value_belongs">value_belongs</a></span> <span class="id">l</span>) <span class="id">cs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> <span class="id">cs</span> &lt;= <span class="id">cks</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">np</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> (<span class="kwd">fun</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> <span class="id">s</span> &lt;= <span class="id">cks</span>) <span class="id">np</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">U</span> == <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#scase">scase</a></span> _ _ _ <span class="id">l</span> <span class="id">cs</span> <span class="id">np</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">V</span> == <span class="id">cks</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;3: <span class="id">eauto</span> 10.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">intros</span> * ? <span class="id">J</span> <span class="id">K</span>. <span class="id">setoid_rewrite</span> &lt;- <span class="id">J</span>. <span class="id">setoid_rewrite</span> &lt;- <span class="id">K</span>. <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> - <span class="id">Nnil</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">U</span> <span class="id">V</span> <span class="id">Hc</span> (<span class="id">np</span> &amp; <span class="id">cs</span> &amp; <span class="id">cks</span> &amp; <span class="id">Tc</span> &amp; <span class="id">Cc</span> &amp; <span class="id">Sn</span> &amp; <span class="id">Cn</span> &amp; <span class="id">Hu</span> &amp; <span class="id">Hv</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hu</span> <span class="kwd">in</span> <span class="id">Hc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_is_cons">AC_is_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#scase_is_cons">scase_is_cons</a></span> <span class="kwd">in</span> <span class="id">Hc</span> <span class="kwd">as</span> [<span class="id">Hcc</span> <span class="id">Hcn</span>]; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Hcc</span> <span class="kwd">as</span> (<span class="id">vc</span> &amp; <span class="id">cs'</span> &amp; <span class="id">Hc</span>); <span class="id">rewrite</span> <span class="id">Hc</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span> <span class="kwd">in</span> <span class="id">Cc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#DSle_cons_elim">DSle_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Cc</span> <span class="kwd">as</span> (<span class="id">cks'</span> &amp; <span class="id">Hck</span> &amp; <span class="id">Cc</span>); <span class="id">rewrite</span> <span class="id">Hck</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id">Hck</span> <span class="kwd">in</span> <span class="id">Cn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#scase_cons">scase_cons</a></span> <span class="kwd">with</span> (<span class="id">Hc</span> := <span class="id">Hcn</span>), <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span> <span class="kwd">in</span> <span class="id">Hu</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id">Hu</span>; <span class="id">clear</span> <span class="id">Hu</span> <span class="id">U</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id">Hv</span>; <span class="id">clear</span> <span class="id">Hv</span> <span class="id">V</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Tc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;first&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> 2 <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#first_cons">first_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#cons_eq_compat">cons_eq_compat</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id">HH</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,4: <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fcase_pres">fcase_pres</a></span> <span class="kwd">in</span> <span class="id">HH0</span> <span class="kwd">as</span> (?&amp;?&amp;?&amp;?&amp;?); <span class="id">try</span> <span class="id">congruence</span>; <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eqb_eq">Nat.eqb_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fcase_abs">fcase_abs</a></span> <span class="kwd">in</span> <span class="id">HH0</span> <span class="kwd">as</span> []; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">l</span>; <span class="id">simpl</span>; <span class="id">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;montrons&nbsp;qu'il&nbsp;ne&nbsp;peut&nbsp;pas&nbsp;y&nbsp;avoir&nbsp;d'erreur&nbsp;dans&nbsp;ce&nbsp;cas&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">a</span> <span class="kwd">as</span> [|<span class="id">j</span>]; <span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.value_belongs">value_belongs</a></span> _ _) <span class="id">and</span> <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">it</span>; <span class="id">try</span> <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">HH0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> (@<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fcase_pres_ok">fcase_pres_ok</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>) <span class="kwd">as</span> [? -&gt;]; <span class="id">try</span> <span class="id">congruence</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eqb_eq">Nat.eqb_eq</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#hds_length">hds_length</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_Forall">forall_nprod_Forall</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall_hds">Forall_hds</a></span> <span class="kwd">in</span> <span class="id">Cn</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> ??? -&gt;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">HH</span>]%<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_le_simpl">Con_le_simpl</a></span>; <span class="id">cases</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;rem&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#lift">lift</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#REM">REM</a></span> _) <span class="id">np</span>), <span class="id">cs'</span>, <span class="id">cks'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>; <span class="id">auto</span>; <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_lift">forall_nprod_lift</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_impl">forall_nprod_impl</a></span> <span class="kwd">in</span> <span class="id">Sn</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_rem">DSForall_rem</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_impl">forall_nprod_impl</a></span> <span class="kwd">in</span> <span class="id">Cn</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> ? <span class="id">Hl</span>%<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_le_compat">rem_le_compat</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#rem_AC">rem_AC</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_cons">rem_cons</a></span> <span class="kwd">in</span> <span class="id">Hl</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.cl_scasev">cl_scasev</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tid</span> <span class="id">tn</span> <span class="id">ck</span> <span class="id">l</span> <span class="id">cs</span> <span class="id">np</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l</span> &lt;&gt; [] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation">Permutation</a></span> <span class="id">l</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq">seq</a></span> 0 (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">tn</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.Tenum">Tenum</a></span> <span class="id">tid</span> <span class="id">tn</span>) <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> (<span class="kwd">fun</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">s</span> /\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">s</span>) <span class="id">np</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.scasev">scasev</a></span> <span class="id">l</span> <span class="id">cs</span> <span class="id">np</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Nnil</span> <span class="id">Hperm</span> <span class="id">Sc</span> <span class="id">Tc</span> <span class="id">Cc</span> <span class="id">SCn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_belongs">ty_belongs</a></span> <span class="kwd">in</span> <span class="id">Tc</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_scasev_">cl_scasev_</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_impl">DSForall_impl</a></span> <span class="kwd">in</span> <span class="id">Tc</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">setoid_rewrite</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Permutation_belongs">Permutation_belongs</a></span> _ _ <span class="id">Hperm</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_impl">forall_nprod_impl</a></span> <span class="kwd">in</span> <span class="id">SCn</span>; <span class="id">eauto</span>; <span class="id">now</span> <span class="id">intros</span> ? [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_impl">forall_nprod_impl</a></span> <span class="kwd">in</span> <span class="id">SCn</span>; <span class="id">eauto</span>; <span class="id">now</span> <span class="id">intros</span> ? [].<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.safe_scasev_">safe_scasev_</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ck</span> <span class="id">l</span> <span class="id">cs</span> <span class="id">np</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l</span> &lt;&gt; [] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall">DSForall</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.value_belongs">value_belongs</a></span> <span class="id">l</span>) <span class="id">cs</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">np</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span>) <span class="id">np</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.scasev">scasev</a></span> <span class="id">l</span> <span class="id">cs</span> <span class="id">np</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Nnil</span> <span class="id">Tc</span> <span class="id">Cc</span> <span class="id">Sn</span> <span class="id">Cn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Cn</span> <span class="id">Cc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ck</span>) <span class="kwd">as</span> <span class="id">cks</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> <span class="id">ck</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember_ds</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.scasev">scasev</a></span> <span class="id">l</span> <span class="id">cs</span> <span class="id">np</span>) <span class="kwd">as</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert_all</span>; <span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">t</span> <span class="kwd">as</span> [| <span class="id">b</span> <span class="id">t</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>; <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.scasev">scasev</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">clear</span> <span class="id">Cof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Classes.RelationClasses.html#symmetry">symmetry</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#cons_is_cons">cons_is_cons</a></span> <span class="kwd">in</span> <span class="id">Ht</span> <span class="kwd">as</span> <span class="id">Hc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#scase_is_cons">scase_is_cons</a></span> <span class="kwd">in</span> <span class="id">Hc</span> <span class="kwd">as</span> [<span class="id">Icc</span> <span class="id">Icn</span>]; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (@<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> _ <span class="id">cs</span>) <span class="kwd">as</span> (<span class="id">c</span> &amp; <span class="id">cs'</span> &amp; <span class="id">Heqc</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Heqc</span> <span class="kwd">in</span> *; <span class="id">clear</span> <span class="id">Heqc</span> <span class="id">cs</span> <span class="id">Icc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unshelve</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#scase_cons">scase_cons</a></span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_eq_simpl">Con_eq_simpl</a></span> <span class="kwd">in</span> <span class="id">Ht</span> <span class="kwd">as</span> [<span class="id">Hb</span> _]; <span class="id">cases</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span> <span class="kwd">in</span> <span class="id">Cc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#DSle_cons_elim">DSle_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Cc</span> <span class="kwd">as</span> (<span class="id">cks'</span> &amp; <span class="id">Hck</span> &amp; <span class="id">Cc</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Tc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;comme&nbsp;dans&nbsp;[cl_scasev_],&nbsp;montrons&nbsp;qu'il&nbsp;y&nbsp;a&nbsp;contradiction&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">c</span> <span class="kwd">as</span> [|[] |]; <span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.value_belongs">value_belongs</a></span> _ _) <span class="id">and</span> <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">it</span>; <span class="id">try</span> <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;c&nbsp;=&nbsp;abs&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fcase_abs_ok">fcase_abs_ok</a></span> <span class="kwd">in</span> <span class="id">Hb</span>; [ <span class="id">congruence</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_and">forall_nprod_and</a></span> <span class="kwd">with</span> (2 := <span class="id">Sn</span>) <span class="kwd">in</span> <span class="id">Cn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_Forall">forall_nprod_Forall</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall_hds">Forall_hds</a></span> <span class="kwd">in</span> <span class="id">Cn</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * -&gt;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hck</span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [[<span class="id">HH</span>]%<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_le_simpl">Con_le_simpl</a></span> <span class="id">Hs</span>]; <span class="id">inv</span> <span class="id">Hs</span>; <span class="id">cases</span>; <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;c&nbsp;=&nbsp;pres&nbsp;_&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> (@<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fcase_pres_ok">fcase_pres_ok</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>) <span class="kwd">as</span> [? -&gt;]; <span class="id">try</span> <span class="id">congruence</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#hds_length">hds_length</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eqb_eq">Nat.eqb_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_Forall">forall_nprod_Forall</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall_hds">Forall_hds</a></span> <span class="kwd">in</span> <span class="id">Cn</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> ??? -&gt;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hck</span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">HH</span>]%<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_le_simpl">Con_le_simpl</a></span>; <span class="id">cases</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_eq_compat">rem_eq_compat</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_cons">rem_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#rem_scase">rem_scase</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_le_compat">rem_le_compat</a></span> <span class="kwd">in</span> <span class="id">Cc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#rem_AC">rem_AC</a></span> <span class="kwd">in</span> <span class="id">Cc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">Cof</span> <span class="kwd">with</span> (<span class="id">cks</span> := <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem">rem</a></span> <span class="id">cks</span>) <span class="kwd">in</span> <span class="id">Ht</span>; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_rem">DSForall_rem</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_impl">forall_nprod_impl</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_lift">forall_nprod_lift</a></span> <span class="kwd">in</span> <span class="id">Sn</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_rem">DSForall_rem</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_impl">forall_nprod_impl</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_lift">forall_nprod_lift</a></span> <span class="kwd">in</span> <span class="id">Cn</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> ? <span class="id">Hc</span>%<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_le_compat">rem_le_compat</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#rem_AC">rem_AC</a></span> <span class="kwd">in</span> <span class="id">Hc</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.safe_scasev">safe_scasev</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tid</span> <span class="id">tn</span> <span class="id">ck</span> <span class="id">l</span> <span class="id">cs</span> <span class="id">np</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l</span> &lt;&gt; [] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation">Permutation</a></span> <span class="id">l</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq">seq</a></span> 0 (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">tn</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.Tenum">Tenum</a></span> <span class="id">tid</span> <span class="id">tn</span>) <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> (<span class="kwd">fun</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">s</span> /\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">s</span>) <span class="id">np</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.scasev">scasev</a></span> <span class="id">l</span> <span class="id">cs</span> <span class="id">np</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Nnil</span> <span class="id">Hperm</span> <span class="id">Sc</span> <span class="id">Tc</span> <span class="id">Cc</span> <span class="id">SCn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_belongs">ty_belongs</a></span> <span class="kwd">in</span> <span class="id">Tc</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_scasev_">safe_scasev_</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_impl">DSForall_impl</a></span> <span class="kwd">in</span> <span class="id">Tc</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">setoid_rewrite</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Permutation_belongs">Permutation_belongs</a></span> _ _ <span class="id">Hperm</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_impl">forall_nprod_impl</a></span> <span class="kwd">in</span> <span class="id">SCn</span>; <span class="id">eauto</span>; <span class="id">now</span> <span class="id">intros</span> ? [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_impl">forall_nprod_impl</a></span> <span class="kwd">in</span> <span class="id">SCn</span>; <span class="id">eauto</span>; <span class="id">now</span> <span class="id">intros</span> ? [].<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
<br/>
<h2> Faits sur scase_defv </h2>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.ty_scase_defv_">ty_scase_defv_</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty</span> <span class="id">tx</span> <span class="id">tn</span> <span class="id">l</span> <span class="id">cs</span> <span class="id">ds</span> <span class="id">np</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.Tenum">Tenum</a></span> <span class="id">tx</span> <span class="id">tn</span>) <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">ty</span> <span class="id">ds</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">ty</span>) <span class="id">np</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">ty</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.scase_defv">scase_defv</a></span> <span class="id">l</span> <span class="id">cs</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#nprod_cons">nprod_cons</a></span> <span class="id">ds</span> <span class="id">np</span>)).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Wtc</span> <span class="id">Wtd</span> <span class="id">Wtnp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.DSForall_pres">DSForall_pres</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.scase_defv">scase_defv</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#scase_def_eq">scase_def_eq</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#scase_def__eq">scase_def__eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Wtnp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">np</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">l</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Foldi_nil">Foldi_nil</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_zip">DSForall_zip</a></span>; <span class="id">eauto</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">cases</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Foldi_cons">Foldi_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_hd">forall_nprod_hd</a></span> <span class="kwd">in</span> <span class="id">Wtnp</span> <span class="kwd">as</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_zip3">DSForall_zip3</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_tl">forall_nprod_tl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fcase">fcase</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">cases_eqn</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="LDENOTSAFE.ty_scase_defv">ty_scase_defv</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty</span> <span class="id">tx</span> <span class="id">tn</span> <span class="id">l</span> <span class="id">cs</span> <span class="id">dnp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.Tenum">Tenum</a></span> <span class="id">tx</span> <span class="id">tn</span>) <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">ty</span>) <span class="id">dnp</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">ty</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.scase_defv">scase_defv</a></span> <span class="id">l</span> <span class="id">cs</span> <span class="id">dnp</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * ? [?] % <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_inv">forall_nprod_inv</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#nprod_hd_tl">nprod_hd_tl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_scase_defv_">ty_scase_defv_</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.cl_scase_defv_">cl_scase_defv_</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tx</span> <span class="id">tn</span> <span class="id">ck</span> <span class="id">l</span> <span class="id">cs</span> <span class="id">ds</span> <span class="id">np</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l</span> &lt;&gt; [] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.Tenum">Tenum</a></span> <span class="id">tx</span> <span class="id">tn</span>) <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">ds</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">ds</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">np</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span>) <span class="id">np</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.scase_defv">scase_defv</a></span> <span class="id">l</span> <span class="id">cs</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#nprod_cons">nprod_cons</a></span> <span class="id">ds</span> <span class="id">np</span>)).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.scase_defv">scase_defv</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#scase_def_eq">scase_def_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ck</span>) <span class="kwd">as</span> <span class="id">cks</span>; <span class="id">clear</span> <span class="id">ck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">cks</span> <span class="id">Nnil</span> <span class="id">Tc</span> <span class="id">Sc</span> <span class="id">Cc</span> <span class="id">Sd</span> <span class="kwd">Cd</span> <span class="id">Sn</span> <span class="id">Cn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#DSle_rec_eq2">DSle_rec_eq2</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">R</span> := <span class="kwd">fun</span> <span class="id">U</span> <span class="id">V</span> =&gt; <span class="kwd">exists</span> <span class="id">np</span> <span class="id">cs</span> <span class="id">ds</span> <span class="id">cks</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.Tenum">Tenum</a></span> <span class="id">tx</span> <span class="id">tn</span>) <span class="id">cs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">cs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> <span class="id">cs</span> &lt;= <span class="id">cks</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">ds</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> <span class="id">ds</span> &lt;= <span class="id">cks</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">np</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> (<span class="kwd">fun</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> <span class="id">s</span> &lt;= <span class="id">cks</span>) <span class="id">np</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">U</span> == <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#scase_def_">scase_def_</a></span> _ _ _ <span class="id">l</span> <span class="id">cs</span> <span class="id">ds</span> <span class="id">np</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">V</span> == <span class="id">cks</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;3: <span class="kwd">exists</span> <span class="id">np</span>, <span class="id">cs</span>, <span class="id">ds</span>, <span class="id">cks</span>; <span class="id">do</span> 4 (<span class="id">split</span>; <span class="id">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">intros</span> * ? <span class="id">J</span> <span class="id">K</span>. <span class="id">setoid_rewrite</span> &lt;- <span class="id">J</span>. <span class="id">setoid_rewrite</span> &lt;- <span class="id">K</span>. <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> - <span class="id">Nnil</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">U</span> <span class="id">V</span> <span class="id">Hc</span> (<span class="id">np</span> &amp; <span class="id">cs</span> &amp; <span class="id">ds</span> &amp; <span class="id">cks</span> &amp; <span class="id">Tc</span> &amp; <span class="id">Sc</span> &amp; <span class="id">Cc</span> &amp; <span class="id">Sd</span> &amp; <span class="kwd">Cd</span> &amp; <span class="id">Sn</span> &amp; <span class="id">Cn</span> &amp; <span class="id">Hu</span> &amp; <span class="id">Hv</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hu</span> <span class="kwd">in</span> <span class="id">Hc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_is_cons">AC_is_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#scase_def__is_cons">scase_def__is_cons</a></span> <span class="kwd">in</span> <span class="id">Hc</span> <span class="kwd">as</span> (<span class="id">Hcc</span> &amp; <span class="id">Hcd</span> &amp; <span class="id">Hcn</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Hcc</span> <span class="kwd">as</span> (<span class="id">vc</span> &amp; <span class="id">cs'</span> &amp; <span class="id">Hc</span>); <span class="id">rewrite</span> <span class="id">Hc</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Hcd</span> <span class="kwd">as</span> (<span class="id">vd</span> &amp; <span class="id">ds'</span> &amp; <span class="id">Hd</span>); <span class="id">rewrite</span> <span class="id">Hd</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span> <span class="kwd">in</span> <span class="id">Cc</span>, <span class="kwd">Cd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#DSle_cons_elim">DSle_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Cc</span> <span class="kwd">as</span> (<span class="id">cks'</span> &amp; <span class="id">Hck</span> &amp; <span class="id">Cc</span>); <span class="id">rewrite</span> <span class="id">Hck</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_le_simpl">Con_le_simpl</a></span> <span class="kwd">in</span> <span class="kwd">Cd</span> <span class="kwd">as</span> (<span class="id">Heq</span> &amp; <span class="kwd">Cd</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id">Hck</span> <span class="kwd">in</span> <span class="id">Cn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#scase_def__cons">scase_def__cons</a></span> <span class="kwd">with</span> (<span class="id">Hc</span> := <span class="id">Hcn</span>), <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span> <span class="kwd">in</span> <span class="id">Hu</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id">Hu</span>; <span class="id">clear</span> <span class="id">Hu</span> <span class="id">U</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id">Hv</span>; <span class="id">clear</span> <span class="id">Hv</span> <span class="id">V</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Tc</span>. <span class="id">inv</span> <span class="id">Sc</span>. <span class="id">inv</span> <span class="id">Sd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;first&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> 2 <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#first_cons">first_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#cons_eq_compat">cons_eq_compat</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id">HH</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fcase_pres">fcase_pres</a></span> <span class="kwd">with</span> (<span class="id">c</span> := <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#abs">abs</a></span>) <span class="kwd">in</span> <span class="id">HH1</span> <span class="kwd">as</span> (?&amp;?&amp;?&amp;?); <span class="id">try</span> <span class="id">congruence</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eqb_eq">Nat.eqb_eq</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fcase_abs">fcase_abs</a></span> <span class="kwd">in</span> <span class="id">HH1</span> <span class="kwd">as</span> []; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">l</span>; <span class="id">simpl</span>; <span class="id">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;montrons&nbsp;qu'il&nbsp;ne&nbsp;peut&nbsp;pas&nbsp;y&nbsp;avoir&nbsp;d'erreur&nbsp;dans&nbsp;ce&nbsp;cas&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.wt_value">wt_value</a></span> _ _) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">HH1</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> (@<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fcase_def_pres_ok">fcase_def_pres_ok</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>) <span class="kwd">as</span> [? -&gt;]; <span class="id">try</span> <span class="id">congruence</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_Forall">forall_nprod_Forall</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall_hds">Forall_hds</a></span> <span class="kwd">in</span> <span class="id">Cn</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> ??? -&gt;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">HH</span>]%<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_le_simpl">Con_le_simpl</a></span>; <span class="id">cases</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;rem&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#lift">lift</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#REM">REM</a></span> _) <span class="id">np</span>), <span class="id">cs'</span>, <span class="id">ds'</span>, <span class="id">cks'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>; <span class="id">auto</span>; <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_lift">forall_nprod_lift</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_impl">forall_nprod_impl</a></span> <span class="kwd">in</span> <span class="id">Sn</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_rem">DSForall_rem</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_impl">forall_nprod_impl</a></span> <span class="kwd">in</span> <span class="id">Cn</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> ? <span class="id">Hl</span>%<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_le_compat">rem_le_compat</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#rem_AC">rem_AC</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_cons">rem_cons</a></span> <span class="kwd">in</span> <span class="id">Hl</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="LDENOTSAFE.cl_scase_defv">cl_scase_defv</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tid</span> <span class="id">tn</span> <span class="id">ck</span> <span class="id">l</span> <span class="id">cs</span> <span class="id">dnp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l</span> &lt;&gt; [] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.Tenum">Tenum</a></span> <span class="id">tid</span> <span class="id">tn</span>) <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> (<span class="kwd">fun</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">s</span> /\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">s</span>) <span class="id">dnp</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.scase_defv">scase_defv</a></span> <span class="id">l</span> <span class="id">cs</span> <span class="id">dnp</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * ???? [[] [] % <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#and_forall_nprod">and_forall_nprod</a></span>] % <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_inv">forall_nprod_inv</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#nprod_hd_tl">nprod_hd_tl</a></span> <span class="id">dnp</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_scase_defv_">cl_scase_defv_</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.safe_scase_defv_">safe_scase_defv_</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tx</span> <span class="id">tn</span> <span class="id">ck</span> <span class="id">l</span> <span class="id">cs</span> <span class="id">ds</span> <span class="id">np</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l</span> &lt;&gt; [] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.Tenum">Tenum</a></span> <span class="id">tx</span> <span class="id">tn</span>) <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">ds</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">ds</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">np</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span>) <span class="id">np</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.scase_defv">scase_defv</a></span> <span class="id">l</span> <span class="id">cs</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#nprod_cons">nprod_cons</a></span> <span class="id">ds</span> <span class="id">np</span>)).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Nnil</span> <span class="id">Tc</span> <span class="id">Sc</span> <span class="id">Cc</span> <span class="id">Sd</span> <span class="kwd">Cd</span> <span class="id">Sn</span> <span class="id">Cn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Cn</span> <span class="id">Cc</span> <span class="kwd">Cd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ck</span>) <span class="kwd">as</span> <span class="id">cks</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> <span class="id">ck</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.scase_defv">scase_defv</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#scase_def_eq">scase_def_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember_ds</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#scase_def_">scase_def_</a></span> _ _ _ <span class="id">l</span> <span class="id">cs</span> <span class="id">ds</span> <span class="id">np</span>) <span class="kwd">as</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert_all</span>; <span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">t</span> <span class="kwd">as</span> [| <span class="id">b</span> <span class="id">t</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>; <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.scase_defv">scase_defv</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">clear</span> <span class="id">Cof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Classes.RelationClasses.html#symmetry">symmetry</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#cons_is_cons">cons_is_cons</a></span> <span class="kwd">in</span> <span class="id">Ht</span> <span class="kwd">as</span> <span class="id">Hc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#scase_def__is_cons">scase_def__is_cons</a></span> <span class="kwd">in</span> <span class="id">Hc</span> <span class="kwd">as</span> (<span class="id">Icc</span> &amp; <span class="id">Icd</span> &amp; <span class="id">Icn</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (@<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> _ <span class="id">cs</span>) <span class="kwd">as</span> (<span class="id">c</span> &amp; <span class="id">cs'</span> &amp; <span class="id">Heqc</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (@<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> _ <span class="id">ds</span>) <span class="kwd">as</span> (<span class="id">d</span> &amp; <span class="id">ds'</span> &amp; <span class="id">Heqd</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Heqc</span> <span class="kwd">in</span> *; <span class="id">clear</span> <span class="id">Heqc</span> <span class="id">cs</span> <span class="id">Icc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Heqd</span> <span class="kwd">in</span> *; <span class="id">clear</span> <span class="id">Heqd</span> <span class="id">ds</span> <span class="id">Icd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unshelve</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#scase_def__cons">scase_def__cons</a></span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_eq_simpl">Con_eq_simpl</a></span> <span class="kwd">in</span> <span class="id">Ht</span> <span class="kwd">as</span> [<span class="id">Hb</span> _]; <span class="id">cases</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span> <span class="kwd">in</span> <span class="id">Cc</span>, <span class="kwd">Cd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#DSle_cons_elim">DSle_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Cc</span> <span class="kwd">as</span> (<span class="id">cks'</span> &amp; <span class="id">Hck</span> &amp; <span class="id">Cc</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hck</span> <span class="kwd">in</span> <span class="kwd">Cd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_le_simpl">Con_le_simpl</a></span> <span class="kwd">in</span> <span class="kwd">Cd</span> <span class="kwd">as</span> (<span class="id">Heq</span> &amp; <span class="kwd">Cd</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Tc</span>. <span class="id">inv</span> <span class="id">Sd</span>. <span class="id">inv</span> <span class="id">Sc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;comme&nbsp;dans&nbsp;[cl_scase_defv_],&nbsp;montrons&nbsp;qu'il&nbsp;y&nbsp;a&nbsp;contradiction&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;c&nbsp;=&nbsp;abs&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fcase_abs_ok">fcase_abs_ok</a></span> <span class="kwd">in</span> <span class="id">Hb</span>; [ <span class="id">congruence</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_and">forall_nprod_and</a></span> <span class="kwd">with</span> (2 := <span class="id">Sn</span>) <span class="kwd">in</span> <span class="id">Cn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_Forall">forall_nprod_Forall</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall_hds">Forall_hds</a></span> <span class="kwd">in</span> <span class="id">Cn</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * -&gt;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hck</span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [[<span class="id">HH</span>]%<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_le_simpl">Con_le_simpl</a></span> <span class="id">Hs</span>]; <span class="id">inv</span> <span class="id">Hs</span>; <span class="id">cases</span>; <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;c&nbsp;=&nbsp;pres&nbsp;_&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hb</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.wt_value">wt_value</a></span> _ _) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> (@<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#fcase_def_pres_ok">fcase_def_pres_ok</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>) <span class="kwd">as</span> [? -&gt;]; <span class="id">try</span> <span class="id">congruence</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_Forall">forall_nprod_Forall</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall_hds">Forall_hds</a></span> <span class="kwd">in</span> <span class="id">Cn</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> ??? -&gt;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hck</span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">HH</span>]%<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_le_simpl">Con_le_simpl</a></span>; <span class="id">cases</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_eq_compat">rem_eq_compat</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_cons">rem_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#rem_scase_def_">rem_scase_def_</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_le_compat">rem_le_compat</a></span> <span class="kwd">in</span> <span class="id">Cc</span>, <span class="kwd">Cd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#rem_AC">rem_AC</a></span> <span class="kwd">in</span> <span class="id">Cc</span>, <span class="kwd">Cd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">Cof</span> <span class="kwd">with</span> (<span class="id">cks</span> := <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem">rem</a></span> <span class="id">cks</span>) <span class="kwd">in</span> <span class="id">Ht</span>; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_rem">DSForall_rem</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_rem">DSForall_rem</a></span>, <span class="id">Tc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_rem">DSForall_rem</a></span>, <span class="id">Sc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_rem">DSForall_rem</a></span>, <span class="id">Sd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_impl">forall_nprod_impl</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_lift">forall_nprod_lift</a></span> <span class="kwd">in</span> <span class="id">Sn</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_rem">DSForall_rem</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_impl">forall_nprod_impl</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_lift">forall_nprod_lift</a></span> <span class="kwd">in</span> <span class="id">Cn</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> ? <span class="id">Hc</span>%<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_le_compat">rem_le_compat</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#rem_AC">rem_AC</a></span> <span class="kwd">in</span> <span class="id">Hc</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="LDENOTSAFE.safe_scase_defv">safe_scase_defv</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tid</span> <span class="id">tn</span> <span class="id">ck</span> <span class="id">l</span> <span class="id">cs</span> <span class="id">dnp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l</span> &lt;&gt; [] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.Tenum">Tenum</a></span> <span class="id">tid</span> <span class="id">tn</span>) <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> (<span class="kwd">fun</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">s</span> /\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ck</span> <span class="id">s</span>) <span class="id">dnp</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.scase_defv">scase_defv</a></span> <span class="id">l</span> <span class="id">cs</span> <span class="id">dnp</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Nnil</span> <span class="id">Sc</span> <span class="id">Tc</span> <span class="id">Cc</span> <span class="id">SCn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#and_forall_nprod">and_forall_nprod</a></span> <span class="kwd">in</span> <span class="id">SCn</span> <span class="kwd">as</span> [[<span class="id">Sn</span>] % <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_inv">forall_nprod_inv</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">Cn</span>] % <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_inv">forall_nprod_inv</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#nprod_hd_tl">nprod_hd_tl</a></span> <span class="id">dnp</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_scase_defv_">safe_scase_defv_</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
<br/>
<h2> Résultats généraux sur les expressions </h2>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.Forall_ty_exp">Forall_ty_exp</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">es</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.typeof">typeof</a></span> <span class="id">e</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exp">denot_exp</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.G">G</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.ins">ins</a></span> <span class="id">e</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.envG">envG</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.envI">envI</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.env">env</a></span>))) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.typesof">typesof</a></span> <span class="id">es</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exps">denot_exps</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.G">G</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.ins">ins</a></span> <span class="id">es</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.envG">envG</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.envI">envI</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.env">env</a></span>)).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">simpl</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exps_eq">denot_exps_eq</a></span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_app">list_of_nprod_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_app">Forall2_app</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.Forall_cl_exp">Forall_cl_exp</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">es</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.clockof">clockof</a></span> <span class="id">e</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exp">denot_exp</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.G">G</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.ins">ins</a></span> <span class="id">e</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.envG">envG</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.envI">envI</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.env">env</a></span>))) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.clocksof">clocksof</a></span> <span class="id">es</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exps">denot_exps</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.G">G</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.ins">ins</a></span> <span class="id">es</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.envG">envG</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.envI">envI</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.env">env</a></span>)).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">simpl</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exps_eq">denot_exps_eq</a></span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_app">list_of_nprod_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_app">Forall2_app</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.Forall_ty_expss">Forall_ty_expss</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">es</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.enumtag">enumtag</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.exp">exp</a></span>)) <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">es</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.annots">annots</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">es</span>)) = <span class="id">n</span>) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">l</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.typeof">typeof</a></span> <span class="id">e</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exp">denot_exp</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.G">G</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.ins">ins</a></span> <span class="id">e</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.envG">envG</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.envI">envI</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.env">env</a></span>))) <span class="id">l</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">es</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">tys</span> (<span class="id">ss</span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#nprod">nprod</a></span> <span class="id">n</span>) =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">tys</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">ss</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.typesof">typesof</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">es</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_expss">denot_expss</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.G">G</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.ins">ins</a></span> <span class="id">es</span> <span class="id">n</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.envG">envG</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.envI">envI</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.env">env</a></span>)).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hl</span> <span class="id">Hf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">es</span> <span class="kwd">as</span> [|[]]; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">simpl</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hf</span>. <span class="id">inv</span> <span class="id">Hl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_expss_eq">denot_expss_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_rect">eq_rect</a></span>; <span class="id">cases</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">setoid_rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_cons">list_of_nprod_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Forall_ty_exp">Forall_ty_exp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.annots_numstreams">annots_numstreams</a></span> <span class="kwd">in</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.Forall_cl_expss">Forall_cl_expss</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">es</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.enumtag">enumtag</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.exp">exp</a></span>)) <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">es</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.annots">annots</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">es</span>)) = <span class="id">n</span>) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">l</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.clockof">clockof</a></span> <span class="id">e</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exp">denot_exp</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.G">G</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.ins">ins</a></span> <span class="id">e</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.envG">envG</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.envI">envI</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.env">env</a></span>))) <span class="id">l</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">es</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">cls</span> (<span class="id">ss</span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#nprod">nprod</a></span> <span class="id">n</span>) =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">cls</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">ss</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.clocksof">clocksof</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">es</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_expss">denot_expss</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.G">G</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.ins">ins</a></span> <span class="id">es</span> <span class="id">n</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.envG">envG</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.envI">envI</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe.env">env</a></span>)).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hl</span> <span class="id">Hf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">es</span> <span class="kwd">as</span> [|[]]; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">simpl</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hf</span>. <span class="id">inv</span> <span class="id">Hl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_expss_eq">denot_expss_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_rect">eq_rect</a></span>; <span class="id">cases</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">setoid_rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_cons">list_of_nprod_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Forall_cl_exp">Forall_cl_exp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.annots_numstreams">annots_numstreams</a></span> <span class="kwd">in</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SDfuns_safe">SDfuns_safe</a></span>.<br/>
<br/>
<span class="id">Global</span> <span class="id">Add</span> <span class="id">Parametric</span> <span class="id">Morphism</span> <span class="id">ins</span> : (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ins</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">signature</span> @<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#Oeq">Oeq</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Systems.html#DS_prod">DS_prod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.SI">SI</a></span>) ==&gt; @<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#Oeq">Oeq</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>) ==&gt; @<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#Oeq">Oeq</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Systems.html#DS_prod">DS_prod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.SI">SI</a></span>) ==&gt; @<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.clock">clock</a></span> ==&gt; @<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#Oeq">Oeq</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> <span class="id">denot_clock_morph</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Eq1</span> * <span class="id">Eq2</span> * <span class="id">Eq3</span> <span class="id">ck</span>.<br/>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">ck</span> <span class="kwd">as</span> [|??? []]; <span class="id">simpl</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> <span class="id">IHck</span>, <span class="id">Eq1</span>, <span class="id">Eq3</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">Global</span> <span class="id">Add</span> <span class="id">Parametric</span> <span class="id">Morphism</span> <span class="id">Γ</span> <span class="id">ins</span> : (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">signature</span> @<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#Oeq">Oeq</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Systems.html#DS_prod">DS_prod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.SI">SI</a></span>) ==&gt; @<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#Oeq">Oeq</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>) ==&gt; @<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#Oeq">Oeq</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Systems.html#DS_prod">DS_prod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.SI">SI</a></span>) ==&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#iff">iff</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> <span class="id">wf_env_morph</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.DSForall_pres">DSForall_pres</a></span>.<br/>
&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Eq1</span> * <span class="id">Eq2</span> * <span class="id">Eq3</span>.<br/>
&nbsp;&nbsp;<span class="id">split</span>; <span class="id">intros</span> <span class="id">Hdec</span> * <span class="id">Hty</span> <span class="id">Hck</span>; <span class="id">destruct</span> (<span class="id">Hdec</span> _ _ _ <span class="id">Hty</span> <span class="id">Hck</span>) <span class="kwd">as</span> (?&amp;?&amp;?).<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> &lt;- <span class="id">Eq1</span>, &lt;- <span class="id">Eq3</span>, &lt;- <span class="id">Eq2</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id">Eq1</span>, <span class="id">Eq3</span>, <span class="id">Eq2</span>; <span class="id">auto</span>.<br/>
Qed.</div></details>
<br/>
<h2> Faits sur denot_var et denot_clock  </h2>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.app_denot_var">app_denot_var</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ins</span> <span class="id">envI1</span> <span class="id">envI2</span> <span class="id">env1</span> <span class="id">env2</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#app">app</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id">ins</span> <span class="id">envI1</span> <span class="id">env1</span> <span class="id">x</span>) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id">ins</span> <span class="id">envI2</span> <span class="id">env2</span> <span class="id">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;== <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id">ins</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#APP_env">APP_env</a></span> <span class="id">envI1</span> <span class="id">envI2</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#APP_env">APP_env</a></span> <span class="id">env1</span> <span class="id">env2</span>) <span class="id">x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">clear</span>.<br/>
&nbsp;&nbsp;<span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span>; <span class="id">cases</span>.<br/>
Qed.</div></details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.rem_denot_var">rem_denot_var</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">env</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem">rem</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">env</span> <span class="id">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;== <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id">ins</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#REM_env">REM_env</a></span> <span class="id">envI</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#REM_env">REM_env</a></span> <span class="id">env</span>) <span class="id">x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span>; <span class="id">intros</span>; <span class="id">cases</span>.<br/>
Qed.</div></details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.rem_denot_clock">rem_denot_clock</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">ck</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem">rem</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">ck</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;== <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ins</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#REM_env">REM_env</a></span> <span class="id">envI</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem">rem</a></span> <span class="id">bs</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#REM_env">REM_env</a></span> <span class="id">env</span>) <span class="id">ck</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">ck</span> <span class="kwd">as</span> [| ??? []]; <span class="id">simpl</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#rem_zip">rem_zip</a></span>, <span class="id">IHck</span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.rem_denot_var">rem_denot_var</a></span>.<br/>
Qed.</div></details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.denot_clock_app">denot_clock_app</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ins</span> <span class="id">envI1</span> <span class="id">envI2</span> <span class="id">bs1</span> <span class="id">bs2</span> <span class="id">env1</span> <span class="id">env2</span> <span class="id">ck</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ins</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#APP_env">APP_env</a></span> <span class="id">envI1</span> <span class="id">envI2</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#app">app</a></span> <span class="id">bs1</span> <span class="id">bs2</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#APP_env">APP_env</a></span> <span class="id">env1</span> <span class="id">env2</span>) <span class="id">ck</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;== <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#app">app</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ins</span> <span class="id">envI1</span> <span class="id">bs1</span> <span class="id">env1</span> <span class="id">ck</span>) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ins</span> <span class="id">envI2</span> <span class="id">bs2</span> <span class="id">env2</span> <span class="id">ck</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">ck</span> <span class="kwd">as</span> [|??? []]; <span class="id">simpl</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#zip_app">zip_app</a></span>, <span class="id">IHck</span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.app_denot_var">app_denot_var</a></span>.<br/>
Qed.</div></details>
<br/>
<br/>
<h2> Faits sur wf_env  </h2>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.wf_env_rem">wf_env_rem</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#REM_env">REM_env</a></span> <span class="id">envI</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem">rem</a></span> <span class="id">bs</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#REM_env">REM_env</a></span> <span class="id">env</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span>.<br/>
&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hco</span> ??? <span class="id">Hty</span> <span class="id">Hcl</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">Hco</span> _ _ _ <span class="id">Hty</span> <span class="id">Hcl</span>) <span class="kwd">as</span> (<span class="id">Ty</span> &amp; <span class="id">Cl</span> &amp; <span class="id">Sf</span>); <span class="id">clear</span> <span class="id">Hco</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.DSForall_pres">DSForall_pres</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.rem_denot_var">rem_denot_var</a></span>, &lt;- <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.rem_denot_clock">rem_denot_clock</a></span>, &lt;- <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#rem_AC">rem_AC</a></span>.<br/>
&nbsp;&nbsp;<span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_rem">DSForall_rem</a></span>.<br/>
Qed.</div></details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.wf_env_APP_">wf_env_APP_</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI1</span> <span class="id">envI2</span> <span class="id">bs1</span> <span class="id">bs2</span> <span class="id">env1</span> <span class="id">env2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI1</span> <span class="id">bs1</span> <span class="id">env1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI2</span> <span class="id">bs2</span> <span class="id">env2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#APP_env">APP_env</a></span> <span class="id">envI1</span> <span class="id">envI2</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#app">app</a></span> <span class="id">bs1</span> <span class="id">bs2</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#APP_env">APP_env</a></span> <span class="id">env1</span> <span class="id">env2</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Co1</span> <span class="id">Co2</span>.<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">x</span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">Hty</span> <span class="id">Hck</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">Co1</span> _ _ _ <span class="id">Hty</span> <span class="id">Hck</span>) <span class="kwd">as</span> (<span class="id">Ty1</span> &amp; <span class="id">Cl1</span> &amp; <span class="id">Sf1</span>).<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">Co2</span> _ _ _ <span class="id">Hty</span> <span class="id">Hck</span>) <span class="kwd">as</span> (<span class="id">Ty2</span> &amp; <span class="id">Cl2</span> &amp; <span class="id">Sf2</span>).<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> 2 <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#APP_env_eq">APP_env_eq</a></span>.<br/>
&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;ty&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.DSForall_pres">DSForall_pres</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>; <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_app">DSForall_app</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;cl&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock_app">denot_clock_app</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#MAP_map">MAP_map</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>; <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#app_map">app_map</a></span> <span class="kwd">in</span> *; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Sf&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>; <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_app">DSForall_app</a></span>; <span class="id">auto</span>.<br/>
Qed.</div></details>
<br/>
<span class="kwd">Corollary</span> <span class="id"><a name="LDENOTSAFE.wf_env_APP">wf_env_APP</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env1</span> <span class="id">env2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#REM_env">REM_env</a></span> <span class="id">envI</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem">rem</a></span> <span class="id">bs</span>) <span class="id">env2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#APP_env">APP_env</a></span> <span class="id">env1</span> <span class="id">env2</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Co1</span> <span class="id">Co2</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#app_rem">app_rem</a></span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#app_rem_env">app_rem_env</a></span> <span class="id">envI</span>).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env_APP_">wf_env_APP_</a></span>; <span class="id">auto</span>.<br/>
Qed.</div></details>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="LDENOTSAFE.wf_var">wf_var</a></span>.<br/>
<br/>
<div class="doc"><span class="bracket"><span class="id">wf_env</span></span> n'étant pas un prédicat co-inductif, il est impossible
      de raisonner directement dessus avec la tactique cofix. (Typiquement,
      pour "attendre" un <span class="bracket"><span class="id">Con</span></span> sur le flot de la condition de reset).
      On introduit donc le prédicat co-inductif <span class="bracket"><span class="id">wf_var</span></span> et on montre
      qu'il est équivalent à <span class="bracket"><span class="id">wf_env</span></span> s'il tient pour chaque variable
      de l'environment (cf. <span class="bracket"><span class="id">wfv_wfe</span></span> et <span class="bracket"><span class="id">wfe_wfv</span></span>).
   </div>
<br/>
&nbsp;&nbsp;<span class="kwd">CoInductive</span> <span class="id"><a name="LDENOTSAFE.wf_var">wf_var</a></span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">ins</span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo.Systems.html#DS_prod">DS_prod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.SI">SI</a></span> -&gt; <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> -&gt; <span class="id"><a href="Velus.Lustre.Denot.Cpo.Systems.html#DS_prod">DS_prod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.SI">SI</a></span> -&gt; <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>) -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="LDENOTSAFE.wfvEps">wfvEps</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_var</span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_var</span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#Eps">Eps</a></span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="LDENOTSAFE.wfvCon">wfvCon</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">x</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_var</span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">ins</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#REM_env">REM_env</a></span> <span class="id">envI</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem">rem</a></span> <span class="id">bs</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#REM_env">REM_env</a></span> <span class="id">env</span>) <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#first">first</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#cons">cons</a></span> <span class="id">x</span> <span class="id">s</span>)) &lt;= <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#first">first</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">ck</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#pres">pres</a></span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.wt_value">wt_value</a></span> <span class="id">v</span> <span class="id">ty</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#abs">abs</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#err">err</a></span> _ =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_var</span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#cons">cons</a></span> <span class="id">x</span> <span class="id">s</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="id">Global</span> <span class="id">Add</span> <span class="id">Parametric</span> <span class="id">Morphism</span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">ins</span> : (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_var">wf_var</a></span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">ins</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">signature</span> @<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#Oeq">Oeq</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Systems.html#DS_prod">DS_prod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.SI">SI</a></span>) ==&gt; @<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#Oeq">Oeq</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>) ==&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#Oeq">Oeq</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Systems.html#DS_prod">DS_prod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.SI">SI</a></span>) ==&gt; @<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#Oeq">Oeq</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>)) ==&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Program.Basics.html#impl">Basics.impl</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> <span class="id">wfv_morph</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span> * <span class="id">Eq1</span> ?? <span class="id">Eq2</span> ?? <span class="id">Eq3</span> ?? <span class="id">Eq4</span> <span class="id">Hwfv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">y2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> <span class="id">Eq4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">Cof</span>; <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#decomp_eq">decomp_eq</a></span> <span class="kwd">in</span> <span class="id">Eq4</span> <span class="kwd">as</span> (? &amp; (<span class="id">k</span> &amp; <span class="id">Hk</span>) &amp; <span class="id">Hy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">Cof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id">Eq1</span>; <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id">Eq2</span>; <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id">Eq3</span>; <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hy</span>; <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> <span class="id">dependent</span> <span class="id">x2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">k</span>; <span class="id">simpl</span>; <span class="id">intros</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">Hwfv</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id">IHk</span> <span class="kwd">in</span> <span class="id">Hk</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">x2</span>; <span class="id">simpl</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">inv</span> <span class="id">Hwfv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#decomp_eq">decomp_eq</a></span> <span class="kwd">in</span> <span class="id">Eq4</span> <span class="kwd">as</span> (? &amp; (<span class="id">k</span> &amp; <span class="id">Hk</span>) &amp; <span class="id">Hy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id">Eq1</span>, &lt;- <span class="id">Eq2</span>, &lt;- <span class="id">Eq3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> <span class="id">dependent</span> <span class="id">x2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">k</span>; <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hk</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">Hwfv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#first_cons">first_cons</a></span> <span class="kwd">in</span> *; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id">IHk</span> <span class="kwd">in</span> <span class="id">Hk</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">x2</span>; <span class="id">simpl</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">inv</span> <span class="id">Hwfv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#decomp_eq">decomp_eq</a></span> <span class="kwd">in</span> <span class="id">Eq4</span> <span class="kwd">as</span> (? &amp; (<span class="id">k</span> &amp; <span class="id">Hk</span>) &amp; <span class="id">Hy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> <span class="id">dependent</span> <span class="id">x2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">k</span>; <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hk</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">now</span> <span class="id">inv</span> <span class="id">Hwfv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id">IHk</span> <span class="kwd">in</span> <span class="id">Hk</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">x2</span>; <span class="id">simpl</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">inv</span> <span class="id">Hwfv</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.wfv_spec1">wfv_spec1</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">xs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_var">wf_var</a></span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">ty</span> <span class="id">xs</span> /\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">xs</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hwfv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.DSForall_pres">DSForall_pres</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;ty&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> <span class="id">dependent</span> <span class="id">xs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">xs</span>; <span class="id">inv</span> <span class="id">Hwfv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; [<span class="id">cases</span>|]; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;sf&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> <span class="id">dependent</span> <span class="id">xs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">xs</span>; <span class="id">inv</span> <span class="id">Hwfv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">destruct</span> <span class="id">s</span>; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id">Cof</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.wfv_spec2">wfv_spec2</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">xs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_var">wf_var</a></span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">ck</span> <span class="id">xs</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hwfv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#DSle_rec_eq2">DSle_rec_eq2</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">R</span> := <span class="kwd">fun</span> <span class="id">U</span> <span class="id">V</span> =&gt; <span class="kwd">exists</span> <span class="id">xs</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_var">wf_var</a></span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">xs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">U</span> == <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> <span class="id">xs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">V</span> == <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">ck</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;3: <span class="id">eauto</span> 8.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">intros</span> ???? (?&amp;?&amp;?&amp;?&amp;?&amp;?&amp;?) ??.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> 5 <span class="id">esplit</span>; <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">U</span> <span class="id">V</span> <span class="id">Hc</span> (<span class="id">xs</span> &amp; <span class="id">envI</span> &amp; <span class="id">bs</span> &amp; <span class="id">env</span> &amp; <span class="id">Hwfv</span> &amp; <span class="id">Hu</span> &amp; <span class="id">Hv</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (@<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> _ <span class="id">xs</span>) <span class="kwd">as</span> (<span class="id">vx</span> &amp; <span class="id">xs'</span> &amp; <span class="id">Hx</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_is_cons">AC_is_cons</a></span>; <span class="id">now</span> <span class="id">rewrite</span> &lt;- <span class="id">Hu</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hx</span> <span class="kwd">in</span> <span class="id">Hu</span>, <span class="id">Hwfv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion_clear</span> <span class="id">Hwfv</span> <span class="kwd">as</span> [|????? <span class="id">Wfv</span> <span class="id">Le</span> <span class="id">Hm</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#first_cons">first_cons</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#DSle_cons_elim">DSle_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Le</span> <span class="kwd">as</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">HH</span> <span class="kwd">as</span> (<span class="id">t</span> &amp; <span class="id">Hf</span> &amp; _).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#first_cons_elim">first_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Hf</span> <span class="kwd">as</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">HH</span> <span class="kwd">as</span> (<span class="id">w</span> &amp; <span class="id">Hw</span> &amp; <span class="id">Ht</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Ht</span> <span class="kwd">in</span> <span class="id">Hf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id">Hu</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id">Hv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#first_cons">first_cons</a></span>, <span class="id">Hf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">setoid_rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.rem_denot_clock">rem_denot_clock</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_cons">rem_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> 5 <span class="id">esplit</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.wfv_wfe">wfv_wfe</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span> <span class="id">ty</span> <span class="id">ck</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasType">HasType</a></span> <span class="id">Γ</span> <span class="id">x</span> <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasClock">HasClock</a></span> <span class="id">Γ</span> <span class="id">x</span> <span class="id">ck</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">s</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">env</span> <span class="id">x</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_var">wf_var</a></span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hwfv</span> <span class="id">x</span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">Hty</span> <span class="id">Hck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wfv_spec1">wfv_spec1</a></span> <span class="kwd">in</span> <span class="id">Hwfv</span> <span class="kwd">as</span> ?; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wfv_spec2">wfv_spec2</a></span> <span class="kwd">in</span> <span class="id">Hwfv</span> <span class="kwd">as</span> ?; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.wfe_wfv_">wfe_wfv_</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">ty</span> <span class="id">s</span> /\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">ck</span> <span class="id">s</span> /\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_var">wf_var</a></span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">s</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> *  (<span class="id">Ty</span> &amp; <span class="id">Cl</span> &amp; <span class="id">Sf</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Ty</span> <span class="id">Cl</span> <span class="id">Sf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.DSForall_pres">DSForall_pres</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">s</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> *; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_le_compat">rem_le_compat</a></span> <span class="kwd">in</span> <span class="id">Cl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#rem_AC">rem_AC</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_cons">rem_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.rem_denot_clock">rem_denot_clock</a></span> <span class="kwd">in</span> <span class="id">Cl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Sf</span>. <span class="id">inv</span> <span class="id">Ty</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#first_le_compat">first_le_compat</a></span> <span class="kwd">in</span> <span class="id">Cl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span> <span class="kwd">in</span> *; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Sf</span>. <span class="id">inv</span> <span class="id">Ty</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.wfe_wfv">wfe_wfv</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span> <span class="id">ty</span> <span class="id">ck</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasType">HasType</a></span> <span class="id">Γ</span> <span class="id">x</span> <span class="id">ty</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasClock">HasClock</a></span> <span class="id">Γ</span> <span class="id">x</span> <span class="id">ck</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">s</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">env</span> <span class="id">x</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_var">wf_var</a></span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">s</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hwf</span> ??? <span class="id">Hty</span> <span class="id">Hcl</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">Hwf</span> _ _ _ <span class="id">Hty</span> <span class="id">Hcl</span>) <span class="kwd">as</span> (<span class="id">Ty</span> &amp; <span class="id">Cl</span> &amp; <span class="id">Sf</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Ty</span> <span class="id">Cl</span> <span class="id">Sf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">env</span> <span class="id">x</span>) <span class="kwd">as</span> <span class="id">xs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.DSForall_pres">DSForall_pres</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">xs</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> *; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_le_compat">rem_le_compat</a></span> <span class="kwd">in</span> <span class="id">Cl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#rem_AC">rem_AC</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_cons">rem_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.rem_denot_clock">rem_denot_clock</a></span> <span class="kwd">in</span> <span class="id">Cl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Sf</span>. <span class="id">inv</span> <span class="id">Ty</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#first_le_compat">first_le_compat</a></span> <span class="kwd">in</span> <span class="id">Cl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span> <span class="kwd">in</span> *; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Sf</span>. <span class="id">inv</span> <span class="id">Ty</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.wf_var_bot">wf_var_bot</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_var">wf_var</a></span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> 0.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS_inv">DS_inv</a></span>; <span class="id">now</span> <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.wf_env_bot">wf_env_bot</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">bs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> 0 <span class="id">bs</span> 0.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wfv_wfe">wfv_wfe</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">cases</span>; <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_var_bot">wf_var_bot</a></span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_var">wf_var</a></span>.<br/>
<br/>
<br/>
<h2> Continuous alternatives of <span class="bracket"><span class="id">denot_var</span></span> and <span class="bracket"><span class="id">denot_clock</span></span>,
    sometimes useful to deal with the ordering properties </h2>
<span class="kwd">Section</span> <span class="id"><a name="LDENOTSAFE.Cont_alt">Cont_alt</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="LDENOTSAFE.denot_var_C">denot_var_C</a></span> <span class="id">ins</span> <span class="id">x</span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo.Systems.html#DS_prod">DS_prod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.SI">SI</a></span> -<span class="id">C</span>-&gt; <span class="id"><a href="Velus.Lustre.Denot.Cpo.Systems.html#DS_prod">DS_prod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.SI">SI</a></span> -<span class="id">C</span>-&gt; <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#curry">curry</a></span> (<span class="kwd">if</span> <span class="id"><a href="Velus.Common.Common.html#mem_ident">mem_ident</a></span> <span class="id">x</span> <span class="id">ins</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#PROJ">PROJ</a></span> _ <span class="id">x</span> @_ <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#FST">FST</a></span> _ _<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#PROJ">PROJ</a></span> _ <span class="id">x</span> @_ <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#SND">SND</a></span> _ _).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="LDENOTSAFE.denot_var_eq">denot_var_eq</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ins</span> <span class="id">x</span> <span class="id">envI</span> <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">env</span> <span class="id">x</span> = <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_var_C">denot_var_C</a></span> <span class="id">ins</span> <span class="id">x</span> <span class="id">envI</span> <span class="id">env</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_var_C">denot_var_C</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="LDENOTSAFE.denot_clock_C">denot_clock_C</a></span> <span class="id">ins</span> <span class="id">ck</span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo.Systems.html#DS_prod">DS_prod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.SI">SI</a></span> -<span class="id">C</span>-&gt; <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> -<span class="id">C</span>-&gt; <span class="id"><a href="Velus.Lustre.Denot.Cpo.Systems.html#DS_prod">DS_prod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.SI">SI</a></span> -<span class="id">C</span>-&gt; <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#curry">curry</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#curry">curry</a></span> <span class="kwd">match</span> <span class="id">ck</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.Cbase">Cbase</a></span> =&gt;  <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#SND">SND</a></span> _ _ @_ <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#FST">FST</a></span> _ _<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.Con">Con</a></span> <span class="id">ck</span> <span class="id">x</span> (_, <span class="id">k</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">sx</span> := (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_var_C">denot_var_C</a></span> <span class="id">ins</span> <span class="id">x</span> @2_ <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#FST">FST</a></span> _ _ @_ <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#FST">FST</a></span> _ _) (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#SND">SND</a></span> _ _) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">cks</span> := (<span class="id">denot_clock_C</span> <span class="id">ins</span> <span class="id">ck</span> @3_ <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#FST">FST</a></span> _ _ @_ <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#FST">FST</a></span> _ _)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#SND">SND</a></span>  _ _ @_ <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#FST">FST</a></span> _ _) (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#SND">SND</a></span> _ _) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#ZIP">ZIP</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sample">sample</a></span> <span class="id">k</span>) @2_ <span class="id">sx</span>) <span class="id">cks</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="LDENOTSAFE.denot_clock_eq">denot_clock_eq</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">ck</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">ck</span> = <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock_C">denot_clock_C</a></span> <span class="id">ins</span> <span class="id">ck</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">ck</span>; <span class="id">simpl</span>; <span class="id">cases</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> <span class="id">IHck</span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_var_eq">denot_var_eq</a></span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Cont_alt">Cont_alt</a></span>.<br/>
<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="LDENOTSAFE.Admissibility">Admissibility</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.admissible_and3">admissible_and3</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">T</span> <span class="id">U</span> <span class="id">V</span> (<span class="id">D</span>:<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#cpo">cpo</a></span>) (<span class="id">P</span> <span class="id">Q</span> : <span class="id">T</span> -&gt; <span class="id">U</span> -&gt; <span class="id">V</span> -&gt; <span class="id">D</span> -&gt; <span class="kwd">Prop</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#admissible">admissible</a></span> (<span class="kwd">fun</span> <span class="id">d</span> =&gt; <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span>, <span class="id">P</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span> <span class="id">d</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#admissible">admissible</a></span> (<span class="kwd">fun</span> <span class="id">d</span> =&gt; <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span>, <span class="id">Q</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span> <span class="id">d</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#admissible">admissible</a></span> (<span class="kwd">fun</span> <span class="id">d</span> =&gt; <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span>, <span class="id">P</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span> <span class="id">d</span> /\ <span class="id">Q</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span> <span class="id">d</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Local</span> <span class="kwd">Set</span> <span class="id">Firstorder</span> <span class="id">Depth</span> 10.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">firstorder</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.wf_env_admissible">wf_env_admissible</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#admissible">admissible</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">f</span> <span class="id">Hf</span> ??? <span class="id">Hty</span> <span class="id">Hck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_var_eq">denot_var_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock_eq">denot_clock_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> 2 (<span class="id">setoid_rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#lub_comp_eq">lub_comp_eq</a></span>; <span class="id">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; [ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_admissible">DSForall_admissible</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#lub_le_compat">lub_le_compat</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_admissible">DSForall_admissible</a></span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id">intro</span> <span class="id">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id">specialize</span> (<span class="id">Hf</span> <span class="id">n</span> _ _ _ <span class="id">Hty</span> <span class="id">Hck</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock_eq">denot_clock_eq</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_var_eq">denot_var_eq</a></span> <span class="kwd">in</span> <span class="id">Hf</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.wf_env_admissible_ins">wf_env_admissible_ins</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">bs</span> <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#admissible">admissible</a></span> (<span class="kwd">fun</span> <span class="id">envI</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">f</span> <span class="id">Hf</span> ??? <span class="id">Hty</span> <span class="id">Hck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_var_eq">denot_var_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock_eq">denot_clock_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span> 2 (<span class="id">setoid_rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#lub_comp_eq">lub_comp_eq</a></span>; <span class="id">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; [ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_admissible">DSForall_admissible</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#lub_le_compat">lub_le_compat</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_admissible">DSForall_admissible</a></span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id">intro</span> <span class="id">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id">specialize</span> (<span class="id">Hf</span> <span class="id">n</span> _ _ _ <span class="id">Hty</span> <span class="id">Hck</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock_eq">denot_clock_eq</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_var_eq">denot_var_eq</a></span> <span class="kwd">in</span> <span class="id">Hf</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Admissibility">Admissibility</a></span>.<br/>
<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="LDENOTSAFE.SubClock">SubClock</a></span>.<br/>
<br/>
<div class="doc">CStr.sub_clock avec une notion de préfixe : le flot de gauche
      est plus long que celui de droite
    par ex :
     T T T F T F T T   est sub_clock de
     F T F F T ⊥
     T T T F T F ⊥   n'est pas sub_clock de
     F T F F T F T
   </div>
&nbsp;&nbsp;<span class="kwd">CoInductive</span> <span class="id"><a name="LDENOTSAFE.sub_clock">sub_clock</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Relations.Relation_Definitions.html#relation">relation</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>) :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="LDENOTSAFE.ScEps">ScEps</a></span> : <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sub_clock</span> <span class="id">x</span> <span class="id">y</span> -&gt; <span class="id">sub_clock</span> <span class="id">x</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#Eps">Eps</a></span> <span class="id">y</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="LDENOTSAFE.ScCon">ScCon</a></span> : <span class="kwd">forall</span> <span class="id">a</span> <span class="id">b</span> <span class="id">s</span> <span class="id">t</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sub_clock</span> <span class="id">s</span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#decomp">decomp</a></span> <span class="id">a</span> <span class="id">s</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html#le">Bool.le</a></span> <span class="id">b</span> <span class="id">a</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sub_clock</span> <span class="id">x</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#cons">cons</a></span> <span class="id">b</span> <span class="id">t</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.le_sub_clock">le_sub_clock</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">x</span> &lt;= <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock">sub_clock</a></span> <span class="id">y</span> <span class="id">x</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">destruct</span> <span class="id">x</span>; <span class="id">intros</span> * <span class="id">Hle</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> <span class="id">Hle</span>. <span class="id">now</span> <span class="id">apply</span> <span class="id">Cof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DSle_uncons">DSle_uncons</a></span> <span class="kwd">in</span> <span class="id">Hle</span> <span class="kwd">as</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">HH</span> <span class="kwd">as</span> (<span class="id">t</span> &amp; <span class="id">Ht</span> &amp; <span class="id">Hle'</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">eauto</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.sub_clock_decomp">sub_clock_decomp</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">s</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#decomp">decomp</a></span> <span class="id">a</span> <span class="id">s</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock">sub_clock</a></span> <span class="id">y</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">b</span> <span class="id">t</span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#decomp">decomp</a></span> <span class="id">b</span> <span class="id">t</span> <span class="id">y</span> /\ <span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html#le">Bool.le</a></span> <span class="id">a</span> <span class="id">b</span> /\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock">sub_clock</a></span> <span class="id">t</span> <span class="id">s</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">s</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Hdx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hdx</span> <span class="kwd">as</span> (<span class="id">k</span> &amp; <span class="id">Hk</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> <span class="id">dependent</span> <span class="id">x</span>. <span class="id">induction</span> <span class="id">k</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">intros</span> * <span class="id">Hk</span> <span class="id">Hsub</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hsub</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">destruct</span> (<span class="id">IHk</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#pred">pred</a></span> <span class="id">x</span>)); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">x</span>; <span class="id">simpl</span>; <span class="id">auto</span>. <span class="id">now</span> <span class="id">inv</span> <span class="id">Hsub</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.sub_clock_trans">sub_clock_trans</a></span> : <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock">sub_clock</a></span> <span class="id">x</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock">sub_clock</a></span> <span class="id">y</span> <span class="id">z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock">sub_clock</a></span> <span class="id">x</span> <span class="id">z</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>. <span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span> * <span class="id">Sub1</span> <span class="id">Sub2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">z</span>; <span class="id">inv</span> <span class="id">Sub2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock_decomp">sub_clock_decomp</a></span> <span class="kwd">in</span> <span class="id">Sub1</span> <span class="kwd">as</span> (<span class="id">c</span> &amp; <span class="id">t</span> &amp;?&amp;?&amp;?); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ScCon">ScCon</a></span> <span class="kwd">with</span> <span class="id">c</span> <span class="id">t</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.BoolOrder.html#le_trans">BoolOrder.le_trans</a></span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.sub_clock_Oeq_compat">sub_clock_Oeq_compat</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">x</span> == <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">z</span> == <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock">sub_clock</a></span> <span class="id">x</span> <span class="id">z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock">sub_clock</a></span> <span class="id">y</span> <span class="id">t</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * [<span class="id">Le1</span> <span class="id">Le2</span>] [<span class="id">Le3</span> <span class="id">Le4</span>] <span class="id">Hsub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.le_sub_clock">le_sub_clock</a></span> <span class="kwd">in</span> <span class="id">Le1</span>, <span class="id">Le2</span>, <span class="id">Le3</span>, <span class="id">Le4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock_trans">sub_clock_trans</a></span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="id">Global</span> <span class="id">Add</span> <span class="id">Parametric</span> <span class="id">Morphism</span> : <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock">sub_clock</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">signature</span> (@<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#Oeq">Oeq</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>)) ==&gt; (@<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#Oeq">Oeq</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>)) ==&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#iff">iff</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> <span class="id">sub_clock_morph</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Eq1</span> ?? <span class="id">Eq2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; <span class="id">intro</span> <span class="id">Hsub</span>; <span class="id">eauto</span> 2 <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock_Oeq_compat">sub_clock_Oeq_compat</a></span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.sub_clock_refl">sub_clock_refl</a></span> : <span class="kwd">forall</span> <span class="id">s</span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock">sub_clock</a></span> <span class="id">s</span> <span class="id">s</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>. <span class="id">intro</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember_ds</span> <span class="id">s</span> <span class="kwd">as</span> <span class="id">t</span>. <span class="id">rewrite</span> <span class="id">Ht</span> <span class="kwd">at</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert_all</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span>; <span class="id">destruct</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">apply</span> <span class="id">Cof</span>. <span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Classes.RelationClasses.html#symmetry">symmetry</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#decomp_eq">decomp_eq</a></span> <span class="kwd">in</span> <span class="id">Ht</span> <span class="kwd">as</span> (?&amp;?&amp; <span class="id">Ht</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.BoolOrder.html#le_refl">BoolOrder.le_refl</a></span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.sub_clock_antisym">sub_clock_antisym</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock">sub_clock</a></span> <span class="id">x</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock">sub_clock</a></span> <span class="id">y</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">x</span> == <span class="id">y</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Sub1</span> <span class="id">Sub2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#DS_bisimulation_allin1">DS_bisimulation_allin1</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id">R</span> := <span class="kwd">fun</span> <span class="id">U</span> <span class="id">V</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock">sub_clock</a></span> <span class="id">U</span> <span class="id">V</span> /\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock">sub_clock</a></span> <span class="id">V</span> <span class="id">U</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">now</span> <span class="id">intros</span> * [] &lt;- &lt;-.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">x</span> <span class="id">y</span> <span class="id">Hc</span> [<span class="id">Sub1</span> <span class="id">Sub2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="kwd">exists</span> <span class="id">u</span> <span class="id">xs</span> <span class="id">v</span> <span class="id">ys</span>, <span class="id">x</span> == <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#cons">cons</a></span> <span class="id">u</span> <span class="id">xs</span> /\ <span class="id">y</span> == <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#cons">cons</a></span> <span class="id">v</span> <span class="id">ys</span>) <span class="kwd">as</span> <span class="id">HH</span>. {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hc</span> <span class="kwd">as</span> [<span class="id">Hc</span>|<span class="id">Hc</span>]; <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Hc</span> <span class="kwd">as</span> (?&amp;?&amp; <span class="id">Heq</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Heq</span> <span class="kwd">in</span> *; [<span class="id">inv</span> <span class="id">Sub2</span>|<span class="id">inv</span> <span class="id">Sub1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">do</span> 4 <span class="id">esplit</span>; <span class="id">split</span>; <span class="id">eauto</span> 1; <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#decomp_eqCon">decomp_eqCon</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">HH</span> <span class="kwd">as</span> (?&amp;?&amp;?&amp;?&amp; <span class="id">Eq1</span> &amp; <span class="id">Eq2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Eq1</span>, <span class="id">Eq2</span>, 2 <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#first_cons">first_cons</a></span>, 2 <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_cons">rem_cons</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Sub1</span>. <span class="id">inv</span> <span class="id">Sub2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#decompCon_eq">decompCon_eq</a></span> <span class="kwd">in</span> <span class="id">H3</span>, <span class="id">H6</span>; <span class="id">inv</span> <span class="id">H3</span>; <span class="id">inv</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html#le">Bool.le</a></span> <span class="kwd">in</span> *; <span class="id">cases</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.sub_clock_le">sub_clock_le</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bs</span> <span class="id">xs</span> <span class="id">ys</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">xs</span> &lt;= <span class="id">ys</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock">sub_clock</a></span> <span class="id">bs</span> <span class="id">ys</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock">sub_clock</a></span> <span class="id">bs</span> <span class="id">xs</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span> * <span class="id">Le</span> <span class="id">Sub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">xs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> <span class="id">Le</span>. <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#decomp_eqCon">decomp_eqCon</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> <span class="id">Hy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hy</span> <span class="kwd">in</span> <span class="id">Sub</span>. <span class="id">inv</span> <span class="id">Sub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ScCon">ScCon</a></span> <span class="kwd">with</span> <span class="id">a</span> <span class="id">s</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">Cof</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.sub_clock_sample">sub_clock_sample</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bs</span> <span class="id">cs</span> <span class="id">xs</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock">sub_clock</a></span> <span class="id">bs</span> <span class="id">cs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock">sub_clock</a></span> <span class="id">bs</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#ZIP">ZIP</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sample">sample</a></span> <span class="id">k</span>) <span class="id">xs</span> <span class="id">cs</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>. <span class="id">intros</span> * <span class="id">Hsub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember_ds</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#ZIP">ZIP</a></span> _ _ _) <span class="kwd">as</span> <span class="id">zs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert_all</span>. <span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">zs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> <span class="id">Hzs</span>. <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Classes.RelationClasses.html#symmetry">symmetry</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#zip_uncons">zip_uncons</a></span> <span class="kwd">in</span> <span class="id">Hzs</span> <span class="kwd">as</span> (?&amp;?&amp;?&amp;?&amp; <span class="id">Hs1</span> &amp; <span class="id">Hs2</span> &amp;?&amp; <span class="id">Hp</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hs2</span> <span class="kwd">in</span> <span class="id">Hsub</span>; <span class="id">inv</span> <span class="id">Hsub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html#le">Bool.le</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sample">sample</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#andb">andb</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Strings.String.html#eqb">eqb</a></span> <span class="kwd">in</span> *; <span class="id">cases_eqn</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.sub_clock_bs">sub_clock_bs</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">ck</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock">sub_clock</a></span> <span class="id">bs</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">ck</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">ck</span> <span class="kwd">as</span> [| <span class="id">ck</span> <span class="id">Hck</span> <span class="id">x</span> (<span class="id">ty</span> &amp; <span class="id">k</span>)]; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock_refl">sub_clock_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock_sample">sub_clock_sample</a></span>, <span class="id">Hck</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.sub_clock_orb">sub_clock_orb</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bs</span> <span class="id">xs</span> <span class="id">ys</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock">sub_clock</a></span> <span class="id">bs</span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock">sub_clock</a></span> <span class="id">bs</span> <span class="id">ys</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock">sub_clock</a></span> <span class="id">bs</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#ZIP">ZIP</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#orb">orb</a></span> <span class="id">xs</span> <span class="id">ys</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>. <span class="id">intros</span> * <span class="id">Sub1</span> <span class="id">Sub2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember_ds</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#ZIP">ZIP</a></span> _ _ _) <span class="kwd">as</span> <span class="id">zs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert_all</span>. <span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">zs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> <span class="id">Hzs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">Cof</span> <span class="kwd">with</span> <span class="id">xs</span> <span class="id">ys</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Classes.RelationClasses.html#symmetry">symmetry</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#zip_uncons">zip_uncons</a></span> <span class="kwd">in</span> <span class="id">Hzs</span> <span class="kwd">as</span> (?&amp; <span class="id">xs'</span> &amp;?&amp; <span class="id">ys'</span> &amp; <span class="id">Hs1</span> &amp; <span class="id">Hs2</span> &amp;?&amp; <span class="id">Hp</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hs1</span>, <span class="id">Hs2</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Sub1</span>. <span class="id">inv</span> <span class="id">Sub2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H1</span>: <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#decomp">decomp</a></span> _ _ _, <span class="id">H2</span>: <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#decomp">decomp</a></span> _ _ _ |- _ =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#decomp_decomp">decomp_decomp</a></span> _ _ _ _ _ _ <span class="id">H1</span> <span class="id">H2</span>); <span class="id">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ScCon">ScCon</a></span> <span class="kwd">with</span> <span class="id">a0</span> <span class="id">s0</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">Cof</span> <span class="kwd">with</span> <span class="id">xs'</span> <span class="id">ys'</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">unfold</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html#le">Bool.le</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#orb">orb</a></span> <span class="kwd">in</span> *. <span class="id">cases</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.orb_sub_clock">orb_sub_clock</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bs</span> <span class="id">xs</span> <span class="id">ys</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock">sub_clock</a></span> <span class="id">bs</span> <span class="id">ys</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">xs</span> &lt;= <span class="id">bs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#ZIP">ZIP</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#orb">orb</a></span> <span class="id">xs</span> <span class="id">ys</span> &lt;= <span class="id">bs</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>. <span class="id">intros</span> * <span class="id">Sub</span> <span class="id">Le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember_ds</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#ZIP">ZIP</a></span> _ _ _) <span class="kwd">as</span> <span class="id">zs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert_all</span>. <span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">zs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> <span class="id">Hzs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">Cof</span> <span class="kwd">with</span> <span class="id">xs</span> <span class="id">ys</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Classes.RelationClasses.html#symmetry">symmetry</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#zip_uncons">zip_uncons</a></span> <span class="kwd">in</span> <span class="id">Hzs</span> <span class="kwd">as</span> (?&amp; <span class="id">xs'</span> &amp;?&amp; <span class="id">ys'</span> &amp; <span class="id">Hs1</span> &amp; <span class="id">Hs2</span> &amp;?&amp; <span class="id">Hp</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hs1</span>, <span class="id">Hs2</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Sub</span>. <span class="id">inv</span> <span class="id">Le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H1</span>: <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#decomp">decomp</a></span> _ _ _, <span class="id">H2</span>: <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#decomp">decomp</a></span> _ _ _ |- _ =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#decomp_decomp">decomp_decomp</a></span> _ _ _ _ _ _ <span class="id">H1</span> <span class="id">H2</span>); <span class="id">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DSleCon">DSleCon</a></span> <span class="kwd">with</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">unfold</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html#le">Bool.le</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#orb">orb</a></span> <span class="kwd">in</span> *. <span class="id">cases</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">Cof</span> <span class="kwd">with</span> <span class="id">xs'</span> <span class="id">ys'</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.SubClock">SubClock</a></span>.<br/>
<br/>
<br/>
<h2> Traitement de l'horloge de base </h2>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.sub_clock_bss">sub_clock_bss</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span> <span class="id">bs</span> (<span class="id">env</span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo.Systems.html#DS_prod">DS_prod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.SI">SI</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l</span> &lt;&gt; [] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> <span class="id">l</span> -&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock">sub_clock</a></span> <span class="id">bs</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> (<span class="id">env</span> <span class="id">x</span>))) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock">sub_clock</a></span> <span class="id">bs</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#bss">bss</a></span> <span class="id">l</span> <span class="id">env</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">l</span> <span class="kwd">as</span> [| <span class="id">x</span> [| <span class="id">y</span> <span class="id">l</span>]]; <span class="id">intros</span> * <span class="id">Hnil</span> <span class="id">Hsub</span>.<br/>
&nbsp;&nbsp;- <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id">Hsub</span>. <span class="id">now</span> <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#bss_cons2">bss_cons2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock_orb">sub_clock_orb</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">Hsub</span>. <span class="id">now</span> <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHl</span>. <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">intros</span>. <span class="id">apply</span> <span class="id">Hsub</span>. <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">tauto</span>. }<br/>
Qed.</div></details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.bss_sub">bss_sub</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span> (<span class="id">env</span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo.Systems.html#DS_prod">DS_prod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.SI">SI</a></span>) <span class="id">bs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">exists</span> <span class="id">x</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> <span class="id">l</span> /\ (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> (<span class="id">env</span> <span class="id">x</span>) &lt;= <span class="id">bs</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> <span class="id">l</span> -&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock">sub_clock</a></span> <span class="id">bs</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> (<span class="id">env</span> <span class="id">x</span>))) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#bss">bss</a></span> <span class="id">l</span> <span class="id">env</span> &lt;= <span class="id">bs</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">l</span> <span class="kwd">as</span> [| <span class="id">y</span> [| <span class="id">z</span> <span class="id">l</span>]]; <span class="id">intros</span> * (<span class="id">x</span> &amp; <span class="id">Hin</span> &amp; <span class="id">Hx</span>) <span class="id">Hsub</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [|<span class="id">HH</span>]; <span class="id">subst</span>; <span class="id">auto</span>; <span class="id">inv</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#bss_cons2">bss_cons2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [|<span class="id">Hin</span>]; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.orb_sub_clock">orb_sub_clock</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock_bss">sub_clock_bss</a></span>. <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">intros</span>. <span class="id">apply</span> <span class="id">Hsub</span>. <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">tauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#zip_comm">zip_comm</a></span>; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html#orb_comm">Bool.orb_comm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.orb_sub_clock">orb_sub_clock</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">apply</span> <span class="id">Hsub</span>. <span class="id">simpl</span>. <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">apply</span> <span class="id">IHl</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">intros</span>. <span class="id">apply</span> <span class="id">Hsub</span>. <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">tauto</span>. }<br/>
Qed.</div></details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.bss_le_bs">bss_le_bs</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">PSyn</span> <span class="id">Prefs</span>} (<span class="id">n</span> : @<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.node">node</a></span> <span class="id">PSyn</span> <span class="id">Prefs</span>),<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">bs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Γ</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) ++ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.wc_env">wc_env</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, (_, <span class="id">ck</span>, _)) =&gt; (<span class="id">x</span>, <span class="id">ck</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_env">cl_env</a></span> <span class="id">Γ</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="id">env</span> <span class="id">bs</span> 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#bss">bss</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="id">env</span> &lt;= <span class="id">bs</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">WCin</span> <span class="id">Hcl</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.bss_sub">bss_sub</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_env_has_Cbase">wc_env_has_Cbase</a></span> _ <span class="id">WCin</span>) <span class="kwd">as</span> [<span class="id">i</span> <span class="id">Hin</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span>. <span class="id">exact</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_ingt0">n_ingt0</a></span> <span class="id">n</span>). }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">i</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>))) <span class="kwd">as</span> <span class="id">Hi</span> <span class="kwd">by</span> (<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span>; <span class="id">solve_In</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">i</span>; <span class="id">split</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hcl</span> <span class="id">i</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.Cbase">Cbase</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="kwd">in</span> <span class="id">Hcl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> (<span class="id"><a href="Velus.Common.Common.html#mem_ident_spec">mem_ident_spec</a></span> _ _) <span class="id">Hi</span>) <span class="kwd">in</span> <span class="id">Hcl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_In</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">Hcl</span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasClock_app">HasClock_app</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_HasClock">senv_HasClock</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">x</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_In</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hcl</span> <span class="id">x</span> <span class="id">c</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="kwd">in</span> <span class="id">Hcl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> (<span class="id"><a href="Velus.Common.Common.html#mem_ident_spec">mem_ident_spec</a></span> _ _)) <span class="kwd">in</span> <span class="id">Hcl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2: <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span>; <span class="id">solve_In</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock_le">sub_clock_le</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">Hcl</span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasClock_app">HasClock_app</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_HasClock">senv_HasClock</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sub_clock_bs">sub_clock_bs</a></span>.<br/>
Qed.</div></details>
<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="LDENOTSAFE.Node_safe">Node_safe</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id"><a name="LDENOTSAFE.Node_safe.PSyn">PSyn</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.decl">decl</a></span> -&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.block">block</a></span> -&gt; <span class="kwd">Prop</span>}.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id"><a name="LDENOTSAFE.Node_safe.Prefs">Prefs</a></span> : <span class="id"><a href="Velus.Common.Common.html#PS.t">PS.t</a></span>}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Variables</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a name="LDENOTSAFE.Node_safe.G">G</a></span> : @<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.global">global</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.PSyn">PSyn</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.Prefs">Prefs</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a name="LDENOTSAFE.Node_safe.envG">envG</a></span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#Dprodi">Dprodi</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.FI">FI</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Hypothesis</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a name="LDENOTSAFE.Node_safe.WCG">WCG</a></span> : <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_global">wc_global</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span>).<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Hypothesis</span> <span class="id"><a name="LDENOTSAFE.Node_safe.Hnode">Hnode</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.find_node">find_node</a></span> <span class="id">f</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">n</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ins</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">n</span>.(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Γ</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) ++ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bs</span> <span class="id">envI</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#bss">bss</a></span> <span class="id">ins</span> <span class="id">envI</span> &lt;= <span class="id">bs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.envG">envG</a></span> <span class="id">f</span> <span class="id">envI</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.basilus_nclockus">basilus_nclockus</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">env</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ss</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exp">denot_exp</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">ins</span> <span class="id">e</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.envG">envG</a></span> <span class="id">envI</span> <span class="id">env</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">nc</span> <span class="id">s</span> =&gt; <span class="kwd">match</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">nc</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">env</span> <span class="id">x</span> = <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span> <span class="kwd">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.nclockof">nclockof</a></span> <span class="id">e</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">ss</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">subst</span> <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;on&nbsp;détruit&nbsp;les&nbsp;paires,&nbsp;c'est&nbsp;parfois&nbsp;utile&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">e</span>; <span class="id">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span> <span class="id">p</span>:(_*_)|- _ =&gt; <span class="id">destruct</span> <span class="id">p</span> <span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">simpl</span>; <span class="id">simpl_Forall</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">setoid_rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exp_eq">denot_exp_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>:<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_forall">Forall2_forall</a></span>; <span class="id">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">now</span> <span class="id">intros</span>|<span class="id">now</span> <span class="id">rewrite</span> (@<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_length">list_of_nprod_length</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>)))].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;FIXME:&nbsp;sans&nbsp;préciser&nbsp;(DS&nbsp;(sampl&nbsp;value)),&nbsp;le&nbsp;rewrite&nbsp;ci-dessus&nbsp;échoue.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Je&nbsp;ne&nbsp;comprends&nbsp;pas&nbsp;pourquoi&nbsp;mais&nbsp;apparemment&nbsp;appliquer&nbsp;le&nbsp;changement<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;suivant&nbsp;semble&nbsp;régler&nbsp;le&nbsp;problème&nbsp;d'unification&nbsp;:&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;change&nbsp;(DStr&nbsp;(sampl&nbsp;value))&nbsp;with&nbsp;(tord&nbsp;(tcpo&nbsp;(DS&nbsp;(sampl&nbsp;value)))).&nbsp;*)</span><br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="LDENOTSAFE.nclocksof_sem">nclocksof_sem</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">env</span> <span class="id">es</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ss</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exps">denot_exps</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">ins</span> <span class="id">es</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.envG">envG</a></span> <span class="id">envI</span> <span class="id">env</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">nc</span> <span class="id">s</span> =&gt; <span class="kwd">match</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">nc</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">env</span> <span class="id">x</span> = <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span> <span class="kwd">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.nclocksof">nclocksof</a></span> <span class="id">es</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">ss</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">es</span>; <span class="id">simpl</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exps_eq">denot_exps_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_app">list_of_nprod_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_app">Forall2_app</a></span>; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.basilus_nclockus">basilus_nclockus</a></span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
<br/>
<h2> Traitement des instanciations de nœuds  </h2>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.Wi_match_ss">Wi_match_ss</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">env</span> <span class="id">env'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bck</span> <span class="id">sub</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">n</span> : @<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.node">node</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.PSyn">PSyn</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.Prefs">Prefs</a></span>) <span class="id">nn</span> (<span class="id">ss</span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#nprod">nprod</a></span> <span class="id">nn</span>) <span class="id">ncks</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ckins</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, (_, <span class="id">ck</span>, _)) =&gt; (<span class="id">x</span>, <span class="id">ck</span>)) <span class="id">n</span>.(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.WellInstantiated">WellInstantiated</a></span> <span class="id">bck</span> <span class="id">sub</span>) <span class="id">ckins</span> <span class="id">ncks</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">nc</span> <span class="id">s</span> =&gt; <span class="kwd">match</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">nc</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">env</span> <span class="id">x</span> = <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">ncks</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">ss</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">ck</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sub</span> <span class="id">x</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id">x</span>, <span class="id">ck</span>) <span class="id">ckins</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.env_of_np">env_of_np</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="id">ss</span>) <span class="id">env'</span> <span class="id">x</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">env</span> <span class="id">y</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Wi</span> <span class="id">Ncs</span> * <span class="id">Hsub</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">n</span>.(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_nodup">n_nodup</a></span>) <span class="kwd">as</span> (<span class="id">Nd</span> % <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_l">NoDup_app_l</a></span> &amp; _).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="kwd">at</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> (<span class="id"><a href="Velus.Common.Common.html#mem_ident_spec">mem_ident_spec</a></span> _ _)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2: <span class="id">simpl_In</span>; <span class="id">esplit</span>; <span class="id">split</span>; <span class="id">now</span> <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_trans_ex">Forall2_trans_ex</a></span> <span class="kwd">in</span> <span class="id">Ncs</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In_nth_error">In_nth_error</a></span> <span class="kwd">in</span> <span class="id">Hin</span> <span class="kwd">as</span> (<span class="id">k</span> &amp; <span class="id">Kth</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#nth_error_Forall2">nth_error_Forall2</a></span> <span class="kwd">in</span> <span class="id">Ncs</span> <span class="kwd">as</span> (?&amp;?&amp;[]&amp;?&amp;[<span class="id">Sub</span> <span class="id">Inst</span>]&amp;?); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">subst</span>. <span class="id">cases</span>; <span class="id">inv</span> <span class="id">Hsub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.env_of_np_nth">env_of_np_nth</a></span> <span class="kwd">with</span> (<span class="id">k</span> := <span class="id">k</span>), <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_nth_error">list_of_nprod_nth_error</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#nth_mem_nth">nth_mem_nth</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#map_nth_error_inv">map_nth_error_inv</a></span> <span class="kwd">in</span> <span class="id">Kth</span> <span class="kwd">as</span> ((?&amp;(?&amp;?)&amp;?)&amp; <span class="id">He</span> &amp; <span class="id">HHH</span>). <span class="id">inv</span> <span class="id">HHH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_map">nth_error_map</a></span>, <span class="id">He</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.denot_clock_inst_ins">denot_clock_inst_ins</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bck</span> <span class="id">sub</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ncks</span> (<span class="id">n</span>: @<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.node">node</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.PSyn">PSyn</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.Prefs">Prefs</a></span>) <span class="id">nn</span> (<span class="id">ss</span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#nprod">nprod</a></span> <span class="id">nn</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ckins</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, (_, <span class="id">ck</span>, _)) =&gt; (<span class="id">x</span>, <span class="id">ck</span>)) <span class="id">n</span>.(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.wc_env">wc_env</a></span> <span class="id">ckins</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.WellInstantiated">WellInstantiated</a></span> <span class="id">bck</span> <span class="id">sub</span>) <span class="id">ckins</span> <span class="id">ncks</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">ncks</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">ss</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">nc</span> <span class="id">s</span> =&gt; <span class="kwd">match</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">nc</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">env</span> <span class="id">x</span> = <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">ncks</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">ss</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env'</span> <span class="id">ck</span> <span class="id">x</span> <span class="id">ck'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id">x</span>, <span class="id">ck</span>) <span class="id">ckins</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.instck">instck</a></span> <span class="id">bck</span> <span class="id">sub</span> <span class="id">ck</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">ck'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.env_of_np">env_of_np</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="id">ss</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">bck</span>) <span class="id">env'</span> <span class="id">ck</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">ck'</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hwc</span> <span class="id">Hinst</span> <span class="id">Hcl</span> <span class="id">Ncs</span> <span class="id">env'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">ck</span>; <span class="id">intros</span> * <span class="id">Hin</span> <span class="id">Hck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">now</span> <span class="id">inv</span> <span class="id">Hck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">cases_eqn</span> <span class="id">HH</span>. <span class="id">inv</span> <span class="id">Hck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.wc_env_var">wc_env_var</a></span> <span class="kwd">in</span> <span class="id">Hwc</span>; <span class="id">eauto</span>; <span class="id">inv</span> <span class="id">Hwc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">IHck</span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Wi_match_ss">Wi_match_ss</a></span>; <span class="id">simpl</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.cl_env_inst">cl_env_inst</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bck</span> <span class="id">sub</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ncks</span> (<span class="id">n</span> : @<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.node">node</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.PSyn">PSyn</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.Prefs">Prefs</a></span>) <span class="id">nn</span> (<span class="id">ss</span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#nprod">nprod</a></span> <span class="id">nn</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ckins</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, (_, <span class="id">ck</span>, _)) =&gt; (<span class="id">x</span>, <span class="id">ck</span>)) <span class="id">n</span>.(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.wc_env">wc_env</a></span> <span class="id">ckins</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.WellInstantiated">WellInstantiated</a></span> <span class="id">bck</span> <span class="id">sub</span>) <span class="id">ckins</span> <span class="id">ncks</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">nc</span> <span class="id">s</span> =&gt; <span class="kwd">match</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">nc</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">env</span> <span class="id">x</span> = <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">ncks</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">ss</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">ncks</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">ss</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_env">cl_env</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) ++ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.env_of_np">env_of_np</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="id">ss</span>) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">bck</span>) 0.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hwc</span> <span class="id">Hinst</span> <span class="id">Ncs</span> <span class="id">Hcl</span> <span class="id">x</span> <span class="id">ck</span> <span class="id">Hck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;seul&nbsp;le&nbsp;cas&nbsp;où&nbsp;x&nbsp;est&nbsp;une&nbsp;entrée&nbsp;nous&nbsp;intéresse&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id">Hxin</span>. 2: <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span>; <span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#MAP_map">MAP_map</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#map_bot">map_bot</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#mem_ident_spec">mem_ident_spec</a></span> <span class="kwd">in</span> <span class="id">Hxin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.HasClock_ins_app">HasClock_ins_app</a></span> <span class="kwd">in</span> <span class="id">Hck</span>; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.NoDup_senv">NoDup_senv</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.HasClock_senv">HasClock_senv</a></span> <span class="kwd">in</span> <span class="id">Hck</span>; <span class="id">auto</span>. <span class="id">clear</span> <span class="id">Hxin</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_map_1">Forall2_map_1</a></span> <span class="kwd">with</span> (<span class="id">f</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span>) <span class="kwd">in</span> <span class="id">Hcl</span> <span class="kwd">as</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_trans_ex">Forall2_trans_ex</a></span> <span class="kwd">with</span> (1 := <span class="id">Hinst</span>) <span class="kwd">in</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In_nth_error">In_nth_error</a></span> <span class="kwd">in</span> <span class="id">Hck</span> <span class="kwd">as</span> <span class="id">J</span>. <span class="id">destruct</span> <span class="id">J</span> <span class="kwd">as</span> (<span class="id">k</span> &amp; <span class="id">Kth</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#nth_error_Forall2">nth_error_Forall2</a></span> <span class="kwd">with</span> (1 := <span class="id">Kth</span>) <span class="kwd">in</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">HH</span> <span class="kwd">as</span> (?&amp;?&amp;?&amp;?&amp;[]&amp;?). <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock_inst_ins">denot_clock_inst_ins</a></span> <span class="kwd">in</span> <span class="id">Hck</span> <span class="kwd">as</span> -&gt;; <span class="id">eauto</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.env_of_np_nth">env_of_np_nth</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_nth_error">list_of_nprod_nth_error</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">n</span>.(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_nodup">n_nodup</a></span>) <span class="kwd">as</span> (<span class="id">Nd</span> % <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_l">NoDup_app_l</a></span> &amp; _).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#nth_mem_nth">nth_mem_nth</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_map">nth_error_map</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonTactics.html#option_map_inv">option_map_inv</a></span> <span class="kwd">in</span> <span class="id">Kth</span> <span class="kwd">as</span> (?&amp;-&gt;&amp;?); <span class="id">cases</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.ef_env_inst">ef_env_inst</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">n</span> : @<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.node">node</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.PSyn">PSyn</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.Prefs">Prefs</a></span>) (<span class="id">ss</span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#nprod">nprod</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>))),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">ss</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ef_env">ef_env</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) ++ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.env_of_np">env_of_np</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="id">ss</span>) 0.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hs</span> ?? <span class="id">Hty</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;seul&nbsp;le&nbsp;cas&nbsp;où&nbsp;x&nbsp;est&nbsp;une&nbsp;entrée&nbsp;nous&nbsp;intéresse&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id">Hxin</span>. 2: <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_bot">DSForall_bot</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#mem_ident_nth">mem_ident_nth</a></span> <span class="kwd">in</span> <span class="id">Hxin</span> <span class="kwd">as</span> (<span class="id">k</span> &amp; <span class="id">Hl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#mem_nth_Some">mem_nth_Some</a></span> <span class="kwd">in</span> <span class="id">Hl</span> <span class="kwd">as</span> <span class="id">Hk</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> <span class="kwd">in</span> <span class="id">Hk</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span> <span class="kwd">in</span> <span class="id">Hk</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.env_of_np_nth">env_of_np_nth</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_k">forall_nprod_k</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.ty_env_inst">ty_env_inst</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tys</span> (<span class="id">n</span> : @<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.node">node</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.PSyn">PSyn</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.Prefs">Prefs</a></span>) <span class="id">nn</span> (<span class="id">ss</span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#nprod">nprod</a></span> <span class="id">nn</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> (<span class="id">et</span> : <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.type">type</a></span>) '(_, (<span class="id">t</span>, _, _)) =&gt; <span class="id">et</span> = <span class="id">t</span>) <span class="id">tys</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">tys</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">ss</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_env">ty_env</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) ++ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.env_of_np">env_of_np</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="id">ss</span>) 0.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hins</span> <span class="id">Hss</span> ?? <span class="id">Hty</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">n</span>.(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_nodup">n_nodup</a></span>) <span class="kwd">as</span> (<span class="id">Nd</span> % <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_l">NoDup_app_l</a></span> &amp; _).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_swap_args">Forall2_swap_args</a></span> <span class="kwd">in</span> <span class="id">Hins</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_trans_ex">Forall2_trans_ex</a></span> <span class="kwd">in</span> <span class="id">Hss</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;seul&nbsp;le&nbsp;cas&nbsp;où&nbsp;x&nbsp;est&nbsp;une&nbsp;entrée&nbsp;nous&nbsp;intéresse&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id">Hxin</span>. 2: <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_bot">DSForall_bot</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.Common.html#mem_ident_spec">mem_ident_spec</a></span> <span class="kwd">in</span> <span class="id">Hxin</span> <span class="kwd">as</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.HasType_ins_app">HasType_ins_app</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Ty_senv">Ty_senv</a></span> <span class="kwd">in</span> <span class="id">Hty</span>; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.NoDup_senv">NoDup_senv</a></span>; <span class="id">clear</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In_nth_error">In_nth_error</a></span> <span class="kwd">in</span> <span class="id">Hty</span> <span class="kwd">as</span> (<span class="id">k</span> &amp; <span class="id">Kth</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.env_of_np_nth">env_of_np_nth</a></span> <span class="kwd">with</span> (<span class="id">k</span> := <span class="id">k</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2: {<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#nth_mem_nth">nth_mem_nth</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#map_nth_error_inv">map_nth_error_inv</a></span> <span class="kwd">in</span> <span class="id">Kth</span> <span class="kwd">as</span> ((?&amp;(?&amp;?)&amp;?)&amp; <span class="id">He</span> &amp; <span class="id">HH</span>). <span class="id">inv</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span>. <span class="id">erewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_nth_error">map_nth_error</a></span>; <span class="id">now</span> <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#map_nth_error_inv">map_nth_error_inv</a></span> <span class="kwd">in</span> <span class="id">Kth</span> <span class="kwd">as</span> ((?&amp;(?&amp;?)&amp;?)&amp;?&amp;<span class="id">HH</span>). <span class="id">inv</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#nth_error_Forall2">nth_error_Forall2</a></span> <span class="kwd">in</span> <span class="id">Hss</span> <span class="kwd">as</span> (?&amp;?&amp;?&amp;?&amp;?&amp;?); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_nth_error">list_of_nprod_nth_error</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.inst_ty_env">inst_ty_env</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tys</span> (<span class="id">n</span> : @<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.node">node</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.PSyn">PSyn</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.Prefs">Prefs</a></span>) <span class="id">envI</span> <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">a</span> '(_, (<span class="id">t</span>, _, _, _)) =&gt; <span class="id">a</span> = <span class="id">t</span>) <span class="id">tys</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_env">ty_env</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) ++ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="id">envI</span> <span class="id">env</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> <span class="id">tys</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.np_of_env">np_of_env</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)) <span class="id">env</span>)).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hty</span> <span class="id">Henv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_env">ty_env</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_forall2">Forall2_forall2</a></span>; <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_length">list_of_nprod_length</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_length">Forall2_length</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">d</span> ? <span class="id">k</span> <span class="id">ty</span> ? <span class="id">Hk</span> ??; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">lk</span> : <span class="id">k</span> &lt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">Datatypes.length</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span>; <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">Hty</span>; <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_nth">list_of_nprod_nth</a></span>, (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.nth_np_of_env">nth_np_of_env</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Henv</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id">k</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)) <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id">k</span> <span class="id">tys</span> <span class="id">d</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="kwd">in</span> <span class="id">Henv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id">Hxin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">exfalso</span>. <span class="id">apply</span> <span class="id"><a href="Velus.Common.Common.html#mem_ident_spec">mem_ident_spec</a></span> <span class="kwd">in</span> <span class="id">Hxin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">n</span>.(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_nodup">n_nodup</a></span>) <span class="kwd">as</span> (<span class="id">Nd</span> &amp;_).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_In">NoDup_app_In</a></span>; <span class="id">eauto</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_In">nth_In</a></span>; <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">Henv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasType_app">HasType_app</a></span>; <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> - <span class="id">Hty</span> <span class="id">Hk</span> <span class="id">lk</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;merci&nbsp;à&nbsp;Basile&nbsp;pour&nbsp;la&nbsp;preuve&nbsp;:&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unshelve</span> <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall2_nth">Forall2_nth</a></span> <span class="kwd">with</span> (<span class="id">n</span> := <span class="id">k</span>) <span class="kwd">in</span> <span class="id">Hty</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> (<span class="id">constructor</span>; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpAux.bool_velus_type">bool_velus_type</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id">k</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)) <span class="id">eqn</span>:<span class="id">Hnth</span>; <span class="id">destruct_conjs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasTypeC">HasTypeC</a></span> <span class="kwd">with</span> (<span class="id">e</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.Build_annotation">Build_annotation</a></span> <span class="id">t</span> <span class="id">c</span> <span class="id">i0</span> <span class="id">o</span>); <span class="id">subst</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_In</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_In">nth_In</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id">Hnth</span>; <span class="id">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">map_nth'</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id">Hnth</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.inst_ef_env">inst_ef_env</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">n</span> : @<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.node">node</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.PSyn">PSyn</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.Prefs">Prefs</a></span>) <span class="id">envI</span> <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ef_env">ef_env</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) ++ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="id">envI</span> <span class="id">env</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.np_of_env">np_of_env</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)) <span class="id">env</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">He</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">forall_np_of_env'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">x</span> <span class="id">Hxin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ef_env">ef_env</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="kwd">exists</span> <span class="id">ty</span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasType">HasType</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) ++ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)) <span class="id">x</span> <span class="id">ty</span>) <span class="kwd">as</span> (<span class="id">ty</span>&amp;<span class="id">Hty</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">apply</span> <span class="id">In_HasType'</span> <span class="kwd">in</span> <span class="id">Hxin</span> <span class="kwd">as</span> (?&amp;?); <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.HasType_app_r">HasType_app_r</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">n</span>.(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_nodup">n_nodup</a></span>) <span class="kwd">as</span> (<span class="id">Nd</span> &amp;_).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">He</span> <span class="kwd">in</span> <span class="id">Hty</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id">HH</span>; <span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#mem_ident_spec">mem_ident_spec</a></span> <span class="kwd">in</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_In">NoDup_app_In</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.inst_cl_env">inst_cl_env</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">env'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bck</span> <span class="id">sub</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">a</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.ann">ann</a></span>) (<span class="id">n</span> : @<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.node">node</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.PSyn">PSyn</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.Prefs">Prefs</a></span>) <span class="id">nn</span> (<span class="id">ss</span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#nprod">nprod</a></span> <span class="id">nn</span>) <span class="id">ncks</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ckins</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, (_, <span class="id">ck</span>, _)) =&gt; (<span class="id">x</span>, <span class="id">ck</span>)) <span class="id">n</span>.(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ckouts</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, (_, <span class="id">ck</span>, _, _)) =&gt; (<span class="id">x</span>, <span class="id">ck</span>)) <span class="id">n</span>.(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.wc_env">wc_env</a></span> <span class="id">ckins</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.wc_env">wc_env</a></span> (<span class="id">ckins</span> ++ <span class="id">ckouts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.WellInstantiated">WellInstantiated</a></span> <span class="id">bck</span> <span class="id">sub</span>) <span class="id">ckouts</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> '(_, <span class="id">ck</span>) =&gt; (<span class="id">ck</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)) <span class="id">a</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.WellInstantiated">WellInstantiated</a></span> <span class="id">bck</span> <span class="id">sub</span>) <span class="id">ckins</span> <span class="id">ncks</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_env">cl_env</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) ++ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.env_of_np">env_of_np</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="id">ss</span>) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">bck</span>) <span class="id">env'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">ncks</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">ss</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">nc</span> <span class="id">s</span> =&gt; <span class="kwd">match</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">nc</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">env</span> <span class="id">x</span> = <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">ncks</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">ss</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">a</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.np_of_env">np_of_env</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)) <span class="id">env'</span>)).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>. <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_env">cl_env</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Wci</span> <span class="id">Wcio</span> <span class="id">Hinsto</span> <span class="id">Hinsti</span> <span class="id">Hclo</span> <span class="id">Hcli</span> <span class="id">Ncs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">Hinsto</span> <span class="kwd">as</span> <span class="id">Hl</span>; <span class="id">rewrite</span> 2 <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span> <span class="kwd">in</span> <span class="id">Hl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;même&nbsp;résultat&nbsp;que&nbsp;denot_clock_inst_ins&nbsp;mais&nbsp;pour&nbsp;les&nbsp;sorties&nbsp;:&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ck</span> <span class="id">x</span> <span class="id">ck'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id">x</span>, <span class="id">ck</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, (_, <span class="id">ck</span>, _, _)) =&gt; (<span class="id">x</span>, <span class="id">ck</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.instck">instck</a></span> <span class="id">bck</span> <span class="id">sub</span> <span class="id">ck</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">ck'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.env_of_np">env_of_np</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="id">ss</span>) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">bck</span>) <span class="id">env'</span> <span class="id">ck</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">ck'</span>) <span class="kwd">as</span> <span class="id">Hcks</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">induction</span> <span class="id">ck</span>; <span class="id">intros</span> * <span class="id">Hin</span> <span class="id">Hck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">now</span> <span class="id">inv</span> <span class="id">Hck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">cases_eqn</span> <span class="id">HH</span>. <span class="id">inv</span> <span class="id">Hck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.wc_env_var">wc_env_var</a></span> <span class="kwd">in</span> <span class="id">Wcio</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id">in_app_weak'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Wcio</span>. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> [|<span class="id">Hino</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;input,&nbsp;on&nbsp;a&nbsp;déjà&nbsp;fait&nbsp;:&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock_inst_ins">denot_clock_inst_ins</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Wi_match_ss">Wi_match_ss</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;contradiction&nbsp;car&nbsp;sub&nbsp;i&nbsp;=&nbsp;None&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_in_left">Forall2_in_left</a></span> <span class="kwd">in</span> <span class="id">Hinsto</span> <span class="kwd">as</span> (?&amp; <span class="id">Hi</span> &amp;[<span class="id">Sub</span> _]); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span> <span class="kwd">in</span> <span class="id">Hi</span> <span class="kwd">as</span> ((?&amp;?)&amp;?&amp;?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subst</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_forall2">Forall2_forall2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>. { <span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_length">list_of_nprod_length</a></span>, 2 <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">d</span> <span class="id">s</span> <span class="id">k</span> ? ? <span class="id">Hk</span> ??; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span> <span class="kwd">in</span> <span class="id">Hk</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_nth">list_of_nprod_nth</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.nth_np_of_env">nth_np_of_env</a></span> <span class="kwd">with</span> (<span class="id">d</span>:=<span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>). 2: <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id">k</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)) <span class="kwd">as</span> (<span class="id">x</span>,(((<span class="id">ty</span>,<span class="id">ck</span>),<span class="id">i</span>),<span class="id">o</span>)) <span class="id">eqn</span>:<span class="id">Kth</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hin</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id">x</span>, ((<span class="id">ty</span>, <span class="id">ck</span>), <span class="id">i</span>, <span class="id">o</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">rewrite</span> &lt;- <span class="id">Kth</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_In">nth_In</a></span>. <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.decl">decl</a></span>. <span class="comment">(*&nbsp;!!!!!&nbsp;*)</span> <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- (<span class="id">Hcks</span> <span class="id">ck</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span>. <span class="kwd">exists</span> (<span class="id">x</span>,(<span class="id">ty</span>,<span class="id">ck</span>,<span class="id">i</span>,<span class="id">o</span>)). <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall2_nth">Forall2_nth</a></span> <span class="kwd">with</span> (<span class="id">n</span> := <span class="id">k</span>) <span class="kwd">in</span> <span class="id">Hinsto</span> <span class="kwd">as</span> [_ <span class="id">Inst</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> 2 <span class="id">map_nth'</span>, <span class="id">Kth</span> <span class="kwd">in</span> <span class="id">Inst</span>. <span class="id">erewrite</span> <span class="id">map_nth'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id">HH</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">rewrite</span> <span class="id">HH</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">rewrite</span> ?<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span>; <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">map_nth'</span>, <span class="id">Kth</span>; <span class="id">simpl</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> _). 2: <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hclo</span> <span class="id">x</span> <span class="id">ck</span>). <span class="id">cases_eqn</span> <span class="id">Hxin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">eapply</span> <span class="id">Hclo</span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.HasClock_app_r">HasClock_app_r</a></span>, <span class="id">senv_HasClock'</span>, <span class="id">Hin</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.Common.html#mem_ident_spec">mem_ident_spec</a></span> <span class="kwd">in</span> <span class="id">Hxin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="comment">(*&nbsp;on&nbsp;y&nbsp;est&nbsp;presque&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.not_in_out">not_in_out</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span>; <span class="id">eauto</span>. <span class="id">repeat</span> <span class="id">esplit</span>; <span class="id">now</span> <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Unshelve</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">repeat</span> <span class="id">split</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpAux.bool_velus_type">bool_velus_type</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span>; <span class="id">exact</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
<div class="doc">À partir de flots bien formés, construire un environnement
      d'entrées bien formé. </div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.safe_inst_in">safe_inst_in</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">es</span> (<span class="id">n</span> : @<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.node">node</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.PSyn">PSyn</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.Prefs">Prefs</a></span>) <span class="id">bck</span> <span class="id">sub</span> <span class="id">nn</span> (<span class="id">ss</span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#nprod">nprod</a></span> <span class="id">nn</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">nn</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> (<span class="id">et</span> : <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.type">type</a></span>) '(_, (<span class="id">t</span>, _, _)) =&gt; <span class="id">et</span> = <span class="id">t</span>) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.typesof">typesof</a></span> <span class="id">es</span>) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.WellInstantiated">WellInstantiated</a></span> <span class="id">bck</span> <span class="id">sub</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, (_, <span class="id">ck</span>, _)) =&gt; (<span class="id">x</span>, <span class="id">ck</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.nclocksof">nclocksof</a></span> <span class="id">es</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.wc_env">wc_env</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, (_, <span class="id">ck</span>, _)) =&gt; (<span class="id">x</span>, <span class="id">ck</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.typesof">typesof</a></span> <span class="id">es</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">ss</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.nclocksof">nclocksof</a></span> <span class="id">es</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">ss</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">ss</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">nc</span> <span class="id">s</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">nc</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">env</span> <span class="id">x</span> = <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.nclocksof">nclocksof</a></span> <span class="id">es</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">ss</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) ++ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.env_of_np">env_of_np</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="id">ss</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">bck</span>) 0.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hn</span> <span class="id">WTi</span> <span class="id">WIi</span> <span class="id">WCi</span> <span class="id">Wt</span> <span class="id">Wc</span> <span class="id">Sf</span> <span class="id">Ncs</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env_decompose">wf_env_decompose</a></span>. <span class="id">repeat</span> <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_env_inst">ty_env_inst</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_env_inst">cl_env_inst</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ef_env_inst">ef_env_inst</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
<br/>
<h2> Traitement du reset </h2>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.denot_clock_ins">denot_clock_ins</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ins</span> <span class="id">bs</span> <span class="id">envI</span> <span class="id">env1</span> <span class="id">env2</span> <span class="id">ck</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">y</span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.Is_free_in_clock">Is_free_in_clock</a></span> <span class="id">y</span> <span class="id">ck</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">y</span> <span class="id">ins</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env1</span> <span class="id">ck</span> == <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env2</span> <span class="id">ck</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">ck</span> <span class="kwd">as</span> [|?? <span class="id">i</span> []]; <span class="id">simpl</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hfr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> (<span class="id"><a href="Velus.Common.Common.html#mem_ident_spec">mem_ident_spec</a></span> _ _)), <span class="id">IHck</span>; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.Is_free_in_clock">Is_free_in_clock</a></span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.clock_ins_stable">clock_ins_stable</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">n</span> : @<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.node">node</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.PSyn">PSyn</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.Prefs">Prefs</a></span>) <span class="id">x</span> <span class="id">ck</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_node">wc_node</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">n</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Γ</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) ++ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ins</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasClock">HasClock</a></span> <span class="id">Γ</span> <span class="id">x</span> <span class="id">ck</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> <span class="id">ins</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">y</span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.Is_free_in_clock">Is_free_in_clock</a></span> <span class="id">y</span> <span class="id">ck</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">y</span> <span class="id">ins</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hwc</span> * <span class="id">Hck</span> <span class="id">Hin</span> <span class="id">y</span> <span class="id">Hfr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_nodup">n_nodup</a></span> <span class="id">n</span>) <span class="kwd">as</span> [<span class="id">Nd</span> <span class="id">Ndl</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion_clear</span> <span class="id">Hwc</span> <span class="kwd">as</span> [? <span class="id">Wci</span> <span class="id">Wcio</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.HasClock_ins_app">HasClock_ins_app</a></span> <span class="kwd">in</span> <span class="id">Hck</span>; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.node_NoDupMembers">node_NoDupMembers</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_env_Is_free_in_clock_In">wc_env_Is_free_in_clock_In</a></span> <span class="kwd">in</span> <span class="id">Wci</span> <span class="kwd">as</span> <span class="id">Hy</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.HasClock_senv">HasClock_senv</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subst</span> <span class="id">ins</span>; <span class="id">solve_In</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
<div class="doc">FIXME: on voudrait généraliser (envG f) pour sortir de la section
      Node_safe, se concentrer sur la fonction de reset (sans Hnode, Γ, etc.)
      et obtenir un résultat du genre :
      Lemma safe_sreset :
        forall (f : DS_prod SI -C-&gt; DS_prod SI) Γ ins envI bs rs,
        (forall bs envI,
          bss ins envI &lt;= bs -&gt;
          wf_env Γ ins envI bs 0 -&gt;
          wf_env Γ ins envI bs (f envI)) -&gt;
        bss ins envI &lt;= bs -&gt;
        safe_DS rs -&gt;
        wf_env Γ ins envI bs 0 -&gt;
        wf_env Γ ins envI bs (sreset f rs envI).
      Malheureusement ça semble impossible car il faut des propriétés
      du type (wc_env Γ) et on ne peut les obtenir que dans un nœud
      bien cadencé.
   </div>
<br/>
<div class="doc">Ici on utilise l'hypothèse de section <span class="bracket"><span class="id">Hnode</span></span> à chaque fois que
      la condition de reset <span class="bracket"><span class="id">rs</span></span> est activée. </div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.safe_sreset">safe_sreset</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">n</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">rs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.find_node">find_node</a></span> <span class="id">f</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">n</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ins</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Γ</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) ++ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#bss">bss</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="id">envI</span> &lt;= <span class="id">bs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sreset">sreset</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.envG">envG</a></span> <span class="id">f</span>) <span class="id">rs</span> <span class="id">envI</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hfind</span> ?? <span class="id">Hbs</span> <span class="id">Hco</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sreset_eq">sreset_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember_ds</span> <span class="id">envI</span> <span class="kwd">as</span> <span class="id">envIk</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (_ (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.envG">envG</a></span> <span class="id">f</span>) <span class="id">envIk</span>) <span class="kwd">as</span> <span class="id">Y</span> <span class="id">eqn</span>:<span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;tout&nbsp;ce&nbsp;qu'on&nbsp;a&nbsp;besoin&nbsp;de&nbsp;savoir&nbsp;sur&nbsp;envIk&nbsp;et&nbsp;Y&nbsp;:&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="kwd">exists</span> <span class="id">envI</span> <span class="id">k</span>, <span class="id">envIk</span> == <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#nrem_env">nrem_env</a></span> <span class="id">k</span> <span class="id">envI</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envIk</span> <span class="id">bs</span> <span class="id">Y</span>) <span class="kwd">as</span> <span class="id">Hy</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">by</span> (<span class="kwd">exists</span> <span class="id">envI</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#O">O</a></span>; <span class="id">subst</span>; <span class="id">rewrite</span> <span class="id">HenvIk</span> <span class="kwd">in</span> *; <span class="id">split</span>; <span class="id">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> <span class="id">HH</span> <span class="id">HenvIk</span> <span class="id">envI</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sreset_aux">sreset_aux</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Cpo_def_ext.html#FIXP_fixp">FIXP_fixp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;on&nbsp;utilise&nbsp;le&nbsp;principe&nbsp;d'induction&nbsp;sur&nbsp;[fixp]&nbsp;de&nbsp;la&nbsp;bibliothèque&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hbs</span> <span class="id">Hco</span> <span class="id">Hy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Y</span> <span class="id">rs</span> <span class="id">envIk</span> <span class="id">bs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#fixp_ind">fixp_ind</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;admissible&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">red</span>; <span class="id">intros</span>; <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env_admissible">wf_env_admissible</a></span>; <span class="id">simpl</span>; <span class="id">now</span> <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">freset</span> <span class="id">Hco'</span> <span class="id">Y</span> <span class="id">rs</span> <span class="id">envIk</span> <span class="id">bs</span> <span class="id">Hbs</span> <span class="id">Hco</span> <span class="id">Hy</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Ici&nbsp;on&nbsp;a&nbsp;besoin&nbsp;d'un&nbsp;raisonnement&nbsp;co-inductif&nbsp;pour&nbsp;extraire&nbsp;la<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tête&nbsp;de&nbsp;[rs].&nbsp;(Tant&nbsp;que&nbsp;[rs]&nbsp;vaut&nbsp;[Eps],&nbsp;sresetf_aux&nbsp;ajoute&nbsp;[Eps]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;en&nbsp;tête&nbsp;de&nbsp;tous&nbsp;ses&nbsp;flots&nbsp;et&nbsp;c'est&nbsp;bon.)&nbsp;Comme&nbsp;[wf_env]&nbsp;n'est&nbsp;pas<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;un&nbsp;prédicat&nbsp;co-inductif,&nbsp;on&nbsp;ne&nbsp;peut&nbsp;pas&nbsp;utiliser&nbsp;cofix&nbsp;directement.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;On&nbsp;choisit&nbsp;de&nbsp;passer&nbsp;par&nbsp;[wf_var],&nbsp;qu'on&nbsp;a&nbsp;montré&nbsp;équivalent.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wfv_wfe">wfv_wfe</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cbv</span> <span class="id">zeta</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">x</span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">Hty</span> <span class="id">Hck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="Velus.Common.Common.html#mem_ident">mem_ident</a></span> <span class="id">x</span> <span class="id">ins</span>) <span class="id">eqn</span>:<span class="id">Hmem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;si&nbsp;x&nbsp;est&nbsp;une&nbsp;entrée,&nbsp;c'est&nbsp;ok&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">Hco</span> <span class="id">x</span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">Hty</span> <span class="id">Hck</span>) <span class="kwd">as</span> (?&amp;?&amp;?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wfe_wfv_">wfe_wfv_</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hmem</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>, <span class="id">ins</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock_ins">denot_clock_ins</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.Common.html#mem_ident_spec">mem_ident_spec</a></span> <span class="kwd">in</span> <span class="id">Hmem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.clock_ins_stable">clock_ins_stable</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_global_node">wc_global_node</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;sinon&nbsp;on&nbsp;va&nbsp;"attendre"&nbsp;les&nbsp;[Eps]&nbsp;sur&nbsp;x&nbsp;jusqu'à&nbsp;lui&nbsp;trouver<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;une&nbsp;tête&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember_ds</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id">ins</span> <span class="id">envIk</span> _ <span class="id">x</span>) <span class="kwd">as</span> <span class="id">xs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> <span class="id">dependent</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">xs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">xs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>; <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> <span class="id">Hxs</span>; <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> <span class="id">Cof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;on&nbsp;a&nbsp;maintenant&nbsp;[is_cons&nbsp;xs],&nbsp;d'où&nbsp;[is_cons&nbsp;rs]&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hxs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wfe_wfv">wfe_wfv</a></span>; <span class="id">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="kwd">exists</span> <span class="id">vr</span> <span class="id">rs'</span>, <span class="id">rs</span> == <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#cons">cons</a></span> <span class="id">vr</span> <span class="id">rs'</span>) <span class="kwd">as</span> (<span class="id">vr</span> &amp; <span class="id">rs'</span> &amp; <span class="id">Hrs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="kwd">in</span> <span class="id">Hxs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hmem</span> <span class="kwd">in</span> <span class="id">Hxs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Classes.RelationClasses.html#symmetry">symmetry</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#cons_is_cons">cons_is_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#is_cons_sresetf_aux">is_cons_sresetf_aux</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Hxs</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hrs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hy</span> <span class="kwd">as</span> (<span class="id">envI</span> &amp; <span class="id">k</span> &amp; <span class="id">Hk</span> &amp; <span class="id">Hco3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_le_compat">rem_le_compat</a></span> <span class="kwd">in</span> <span class="id">Hbs</span> <span class="kwd">as</span> <span class="id">Hbsr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env_rem">wf_env_rem</a></span> <span class="kwd">in</span> <span class="id">Hco</span> <span class="kwd">as</span> <span class="id">Hcor</span>, <span class="id">Hco3</span> <span class="kwd">as</span> <span class="id">Hco4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#REM_env_bot">REM_env_bot</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#rem_bss">rem_bss</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sresetf_aux_eq">sresetf_aux_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">vr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;signal&nbsp;true&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">Hco'</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;signal&nbsp;false&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env_APP">wf_env_APP</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">Hco'</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">envI</span>, (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">k</span>); <span class="id">rewrite</span> <span class="id">Hk</span> <span class="kwd">in</span> <span class="id">Hco4</span> |- * ; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Ltac</span> <span class="id">find_specialize_in</span> <span class="id">H</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">multimatch</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id">v</span> : _ |- _ ] =&gt; <span class="id">specialize</span> (<span class="id">H</span> <span class="id">v</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.safe_exp_">safe_exp_</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#bss">bss</a></span> <span class="id">ins</span> <span class="id">envI</span> &lt;= <span class="id">bs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">e</span> : <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.exp">exp</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_exp">wt_exp</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">Γ</span> <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">Γ</span> <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_exp">no_rte_exp</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">ins</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.envG">envG</a></span> <span class="id">envI</span> <span class="id">env</span> <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ss</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exp">denot_exp</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">ins</span> <span class="id">e</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.envG">envG</a></span> <span class="id">envI</span> <span class="id">env</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.typeof">typeof</a></span> <span class="id">e</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">ss</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.clockof">clockof</a></span> <span class="id">e</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">ss</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">ss</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> ???? <span class="id">env</span> <span class="id">Safe</span> <span class="id">Hbs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">e</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.exp_ind2">exp_ind2</a></span>; <span class="id">intros</span> <span class="id">Hwt</span> <span class="id">Hwc</span> <span class="id">Hoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">try</span> (<span class="id">now</span> <span class="id">inv</span> <span class="id">Hoc</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;Econst&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hwt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exp_eq">denot_exp_eq</a></span>; <span class="id">simpl</span>; <span class="id">autorewrite</span> <span class="kwd">with</span> <span class="id">cpodb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_sconst">ty_sconst</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.wt_value">wt_value</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.wt_cvalue_cconst">wt_cvalue_cconst</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_sconst">cl_sconst</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_sconst">safe_sconst</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;Eenum&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hwt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exp_eq">denot_exp_eq</a></span>; <span class="id">simpl</span>; <span class="id">autorewrite</span> <span class="kwd">with</span> <span class="id">cpodb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_sconst">ty_sconst</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.wt_value">wt_value</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.wt_cvalue_cconst">wt_cvalue_cconst</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_sconst">cl_sconst</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_sconst">safe_sconst</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;Evar&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hwt</span>. <span class="id">inv</span> <span class="id">Hwc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id">Safe</span> <span class="kwd">as</span> (?&amp;?&amp;?); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exp_eq">denot_exp_eq</a></span>; <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;Eunop&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_exp_wl_exp">wt_exp_wl_exp</a></span> <span class="kwd">in</span> <span class="id">Hwt</span> <span class="kwd">as</span> <span class="id">Hwl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hwl</span>. <span class="id">inv</span> <span class="id">Hwt</span>. <span class="id">inv</span> <span class="id">Hwc</span>. <span class="id">inv</span> <span class="id">Hoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">find_specialize_in</span> <span class="id">IHe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">find_specialize_in</span> <span class="id">H12</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exp_eq">denot_exp_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">IHe</span> <span class="id">H12</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">gen_sub_exps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.typeof">typeof</a></span> <span class="id">e</span> = _) <span class="id">and</span> <span class="id">rewrite</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.numstreams">numstreams</a></span> <span class="id">e</span> = _) <span class="id">and</span> <span class="id">rewrite</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>; <span class="id">intro</span> <span class="id">s</span>; <span class="id">autorewrite</span> <span class="kwd">with</span> <span class="id">cpodb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> (<span class="id">Wte</span> &amp; <span class="id">Wce</span> &amp; <span class="id">Efe</span>) <span class="id">Hop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.DSForall_pres_impl">DSForall_pres_impl</a></span> <span class="kwd">in</span> <span class="id">Hop</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>. <span class="id">all</span>: <span class="id">simpl_Forall</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_sunop">ty_sunop</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_sunop">cl_sunop</a></span>; <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS_decompose">safe_DS_decompose</a></span> <span class="kwd">in</span> <span class="id">Efe</span> <span class="kwd">as</span> (?&amp;?&amp;?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS_compose">safe_DS_compose</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_ty_sunop">safe_ty_sunop</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_cl_sunop">safe_cl_sunop</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_op_sunop">safe_op_sunop</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;Ebinop&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_exp_wl_exp">wt_exp_wl_exp</a></span> <span class="kwd">in</span> <span class="id">Hwt</span> <span class="kwd">as</span> <span class="id">Hwl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hwl</span>. <span class="id">inv</span> <span class="id">Hwt</span>. <span class="id">inv</span> <span class="id">Hwc</span>. <span class="id">inv</span> <span class="id">Hoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">find_specialize_in</span> <span class="id">IHe1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">find_specialize_in</span> <span class="id">IHe2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H20</span> _ _ <span class="id">H9</span> <span class="id">H10</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exp_eq">denot_exp_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">IHe1</span> <span class="id">IHe2</span> <span class="id">H20</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">gen_sub_exps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.typeof">typeof</a></span> <span class="id">e1</span> = _) <span class="id">and</span> <span class="id">rewrite</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.typeof">typeof</a></span> <span class="id">e2</span> = _) <span class="id">and</span> <span class="id">rewrite</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.numstreams">numstreams</a></span> <span class="id">e1</span> = _) <span class="id">and</span> <span class="id">rewrite</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.numstreams">numstreams</a></span> <span class="id">e2</span> = _) <span class="id">and</span> <span class="id">rewrite</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>; <span class="id">intros</span> <span class="id">s1</span> <span class="id">s2</span>; <span class="id">rewrite</span> 3 <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#ID_simpl">ID_simpl</a></span>, 3 <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#Id_simpl">Id_simpl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> (<span class="id">Wte1</span> &amp; <span class="id">Wce1</span> &amp; <span class="id">Efe1</span>) (<span class="id">Wte2</span> &amp; <span class="id">Wce2</span> &amp; <span class="id">Efe2</span>) <span class="id">Hop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.DSForall_2pres_impl">DSForall_2pres_impl</a></span> <span class="kwd">in</span> <span class="id">Hop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>. <span class="id">all</span>: <span class="id">simpl_Forall</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_sbinop">ty_sbinop</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_sbinop">cl_sbinop</a></span>; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS_decompose">safe_DS_decompose</a></span> <span class="kwd">in</span> <span class="id">Efe1</span> <span class="kwd">as</span> (?&amp;?&amp;?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS_decompose">safe_DS_decompose</a></span> <span class="kwd">in</span> <span class="id">Efe2</span> <span class="kwd">as</span> (?&amp;?&amp;?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">x</span> = <span class="id">x0</span>) <span class="kwd">by</span> <span class="id">congruence</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS_compose">safe_DS_compose</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_ty_sbinop">safe_ty_sbinop</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_cl_sbinop">safe_cl_sbinop</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_op_sbinop">safe_op_sbinop</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;Efby&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_exp_wl_exp">wt_exp_wl_exp</a></span> <span class="kwd">in</span> <span class="id">Hwt</span> <span class="kwd">as</span> <span class="id">Hwl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hwl</span>. <span class="id">inv</span> <span class="id">Hwt</span>. <span class="id">inv</span> <span class="id">Hwc</span>. <span class="id">inv</span> <span class="id">Hoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall_impl_inside">Forall_impl_inside</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_exp">wt_exp</a></span> _ _) <span class="kwd">in</span> <span class="id">H</span>, <span class="id">H0</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall_impl_inside">Forall_impl_inside</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_exp">wc_exp</a></span> _ _) <span class="kwd">in</span> <span class="id">H</span>, <span class="id">H0</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall_impl_inside">Forall_impl_inside</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_exp">no_rte_exp</a></span> _ _ _ _ _) <span class="kwd">in</span> <span class="id">H</span>, <span class="id">H0</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_and_inv">Forall_and_inv</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">Wt0</span> <span class="id">H'</span>], <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">Wt</span> <span class="id">H0'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_and_inv">Forall_and_inv</a></span> <span class="kwd">in</span> <span class="id">H'</span> <span class="kwd">as</span> [<span class="id">Wc0</span> <span class="id">Sf0</span>], <span class="id">H0'</span> <span class="kwd">as</span> [<span class="id">Wc</span> <span class="id">Sf</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Forall_ty_exp">Forall_ty_exp</a></span> <span class="kwd">in</span> <span class="id">Wt0</span>, <span class="id">Wt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Forall_cl_exp">Forall_cl_exp</a></span> <span class="kwd">in</span> <span class="id">Wc0</span>, <span class="id">Wc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.forall_denot_exps">forall_denot_exps</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_Forall">forall_nprod_Forall</a></span> <span class="kwd">in</span> <span class="id">Sf0</span>, <span class="id">Sf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exp_eq">denot_exp_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Wt0</span> <span class="id">Wt</span> <span class="id">Wc0</span> <span class="id">Wc</span> <span class="id">Sf0</span> <span class="id">Sf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">gen_sub_exps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.annots_numstreams">annots_numstreams</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>; <span class="id">intros</span>; <span class="id">unfold</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_rect">eq_rect</a></span>; <span class="id">cases</span>; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.typesof">typesof</a></span> <span class="id">es</span> = _) <span class="id">and</span> <span class="id">rewrite</span> <span class="id">it</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.typesof">typesof</a></span> <span class="id">e0s</span> = _) <span class="id">and</span> <span class="id">rewrite</span> <span class="id">it</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> _ _) <span class="id">and</span> <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_eq">Forall2_eq</a></span> <span class="kwd">in</span> <span class="id">it</span>; <span class="id">rewrite</span> &lt;- <span class="id">it</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> _ _) <span class="id">and</span> <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_eq">Forall2_eq</a></span> <span class="kwd">in</span> <span class="id">it</span>; <span class="id">rewrite</span> &lt;- <span class="id">it</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DStr">DStr</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>)) <span class="kwd">with</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#tord">tord</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#tcpo">tcpo</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>)))). <span class="comment">(*&nbsp;FIXME:&nbsp;voir&nbsp;plus&nbsp;haut&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall2_lift2">Forall2_lift2</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_fby">ty_fby</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall2_lift2">Forall2_lift2</a></span>. <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_fby">cl_fby</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">simpl_Forall</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall_forall_nprod">Forall_forall_nprod</a></span>, <span class="id">Forall2_ignore1''</span> <span class="kwd">with</span> (<span class="id">xs</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall2_lift2">Forall2_lift2</a></span>. <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_fby">safe_fby</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">simpl_Forall</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;Ewhen&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_exp_wl_exp">wt_exp_wl_exp</a></span> <span class="kwd">in</span> <span class="id">Hwt</span> <span class="kwd">as</span> <span class="id">Hwl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hwl</span>. <span class="id">inv</span> <span class="id">Hwt</span>. <span class="id">inv</span> <span class="id">Hwc</span>. <span class="id">inv</span> <span class="id">Hoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall_impl_inside">Forall_impl_inside</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_exp">wt_exp</a></span> _ _) <span class="kwd">in</span> <span class="id">H</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall_impl_inside">Forall_impl_inside</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_exp">wc_exp</a></span> _ _) <span class="kwd">in</span> <span class="id">H</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall_impl_inside">Forall_impl_inside</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_exp">no_rte_exp</a></span> _ _ _ _ _) <span class="kwd">in</span> <span class="id">H</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_and_inv">Forall_and_inv</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">Wt</span> <span class="id">H'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_and_inv">Forall_and_inv</a></span> <span class="kwd">in</span> <span class="id">H'</span> <span class="kwd">as</span> [<span class="id">Wc</span> <span class="id">Sf</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Forall_ty_exp">Forall_ty_exp</a></span> <span class="kwd">in</span> <span class="id">Wt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Forall_cl_exp">Forall_cl_exp</a></span> <span class="kwd">in</span> <span class="id">Wc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.forall_denot_exps">forall_denot_exps</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_Forall">forall_nprod_Forall</a></span> <span class="kwd">in</span> <span class="id">Sf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exp_eq">denot_exp_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Wt</span> <span class="id">Wc</span> <span class="id">Sf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">gen_sub_exps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.annots_numstreams">annots_numstreams</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>; <span class="id">intros</span>; <span class="id">unfold</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_rect">eq_rect</a></span>; <span class="id">cases</span>; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall2_Forall_eq">Forall2_Forall_eq</a></span> <span class="kwd">in</span> <span class="id">Wc</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id">Safe</span> <span class="kwd">as</span> (?&amp;?&amp;?); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DStr">DStr</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>)) <span class="kwd">with</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#tord">tord</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#tcpo">tcpo</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>)))). <span class="comment">(*&nbsp;FIXME:&nbsp;voir&nbsp;plus&nbsp;haut&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall2_llift">Forall2_llift</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_swhenv">ty_swhenv</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_map_1">Forall2_map_1</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall2_llift">Forall2_llift</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">intros</span> * <span class="id">HH</span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_swhenv">cl_swhenv</a></span>, <span class="id">HH</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_llift">forall_nprod_llift</a></span> <span class="kwd">with</span> (<span class="id">Q</span> := <span class="kwd">fun</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> _ _ _ _ <span class="id">ck</span> <span class="id">s</span> /\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">s</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">intros</span> ? []. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_swhenv">safe_swhenv</a></span>. <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_and">forall_nprod_and</a></span>; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall_forall_nprod">Forall_forall_nprod</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;Emerge&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_exp_wl_exp">wt_exp_wl_exp</a></span> <span class="kwd">in</span> <span class="id">Hwt</span> <span class="kwd">as</span> <span class="id">Hwl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hwl</span>. <span class="id">inv</span> <span class="id">Hwt</span>. <span class="id">inv</span> <span class="id">Hwc</span>. <span class="id">inv</span> <span class="id">Hoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Common.CommonList.html#Forall_map">Forall_map</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall_concat">Forall_concat</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall_impl_inside">Forall_impl_inside</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_exp">wt_exp</a></span> _ _) <span class="kwd">in</span> <span class="id">H</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall_impl_inside">Forall_impl_inside</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_exp">wc_exp</a></span> _ _) <span class="kwd">in</span> <span class="id">H</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall_impl_inside">Forall_impl_inside</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_exp">no_rte_exp</a></span> _ _ _ _ _) <span class="kwd">in</span> <span class="id">H</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_and_inv">Forall_and_inv</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">Wt</span> <span class="id">H'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_and_inv">Forall_and_inv</a></span> <span class="kwd">in</span> <span class="id">H'</span> <span class="kwd">as</span> [<span class="id">Wc</span> <span class="id">Sf</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Common.CommonList.html#Forall_concat">Forall_concat</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Forall_ty_expss">Forall_ty_expss</a></span> <span class="kwd">with</span> (<span class="id">n</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">tys</span>) <span class="kwd">in</span> <span class="id">Wt</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Forall_cl_expss">Forall_cl_expss</a></span> <span class="kwd">with</span> (<span class="id">n</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">tys</span>) <span class="kwd">in</span> <span class="id">Wc</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.Forall_denot_expss">Forall_denot_expss</a></span> <span class="kwd">with</span> (<span class="id">n</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">tys</span>) <span class="kwd">in</span> <span class="id">Sf</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exp_eq">denot_exp_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.typeof">typeof</a></span> _); <span class="id">simpl</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.clockof">clockof</a></span> _).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Wt</span> <span class="id">Wc</span> <span class="id">Sf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">gen_sub_exps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>; <span class="id">intros</span>; <span class="id">unfold</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_rect_r">eq_rect_r</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_rect">eq_rect</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_sym">eq_sym</a></span>; <span class="id">cases</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id">Safe</span> <span class="kwd">as</span> (?&amp;?&amp;?); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DStr">DStr</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>)) <span class="kwd">with</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#tord">tord</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#tcpo">tcpo</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>)))). <span class="comment">(*&nbsp;FIXME:&nbsp;voir&nbsp;plus&nbsp;haut&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id">tys</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.typesof">typesof</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">es</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">by</span> (<span class="id">simpl_Forall</span>; <span class="id">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall2_Forall_eq">Forall2_Forall_eq</a></span> <span class="kwd">in</span> <span class="id">Wt</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall2_lift_nprod">Forall2_lift_nprod</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_smergev">ty_smergev</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_map_1">Forall2_map_1</a></span>, <span class="id">Forall2_ignore1'</span>; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_length">list_of_nprod_length</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall_lift_nprod">Forall_lift_nprod</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_smergev">cl_smergev</a></span>, <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#map_eq_nnil">map_eq_nnil</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> (<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#nprod_forall_Forall">nprod_forall_Forall</a></span> <span class="kwd">in</span> *; <span class="id">simpl_Forall</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> _) _) <span class="id">and</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall2_Forall_eq">Forall2_Forall_eq</a></span> <span class="kwd">in</span> <span class="id">it</span>; <span class="id">eauto</span>; <span class="id">now</span> <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall_forall_nprod">Forall_forall_nprod</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall_lift_nprod">Forall_lift_nprod</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_smergev">safe_smergev</a></span>, <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#map_eq_nnil">map_eq_nnil</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> (<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#nprod_forall_Forall">nprod_forall_Forall</a></span> <span class="kwd">in</span> *; <span class="id">simpl_Forall</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> _) _) <span class="id">and</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall2_Forall_eq">Forall2_Forall_eq</a></span> <span class="kwd">in</span> <span class="id">it</span>; <span class="id">eauto</span>; <span class="id">now</span> <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">d</span> <span class="kwd">as</span> [<span class="id">des</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;Ecase&nbsp;défaut&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">a</span> <span class="kwd">as</span> [<span class="id">tys</span> <span class="id">nck</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_exp_wl_exp">wt_exp_wl_exp</a></span> <span class="kwd">in</span> <span class="id">Hwt</span> <span class="kwd">as</span> <span class="id">Hwl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hwl</span>. <span class="id">inv</span> <span class="id">Hwt</span>. <span class="id">inv</span> <span class="id">Hwc</span>. <span class="id">inv</span> <span class="id">Hoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">set</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.typesof">typesof</a></span> <span class="id">des</span>) <span class="kwd">as</span> <span class="id">tys</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">find_specialize_in</span> <span class="id">IHe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;pour&nbsp;les&nbsp;expressions&nbsp;par&nbsp;défaut&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall_impl_inside">Forall_impl_inside</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_exp">wt_exp</a></span> _ _) <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall_impl_inside">Forall_impl_inside</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_exp">wc_exp</a></span> _ _) <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall_impl_inside">Forall_impl_inside</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_exp">no_rte_exp</a></span> _ _ _ _ _) <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_and_inv">Forall_and_inv</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">Wtd</span> % <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Forall_ty_exp">Forall_ty_exp</a></span> <span class="id">H'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_and_inv">Forall_and_inv</a></span> <span class="kwd">in</span> <span class="id">H'</span> <span class="kwd">as</span> [<span class="id">Wcd</span> % <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Forall_cl_exp">Forall_cl_exp</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Sfd</span> % <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.forall_denot_exps">forall_denot_exps</a></span> <span class="comment">(*&nbsp;%&nbsp;forall_nprod_Forall&nbsp;*)</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;pour&nbsp;les&nbsp;es&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Common.CommonList.html#Forall_map">Forall_map</a></span> <span class="kwd">with</span> (<span class="id">f</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span>), <span class="id"><a href="Velus.Common.CommonList.html#Forall_concat">Forall_concat</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall_impl_inside">Forall_impl_inside</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_exp">wt_exp</a></span> _ _) <span class="kwd">in</span> <span class="id">H</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall_impl_inside">Forall_impl_inside</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_exp">wc_exp</a></span> _ _) <span class="kwd">in</span> <span class="id">H</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall_impl_inside">Forall_impl_inside</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_exp">no_rte_exp</a></span> _ _ _ _ _) <span class="kwd">in</span> <span class="id">H</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_and_inv">Forall_and_inv</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">Wt</span> <span class="id">H'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_and_inv">Forall_and_inv</a></span> <span class="kwd">in</span> <span class="id">H'</span> <span class="kwd">as</span> [<span class="id">Wc</span> <span class="id">Sf</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Common.CommonList.html#Forall_concat">Forall_concat</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Forall_ty_expss">Forall_ty_expss</a></span> <span class="kwd">with</span> (<span class="id">n</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">tys</span>) <span class="kwd">in</span> <span class="id">Wt</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Forall_cl_expss">Forall_cl_expss</a></span> <span class="kwd">with</span> (<span class="id">n</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">tys</span>) <span class="kwd">in</span> <span class="id">Wc</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.Forall_denot_expss">Forall_denot_expss</a></span> <span class="kwd">with</span> (<span class="id">n</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">tys</span>) <span class="kwd">in</span> <span class="id">Sf</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exp_eq">denot_exp_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.typeof">typeof</a></span> _); <span class="id">simpl</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.clockof">clockof</a></span> _).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.typeof">typeof</a></span> <span class="id">e</span> = _) <span class="id">and</span> <span class="id">rewrite</span> <span class="id">it</span> <span class="kwd">in</span> <span class="id">IHe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.clockof">clockof</a></span> <span class="id">e</span> = _) <span class="id">and</span> <span class="id">rewrite</span> <span class="id">it</span> <span class="kwd">in</span> <span class="id">IHe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hl</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#list_sum">list_sum</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.numstreams">numstreams</a></span> <span class="id">des</span>) = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">tys</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">by</span> (<span class="id">subst</span> <span class="id">tys</span>; <span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.length_typesof_annots">length_typesof_annots</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.annots_numstreams">annots_numstreams</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">IHe</span> <span class="id">Wtd</span> <span class="id">Wcd</span> <span class="id">Sfd</span> <span class="id">Wt</span> <span class="id">Wc</span> <span class="id">Sf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">gen_sub_exps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>; <span class="id">unfold</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_rect_r">eq_rect_r</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_rect">eq_rect</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_sym">eq_sym</a></span>; <span class="id">cases</span> ; <span class="id">intros</span>; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">IHe</span> <span class="kwd">as</span> (<span class="id">Tye</span> &amp; <span class="id">Cle</span> &amp; <span class="id">Sfe</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Tye</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Cle</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DStr">DStr</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>)) <span class="kwd">with</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#tord">tord</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#tcpo">tcpo</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>)))). <span class="comment">(*&nbsp;FIXME:&nbsp;voir&nbsp;plus&nbsp;haut&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id">tys</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.typesof">typesof</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">es</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">by</span> (<span class="id">simpl_Forall</span>; <span class="id">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall2_Forall_eq">Forall2_Forall_eq</a></span> <span class="kwd">in</span> <span class="id">Wt</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;utile&nbsp;dans&nbsp;les&nbsp;deux&nbsp;dernières&nbsp;branches&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">nck</span>)) <span class="id">t1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall_forall_nprod">Forall_forall_nprod</a></span>; <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_in_right">Forall2_in_right</a></span> <span class="kwd">in</span> <span class="id">Wc</span> <span class="kwd">as</span> (?&amp;?&amp; <span class="id">Hcl</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall_forall_nprod">Forall_forall_nprod</a></span>, <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall2_Forall_eq">Forall2_Forall_eq</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall2_lift_nprod">Forall2_lift_nprod</a></span> <span class="kwd">with</span> (<span class="id">F</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.scase_defv">scase_defv</a></span> _ _);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_scase_defv">ty_scase_defv</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_cons">list_of_nprod_cons</a></span>; <span class="id">constructor</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_map_1">Forall2_map_1</a></span>, <span class="id">Forall2_ignore1'</span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_Forall">forall_nprod_Forall</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_length">list_of_nprod_length</a></span>; <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_lift_nprod">forall_lift_nprod</a></span> <span class="kwd">with</span> (<span class="id">F</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.scase_defv">scase_defv</a></span> _ _);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_scase_defv">cl_scase_defv</a></span>, <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#map_eq_nnil">map_eq_nnil</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span> |- <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> ?<span class="id">P</span> _ =&gt; <span class="id">change</span> <span class="id">P</span> <span class="kwd">with</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">P</span> <span class="id">x</span>) <span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_and_iff">forall_nprod_and_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_cons">forall_nprod_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_and">forall_nprod_and</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall_forall_nprod">Forall_forall_nprod</a></span>, <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall2_Forall_eq">Forall2_Forall_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_lift_nprod">forall_lift_nprod</a></span> <span class="kwd">with</span> (<span class="id">F</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.scase_defv">scase_defv</a></span> _ _);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_scase_defv">safe_scase_defv</a></span>, <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#map_eq_nnil">map_eq_nnil</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span> |- <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> ?<span class="id">P</span> _ =&gt; <span class="id">change</span> <span class="id">P</span> <span class="kwd">with</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">P</span> <span class="id">x</span>) <span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_and_iff">forall_nprod_and_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_cons">forall_nprod_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_and">forall_nprod_and</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall_forall_nprod">Forall_forall_nprod</a></span>, <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall2_Forall_eq">Forall2_Forall_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}{ <span class="comment">(*&nbsp;Ecase&nbsp;total&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_exp_wl_exp">wt_exp_wl_exp</a></span> <span class="kwd">in</span> <span class="id">Hwt</span> <span class="kwd">as</span> <span class="id">Hwl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hwl</span>. <span class="id">inv</span> <span class="id">Hwt</span>. <span class="id">inv</span> <span class="id">Hwc</span>. <span class="id">inv</span> <span class="id">Hoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">find_specialize_in</span> <span class="id">IHe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Common.CommonList.html#Forall_map">Forall_map</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall_concat">Forall_concat</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall_impl_inside">Forall_impl_inside</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_exp">wt_exp</a></span> _ _) <span class="kwd">in</span> <span class="id">H</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall_impl_inside">Forall_impl_inside</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_exp">wc_exp</a></span> _ _) <span class="kwd">in</span> <span class="id">H</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall_impl_inside">Forall_impl_inside</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_exp">no_rte_exp</a></span> _ _ _ _ _) <span class="kwd">in</span> <span class="id">H</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_and_inv">Forall_and_inv</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">Wt</span> <span class="id">H'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_and_inv">Forall_and_inv</a></span> <span class="kwd">in</span> <span class="id">H'</span> <span class="kwd">as</span> [<span class="id">Wc</span> <span class="id">Sf</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Common.CommonList.html#Forall_concat">Forall_concat</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Forall_ty_expss">Forall_ty_expss</a></span> <span class="kwd">with</span> (<span class="id">n</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">tys</span>) <span class="kwd">in</span> <span class="id">Wt</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Forall_cl_expss">Forall_cl_expss</a></span> <span class="kwd">with</span> (<span class="id">n</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">tys</span>) <span class="kwd">in</span> <span class="id">Wc</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.Forall_denot_expss">Forall_denot_expss</a></span> <span class="kwd">with</span> (<span class="id">n</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">tys</span>) <span class="kwd">in</span> <span class="id">Sf</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exp_eq">denot_exp_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.typeof">typeof</a></span> _); <span class="id">simpl</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.clockof">clockof</a></span> _).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">IHe</span> <span class="id">Wt</span> <span class="id">Wc</span> <span class="id">Sf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">gen_sub_exps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>; <span class="id">intros</span>; <span class="id">unfold</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_rect_r">eq_rect_r</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_rect">eq_rect</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_sym">eq_sym</a></span>; <span class="id">cases</span>; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">IHe</span> <span class="kwd">as</span> (<span class="id">Tye</span> &amp; <span class="id">Cle</span> &amp; <span class="id">Sfe</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.typeof">typeof</a></span> <span class="id">e</span> = _) <span class="id">and</span> <span class="id">rewrite</span> <span class="id">it</span> <span class="kwd">in</span> <span class="id">Tye</span>; <span class="id">inv</span> <span class="id">Tye</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.clockof">clockof</a></span> <span class="id">e</span> = _) <span class="id">and</span> <span class="id">rewrite</span> <span class="id">it</span> <span class="kwd">in</span> <span class="id">Cle</span>; <span class="id">inv</span> <span class="id">Cle</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DStr">DStr</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>)) <span class="kwd">with</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#tord">tord</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#tcpo">tcpo</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>)))). <span class="comment">(*&nbsp;FIXME:&nbsp;voir&nbsp;plus&nbsp;haut&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;utile&nbsp;dans&nbsp;les&nbsp;deux&nbsp;dernières&nbsp;branches&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">nck</span>)) <span class="id">t0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall_forall_nprod">Forall_forall_nprod</a></span>; <span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_in_right">Forall2_in_right</a></span> <span class="kwd">in</span> <span class="id">Wc</span> <span class="kwd">as</span> (?&amp;?&amp; <span class="id">Hcl</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall_forall_nprod">Forall_forall_nprod</a></span>, <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall2_Forall_eq">Forall2_Forall_eq</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id">tys</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.typesof">typesof</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">es</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">by</span> (<span class="id">simpl_Forall</span>; <span class="id">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall2_Forall_eq">Forall2_Forall_eq</a></span> <span class="kwd">in</span> <span class="id">Wt</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall2_lift_nprod">Forall2_lift_nprod</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_scasev">ty_scasev</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_map_1">Forall2_map_1</a></span>, <span class="id">Forall2_ignore1'</span>; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_length">list_of_nprod_length</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_Forall">forall_nprod_Forall</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_lift_nprod">forall_lift_nprod</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_scasev">cl_scasev</a></span>, <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#map_eq_nnil">map_eq_nnil</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span> |- <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> ?<span class="id">P</span> _ =&gt; <span class="id">change</span> <span class="id">P</span> <span class="kwd">with</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">P</span> <span class="id">x</span>) <span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_and_iff">forall_nprod_and_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_and">forall_nprod_and</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall_forall_nprod">Forall_forall_nprod</a></span>, <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall2_Forall_eq">Forall2_Forall_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_lift_nprod">forall_lift_nprod</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_scasev">safe_scasev</a></span>, <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#map_eq_nnil">map_eq_nnil</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span> |- <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> ?<span class="id">P</span> _ =&gt; <span class="id">change</span> <span class="id">P</span> <span class="kwd">with</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">P</span> <span class="id">x</span>) <span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_and_iff">forall_nprod_and_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_and">forall_nprod_and</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#Forall_forall_nprod">Forall_forall_nprod</a></span>, <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall2_Forall_eq">Forall2_Forall_eq</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;Eapp&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_exp_wl_exp">wt_exp_wl_exp</a></span> <span class="kwd">in</span> <span class="id">Hwt</span> <span class="kwd">as</span> <span class="id">Hwl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hwl</span>. <span class="id">inv</span> <span class="id">Hwt</span>. <span class="id">inv</span> <span class="id">Hwc</span>. <span class="id">inv</span> <span class="id">Hoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall_impl_inside">Forall_impl_inside</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_exp">wt_exp</a></span> _ _) <span class="kwd">in</span> <span class="id">H</span>, <span class="id">H0</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall_impl_inside">Forall_impl_inside</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_exp">wc_exp</a></span> _ _) <span class="kwd">in</span> <span class="id">H</span>, <span class="id">H0</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall_impl_inside">Forall_impl_inside</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_exp">no_rte_exp</a></span> _ _ _ _ _) <span class="kwd">in</span> <span class="id">H</span>, <span class="id">H0</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_and_inv">Forall_and_inv</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">Wt</span> <span class="id">H'</span>], <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">Wt2</span> <span class="id">H'2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_and_inv">Forall_and_inv</a></span> <span class="kwd">in</span> <span class="id">H'</span> <span class="kwd">as</span> [<span class="id">Wc</span> <span class="id">Sf</span>], <span class="id">H'2</span> <span class="kwd">as</span> [<span class="id">Wc2</span> <span class="id">Sf2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Forall_ty_exp">Forall_ty_exp</a></span> <span class="kwd">in</span> <span class="id">Wt</span>, <span class="id">Wt2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Forall_cl_exp">Forall_cl_exp</a></span> <span class="kwd">in</span> <span class="id">Wc</span>, <span class="id">Wc2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.forall_denot_exps">forall_denot_exps</a></span> <span class="comment">(*&nbsp;forall_nprod_Forall&nbsp;*)</span> <span class="kwd">in</span> <span class="id">Sf</span>, <span class="id">Sf2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.nclocksof_sem">nclocksof_sem</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">env</span> <span class="id">es</span>) <span class="kwd">as</span> <span class="id">Ncs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.nclocksof_sem">nclocksof_sem</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">env</span> <span class="id">er</span>) <span class="kwd">as</span> <span class="id">Ncs2</span>. <span class="comment">(*&nbsp;vraiment&nbsp;utile?&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.annots_numstreams">annots_numstreams</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exp_eq">denot_exp_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Wt</span> <span class="id">Wc</span> <span class="id">Sf</span> <span class="id">Ncs</span> <span class="id">Wt2</span> <span class="id">Wc2</span> <span class="id">Sf2</span> <span class="id">Ncs2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">gen_sub_exps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#list_sum">list_sum</a></span> _ = _) <span class="id">and</span> <span class="id">rewrite</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">sr</span> <span class="id">ss</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.find_node">find_node</a></span> <span class="id">f</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> = _) <span class="id">and</span> <span class="id">rewrite</span> <span class="id">it</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">take</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> _ = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> _) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_find_node">wc_find_node</a></span> <span class="kwd">in</span> <span class="id">WCG</span> <span class="kwd">as</span> <span class="id">HH</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">HH</span> <span class="kwd">as</span> (? &amp; <span class="id">WCG2</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion_clear</span> <span class="id">WCG2</span> <span class="kwd">as</span> [? <span class="id">WCi</span> <span class="id">WCio</span> _].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>; <span class="id">intros</span>; <span class="id">cases</span>; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.clocksof_nclocksof">clocksof_nclocksof</a></span> <span class="kwd">in</span> <span class="id">Wc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.decl">decl</a></span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">a</span> = _ ) <span class="id">and</span> <span class="id">rewrite</span> <span class="id">it</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span> <span class="kwd">in</span> *; <span class="id">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_rect">eq_rect</a></span>; <span class="id">cases</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;remarque:&nbsp;Hnode&nbsp;est&nbsp;utilisé&nbsp;par&nbsp;safe_sreset&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;on&nbsp;choisit&nbsp;bien&nbsp;[[bck]]&nbsp;comme&nbsp;majorant&nbsp;de&nbsp;bss&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_sreset">safe_sreset</a></span> <span class="id">f</span> <span class="id">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.env_of_np">env_of_np</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="id">ss</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">bck</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.sbools_of">sbools_of</a></span> <span class="id">sr</span>) <span class="id">it</span>) <span class="kwd">as</span> <span class="id">Hres</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env_decompose">wf_env_decompose</a></span> <span class="kwd">in</span> <span class="id">Hres</span> <span class="kwd">as</span> (<span class="id">fTy</span> &amp; <span class="id">fCl</span> &amp; <span class="id">fEf</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">repeat</span> <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.inst_ty_env">inst_ty_env</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_map_1">Forall2_map_1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.inst_cl_env">inst_cl_env</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.inst_ef_env">inst_ef_env</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.bss_le_bs">bss_le_bs</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_env_inst">cl_env_inst</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_inst_in">safe_inst_in</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="LDENOTSAFE.safe_exp">safe_exp</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#bss">bss</a></span> <span class="id">ins</span> <span class="id">envI</span> &lt;= <span class="id">bs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">e</span> : <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.exp">exp</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_exp">wt_exp</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">Γ</span> <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">Γ</span> <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_exp">no_rte_exp</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">ins</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.envG">envG</a></span> <span class="id">envI</span> <span class="id">env</span> <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ss</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exp">denot_exp</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">ins</span> <span class="id">e</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.envG">envG</a></span> <span class="id">envI</span> <span class="id">env</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">ss</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_exp_">safe_exp_</a></span> <span class="kwd">as</span> (?&amp;?&amp;?); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.safe_exps_">safe_exps_</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#bss">bss</a></span> <span class="id">ins</span> <span class="id">envI</span> &lt;= <span class="id">bs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">es</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.exp">exp</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_exp">wt_exp</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">Γ</span>) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">Γ</span>) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_exp">no_rte_exp</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">ins</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.envG">envG</a></span> <span class="id">envI</span> <span class="id">env</span>) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ss</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exps">denot_exps</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">ins</span> <span class="id">es</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.envG">envG</a></span> <span class="id">envI</span> <span class="id">env</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.typesof">typesof</a></span> <span class="id">es</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">ss</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.clocksof">clocksof</a></span> <span class="id">es</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">ss</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">ss</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Safe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">es</span> <span class="kwd">as</span> [|<span class="id">e</span> <span class="id">es</span>]; <span class="id">simpl</span>; <span class="id">auto</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">IHes</span> <span class="kwd">as</span> (?&amp;?&amp;?); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_exp_">safe_exp_</a></span> <span class="kwd">in</span> <span class="id">Safe</span> <span class="kwd">as</span> (?&amp;?&amp;?); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exps_eq">denot_exps_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_app">list_of_nprod_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_app">Forall2_app</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_app">forall_nprod_app</a></span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="LDENOTSAFE.safe_exps">safe_exps</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#bss">bss</a></span> <span class="id">ins</span> <span class="id">envI</span> &lt;= <span class="id">bs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">es</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.exp">exp</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_exp">wt_exp</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">Γ</span>) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">Γ</span>) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_exp">no_rte_exp</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">ins</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.envG">envG</a></span> <span class="id">envI</span> <span class="id">env</span>) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ss</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exps">denot_exps</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">ins</span> <span class="id">es</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.envG">envG</a></span> <span class="id">envI</span> <span class="id">env</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">ss</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_exps_">safe_exps_</a></span> <span class="kwd">as</span> (?&amp;?&amp;?); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
<br/>
<div class="doc">Terrible cas des appels de nœuds aux sorties dépendantes.
      Il ne rentre pas dans le cadre de <span class="bracket"><span class="id">safe_exp</span></span> car on n'a pas l'hypothèse
      <span class="bracket"><span class="id">wc_exp</span> <span class="id">G</span> <span class="id">Γ</span> (<span class="id">Eapp</span> <span class="id">f</span> <span class="id">es</span> <span class="id">er</span> <span class="id">anns</span>)</span>. De toute façon, le résultat de
      <span class="bracket"><span class="id">safe_exp</span></span> ne serait pas correct ici.
      Par ex. soit <span class="bracket"><span class="id">f</span></span> de signature
         f (t :: ⋅) returns (c :: ⋅, y :: ⋅ on c)
      et l'équation
         b :: ⋅, x :: ⋅ on b = f(t);
      Alors par <span class="bracket"><span class="id">Hnode</span></span> le deuxième flot, correspondant à celui de <span class="bracket"><span class="id">y</span></span> dans
      l'environnement interne de <span class="bracket"><span class="id">f</span></span> respecte bien l'horloge <span class="bracket"><span class="id">⋅</span> <span class="id">on</span> <span class="id">c</span></span>, mais
      pas <span class="bracket"><span class="id">⋅</span> <span class="id">on</span> <span class="id">b</span></span> dans l'environnement de l'appelant.
      On va donc montrer la préservation de <span class="bracket"><span class="id">cl_DS</span></span> mais seulement dans
      l'environnement (env') dans lequel les variables b et x ont été mises
      à jour, soit à la fin d'un tour de <span class="bracket"><span class="id">denot_node</span></span>.
   </div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.safe_Eapp_dep">safe_Eapp_dep</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">xs</span> <span class="id">f</span> <span class="id">es</span> <span class="id">er</span> <span class="id">anns</span> <span class="id">n</span> <span class="id">bck</span> <span class="id">sub</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#bss">bss</a></span> <span class="id">ins</span> <span class="id">envI</span> &lt;= <span class="id">bs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_exp">wt_exp</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">Γ</span>) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">Γ</span>) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_exp">no_rte_exp</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">ins</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.envG">envG</a></span> <span class="id">envI</span> <span class="id">env</span>) <span class="id">es</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_exp">wt_exp</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">Γ</span>) <span class="id">er</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">Γ</span>) <span class="id">er</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_exp">no_rte_exp</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">ins</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.envG">envG</a></span> <span class="id">envI</span> <span class="id">env</span>) <span class="id">er</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.find_node">find_node</a></span> <span class="id">f</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">n</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id">xs</span> ++ <span class="id">ins</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.typeof">typeof</a></span> <span class="id">e</span> = [<span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpAux.bool_velus_type">bool_velus_type</a></span>]) <span class="id">er</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.wc_env">wc_env</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, (_, <span class="id">ck</span>, _)) =&gt; (<span class="id">x</span>, <span class="id">ck</span>)) <span class="id">n</span>.(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.wc_env">wc_env</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, (_, <span class="id">ck</span>, _)) =&gt; (<span class="id">x</span>, <span class="id">ck</span>)) <span class="id">n</span>.(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span>) ++ <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, (_, <span class="id">ck</span>, _, _)) =&gt; (<span class="id">x</span>, <span class="id">ck</span>)) <span class="id">n</span>.(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> (<span class="id">et</span> : <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.type">type</a></span>) '(_, (<span class="id">t</span>, _, _)) =&gt; <span class="id">et</span> = <span class="id">t</span>) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.typesof">typesof</a></span> <span class="id">es</span>) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">a</span> '(_, (<span class="id">t</span>, _, _, _)) =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">a</span> = <span class="id">t</span>) <span class="id">anns</span> <span class="id">n</span>.(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.WellInstantiated">WellInstantiated</a></span> <span class="id">bck</span> <span class="id">sub</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, (_, <span class="id">ck</span>, _)) =&gt; (<span class="id">x</span>, <span class="id">ck</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.nclocksof">nclocksof</a></span> <span class="id">es</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#Forall3">Forall3</a></span> (<span class="kwd">fun</span> <span class="id">xck</span> <span class="id">ck2</span> <span class="id">x2</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.WellInstantiated">WellInstantiated</a></span> <span class="id">bck</span> <span class="id">sub</span> <span class="id">xck</span> (<span class="id">ck2</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x2</span>)) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, (_, <span class="id">ck</span>, _, _)) =&gt; (<span class="id">x</span>, <span class="id">ck</span>)) <span class="id">n</span>.(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span>)) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">anns</span>) <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env'</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">env</span> &lt;= <span class="id">env'</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ss</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exp">denot_exp</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">ins</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.Eapp">Eapp</a></span> <span class="id">f</span> <span class="id">es</span> <span class="id">er</span> <span class="id">anns</span>) <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.envG">envG</a></span> <span class="id">envI</span> <span class="id">env</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">x</span> (<span class="id">s</span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>)) =&gt; <span class="id">s</span> &lt;= <span class="id">env'</span> <span class="id">x</span>) <span class="id">xs</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">ss</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">anns</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">ss</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env'</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">anns</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">ss</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">ss</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hsafe</span> <span class="id">Hbs</span> <span class="id">Hwt</span> <span class="id">Hwc</span> <span class="id">Hop</span> <span class="id">Hwtr</span> <span class="id">Hwcr</span> <span class="id">Hopr</span> <span class="id">Hfind</span> <span class="id">ND</span> <span class="id">Wtr'</span> <span class="id">Wci</span> <span class="id">Wcio</span> <span class="id">Wtin</span> <span class="id">Wtout</span> <span class="id">WIin</span> <span class="id">WIout</span> ? <span class="id">Hle</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">anns</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)) <span class="kwd">as</span> <span class="id">Hlout</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall3_length">Forall3_length</a></span> <span class="kwd">in</span> <span class="id">WIout</span>. <span class="id">now</span> <span class="id">rewrite</span> 2 <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span> <span class="kwd">in</span> <span class="id">WIout</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)) = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">anns</span>) <span class="kwd">as</span> <span class="id">Hlout'</span>. <span class="comment">(*&nbsp;pas&nbsp;une&nbsp;blague&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span>. <span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">xs</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">anns</span>) <span class="kwd">as</span> <span class="id">Hl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall3_length">Forall3_length</a></span> <span class="kwd">in</span> <span class="id">WIout</span>. <span class="id">now</span> <span class="id">rewrite</span> 2 <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span> <span class="kwd">in</span> <span class="id">WIout</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">x</span> <span class="id">y</span> =&gt; <span class="id">sub</span> <span class="id">x</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)) <span class="id">xs</span>) <span class="kwd">as</span> <span class="id">Hsub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall3_ignore2">Forall3_ignore2</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_map_1">Forall2_map_1</a></span> <span class="kwd">in</span> <span class="id">WIout</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span>; <span class="id">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_map_1">Forall2_map_1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_impl_In">Forall2_impl_In</a></span> <span class="kwd">with</span> (2 := <span class="id">WIout</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> (?&amp;((?&amp;?)&amp;?)&amp;?) ? ?? (?&amp;?&amp;?); <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.nclocksof_sem">nclocksof_sem</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">env</span> <span class="id">es</span>) <span class="kwd">as</span> <span class="id">Ncs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;on&nbsp;réduit&nbsp;un&nbsp;peu&nbsp;ss&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exp_eq">denot_exp_eq</a></span>, <span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">set</span> (<span class="id">ses</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exps">denot_exps</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">ins</span> <span class="id">es</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.envG">envG</a></span> <span class="id">envI</span> <span class="id">env</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">set</span> (<span class="id">rs</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exps">denot_exps</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">ins</span> <span class="id">er</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.envG">envG</a></span> <span class="id">envI</span> <span class="id">env</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_rect">eq_rect</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>; <span class="id">cases</span>; <span class="id">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(****&nbsp;début&nbsp;instanciation&nbsp;de&nbsp;safe_sreset/Hnode&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_exps_">safe_exps_</a></span> _ _ _ _ _ <span class="id">Hsafe</span> <span class="id">Hbs</span> <span class="id">es</span>) <span class="kwd">as</span> (<span class="id">Tys</span> &amp; <span class="id">Cls</span> &amp; <span class="id">Sfs</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Forall2_ty_DS_le">Forall2_ty_DS_le</a></span> <span class="kwd">with</span> (<span class="id">xs</span> := <span class="id">ses</span>) <span class="kwd">in</span> <span class="id">Tys</span>; [|<span class="id">subst</span> <span class="id">ses</span>; <span class="id">auto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Forall2_cl_DS_le">Forall2_cl_DS_le</a></span> <span class="kwd">with</span> (<span class="id">xs</span> := <span class="id">ses</span>) <span class="kwd">in</span> <span class="id">Cls</span>; [|<span class="id">subst</span> <span class="id">ses</span>; <span class="id">auto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.forall_safe_le">forall_safe_le</a></span>   <span class="kwd">with</span> (<span class="id">xs</span> := <span class="id">ses</span>) <span class="kwd">in</span> <span class="id">Sfs</span>; [|<span class="id">subst</span> <span class="id">ses</span>; <span class="id">auto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.clocksof_nclocksof">clocksof_nclocksof</a></span> <span class="kwd">in</span> <span class="id">Cls</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_exps_">safe_exps_</a></span> _ _ _ _ _ <span class="id">Hsafe</span> <span class="id">Hbs</span> <span class="id">er</span>) <span class="kwd">as</span> (<span class="id">Tyr</span> &amp; <span class="id">Clr</span> &amp; <span class="id">Sfr</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Forall2_ty_DS_le">Forall2_ty_DS_le</a></span> <span class="kwd">with</span> (<span class="id">xs</span> := <span class="id">rs</span>) <span class="kwd">in</span> <span class="id">Tyr</span>; [|<span class="id">subst</span> <span class="id">rs</span>; <span class="id">auto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Forall2_cl_DS_le">Forall2_cl_DS_le</a></span> <span class="kwd">with</span> (<span class="id">xs</span> := <span class="id">rs</span>) <span class="kwd">in</span> <span class="id">Clr</span>; [|<span class="id">subst</span> <span class="id">rs</span>; <span class="id">auto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.forall_safe_le">forall_safe_le</a></span>   <span class="kwd">with</span> (<span class="id">xs</span> := <span class="id">rs</span>) <span class="kwd">in</span> <span class="id">Sfr</span>; [|<span class="id">subst</span> <span class="id">rs</span>; <span class="id">auto</span>].<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_inst_in">safe_inst_in</a></span> <span class="kwd">in</span> <span class="id">Cls</span> <span class="kwd">as</span> <span class="id">Hs0</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.annots_numstreams">annots_numstreams</a></span>, &lt;- <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.length_typesof_annots">length_typesof_annots</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_length">Forall2_length</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_sreset">safe_sreset</a></span> <span class="id">f</span> <span class="id">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.env_of_np">env_of_np</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="id">ses</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">bck</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.sbools_of">sbools_of</a></span> <span class="id">rs</span>) <span class="id">Hfind</span>) <span class="kwd">in</span> <span class="id">Hs0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2: <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.bss_le_bs">bss_le_bs</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_env_inst">cl_env_inst</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(****&nbsp;fin&nbsp;instanciation&nbsp;de&nbsp;safe_sreset&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intro</span> <span class="id">Henv'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env_decompose">wf_env_decompose</a></span> <span class="kwd">in</span> <span class="id">Hs0</span> <span class="kwd">as</span> (<span class="id">Ty</span> &amp; <span class="id">Cl</span> &amp; <span class="id">Sf</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;1: <span class="comment">(*&nbsp;ty_DS&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.inst_ty_env">inst_ty_env</a></span>; <span class="id">eauto</span>; <span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_map_1">Forall2_map_1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2: <span class="comment">(*&nbsp;safe_DS&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.inst_ef_env">inst_ef_env</a></span>; <span class="id">now</span> <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;ici&nbsp;on&nbsp;montre&nbsp;que&nbsp;l'horloge&nbsp;du&nbsp;nœud&nbsp;appelé&nbsp;correspond&nbsp;à&nbsp;celle&nbsp;du&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;nœud&nbsp;appelant,&nbsp;mais&nbsp;après&nbsp;mise&nbsp;à&nbsp;jour&nbsp;de&nbsp;l'environnement&nbsp;(env')&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ck</span> <span class="id">x</span> <span class="id">ck'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id">x</span>, <span class="id">ck</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> '(<span class="id">x</span>, (_, <span class="id">ck</span>, _, _)) =&gt; (<span class="id">x</span>, <span class="id">ck</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.instck">instck</a></span> <span class="id">bck</span> <span class="id">sub</span> <span class="id">ck</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">ck'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.env_of_np">env_of_np</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="id">ses</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">bck</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sreset">sreset</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.envG">envG</a></span> <span class="id">f</span>) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.sbools_of">sbools_of</a></span> <span class="id">rs</span>) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.env_of_np">env_of_np</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="id">ses</span>)) <span class="id">ck</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;= <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env'</span> <span class="id">ck'</span>) <span class="kwd">as</span> <span class="id">Hcks</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;FIXME:&nbsp;Simplifier&nbsp;?&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> - <span class="id">Wcio</span> <span class="id">WIin</span> <span class="id">WIout</span> <span class="id">Hle</span> <span class="id">Ncs</span> <span class="id">Wci</span> <span class="id">Cls</span> <span class="id">ND</span> <span class="id">Hsub</span> <span class="id">Hfind</span> <span class="id">Hl</span> <span class="id">Hlout'</span> <span class="id">Henv'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">ck</span> <span class="kwd">as</span> [|??? []]; <span class="id">intros</span> * <span class="id">Hin</span> <span class="id">Hck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> _ _ _ _ _).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> 2 <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock_eq">denot_clock_eq</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hck</span>. <span class="id">cases_eqn</span> <span class="id">HH</span>. <span class="id">inv</span> <span class="id">Hck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.wc_env_var">wc_env_var</a></span> <span class="kwd">in</span> <span class="id">Wcio</span>; <span class="id">eauto</span> 2 <span class="kwd">using</span> <span class="id">in_app_weak'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Wcio</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> _ _ _ _ _).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> _ (_ ++ _)) <span class="id">and</span> <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span> <span class="kwd">in</span> <span class="id">it</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">it</span> <span class="kwd">as</span> [|<span class="id">Hino</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;input,&nbsp;on&nbsp;a&nbsp;déjà&nbsp;fait&nbsp;:&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock_inst_ins">denot_clock_inst_ins</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Wi_match_ss">Wi_match_ss</a></span>; <span class="id">eauto</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> 2 <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_var_eq">denot_var_eq</a></span>, 2 <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock_eq">denot_clock_eq</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;cas&nbsp;intéressant&nbsp;:&nbsp;mise&nbsp;à&nbsp;jour&nbsp;d'une&nbsp;variable&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">IHck</span> <span class="kwd">in</span> <span class="id">Hino</span> <span class="kwd">as</span> <span class="id">Hck</span>; <span class="id">eauto</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.env_of_np">env_of_np</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="id">ses</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sreset">sreset</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.envG">envG</a></span> <span class="id">f</span>) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.sbools_of">sbools_of</a></span> <span class="id">rs</span>) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.env_of_np">env_of_np</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="id">ses</span>)) <span class="id">i</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;= <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">env'</span> <span class="id">i0</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;maintenant&nbsp;il&nbsp;faut&nbsp;utiliser&nbsp;Henv',&nbsp;et&nbsp;c'est&nbsp;long...&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">i0</span> <span class="id">xs</span>) <span class="kwd">as</span> <span class="id">Hxs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall3_ignore2">Forall3_ignore2</a></span> <span class="kwd">in</span> <span class="id">WIout</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_in_left">Forall2_in_left</a></span> <span class="kwd">with</span> (2 := <span class="id">Hino</span>) <span class="kwd">in</span> <span class="id">WIout</span> <span class="kwd">as</span> (?&amp;?&amp;?&amp;[]).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Common.Common.html#mem_ident">mem_ident</a></span> <span class="id">i0</span> <span class="id">ins</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>) <span class="kwd">as</span> <span class="id">Hi0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">apply</span> <span class="id"><a href="Velus.Common.Common.html#mem_ident_false">mem_ident_false</a></span>. <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_In">NoDup_app_In</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Common.Common.html#mem_ident">mem_ident</a></span> <span class="id">i</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>) <span class="kwd">as</span> <span class="id">Hi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">apply</span> <span class="id"><a href="Velus.Common.Common.html#mem_ident_false">mem_ident_false</a></span>. <span class="id">intro</span>. <span class="id">apply</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.not_in_out">not_in_out</a></span> <span class="id">n</span> <span class="id">i</span>); <span class="id">solve_In</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="Velus.Common.CommonList.html#In_nth_error_len">In_nth_error_len</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)) <span class="id">i</span>) <span class="kwd">as</span> (<span class="id">k</span> &amp; <span class="id">kle</span> &amp; <span class="id">kth</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span>. <span class="id">solve_In</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#nth_error_Forall2">nth_error_Forall2</a></span> <span class="kwd">with</span> (1 := <span class="id">kth</span>) <span class="kwd">in</span> <span class="id">Hsub</span> <span class="kwd">as</span> (?&amp;?&amp; <span class="id">Sub</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Sub</span> <span class="kwd">in</span> <span class="id">HH0</span>; <span class="id">inv</span> <span class="id">HH0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.env_of_np_eq">env_of_np_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id">HH</span>; <span class="id">try</span> <span class="id">contradiction</span>; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#nth_error_Forall2">nth_error_Forall2</a></span> <span class="kwd">with</span> (1 := <span class="id">H</span>) <span class="kwd">in</span> <span class="id">Henv'</span> <span class="kwd">as</span> (<span class="id">xs'</span> &amp; <span class="id">Kth</span> &amp; <span class="id">Hle'</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DStr">DStr</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>)) <span class="kwd">with</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#tord">tord</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#tcpo">tcpo</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>)))) <span class="kwd">in</span> *. <span class="comment">(*&nbsp;FIXME&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_nth_error">list_of_nprod_nth_error</a></span> <span class="kwd">in</span> <span class="id">Kth</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.nth_np_of_env">nth_np_of_env</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_nth">nth_error_nth</a></span> <span class="kwd">in</span> <span class="id">Kth</span>; <span class="id">eauto</span> 1; <span class="id">now</span> <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">set</span> (<span class="id">envN</span> := <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sreset">sreset</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.envG">envG</a></span> <span class="id">f</span>) _ _) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;FIXME:&nbsp;la&nbsp;suite&nbsp;ressemble&nbsp;méchamment&nbsp;à&nbsp;la&nbsp;fin&nbsp;de&nbsp;inst_cl_env&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_forall2">Forall2_forall2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DStr">DStr</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>)) <span class="kwd">with</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#tord">tord</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#tcpo">tcpo</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>)))). <span class="comment">(*&nbsp;FIXME:&nbsp;voir&nbsp;plus&nbsp;haut&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>. { <span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_length">list_of_nprod_length</a></span>, 2 <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span> <span class="kwd">in</span> *. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">d</span> <span class="id">s</span> <span class="id">k</span> ? ? <span class="id">Hk</span> ??; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span> <span class="kwd">in</span> <span class="id">Hk</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_nth">list_of_nprod_nth</a></span>; <span class="id">try</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.nth_np_of_env">nth_np_of_env</a></span> <span class="kwd">with</span> (<span class="id">d</span>:=<span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>); <span class="id">try</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id">k</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)) <span class="kwd">as</span> (<span class="id">x</span>,(((<span class="id">ty</span>,<span class="id">ck</span>),<span class="id">i</span>),<span class="id">o</span>)) <span class="id">eqn</span>:<span class="id">Kth</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hin</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id">x</span>, ((<span class="id">ty</span>,<span class="id">ck</span>), <span class="id">i</span>, <span class="id">o</span>)) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">rewrite</span> &lt;- <span class="id">Kth</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_In">nth_In</a></span>. <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>. <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#Ole_trans">Ole_trans</a></span>, <span class="id">Hcks</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span>. <span class="kwd">exists</span> (<span class="id">x</span>,((<span class="id">ty</span>,<span class="id">ck</span>),<span class="id">i</span>,<span class="id">o</span>)). <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall3_nth">Forall3_nth</a></span> <span class="kwd">with</span> (<span class="id">n</span> := <span class="id">k</span>) <span class="kwd">in</span> <span class="id">WIout</span> <span class="kwd">as</span> [_ <span class="id">Inst</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> 2 <span class="id">map_nth'</span>, <span class="id">Kth</span> <span class="kwd">in</span> <span class="id">Inst</span>. <span class="id">erewrite</span> <span class="id">map_nth'</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">rewrite</span> ?<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#length_map">length_map</a></span>; <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.decl">decl</a></span> <span class="kwd">in</span> *; <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.idents">idents</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.decl">decl</a></span> <span class="kwd">in</span> *. <span class="id">erewrite</span> <span class="id">map_nth'</span>, <span class="id">Kth</span>; <span class="id">simpl</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> _); <span class="id">try</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#Ole_trans">Ole_trans</a></span>, (<span class="id">Cl</span> <span class="id">x</span> <span class="id">ck</span>); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2: <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasClock_app">HasClock_app</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id">senv_HasClock'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span>. <span class="id">cases_eqn</span> <span class="id">Hxin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.Common.html#mem_ident_spec">mem_ident_spec</a></span> <span class="kwd">in</span> <span class="id">Hxin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="comment">(*&nbsp;on&nbsp;y&nbsp;est&nbsp;presque&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.not_in_out">not_in_out</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span>; <span class="id">eauto</span>. <span class="id">repeat</span> <span class="id">esplit</span>; <span class="id">now</span> <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Unshelve</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">repeat</span> <span class="id">split</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpAux.bool_velus_type">bool_velus_type</a></span>; <span class="id">exact</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.denot_blocks_equs">denot_blocks_equs</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">PSyn</span> <span class="id">Prefs</span>} (<span class="id">G</span> : @<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.global">global</a></span> <span class="id">PSyn</span> <span class="id">Prefs</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ins</span> <span class="id">envG</span> <span class="id">envI</span> <span class="id">env</span> <span class="id">blks</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.wl_block">wl_block</a></span> <span class="id">G</span>) <span class="id">blks</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#flat_map">flat_map</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.get_defined">get_defined</a></span> <span class="id">blks</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">env'</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_blocks">denot_blocks</a></span> <span class="id">G</span> <span class="id">ins</span> <span class="id">blks</span> <span class="id">envG</span> <span class="id">envI</span> <span class="id">env</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">blk</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">blk</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.Beq">Beq</a></span> (<span class="id">xs</span>,<span class="id">es</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">x</span> (<span class="id">s</span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> _) =&gt; <span class="id">s</span> == <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#PROJ">PROJ</a></span> _ <span class="id">x</span> <span class="id">env'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">xs</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exps">denot_exps</a></span> <span class="id">G</span> <span class="id">ins</span> <span class="id">es</span> <span class="id">envG</span> <span class="id">envI</span> <span class="id">env</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| _ =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="id">blks</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cbv</span> <span class="id">zeta</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">blks</span> <span class="kwd">as</span> [|<span class="id">blk</span> <span class="id">blks</span>]; <span class="id">intros</span> * <span class="id">Wl</span> <span class="id">ND</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Wl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">blk</span>; <span class="id">auto</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">e</span> <span class="kwd">as</span> (<span class="id">xs</span>,<span class="id">es</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.wl_block">wl_block</a></span> _ _) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.wl_equation">wl_equation</a></span> _ _) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_l">NoDup_app_l</a></span> <span class="kwd">in</span> <span class="id">ND</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DStr">DStr</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>)) <span class="kwd">with</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#tord">tord</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#tcpo">tcpo</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>)))). <span class="comment">(*&nbsp;FIXME&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_forall2">Forall2_forall2</a></span>; <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_length">list_of_nprod_length</a></span>, &lt;- <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.annots_numstreams">annots_numstreams</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span> * <span class="id">Hn</span> ? ?; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#PROJ_simpl">PROJ_simpl</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_nth">list_of_nprod_nth</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_blocks_eq_cons">denot_blocks_eq_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_block_eq">denot_block_eq</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.env_of_np_ext_eq">env_of_np_ext_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">setoid_rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#mem_nth_nth">mem_nth_nth</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- 2 <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_nth">list_of_nprod_nth</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_indep">nth_indep</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DStr">DStr</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>)) <span class="kwd">with</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#tord">tord</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#tcpo">tcpo</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op.value">value</a></span>)))). <span class="comment">(*&nbsp;FIXME&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_length">list_of_nprod_length</a></span>, &lt;- <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.annots_numstreams">annots_numstreams</a></span>; <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">ND</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">NoDup_app'_iff</span> <span class="kwd">in</span> <span class="id">ND</span> <span class="kwd">as</span> <span class="id">HH</span>; <span class="id">destruct</span> <span class="id">HH</span> <span class="kwd">as</span> (<span class="id">ND1</span> &amp; <span class="id">ND2</span> &amp; <span class="id">ND3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_impl_In">Forall_impl_In</a></span> <span class="kwd">in</span> <span class="id">IHblks</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [] <span class="id">Hin</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">e</span> <span class="kwd">as</span> (<span class="id">xs</span>,<span class="id">es</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_impl_In">Forall2_impl_In</a></span>; <span class="id">intros</span> * ??.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_blocks_eq_cons">denot_blocks_eq_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_block_eq">denot_block_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">blk</span>; <span class="id">auto</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">e</span> <span class="kwd">as</span> (<span class="id">xs'</span>,<span class="id">es'</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> 2 <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#PROJ_simpl">PROJ_simpl</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.env_of_np_ext_eq">env_of_np_ext_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id">Hmem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#mem_nth_In">mem_nth_In</a></span> <span class="kwd">in</span> <span class="id">Hmem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">with</span> (1 := <span class="id">ND3</span>) <span class="kwd">in</span> <span class="id">Hmem</span>; <span class="id">destruct</span> <span class="id">Hmem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_flat_map">in_flat_map</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.safe_node">safe_node</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">envI</span> <span class="id">env</span> <span class="id">bs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ins</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">n</span>.(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Γ</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) ++ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>) ++ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.get_locals">get_locals</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_block">n_block</a></span> <span class="id">n</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#bss">bss</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="id">envI</span> &lt;= <span class="id">bs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">env</span> &lt;= <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_node">denot_node</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">n</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.envG">envG</a></span> <span class="id">envI</span> <span class="id">env</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_node">wc_node</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">n</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_node">wt_node</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">n</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_node">no_rte_node</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">ins</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.envG">envG</a></span> <span class="id">envI</span> <span class="id">env</span> <span class="id">n</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_node">denot_node</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">n</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.envG">envG</a></span> <span class="id">envI</span> <span class="id">env</span>).<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hbs</span> <span class="id">Hle</span> <span class="id">Wc</span> <span class="id">Wt</span> <span class="id">Hop</span> <span class="id">Hsafe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hle</span> <span class="id">Hop</span> <span class="id">Hsafe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Γ</span>; <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_node">no_rte_node</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_node_eq">denot_node_eq</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_top_block_eq">denot_top_block_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id">Hnd</span>; <span class="id">simpl</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.get_locals">get_locals</a></span> _); <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;cas&nbsp;restreints&nbsp;:&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;1-5: <span class="id">now</span> <span class="id">assert</span> (<span class="id">env</span> == 0) <span class="kwd">as</span> &lt;- <span class="kwd">by</span> <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rename</span> <span class="id">l</span> <span class="id">into</span> <span class="id">vars</span>, <span class="id">l0</span> <span class="id">into</span> <span class="id">blks</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion_clear</span> <span class="id">Wc</span> <span class="kwd">as</span> [??? <span class="id">Wcb</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion_clear</span> <span class="id">Wt</span> <span class="kwd">as</span> [????? <span class="id">Wtb</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">x</span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">Hty</span> <span class="id">Hck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">Hsafe</span> <span class="id">x</span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">Hty</span> <span class="id">Hck</span>) <span class="kwd">as</span> (?&amp; <span class="id">Clx</span> &amp;?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id">Hxin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;si&nbsp;x&nbsp;est&nbsp;une&nbsp;entrée&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock_eq">denot_clock_eq</a></span> <span class="kwd">in</span> <span class="id">Clx</span>|-*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#Ole_trans">Ole_trans</a></span>; <span class="id">eauto</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;sinon,&nbsp;on&nbsp;prépare&nbsp;une&nbsp;itération&nbsp;sur&nbsp;la&nbsp;liste&nbsp;des&nbsp;blocs&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hnd</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Wtb</span>. <span class="id">inv</span> <span class="id">Wcb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_scope">wt_scope</a></span> _ _ _ _) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_scope">wc_scope</a></span> _ _ _ _) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Ndiov</span> : <span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> ((<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)) ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span> <span class="id">vars</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">rewrite</span> &lt;- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>; <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.NoDup_senv_loc">NoDup_senv_loc</a></span>; <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Nd</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#flat_map">flat_map</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.get_defined">get_defined</a></span> <span class="id">blks</span> ++ <span class="id">ins</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.NoDup_get_defined">NoDup_get_defined</a></span>; <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Ndd</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#flat_map">flat_map</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.get_defined">get_defined</a></span> <span class="id">blks</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_l">NoDup_app_l</a></span>; <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hwl</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.wl_block">wl_block</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span>) <span class="id">blks</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">simpl_Forall</span>. <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_block_wl_block">wt_block_wl_block</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fold</span> <span class="id">ins</span> <span class="kwd">in</span> <span class="id">Hbs</span>, <span class="id">Hle</span> |- *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_blocks_equs">denot_blocks_equs</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">ins</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.envG">envG</a></span> <span class="id">envI</span> <span class="id">env</span> <span class="id">blks</span> <span class="id">Hwl</span> <span class="id">Ndd</span>) <span class="kwd">as</span> <span class="id">Henv'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> <span class="id">Hnd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hle</span> <span class="id">Henv'</span>; <span class="id">cbv</span> <span class="id">zeta</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_blocks">denot_blocks</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">ins</span> <span class="id">blks</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.envG">envG</a></span> <span class="id">envI</span> <span class="id">env</span>) <span class="kwd">at</span> 1 2 4.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">env'</span> <span class="id">Henv'</span> <span class="id">Hle</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">blks</span> <span class="kwd">as</span> [|<span class="id">blk</span> <span class="id">blks</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;bloc&nbsp;vide&nbsp;:&nbsp;⊥&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_blocks_eq">denot_blocks_eq</a></span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>; <span class="id">try</span> <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_bot">DSForall_bot</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#MAP_map">MAP_map</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#map_bot">map_bot</a></span>; <span class="id">auto</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_blocks_eq_cons">denot_blocks_eq_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_block_eq">denot_block_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">take</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> _ (_ :: _)) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">blk</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">e</span> <span class="kwd">as</span> (<span class="id">xs</span>,<span class="id">es</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Nd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="kwd">in</span> <span class="id">Nd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">NoDup_app'_iff</span> <span class="kwd">in</span> <span class="id">Nd</span> <span class="kwd">as</span> <span class="id">HH</span>; <span class="id">destruct</span> <span class="id">HH</span> <span class="kwd">as</span> (<span class="id">Nd1</span> &amp; <span class="id">Nd2</span> &amp; <span class="id">Nd3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.env_of_np_ext_eq">env_of_np_ext_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.mem_nth">mem_nth</a></span> <span class="id">xs</span> <span class="id">x</span>) <span class="kwd">as</span> [<span class="id">k</span>|] <span class="id">eqn</span>:<span class="id">Hmem</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_l">NoDup_app_l</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;on&nbsp;a&nbsp;trouvé&nbsp;le&nbsp;bloc&nbsp;de&nbsp;x&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_block">wt_block</a></span> _ _ _) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_equation">wt_equation</a></span> _ _ _) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_block">wc_block</a></span> _ _ _) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="kwd">in</span> <span class="id">Hsafe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Il&nbsp;y&nbsp;a&nbsp;deux&nbsp;cas&nbsp;possibles&nbsp;dans&nbsp;wc_equation.&nbsp;Dans&nbsp;les&nbsp;deux&nbsp;cas,&nbsp;on<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;montre&nbsp;que&nbsp;les&nbsp;[es]&nbsp;sont&nbsp;bien&nbsp;cadencées&nbsp;*dans&nbsp;env'*,&nbsp;l'environment<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mis&nbsp;à&nbsp;jour.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ss</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exps">denot_exps</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.G">G</a></span> <span class="id">ins</span> <span class="id">es</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe.envG">envG</a></span> <span class="id">envI</span> <span class="id">env</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.typesof">typesof</a></span> <span class="id">es</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">ss</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env'</span>) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.clocksof">clocksof</a></span> <span class="id">es</span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> <span class="id">ss</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod">forall_nprod</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">ss</span>) <span class="kwd">as</span> (<span class="id">esTy</span> &amp; <span class="id">esCl</span> &amp; <span class="id">esSf</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_equation">wc_equation</a></span> _ _ _) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;cas&nbsp;merdique&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> (<span class="id">take</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> _ [_]) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_exp">no_rte_exp</a></span> _ _ _ _ _ _) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_exp">wt_exp</a></span> _ _ _) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.find_node">find_node</a></span> _ _ = _) <span class="id">and</span> <span class="id">rewrite</span> <span class="id">it</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> _ = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> _) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_find_node">wc_find_node</a></span> <span class="kwd">in</span> <span class="id">WCG</span> <span class="kwd">as</span> <span class="id">HH</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">HH</span> <span class="kwd">as</span> [? <span class="id">HH</span>]; <span class="id">inversion_clear</span> <span class="id">HH</span> <span class="kwd">as</span> [?? <span class="id">WCi</span> <span class="id">WCio</span> <span class="id">Wcb</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_Eapp_dep">safe_Eapp_dep</a></span> <span class="kwd">with</span> (<span class="id">es</span> := <span class="id">es0</span>) (<span class="id">er</span> := <span class="id">er</span>) (<span class="id">env'</span> := <span class="id">env'</span>) (<span class="id">xs</span> := <span class="id">xs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span> <span class="id">Hsafe</span> <span class="kwd">as</span> (<span class="id">Ty</span> &amp; <span class="id">Cl</span> &amp; <span class="id">Sf</span>); <span class="id">eauto</span> 3.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exps_1">denot_exps_1</a></span> _ _ (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.Eapp">Eapp</a></span> <span class="id">f</span> <span class="id">es0</span> <span class="id">er</span> <span class="id">anns</span>)), 2 <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exps_eq">denot_exps_eq</a></span> _ _ (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.Eapp">Eapp</a></span> <span class="id">f</span> <span class="id">es0</span> <span class="id">er</span> <span class="id">anns</span>) []), <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exps_nil">denot_exps_nil</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_app">forall_nprod_app</a></span>; <span class="id">simpl</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">clear</span> - <span class="id">Nd</span>; <span class="id">solve_NoDup_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">take</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> _ _ (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod">list_of_nprod</a></span> _)) <span class="id">and</span> <span class="id">revert</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exps_1">denot_exps_1</a></span> _ _ (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.Eapp">Eapp</a></span> <span class="id">f</span> <span class="id">es0</span> <span class="id">er</span> <span class="id">anns</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_impl_In">Forall2_impl_In</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;cas&nbsp;normal&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_exp">wt_exp</a></span> _ _) <span class="id">es</span>) <span class="id">and</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_exps_">safe_exps_</a></span> <span class="kwd">in</span> <span class="id">it</span> <span class="kwd">as</span> (<span class="id">Ty</span> &amp; <span class="id">Cl</span> &amp; <span class="id">Sf</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Forall2_ty_DS_le">Forall2_ty_DS_le</a></span> <span class="kwd">in</span> <span class="id">Ty</span>; <span class="id">eauto</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Forall2_cl_DS_le">Forall2_cl_DS_le</a></span> <span class="kwd">with</span> (<span class="id">xs</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_exps">denot_exps</a></span> _ _ _ _ _ <span class="id">env</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span> <span class="id">Cl</span>; <span class="id">eauto</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;comme&nbsp;env&nbsp;&lt;=&nbsp;env',&nbsp;ça&nbsp;tient&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Cl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_impl_In">Forall2_impl_In</a></span>; <span class="id">intros</span> * ??.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> 2 <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock_eq">denot_clock_eq</a></span>; <span class="id">eauto</span> 3.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.forall_safe_le">forall_safe_le</a></span> <span class="kwd">in</span> <span class="id">Sf</span>; <span class="id">eauto</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Clxs</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasClock">HasClock</a></span> <span class="id">Γ'</span>) <span class="id">xs</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.clocksof">clocksof</a></span> <span class="id">es</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">by</span> (<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_equation">wc_equation</a></span> _ _ _) <span class="id">and</span> <span class="id">inv</span> <span class="id">it</span>; <span class="id">simpl</span>; <span class="id">now</span> <span class="id">rewrite</span> ?<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#mem_nth_error">mem_nth_error</a></span> <span class="kwd">in</span> <span class="id">Hmem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;ty_DS&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasType">HasType</a></span> _) _ _) <span class="id">and</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#nth_error_Forall2">nth_error_Forall2</a></span> <span class="kwd">in</span> <span class="id">it</span> <span class="kwd">as</span> (?&amp;?&amp; <span class="id">Hty'</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#nth_error_Forall2">nth_error_Forall2</a></span> <span class="kwd">in</span> <span class="id">esTy</span> <span class="kwd">as</span> (?&amp; <span class="id">Hn</span> &amp;?); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_nth_error">list_of_nprod_nth_error</a></span> <span class="kwd">in</span> <span class="id">Hn</span> <span class="kwd">as</span> -&gt;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subst</span> <span class="id">Γ'</span> <span class="id">Γ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasType_det">HasType_det</a></span> <span class="kwd">in</span> <span class="id">Hty'</span> <span class="kwd">as</span> -&gt;; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;cl_DS&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#nth_error_Forall2">nth_error_Forall2</a></span> <span class="kwd">in</span> <span class="id">Clxs</span> <span class="kwd">as</span> (?&amp;?&amp; <span class="id">Hcl'</span>); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#nth_error_Forall2">nth_error_Forall2</a></span> <span class="kwd">in</span> <span class="id">esCl</span> <span class="kwd">as</span> (?&amp; <span class="id">Hn</span> &amp;?); <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#list_of_nprod_nth_error">list_of_nprod_nth_error</a></span> <span class="kwd">in</span> <span class="id">Hn</span> <span class="kwd">as</span> -&gt;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subst</span> <span class="id">Γ'</span> <span class="id">Γ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasClock_det">HasClock_det</a></span> <span class="kwd">in</span> <span class="id">Hcl'</span> <span class="kwd">as</span> -&gt;; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;safe_DS&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Nprod.html#forall_nprod_k">forall_nprod_k</a></span> <span class="kwd">with</span> (<span class="id">k</span> := <span class="id">k</span>) <span class="kwd">in</span> <span class="id">esSf</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">xs</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#list_sum">list_sum</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.numstreams">numstreams</a></span> <span class="id">es</span>)) <span class="kwd">as</span> &lt;-.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.annots_numstreams">annots_numstreams</a></span>, &lt;- <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.length_typesof_annots">length_typesof_annots</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_length">Forall2_length</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_Some">nth_error_Some</a></span>. <span class="id">now</span> <span class="id">setoid_rewrite</span> <span class="id">Hmem</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Node_safe">Node_safe</a></span>.<br/>
<br/>
<br/>
<h1> Deuxième partie : montrer que wf_env est préservé </h1>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="LDENOTSAFE.Rev">Rev</a></span>.<br/>
<br/>
<div class="doc">Dans la suite on souhaite utiliser fixp_ind pour établir un résultat
      sur l'environnement env := FIXP (denot_equation ...).
      Or pour appliquer safe_exp on a besoin de no_rte_exp, qui est
      supposé prouvé pour env. <span class="bracket"><span class="id">fixp_inv2</span></span> permet de transporter cette
      hypothèse à chaque itération du point fixe. Il faut cependant montrer
      qu'elle est admissible "en arrière" :
   </div>
<span class="kwd">Definition</span> <span class="id"><a name="LDENOTSAFE.admissible_rev">admissible_rev</a></span> (<span class="id">D</span>:<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#cpo">cpo</a></span>)(<span class="id">P</span>:<span class="id">D</span>-&gt;<span class="kwd">Type</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#natO">natO</a></span> -<span class="id">m</span>&gt; <span class="id">D</span>, <span class="id">P</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#lub">lub</a></span> <span class="id">f</span>) -&gt; (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id">P</span> (<span class="id">f</span> <span class="id">n</span>)).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.fixp_inv2">fixp_inv2</a></span> : <span class="kwd">forall</span> (<span class="id">D</span>:<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#cpo">cpo</a></span>) (<span class="id">F</span>:<span class="id">D</span> -<span class="id">m</span>&gt; <span class="id">D</span>) (<span class="id">P</span> <span class="id">P'</span> <span class="id">Q</span> : <span class="id">D</span> -&gt; <span class="kwd">Prop</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id">P'</span> <span class="id">x</span> -&gt; <span class="id">P</span> <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#admissible">admissible</a></span> <span class="id">P</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.admissible_rev">admissible_rev</a></span> _ <span class="id">Q</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Q</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#fixp">fixp</a></span> <span class="id">F</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P'</span> 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id">P'</span> <span class="id">x</span> -&gt; <span class="id">Q</span> <span class="id">x</span> -&gt; <span class="id">P'</span> (<span class="id">F</span> <span class="id">x</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#fixp">fixp</a></span> <span class="id">F</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#fixp">fixp</a></span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">X</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> <span class="kwd">with</span> (<span class="id">A</span> := <span class="id">P'</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#iter">iter</a></span> (<span class="id">D</span>:=<span class="id">D</span>) <span class="id">F</span> <span class="id">n</span>)).<br/>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">n</span>; <span class="id">simpl</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">IHn</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.admissible_rev">admissible_rev</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#admissible">admissible</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">firstorder</span>.<br/>
Qed.</div></details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.fixp_inv2_le">fixp_inv2_le</a></span> : <span class="kwd">forall</span> (<span class="id">D</span>:<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#cpo">cpo</a></span>) (<span class="id">F</span>:<span class="id">D</span> -<span class="id">m</span>&gt; <span class="id">D</span>) (<span class="id">P</span> <span class="id">Q</span> : <span class="id">D</span> -&gt; <span class="kwd">Prop</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#admissible">admissible</a></span> <span class="id">P</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.admissible_rev">admissible_rev</a></span> _ <span class="id">Q</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Q</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#fixp">fixp</a></span> <span class="id">F</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span> 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id">P</span> <span class="id">x</span> -&gt; <span class="id">x</span> &lt;= <span class="id">F</span> <span class="id">x</span> -&gt; <span class="id">Q</span> <span class="id">x</span> -&gt; <span class="id">P</span> (<span class="id">F</span> <span class="id">x</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#fixp">fixp</a></span> <span class="id">F</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#fixp">fixp</a></span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">X</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> <span class="kwd">with</span> (<span class="id">A</span> := <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#iter_">iter_</a></span> <span class="id">F</span> <span class="id">n</span> &lt;= <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#iter_">iter_</a></span> <span class="id">F</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>)).<br/>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">n</span>; <span class="id">simpl</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">IHn</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.admissible_rev">admissible_rev</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#admissible">admissible</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">firstorder</span>.<br/>
Qed.</div></details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.denot_clock_le">denot_clock_le</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">env'</span> <span class="id">ck</span> ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">env</span> &lt;= <span class="id">env'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">ck</span> &lt;=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env'</span> <span class="id">ck</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> 2 <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock_eq">denot_clock_eq</a></span>.<br/>
&nbsp;&nbsp;<span class="id">auto</span>.<br/>
Qed.</div></details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.oc_node_admissible_rev">oc_node_admissible_rev</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">PSyn</span> <span class="id">Prefs</span>} (<span class="id">G</span> : @<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.global">global</a></span> <span class="id">PSyn</span> <span class="id">Prefs</span>),<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ins</span> <span class="id">envG</span> <span class="id">envI</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.admissible_rev">admissible_rev</a></span> _ (<span class="kwd">fun</span> <span class="id">env</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_node">no_rte_node</a></span> <span class="id">G</span> <span class="id">ins</span> <span class="id">envG</span> <span class="id">envI</span> <span class="id">env</span> <span class="id">n</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">intros</span> ???????? <span class="id">Hoc</span>.<br/>
&nbsp;&nbsp;<span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_node_le_compat">no_rte_node_le_compat</a></span>.<br/>
Qed.</div></details>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Rev">Rev</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.wf_env_loc">wf_env_loc</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">PSyn</span> <span class="id">Prefs</span>} (<span class="id">n</span> : @<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.node">node</a></span> <span class="id">PSyn</span> <span class="id">Prefs</span>),<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.get_locals">get_locals</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_block">n_block</a></span> <span class="id">n</span>)) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="id">envI</span> <span class="id">bs</span> <span class="id">env</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">He</span> <span class="id">x</span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">Hty</span> <span class="id">Hck</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">He</span> <span class="id">x</span> <span class="id">ty</span> <span class="id">ck</span>); <span class="id">auto</span>; <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hty</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Common.CommonList.html#in_app_weak">in_app_weak</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Common.CommonList.html#in_app_weak">in_app_weak</a></span>.<br/>
Qed.</div></details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.wf_env_0_ext">wf_env_0_ext</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">PSyn</span> <span class="id">Prefs</span>} (<span class="id">n</span> : @<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.node">node</a></span> <span class="id">PSyn</span> <span class="id">Prefs</span>),<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">envI</span> <span class="id">bs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="id">envI</span> <span class="id">bs</span> 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.get_locals">get_locals</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_block">n_block</a></span> <span class="id">n</span>)) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="id">envI</span> <span class="id">bs</span> 0.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">He</span> <span class="id">x</span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">Hty</span> <span class="id">Hck</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span>.<br/>
&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id">Hmem</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;x&nbsp;est&nbsp;une&nbsp;entrée&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">He</span> <span class="id">x</span> <span class="id">ty</span> <span class="id">ck</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="kwd">in</span> <span class="id">He</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hmem</span> <span class="kwd">in</span> <span class="id">He</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.Common.html#mem_ident_spec">mem_ident_spec</a></span> <span class="kwd">in</span> <span class="id">Hmem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">He</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.HasType_app_l">HasType_app_l</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.HasType_ins_app">HasType_ins_app</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.NoDup_iol">NoDup_iol</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.HasClock_app_l">HasClock_app_l</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.HasClock_ins_app">HasClock_ins_app</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.NoDup_iol">NoDup_iol</a></span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;sinon&nbsp;c'est&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.ty_DS">ty_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>; <span class="id">try</span> <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_bot">DSForall_bot</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#MAP_map">MAP_map</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#map_bot">map_bot</a></span>; <span class="id">auto</span>.<br/>
Qed.</div></details>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="LDENOTSAFE.noerrors_prog">noerrors_prog</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">PSyn</span> <span class="id">Prefs</span>} (<span class="id">G</span> : @<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.global">global</a></span> <span class="id">PSyn</span> <span class="id">Prefs</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_global">wt_global</a></span> <span class="id">G</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_global">wc_global</a></span> <span class="id">G</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_global">no_rte_global</a></span> <span class="id">G</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">n</span> <span class="id">envI</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.find_node">find_node</a></span> <span class="id">f</span> <span class="id">G</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">n</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ins</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">n</span>.(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Γ</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) ++ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>) ++ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.get_locals">get_locals</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_block">n_block</a></span> <span class="id">n</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bs</span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#bss">bss</a></span> <span class="id">ins</span> <span class="id">envI</span> &lt;= <span class="id">bs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_global">denot_global</a></span> <span class="id">G</span> <span class="id">f</span> <span class="id">envI</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Wtg</span> <span class="id">Wcg</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_global">no_rte_global</a></span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_global">denot_global</a></span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Cpo_def_ext.html#FIXP_fixp">FIXP_fixp</a></span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;point&nbsp;fixe&nbsp;global&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Cpo_def_ext.html#fixp_ind_le">fixp_ind_le</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;{ <span class="comment">(*&nbsp;admissible&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> ? <span class="id">HH</span> <span class="id">Hf</span> ???????.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env_admissible">wf_env_admissible</a></span>; <span class="id">intro</span> <span class="id">k</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">HH</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>, <span class="id">Hf</span>; <span class="id">cbv</span> <span class="id">beta</span>; <span class="id">intros</span> * <span class="id">Hop</span> <span class="id">envI'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_node_le_compat">no_rte_node_le_compat</a></span>, <span class="id">Hop</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Cpo_def_ext.html#fcont_app_le_compat">fcont_app_le_compat</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#le_lub">le_lub</a></span> <span class="id">f</span> <span class="id">k</span>). }<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;étape&nbsp;d'induction&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">envG</span> <span class="id">HenvG</span> <span class="id">HenvG_le</span> * <span class="id">Ocg</span> ?? <span class="id">envI</span> <span class="id">Hfind</span> ? <span class="id">Hbs</span> <span class="id">Hins</span>.<br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#fcontit">fcontit</a></span> ?<span class="id">a</span> ?<span class="id">b</span>) <span class="kwd">with</span> (<span class="id">a</span> <span class="id">b</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonList2.html#Forall_In">Forall_In</a></span> <span class="kwd">in</span> <span class="id">Ocg</span> <span class="kwd">as</span> <span class="id">Hoc</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.find_node_in_nodes">find_node_in_nodes</a></span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hoc</span> <span class="id">envI</span>); <span class="id">revert</span> <span class="id">Hoc</span>.<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> 2 <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_global_eq">denot_global_eq</a></span>, &lt;- <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.find_node_name">find_node_name</a></span>, <span class="id">Hfind</span>; <span class="id">eauto</span> 1.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Cpo_def_ext.html#FIXP_fixp">FIXP_fixp</a></span>; <span class="id">intro</span> <span class="id">Hoc</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;point&nbsp;fixe&nbsp;sur&nbsp;le&nbsp;nœud&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.fixp_inv2_le">fixp_inv2_le</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Q</span> := <span class="kwd">fun</span> <span class="id">env</span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_node">no_rte_node</a></span> <span class="id">G</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="id">envG</span> <span class="id">envI</span> <span class="id">env</span> <span class="id">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;); <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env_admissible">wf_env_admissible</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.oc_node_admissible_rev">oc_node_admissible_rev</a></span>.<br/>
&nbsp;&nbsp;{ <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_node_le_compat">no_rte_node_le_compat</a></span>, <span class="id">Hoc</span>; <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">env</span> <span class="id">Henv</span> <span class="id">Henv_le</span> <span class="id">Hoc'</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_node">safe_node</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_global_node">wc_global_node</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_global_node">wt_global_node</a></span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;hypothèse&nbsp;d'induction&nbsp;globale&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">f'</span> <span class="id">n'</span> <span class="id">Hfind'</span> ?? <span class="id">bs'</span> <span class="id">envI'</span> <span class="id">Hbs'</span> <span class="id">Hins'</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env_loc">wf_env_loc</a></span>, <span class="id">HenvG</span>; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env_0_ext">wf_env_0_ext</a></span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>, <span class="id">Ocg</span>; <span class="id">cbv</span> <span class="id">beta</span>; <span class="id">intros</span> ? <span class="id">HH</span> ?.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_node_le_compat">no_rte_node_le_compat</a></span>, <span class="id">HH</span>; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Cpo_def_ext.html#fcont_app_le_compat">fcont_app_le_compat</a></span>.<br/>
Qed.</div></details>
<br/>
<br/>
<div class="doc">the same theorem but with the weaker <span class="bracket"><span class="id">no_rte_node_main</span></span> hypothesis </div>
<span class="kwd">Theorem</span> <span class="id"><a name="LDENOTSAFE.noerrors_prog_main">noerrors_prog_main</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">PSyn</span> <span class="id">Prefs</span>} (<span class="id">G</span> : @<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.global">global</a></span> <span class="id">PSyn</span> <span class="id">Prefs</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_global">wt_global</a></span> <span class="id">G</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_global">wc_global</a></span> <span class="id">G</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">n</span> <span class="id">envI</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_global_main">no_rte_global_main</a></span> <span class="id">G</span> <span class="id">f</span> <span class="id">envI</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.find_node">find_node</a></span> <span class="id">f</span> <span class="id">G</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">n</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ins</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">n</span>.(<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Γ</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) ++ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>) ++ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.get_locals">get_locals</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_block">n_block</a></span> <span class="id">n</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">bs</span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#bss">bss</a></span> <span class="id">ins</span> <span class="id">envI</span> &lt;= <span class="id">bs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_global">denot_global</a></span> <span class="id">G</span> <span class="id">f</span> <span class="id">envI</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Wtg</span> <span class="id">Wcg</span> * <span class="id">Norte</span> <span class="id">Hfind</span> ??? <span class="id">Hle</span> <span class="id">Hins</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_global_main">no_rte_global_main</a></span> <span class="kwd">in</span> <span class="id">Norte</span>.<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Lord.Ordered_nodes">Ordered_nodes</a></span> <span class="id">G</span>) <span class="kwd">as</span> <span class="id">Hord</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Lord.wl_global_Ordered_nodes">wl_global_Ordered_nodes</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_global_wl_global">wt_global_wl_global</a></span>.<br/>
&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_global">denot_global</a></span> <span class="id">G</span>) <span class="kwd">as</span> <span class="id">envG</span> <span class="id">eqn</span>:<span class="id">HG</span>.<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="kwd">forall</span> <span class="id">f</span> <span class="id">nd</span> <span class="id">envI</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.find_node">find_node</a></span> <span class="id">f</span> <span class="id">G</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">nd</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">envG</span> <span class="id">f</span> <span class="id">envI</span> == <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#FIXP">FIXP</a></span> _ (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_node">denot_node</a></span> <span class="id">G</span> <span class="id">nd</span> <span class="id">envG</span> <span class="id">envI</span>)) <span class="kwd">as</span> <span class="id">HenvG</span>.<br/>
&nbsp;&nbsp;{ <span class="id">intros</span> * <span class="id">Hf</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_global">denot_global</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#PROJ_simpl">PROJ_simpl</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#FIXP_eq">FIXP_eq</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#PROJ_simpl">PROJ_simpl</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_global_eq">denot_global_eq</a></span>, <span class="id">Hf</span> <span class="kwd">at</span> 1. }<br/>
&nbsp;&nbsp;<span class="id">clear</span> <span class="id">HG</span>. <span class="comment">(*&nbsp;maintenant&nbsp;HenvG&nbsp;contient&nbsp;tout&nbsp;ce&nbsp;qu'on&nbsp;doit&nbsp;savoir&nbsp;sur&nbsp;envG&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Norte</span>.<br/>
&nbsp;&nbsp;<span class="id">generalize</span> <span class="id">dependent</span> <span class="id">n</span>. <span class="id">revert</span> <span class="id">f</span> <span class="id">envI</span>. <span class="id">revert</span> <span class="id">bs</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">G</span> <span class="kwd">as</span> [<span class="id">tys</span> <span class="id">exts</span> <span class="id">nds</span>].<br/>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">nds</span> <span class="kwd">as</span> [|<span class="id">a</span> <span class="id">nds</span>]; <span class="id">intros</span>. <span class="id">inv</span> <span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="Velus.Common.Common.html#ident_eq_dec">ident_eq_dec</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_name">n_name</a></span> <span class="id">a</span>) <span class="id">f</span>); <span class="id">subst</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;cas&nbsp;qui&nbsp;nous&nbsp;intéresse&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.find_node_now">find_node_now</a></span> <span class="kwd">in</span> <span class="id">Hfind</span>; <span class="id">inv</span> <span class="id">Hfind</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion_clear</span> <span class="id">Norte</span> <span class="kwd">as</span> [|?? <span class="id">Hoc</span> <span class="id">Hocs</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#ident_eqb_refl">ident_eqb_refl</a></span> <span class="kwd">in</span> <span class="id">Hoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;specialize&nbsp;(Hoc&nbsp;envI&nbsp;bs&nbsp;(wf_env_loc&nbsp;_&nbsp;_&nbsp;_&nbsp;_&nbsp;Hins)).&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hoc</span>. <span class="id">fold</span> <span class="id">ins</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">HenvG</span>; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.find_node_now">find_node_now</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_node_cons">denot_node_cons</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Lord.find_node_not_Is_node_in">find_node_not_Is_node_in</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.find_node_now">find_node_now</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Cpo_def_ext.html#FIXP_fixp">FIXP_fixp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intro</span> <span class="id">Hoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_node_cons">no_rte_node_cons</a></span> <span class="kwd">in</span> <span class="id">Hoc</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Lord.find_node_not_Is_node_in">find_node_not_Is_node_in</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.find_node_now">find_node_now</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.fixp_inv2_le">fixp_inv2_le</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Q</span> := <span class="kwd">fun</span> <span class="id">env</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_node">no_rte_node</a></span> {| <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.types">types</a></span> := <span class="id">tys</span>; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.externs">externs</a></span> := <span class="id">exts</span>; <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.nodes">nodes</a></span> := <span class="id">nds</span> |} <span class="id">ins</span> <span class="id">envG</span> <span class="id">envI</span> <span class="id">env</span> <span class="id">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;); <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env_admissible">wf_env_admissible</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.oc_node_admissible_rev">oc_node_admissible_rev</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env_0_ext">wf_env_0_ext</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">env</span> <span class="id">Hsafe</span> <span class="id">Hl</span> <span class="id">Hoc2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Lord.Ordered_nodes_cons">Ordered_nodes_cons</a></span> <span class="kwd">in</span> <span class="id">Hord</span> <span class="kwd">as</span> <span class="id">Hord'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_global_cons">wt_global_cons</a></span> <span class="kwd">in</span> <span class="id">Wtg</span> <span class="kwd">as</span> <span class="id">Wtg'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Wtg</span> <span class="kwd">as</span> [? <span class="id">Wtp</span>] <span class="id">eqn</span>:<span class="id">HH</span>; <span class="id">clear</span> <span class="id">HH</span>. <span class="comment">(*&nbsp;trouver&nbsp;un&nbsp;autre&nbsp;moyen&nbsp;de&nbsp;garder&nbsp;Wtg&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Wcg</span>. <span class="id">inv</span> <span class="id">Wtp</span>. <span class="comment">(*&nbsp;inv&nbsp;Rg.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_node">safe_node</a></span>; <span class="id">auto</span>; <span class="id">try</span> <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;reste&nbsp;l'hypothèse&nbsp;de&nbsp;récurrence&nbsp;sur&nbsp;les&nbsp;nœuds&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">f2</span> <span class="id">n2</span> <span class="id">Hfind</span> ?? <span class="id">bs2</span> <span class="id">envI2</span> <span class="id">Hbs2</span> <span class="id">Hins2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env_loc">wf_env_loc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">IHnds</span>; <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env_0_ext">wf_env_0_ext</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;montrons&nbsp;que&nbsp;HenvG&nbsp;tient&nbsp;toujours&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">f'</span> <span class="id">ndf'</span> <span class="id">envI'</span> <span class="id">Hfind'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Lord.find_node_uncons">find_node_uncons</a></span> <span class="kwd">with</span> (<span class="id">nd</span> := <span class="id">n</span>) <span class="kwd">in</span> <span class="id">Hfind'</span> <span class="kwd">as</span> ?; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">HenvG</span>, &lt;- <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_node_cons">denot_node_cons</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Lord.find_node_later_not_Is_node_in">find_node_later_not_Is_node_in</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;montrons&nbsp;que&nbsp;no_rte&nbsp;tient&nbsp;toujours&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.nodes">nodes</a></span> _).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">take</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_node">wc_node</a></span> _ _ /\ _) <span class="id">and</span> <span class="id">destruct</span> <span class="id">it</span> <span class="kwd">as</span> [? <span class="id">Hnn</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> - <span class="id">Hocs</span> <span class="id">Hnn</span> <span class="id">Hord</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_Forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Common.Common.html#ident_eqb_neq">ident_eqb_neq</a></span>, <span class="id"><a href="Velus.Common.Common.html#ident_eqb_sym">ident_eqb_sym</a></span> <span class="kwd">in</span> <span class="id">Hnn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hnn</span> <span class="kwd">in</span> <span class="id">Hocs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id">HH</span>; <span class="id">intros</span>; <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_node_cons">no_rte_node_cons</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Lord.Ordered_nodes_nin">Ordered_nodes_nin</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.find_node_other">find_node_other</a></span> <span class="kwd">in</span> <span class="id">Hfind</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">IHnds</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ.wt_global_cons">wt_global_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl.wc_global_cons">wc_global_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Lord.Ordered_nodes_cons">Ordered_nodes_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span> <span class="id">f'</span> <span class="id">ndf'</span> <span class="id">envI'</span> <span class="id">Hfind'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Lord.find_node_uncons">find_node_uncons</a></span> <span class="kwd">with</span> (<span class="id">nd</span> := <span class="id">a</span>) <span class="kwd">in</span> <span class="id">Hfind'</span> <span class="kwd">as</span> ?; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">HenvG</span>, &lt;- <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_node_cons">denot_node_cons</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Lord.find_node_later_not_Is_node_in">find_node_later_not_Is_node_in</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">clear</span> - <span class="id">Norte</span> <span class="id">Hord</span>. <span class="id">inv</span> <span class="id">Norte</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_impl_In">Forall_impl_In</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>; <span class="id">intros</span> * <span class="id">Hin</span> <span class="id">HH</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases_eqn</span> <span class="id">HH</span>; <span class="id">intros</span>; <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr.no_rte_node_cons">no_rte_node_cons</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Lord.Ordered_nodes_nin">Ordered_nodes_nin</a></span>.<br/>
Qed.</div></details>
<br/>
<br/>
<div class="doc">As a consequence of clock typing correctness, we prove that the
    absences of inputs and outputs are aligned </div>
<span class="kwd">Section</span> <span class="id"><a name="LDENOTSAFE.Abs_aligned">Abs_aligned</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.denot_clock_abs">denot_clock_abs</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ins</span> <span class="id">ck</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">abs_env</span> := <span class="kwd">fun</span> _ : <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#DS_const">DS_const</a></span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#abs">abs</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ins</span> <span class="id">abs_env</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#DS_const">DS_const</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>) <span class="id">abs_env</span> <span class="id">ck</span> == <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#DS_const">DS_const</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">clear</span>.<br/>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">ck</span> <span class="kwd">as</span> [|??? []]; <span class="id">simpl</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">IHck</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span>.<br/>
&nbsp;&nbsp;<span class="id">cases</span>; <span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#zip_const">zip_const</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#MAP_map">MAP_map</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#map_DS_const">map_DS_const</a></span>.<br/>
Qed.</div></details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.wf_env_abs_ins">wf_env_abs_ins</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">Γ</span> <span class="id">ins</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span> <span class="id">ck</span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasClock">HasClock</a></span> <span class="id">Γ</span> <span class="id">x</span> <span class="id">ck</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> <span class="id">ins</span> -&gt; (<span class="kwd">forall</span> <span class="id">y</span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.Is_free_in_clock">Is_free_in_clock</a></span> <span class="id">y</span> <span class="id">ck</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">y</span> <span class="id">ins</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> (<span class="kwd">fun</span> _ : <span class="id"><a href="Velus.Common.Common.html#ident">ident</a></span> =&gt; <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#DS_const">DS_const</a></span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#abs">abs</a></span>) (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#DS_const">DS_const</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>) 0.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">clear</span>.<br/>
&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hfr</span> ??? <span class="id">Hty</span> <span class="id">Hck</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span>; <span class="id">cases_eqn</span> <span class="id">Hmem</span>.<br/>
&nbsp;&nbsp;- <span class="id">repeat</span> <span class="id">split</span>; <span class="id">try</span> <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_const">DSForall_const</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.Common.html#mem_ident_spec">mem_ident_spec</a></span> <span class="kwd">in</span> <span class="id">Hmem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock_ins">denot_clock_ins</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock_abs">denot_clock_abs</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#MAP_map">MAP_map</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#map_DS_const">map_DS_const</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">repeat</span> <span class="id">split</span>; <span class="id">try</span> <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.CommonDS.html#DSForall_bot">DSForall_bot</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#MAP_map">MAP_map</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#map_bot">map_bot</a></span>.<br/>
Qed.</div></details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.wf_env_smask0">wf_env_smask0</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> <span class="id">k</span> <span class="id">rs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span> <span class="id">ck</span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasClock">HasClock</a></span> <span class="id">Γ</span> <span class="id">x</span> <span class="id">ck</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> <span class="id">ins</span> -&gt; (<span class="kwd">forall</span> <span class="id">y</span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks.Is_free_in_clock">Is_free_in_clock</a></span> <span class="id">y</span> <span class="id">ck</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">y</span> <span class="id">ins</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">bs</span> 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Denot.ResetMask.html#smask_env">smask_env</a></span> <span class="id">k</span> <span class="id">rs</span> <span class="id">envI</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#MAP">MAP</a></span> <span class="id"><a href="Velus.Lustre.Denot.ResetMask.html#bool_of_sbool">bool_of_sbool</a></span> (<span class="id"><a href="Velus.Lustre.Denot.ResetMask.html#smask">smask</a></span> <span class="id">k</span> <span class="id">rs</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#MAP">MAP</a></span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#pres">pres</a></span> <span class="id">bs</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hfr</span> <span class="id">Hwf</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.ResetMask.html#smask_env">smask_env</a></span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.Cpo_def_ext.html#FIXP_fixp">FIXP_fixp</a></span>.<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hwf</span>.<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">k</span> <span class="id">envI</span> <span class="id">rs</span> <span class="id">bs</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#fixp_ind">fixp_ind</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">red</span>; <span class="id">intros</span>; <span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env_admissible_ins">wf_env_admissible_ins</a></span>; <span class="id">simpl</span>; <span class="id">now</span> <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span>; <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env_bot">wf_env_bot</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">fmask_env</span> <span class="id">HR</span> **.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;on&nbsp;attend&nbsp;une&nbsp;valeur&nbsp;sur&nbsp;rs,&nbsp;cf.&nbsp;[safe_sreset]&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wfv_wfe">wfv_wfe</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">x</span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">Hty</span> <span class="id">Hck</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cbv</span> <span class="id">zeta</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="Velus.Common.Common.html#mem_ident">mem_ident</a></span> <span class="id">x</span> <span class="id">ins</span>) <span class="id">eqn</span>:<span class="id">Hmem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;si&nbsp;x&nbsp;n'est&nbsp;pas&nbsp;une&nbsp;entrée,&nbsp;c'est&nbsp;ok&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;2: <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span>; <span class="id">rewrite</span> <span class="id">Hmem</span>; <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_var_bot">wf_var_bot</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember_ds</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id">ins</span> _ _ <span class="id">x</span>) <span class="kwd">as</span> <span class="id">xs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">generalize</span> <span class="id">dependent</span> <span class="id">xs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">xs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>; <span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> <span class="id">Hxs</span>; <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> <span class="id">Cof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hxs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wfe_wfv">wfe_wfv</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (@<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#is_cons_elim">is_cons_elim</a></span> _ <span class="id">rs</span>) <span class="kwd">as</span> (<span class="id">vr</span> &amp; <span class="id">rs'</span> &amp; <span class="id">Hrs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="kwd">in</span> <span class="id">Hxs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hmem</span> <span class="kwd">in</span> <span class="id">Hxs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Classes.RelationClasses.html#symmetry">symmetry</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#cons_is_cons">cons_is_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DScase_is_cons">DScase_is_cons</a></span> <span class="kwd">in</span> <span class="id">Hxs</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env_rem">wf_env_rem</a></span> <span class="kwd">in</span> <span class="id">Hwf</span> <span class="kwd">as</span> <span class="id">Hwfr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#REM_env_bot">REM_env_bot</a></span> <span class="kwd">in</span> <span class="id">Hwfr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hrs</span>, (<span class="id"><a href="Velus.Lustre.Denot.ResetMask.html#smask_envf_eq">smask_envf_eq</a></span> <span class="id">fmask_env</span> <span class="id">k</span>), <span class="id"><a href="Velus.Lustre.Denot.ResetMask.html#smask_eq">smask_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;1: <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#MAP_map">MAP_map</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#map_DS_const">map_DS_const</a></span>; <span class="id">now</span> <span class="id">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env_abs_ins">wf_env_abs_ins</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">rewrite</span> 2 <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#MAP_map">MAP_map</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#rem_map">rem_map</a></span>, &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#APP_env_bot">APP_env_bot</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;1,2: <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#app_map">app_map</a></span>, <span class="id"><a href="Velus.Lustre.Denot.ResetMask.html#bool_of_sbool_pres">bool_of_sbool_pres</a></span>; <span class="id">now</span> <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env_APP_">wf_env_APP_</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span>: <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#map_eq_cons">map_eq_cons</a></span>, &lt;- (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#app_cons">app_cons</a></span> _ (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#DS_const">DS_const</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>)), &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#DS_const_eq">DS_const_eq</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env_APP_">wf_env_APP_</a></span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env_abs_ins">wf_env_abs_ins</a></span>.<br/>
Qed.</div></details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.bss_abs">bss_abs</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">I</span> <span class="id">A</span> <span class="id">l</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#bss">bss</a></span> <span class="id">I</span> <span class="id">A</span> <span class="id">l</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#abs_env">abs_env</a></span> == <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#DS_const">DS_const</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">l</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#abs_env">abs_env</a></span>, <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#abss">abss</a></span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#bss_cons">bss_cons</a></span>, <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#MAP_map">MAP_map</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#map_DS_const">map_DS_const</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#zip_const">zip_const</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#MAP_map">MAP_map</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#map_DS_const">map_DS_const</a></span>.<br/>
Qed.</div></details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.denot_clock_bs_abs">denot_clock_bs_abs</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">env</span> <span class="id">ck</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> <span class="id">ins</span> <span class="id">envI</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#DS_const">DS_const</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>) <span class="id">env</span> <span class="id">ck</span> &lt;= <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#DS_const">DS_const</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">ck</span> <span class="kwd">as</span> [|???[]]; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">simpl</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock">denot_clock</a></span> _ _ _ _ _).<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#Ole_trans">Ole_trans</a></span> <span class="kwd">with</span> (<span class="id">y</span> := <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#ZIP">ZIP</a></span> _ _ (<span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#DS_const">DS_const</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>)); <span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#zip_const2">zip_const2</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#MAP_map">MAP_map</a></span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;TOOD:&nbsp;un&nbsp;lemme&nbsp;pour&nbsp;la&nbsp;suite&nbsp;?&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">remember_ds</span> (<span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#map">map</a></span> _ _) <span class="kwd">as</span> <span class="id">y</span>; <span class="id">revert</span> <span class="id">Hy</span>.<br/>
&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="id">ins</span> <span class="id">envI</span> <span class="id">env</span> <span class="id">i</span>).<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">y</span>; <span class="id">clear</span>; <span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">y</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> *; <span class="id">eapply</span> <span class="id">Cof</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Classes.RelationClasses.html#symmetry">symmetry</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#map_eq_cons_elim">map_eq_cons_elim</a></span> <span class="kwd">in</span> <span class="id">Hy</span> <span class="kwd">as</span> (?&amp;?&amp;?&amp;?&amp;?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.sample">sample</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; [| <span class="id">eapply</span> <span class="id">Cof</span>]; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#DS_const_eq">DS_const_eq</a></span> <span class="kwd">at</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>; <span class="id">subst</span>; <span class="id">rewrite</span> ?<span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html#andb_false_r">Bool.andb_false_r</a></span>; <span class="id">auto</span>.<br/>
Qed.</div></details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="LDENOTSAFE.AC_le_abss">AC_le_abss</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> (<span class="id">xs</span> : <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#DS">DS</a></span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#sampl">sampl</a></span> <span class="id">A</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.safe_DS">safe_DS</a></span> <span class="id">xs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC">AC</a></span> <span class="id">xs</span> &lt;= <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#DS_const">DS_const</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">xs</span> &lt;= <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#abss">abss</a></span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">Cof</span>; <span class="id">intros</span> * <span class="id">Hsf</span> <span class="id">Hac</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">xs</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#eqEps">eqEps</a></span> <span class="kwd">in</span> <span class="id">Hsf</span>, <span class="id">Hac</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="id">apply</span> <span class="id">Cof</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#AC_cons">AC_cons</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#DS_const_eq">DS_const_eq</a></span> <span class="kwd">in</span> <span class="id">Hac</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#Con_le_simpl">Con_le_simpl</a></span> <span class="kwd">in</span> <span class="id">Hac</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cases</span>; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; [| <span class="id">apply</span> <span class="id">Cof</span>]; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#abss">abss</a></span> <span class="kwd">at</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#DS_const_eq">DS_const_eq</a></span>; <span class="id">auto</span>.<br/>
Qed.</div></details>
<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="LDENOTSAFE.wf_alignLE">wf_alignLE</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">PSyn</span> <span class="id">Prefs</span>} (<span class="id">G</span> : @<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.global">global</a></span> <span class="id">PSyn</span> <span class="id">Prefs</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Restr.restr_global">restr_global</a></span> <span class="id">G</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.find_node">find_node</a></span> <span class="id">f</span> <span class="id">G</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">n</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">envI</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ins</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Γ</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_ins">senv_of_ins</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_in">n_in</a></span> <span class="id">n</span>) ++ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.senv_of_decls">senv_of_decls</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>) ++ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.get_locals">get_locals</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_block">n_block</a></span> <span class="id">n</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env">wf_env</a></span> <span class="id">Γ</span> <span class="id">ins</span> <span class="id">envI</span> (<span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#bss">bss</a></span> <span class="id">ins</span> <span class="id">envI</span>) (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_global">denot_global</a></span> <span class="id">G</span> <span class="id">f</span> <span class="id">envI</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Denot.ResetMask.html#abs_alignLE">abs_alignLE</a></span> <span class="id">envI</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_global">denot_global</a></span> <span class="id">G</span> <span class="id">f</span> <span class="id">envI</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">intros</span> * <span class="id">Hrg</span> ?? <span class="id">Hfind</span> ??? <span class="id">Hwf</span> <span class="id">k</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;pose&nbsp;proof&nbsp;(Hr&nbsp;:=&nbsp;restr_global_find&nbsp;_&nbsp;_&nbsp;_&nbsp;Hrg&nbsp;Hfind).&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id">Hin</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_in">denot_in</a></span> <span class="id">G</span> <span class="id">f</span> <span class="id">n</span> <span class="id">Hfind</span> <span class="id">envI</span>).<br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id">Hout</span> := <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.not_out_bot">not_out_bot</a></span> <span class="id">G</span> <span class="id">f</span> <span class="id">n</span> <span class="id">Hfind</span> <span class="id">envI</span>).<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hin</span> <span class="id">Hout</span> <span class="id">Hwf</span>.<br/>
&nbsp;&nbsp;<span class="id">generalize</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_global">denot_global</a></span> <span class="id">G</span> <span class="id">f</span> <span class="id">envI</span>) <span class="kwd">as</span> <span class="id">env</span>.<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">envI</span>.<br/>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">k</span>; <span class="id">intros</span> <span class="id">envI</span> <span class="id">env</span> ??? <span class="id">Hk</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#nrem_env_0">nrem_env_0</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;rewrite&nbsp;Hk,&nbsp;bss_abs&nbsp;in&nbsp;Hwf.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#abs_env">abs_env</a></span>; <span class="id">intro</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hwf</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.denot_var">denot_var</a></span> <span class="kwd">in</span> <span class="id">Hwf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="Velus.Common.Common.html#mem_ident">mem_ident</a></span> <span class="id">x</span> <span class="id">ins</span>) <span class="id">eqn</span>:<span class="id">Hmem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;si&nbsp;x&nbsp;est&nbsp;dans&nbsp;ins&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.Common.html#mem_ident_spec">mem_ident_spec</a></span> <span class="kwd">in</span> <span class="id">Hmem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hin</span>; <span class="id">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="Velus.Common.Common.html#mem_ident">mem_ident</a></span> <span class="id">x</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_out">n_out</a></span> <span class="id">n</span>) ++ <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den.get_locals">get_locals</a></span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn.n_block">n_block</a></span> <span class="id">n</span>)))) <span class="id">eqn</span>:<span class="id">Hmem2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;si&nbsp;x&nbsp;est&nbsp;dans&nbsp;out&nbsp;ou&nbsp;vars,&nbsp;seul&nbsp;cas&nbsp;intéressant&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="kwd">exists</span> <span class="id">ty</span> <span class="id">ck</span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasType">HasType</a></span> <span class="id">Γ</span> <span class="id">x</span> <span class="id">ty</span> /\ <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.HasClock">HasClock</a></span> <span class="id">Γ</span> <span class="id">x</span> <span class="id">ck</span>) <span class="kwd">as</span> (<span class="id">ty</span> &amp; <span class="id">ck</span> &amp; <span class="id">Hty</span> &amp; <span class="id">Hck</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">apply</span> <span class="id"><a href="Velus.Common.Common.html#mem_ident_spec">mem_ident_spec</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span> <span class="kwd">in</span> <span class="id">Hmem2</span> <span class="kwd">as</span> [<span class="id">Hx</span>|<span class="id">Hx</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.In_HasClock">In_HasClock</a></span> <span class="kwd">in</span> <span class="id">Hx</span> <span class="kwd">as</span> <span class="id">HH1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">In_HasType'</span> <span class="kwd">in</span> <span class="id">Hx</span> <span class="kwd">as</span> <span class="id">HH2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">HH1</span> <span class="kwd">as</span> (<span class="id">ck</span>, <span class="id">Hck</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">HH2</span> <span class="kwd">as</span> (<span class="id">ty</span>, <span class="id">Hty</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eauto</span> 8 <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.HasClock_app_r">HasClock_app_r</a></span>,  <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.HasClock_app_l">HasClock_app_l</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.HasType_app_r">HasType_app_r</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.HasType_app_l">HasType_app_l</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span> <span class="kwd">in</span> <span class="id">Hx</span> <span class="kwd">as</span> ([? <span class="id">a</span>]&amp;?&amp;?); <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.typ">typ</a></span> <span class="id">a</span>), (<span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv.clo">clo</a></span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; <span class="id">econstructor</span>; <span class="id">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Common.CommonList.html#in_app_weak">in_app_weak</a></span>, <span class="id">in_app_weak'</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hwf</span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">Hty</span> <span class="id">Hck</span>); <span class="id">destruct</span> <span class="id">Hwf</span> <span class="kwd">as</span> (_ &amp; <span class="id">Hcl</span> &amp; <span class="id">Hsf</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.cl_DS">cl_DS</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock_eq">denot_clock_eq</a></span>, <span class="id">Hk</span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.bss_abs">bss_abs</a></span>, &lt;- <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock_eq">denot_clock_eq</a></span> <span class="kwd">in</span> <span class="id">Hcl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.AC_le_abss">AC_le_abss</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_def.html#Ole_trans">Ole_trans</a></span>, <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.denot_clock_bs_abs">denot_clock_bs_abs</a></span>; <span class="id">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;sinon&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Velus.Common.Common.html#mem_ident_false">mem_ident_false</a></span> <span class="kwd">in</span> <span class="id">Hmem2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span> <span class="kwd">in</span> <span class="id">Hmem2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">Hout</span> <span class="id">x</span>) <span class="kwd">as</span> [-&gt;]; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.wf_env_rem">wf_env_rem</a></span> <span class="kwd">in</span> <span class="id">Hwf</span>; <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.SDfuns.html#rem_bss">rem_bss</a></span> <span class="kwd">in</span> <span class="id">Hwf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">IHk</span> <span class="kwd">in</span> <span class="id">Hwf</span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#nrem_rem_env">nrem_rem_env</a></span> <span class="kwd">in</span> <span class="id">Hwf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span>; <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#REM_env_eq">REM_env_eq</a></span>, <span class="id">Hin</span>, <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_eq_bot">rem_eq_bot</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span>; <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#REM_env_eq">REM_env_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">Hout</span> <span class="id">x</span>), <span class="id"><a href="Velus.Lustre.Denot.Cpo.Cpo_streams_type.html#rem_eq_bot">rem_eq_bot</a></span>; <span class="id">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">now</span> <span class="id">rewrite</span> <span class="id"><a href="Velus.Lustre.Denot.Cpo_ext.DS_ext.html#nrem_rem_env">nrem_rem_env</a></span>.<br/>
Qed.</div></details>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE.Abs_aligned">Abs_aligned</a></span>.<br/>
<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE">LDENOTSAFE</a></span>.<br/>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="LdenotsafeFun">LdenotsafeFun</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ids</span>   : <span class="id"><a href="Velus.Common.Common.html#IDS">IDS</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Op</span>    : <span class="id"><a href="Velus.Operators.html#OPERATORS">OPERATORS</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">OpAux</span> : <span class="id"><a href="Velus.Operators.html#OPERATORS_AUX">OPERATORS_AUX</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op">Op</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Cks</span>   : <span class="id"><a href="Velus.Clocks.html#CLOCKS">CLOCKS</a></span>        <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpAux">OpAux</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Senv</span>  : <span class="id"><a href="Velus.Lustre.StaticEnv.html#STATICENV">STATICENV</a></span>     <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks">Cks</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Syn</span>   : <span class="id"><a href="Velus.Lustre.LSyntax.html#LSYNTAX">LSYNTAX</a></span>       <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv">Senv</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Typ</span>   : <span class="id"><a href="Velus.Lustre.LTyping.html#LTYPING">LTYPING</a></span>       <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn">Syn</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Restr</span> : <span class="id"><a href="Velus.Lustre.Denot.Restr.html#LRESTR">LRESTR</a></span>        <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn">Syn</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Cl</span>    : <span class="id"><a href="Velus.Lustre.LClocking.html#LCLOCKING">LCLOCKING</a></span>     <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn">Syn</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Lord</span>  : <span class="id"><a href="Velus.Lustre.LOrdered.html#LORDERED">LORDERED</a></span>      <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn">Syn</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Den</span>   : <span class="id"><a href="Velus.Lustre.Denot.SD.html#SD">SD</a></span>            <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn">Syn</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Lord">Lord</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ckop</span>  : <span class="id"><a href="Velus.Lustre.Denot.CheckOp.html#CHECKOP">CHECKOP</a></span>       <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn">Syn</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">OpErr</span> : <span class="id"><a href="Velus.Lustre.Denot.OpErr.html#OP_ERR">OP_ERR</a></span>        <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn">Syn</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ">Typ</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Restr">Restr</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Lord">Lord</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den">Den</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Ckop">Ckop</a></span>)<br/>
&lt;: <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE">LDENOTSAFE</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn">Syn</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ">Typ</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Restr">Restr</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl">Cl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Lord">Lord</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den">Den</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Ckop">Ckop</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr">OpErr</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Include</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LDENOTSAFE">LDENOTSAFE</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cks">Cks</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Senv">Senv</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Syn">Syn</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Typ">Typ</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Restr">Restr</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Cl">Cl</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Lord">Lord</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Den">Den</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#Ckop">Ckop</a></span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#OpErr">OpErr</a></span>.<br/>
<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.Denot.Safe.html#LdenotsafeFun">LdenotsafeFun</a></span>.<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
