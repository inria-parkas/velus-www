
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Correctness</title>
<meta name="description" content="Documentation of Coq module Correctness" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Correctness</h1>
<div class="coq">
<span class="kwd">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html">List</a></span>.<br/>
<span class="kwd">Import</span> <span class="id">List.ListNotations</span>.<br/>
<span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">list_scope</span>.<br/>
<span class="kwd">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Setoids.Setoid.html">Setoid</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.Morphisms.html">Morphisms</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.omega.Omega.html">Omega</a></span>.<br/>
<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Common.Common.html">Common</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Operators.html">Operators</a></span> <span class="id"><a href="Velus.Environment.html">Environment</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Clocks.html">Clocks</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.CoindStreams.html">CoindStreams</a></span> <span class="id"><a href="Velus.IndexedStreams.html">IndexedStreams</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.CoindIndexed.html">CoindIndexed</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Lustre.LSyntax.html">Lustre.LSyntax</a></span> <span class="id"><a href="Velus.Lustre.LOrdered.html">Lustre.LOrdered</a></span> <span class="id"><a href="Velus.Lustre.LTyping.html">Lustre.LTyping</a></span> <span class="id"><a href="Velus.Lustre.LClocking.html">Lustre.LClocking</a></span> <span class="id"><a href="Velus.Lustre.LCausality.html">Lustre.LCausality</a></span> <span class="id"><a href="Velus.Lustre.LSemantics.html">Lustre.LSemantics</a></span> <span class="id"><a href="Velus.Lustre.LClockSemantics.html">Lustre.LClockSemantics</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Lustre.Normalization.Fresh.html">Lustre.Normalization.Fresh</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Normalization.html">Lustre.Normalization.Normalization</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Lustre.Normalization.NTyping.html">Lustre.Normalization.NTyping</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NClocking.html">Lustre.Normalization.NClocking</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Lustre.Normalization.NCausality.html">Lustre.Normalization.NCausality</a></span>.<br/>
<br/>
<h1> Correctness of the Normalization </h1>
<br/>
<span class="kwd">Module</span> <span class="kwd">Type</span> <span class="id"><a name="CORRECTNESS">CORRECTNESS</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Ids</span> : <span class="id"><a href="Velus.Common.Common.html#IDS">IDS</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Op</span> : <span class="id"><a href="Velus.Operators.html#OPERATORS">OPERATORS</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">OpAux</span> : <span class="id"><a href="Velus.Operators.html#OPERATORS_AUX">OPERATORS_AUX</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op">Op</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">CStr</span> : <span class="id"><a href="Velus.CoindStreams.html#COINDSTREAMS">COINDSTREAMS</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux">OpAux</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">IStr</span> : <span class="id"><a href="Velus.IndexedStreams.html#INDEXEDSTREAMS">INDEXEDSTREAMS</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux">OpAux</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Syn</span> : <span class="id"><a href="Velus.Lustre.LSyntax.html#LSYNTAX">LSYNTAX</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op">Op</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">LCA</span>        : <span class="id"><a href="Velus.Lustre.LCausality.html#LCAUSALITY">LCAUSALITY</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn">Syn</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Ty</span> : <span class="id"><a href="Velus.Lustre.LTyping.html#LTYPING">LTYPING</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn">Syn</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Cl</span> : <span class="id"><a href="Velus.Lustre.LClocking.html#LCLOCKING">LCLOCKING</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn">Syn</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Ord</span> : <span class="id"><a href="Velus.Lustre.LOrdered.html#LORDERED">LORDERED</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn">Syn</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Sem</span> : <span class="id"><a href="Velus.Lustre.LSemantics.html#LSEMANTICS">LSEMANTICS</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn">Syn</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ord">Ord</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr">CStr</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">LCS</span> : <span class="id"><a href="Velus.Lustre.LClockSemantics.html#LCLOCKSEMANTICS">LCLOCKSEMANTICS</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn">Syn</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl">Cl</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCA">LCA</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ord">Ord</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr">CStr</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#IStr">IStr</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem">Sem</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Norm</span> : <span class="id"><a href="Velus.Lustre.Normalization.Normalization.html#NORMALIZATION">NORMALIZATION</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn">Syn</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCA">LCA</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Import</span> <span class="id">Fresh</span> <span class="id">Tactics</span> <span class="id">Unnesting</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Module</span> <span class="kwd">Import</span> <span class="id"><a name="CORRECTNESS.Typing">Typing</a></span> := <span class="id"><a href="Velus.Lustre.Normalization.NTyping.html#NTypingFun">NTypingFun</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn">Syn</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCA">LCA</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty">Ty</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm">Norm</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Module</span> <span class="kwd">Import</span> <span class="id"><a name="CORRECTNESS.Clocking">Clocking</a></span> := <span class="id"><a href="Velus.Lustre.Normalization.NClocking.html#NClockingFun">NClockingFun</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn">Syn</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCA">LCA</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl">Cl</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm">Norm</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Module</span> <span class="kwd">Import</span> <span class="id"><a name="CORRECTNESS.Causality">Causality</a></span> := <span class="id"><a href="Velus.Lustre.Normalization.NCausality.html#NCausalityFun">NCausalityFun</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn">Syn</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCA">LCA</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl">Cl</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm">Norm</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Import</span> <span class="id">List</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">CoFixpoint</span> <span class="id"><a name="CORRECTNESS.default_stream">default_stream</a></span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux.value">OpAux.value</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux.absent">absent</a></span> ⋅ <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#default_stream">default_stream</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.unnest_exp_sem_length">unnest_exp_sem_length</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">vars</span> <span class="id">e</span> <span class="id">is_control</span> <span class="id">es</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_exp">wt_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_tys">Typing.st_tys</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_exp">unnest_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#is_control">is_control</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id">es</span>', <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="kwd">forall</span> <span class="id">v</span> <span class="id">H</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span> = 1) <span class="id">es</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1')">Proof.</div>
<div class="proofscript" id="proof1">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hwt</span> <span class="id">Hnorm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_exp_numstreams">unnest_exp_numstreams</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hnorm</span>) <span class="kwd">as</span> <span class="id">Hnumstreams</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_exp_wt">unnest_exp_wt</a></span> <span class="kwd">in</span> <span class="id">Hnorm</span> <span class="kwd">as</span> [<span class="id">Hwt</span>' <span class="id">_</span>]; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">rewrite_Forall_forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id">Hnumstreams</span> <span class="id">_</span> <span class="id">H</span>). <span class="tactic">specialize</span> (<span class="id">Hwt</span>' <span class="id">_</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hnumstreams</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_numstreams">sem_exp_numstreams</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">Some additional stuff </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Import</span> <span class="id">Permutation</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.fresh_ident_refines">fresh_ident_refines</a></span> {<span class="id">B</span> <span class="id">V</span>} : <span class="kwd">forall</span> <span class="id">vars</span> <span class="id">H</span> <span class="id">H</span>' <span class="id">a</span> <span class="id">id</span> (<span class="id">v</span> : <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#V">V</a></span>) (<span class="id">st</span> <span class="id">st</span>' : <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.fresh_st">fresh_st</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#B">B</a></span>) <span class="id">reu</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reu">reu</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.fresh_ident">fresh_ident</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ids.norm1">norm1</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#a">a</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#id">id</a></span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H</span>' = <span class="id"><a href="Velus.Environment.html#Env.add">Env.add</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#id">id</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id">H</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2')">Proof with</div>
<div class="proofscript" id="proof2">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hvalid</span> <span class="id">Hdom</span> <span class="id">Hfresh</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id">st</span>' (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id">vars</span>) <span class="id">reu</span>) <span class="kwd">as</span> <span class="id">Hvalid</span>' <span class="tactic">by</span> <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.refines_add">Env.refines_add</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">contra</span>. <span class="id">erewrite</span> <span class="id"><a href="Velus.Environment.html#Env.dom_use">Env.dom_use</a></span> <span class="kwd">in</span> <span class="id">contra</span>; [| <span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_or">in_app_or</a></span> <span class="kwd">in</span> <span class="id">contra</span>. <span class="tactic">destruct</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.Facts.fresh_ident_In">Facts.fresh_ident_In</a></span> <span class="kwd">in</span> <span class="id">Hfresh</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">id</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id">st</span>')).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span>, <span class="id"><a href="Velus.Common.Common.html#idty">idty</a></span>. <span class="tactic">repeat</span> <span class="id">simpl_In</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> (<span class="id">id</span>, <span class="id">a</span>); <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_valid_reuse_NoDup">st_valid_reuse_NoDup</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_In">NoDup_app_In</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>'; [|<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hvalid</span>'; <span class="tactic">clear</span> <span class="id">Hvalid</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_or_app">in_or_app</a></span>; <span class="tactic">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonPS.html#ps_of_list_ps_to_list">ps_of_list_ps_to_list</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.Facts.fresh_ident_reuse_nIn">Facts.fresh_ident_reuse_nIn</a></span> <span class="kwd">in</span> <span class="id">Hfresh</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.idents_for_anns_NoDupMembers">idents_for_anns_NoDupMembers</a></span> : <span class="kwd">forall</span> <span class="id">anns</span> <span class="id">ids</span> <span class="id">st</span> <span class="id">st</span>' <span class="id">aft</span> <span class="id">reu</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#aft">aft</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reu">reu</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.idents_for_anns">idents_for_anns</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#anns">anns</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ids">ids</a></span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ids">ids</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3')">Proof.</div>
<div class="proofscript" id="proof3">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hvalid</span> <span class="id">Hids</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.idents_for_anns_st_valid_reuse">idents_for_anns_st_valid_reuse</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.idents_for_anns_vars_perm">idents_for_anns_vars_perm</a></span> <span class="kwd">in</span> <span class="id">Hids</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_valid_reuse_NoDup">st_valid_reuse_NoDup</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_l">NoDup_app_l</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#fst_NoDupMembers">fst_NoDupMembers</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hids</span> <span class="kwd">in</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_l">NoDup_app_l</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.idents_for_anns_nIn">idents_for_anns_nIn</a></span> : <span class="kwd">forall</span> <span class="id">anns</span> <span class="id">ids</span> <span class="id">st</span> <span class="id">st</span>' <span class="id">aft</span> <span class="id">reu</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#aft">aft</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reu">reu</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.idents_for_anns">idents_for_anns</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#anns">anns</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ids">ids</a></span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">id</span> =&gt; ~<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#id">id</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>)) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ids">ids</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4')">Proof.</div>
<div class="proofscript" id="proof4">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hvalid</span> <span class="id">Hids</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.idents_for_anns_st_valid_reuse">idents_for_anns_st_valid_reuse</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_valid_reuse_NoDup">st_valid_reuse_NoDup</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_l">NoDup_app_l</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.idents_for_anns_vars_perm">idents_for_anns_vars_perm</a></span> <span class="kwd">in</span> <span class="id">Hids</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hids</span> <span class="kwd">in</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>. <span class="tactic">intros</span> <span class="id">x</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_In">NoDup_app_In</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.idents_for_anns_dom">idents_for_anns_dom</a></span> {<span class="id">V</span>} : <span class="kwd">forall</span> <span class="id">vars</span> <span class="id">H</span> <span class="id">H</span>' <span class="id">anns</span> <span class="id">ids</span> (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#V">V</a></span>) <span class="id">st</span> <span class="id">st</span>' <span class="id">reu</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ids">ids</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reu">reu</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.idents_for_anns">idents_for_anns</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#anns">anns</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ids">ids</a></span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H</span>' = <span class="id"><a href="Velus.Environment.html#Env.adds">Env.adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ids">ids</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id">H</span>' (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id">st</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5')">Proof with</div>
<div class="proofscript" id="proof5">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hlen</span> <span class="id">Hvalid</span> <span class="id">Hdom</span> <span class="id">Hids</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.idents_for_anns_vars_perm">idents_for_anns_vars_perm</a></span> <span class="kwd">in</span> <span class="id">Hids</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_adds">Env.dom_adds</a></span> <span class="kwd">with</span> (<span class="id">ids0</span>:=<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">ids</span>) (<span class="id">vs0</span>:=<span class="id">vs</span>) <span class="kwd">in</span> <span class="id">Hdom</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2:(<span class="tactic">repeat</span> <span class="id">rewrite_Forall_forall</span>; <span class="id">solve_length</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_Permutation">Env.dom_Permutation</a></span>; [|<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_app_comm">Permutation_app_comm</a></span>. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_app_head">Permutation_app_head</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_app_comm">Permutation_app_comm</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.idents_for_anns_refines">idents_for_anns_refines</a></span> {<span class="id">V</span>} : <span class="kwd">forall</span> <span class="id">vars</span> <span class="id">H</span> <span class="id">H</span>' <span class="id">anns</span> <span class="id">ids</span> (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#V">V</a></span>) <span class="id">st</span> <span class="id">st</span>' <span class="id">reu</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ids">ids</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reu">reu</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.idents_for_anns">idents_for_anns</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#anns">anns</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ids">ids</a></span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H</span>' = <span class="id"><a href="Velus.Environment.html#Env.adds">Env.adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ids">ids</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id">H</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof6')">Proof with</div>
<div class="proofscript" id="proof6">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hlen</span> <span class="id">Hvalid</span> <span class="id">Hdom</span> <span class="id">Hids</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">id</span> =&gt; ~<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#id">id</a></span> <span class="id">vars</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">ids</span>)) <span class="kwd">as</span> <span class="id">Hnvar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id">st</span>' (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id">vars</span>) <span class="id">reu</span>) <span class="tactic">by</span> <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.idents_for_anns_incl_ids">idents_for_anns_incl_ids</a></span> <span class="kwd">in</span> <span class="id">Hids</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_forall</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">i</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">ids</span>)) <span class="tactic">by</span> (<span class="id">simpl_In</span>; <span class="tactic">exists</span> (<span class="id">i</span>, <span class="id">a</span>); <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hids</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_valid_reuse_NoDup">st_valid_reuse_NoDup</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_In">NoDup_app_In</a></span> <span class="kwd">in</span> <span class="id">H0</span>; [|<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_or_app">in_or_app</a></span>. <span class="tactic">left</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonPS.html#ps_of_list_ps_to_list">ps_of_list_ps_to_list</a></span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heq</span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.refines_adds">Env.refines_adds</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.idents_for_anns_nIn">idents_for_anns_nIn</a></span> <span class="kwd">in</span> <span class="id">Hids</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> *. <span class="tactic">intros</span> <span class="id">x1</span> <span class="id">Hin</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="Velus.Environment.html#Env.dom_use">Env.dom_use</a></span> <span class="kwd">in</span> <span class="id">contra</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_or">in_app_or</a></span> <span class="kwd">in</span> <span class="id">contra</span>; <span class="tactic">destruct</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Hnvar</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Hids</span>...<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id">idents_for_anns</span>'<span class="id">_NoDupMembers</span> : <span class="kwd">forall</span> <span class="id">anns</span> <span class="id">ids</span> <span class="id">st</span> <span class="id">st</span>' <span class="id">aft</span> <span class="id">reusable</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_streams">Syn.anon_streams</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#anns">anns</a></span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#aft">aft</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_streams">Syn.anon_streams</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#anns">anns</a></span>)) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">idents_for_anns</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#anns">anns</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ids">ids</a></span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ids">ids</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7')">Proof.</div>
<div class="proofscript" id="proof7">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">anns</span> <span class="id">ids</span> <span class="id">st</span> <span class="id">st</span>' <span class="id">aft</span> <span class="id">reusable</span> <span class="id">Hndup</span> <span class="id">Hvalid</span> <span class="id">Hids</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">idents_for_anns</span>'<span class="id">_st_valid</span> <span class="kwd">in</span> <span class="id">Hvalid</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">idents_for_anns</span>'<span class="id">_vars_perm</span> <span class="kwd">in</span> <span class="id">Hids</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_valid_reuse_NoDup">st_valid_reuse_NoDup</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_l">NoDup_app_l</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#fst_NoDupMembers">fst_NoDupMembers</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hids</span> <span class="kwd">in</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_l">NoDup_app_l</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id">idents_for_anns</span>'<span class="id">_nIn</span> : <span class="kwd">forall</span> <span class="id">anns</span> <span class="id">ids</span> <span class="id">st</span> <span class="id">st</span>' <span class="id">aft</span> <span class="id">reusable</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_streams">Syn.anon_streams</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#anns">anns</a></span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#aft">aft</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_streams">Syn.anon_streams</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#anns">anns</a></span>)) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">idents_for_anns</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#anns">anns</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ids">ids</a></span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">id</span> =&gt; ~<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#id">id</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>)) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ids">ids</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof8')">Proof.</div>
<div class="proofscript" id="proof8">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">anns</span> <span class="id">ids</span> <span class="id">st</span> <span class="id">st</span>' <span class="id">aft</span> <span class="id">reusable</span> <span class="id">Hndup</span> <span class="id">Hvalid</span> <span class="id">Hids</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">idents_for_anns</span>'<span class="id">_st_valid</span> <span class="kwd">in</span> <span class="id">Hvalid</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_valid_reuse_NoDup">st_valid_reuse_NoDup</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_l">NoDup_app_l</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">idents_for_anns</span>'<span class="id">_vars_perm</span> <span class="kwd">in</span> <span class="id">Hids</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hids</span> <span class="kwd">in</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>. <span class="tactic">intros</span> <span class="id">x</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_In">NoDup_app_In</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id">idents_for_anns</span>'<span class="id">_nIn</span>' : <span class="kwd">forall</span> <span class="id">anns</span> <span class="id">ids</span> <span class="id">st</span> <span class="id">st</span>' <span class="id">aft</span> <span class="id">reusable</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_streams">Syn.anon_streams</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#anns">anns</a></span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#aft">aft</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_streams">Syn.anon_streams</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#anns">anns</a></span>)) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">idents_for_anns</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#anns">anns</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ids">ids</a></span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">id</span> =&gt; ~<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#id">id</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.to_list">PSP.to_list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#aft">aft</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>)) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ids">ids</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9')">Proof.</div>
<div class="proofscript" id="proof9">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">anns</span> <span class="id">ids</span> <span class="id">st</span> <span class="id">st</span>' <span class="id">aft</span> <span class="id">reusable</span> <span class="id">Hndup</span> <span class="id">Hvalid</span> <span class="id">Hids</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">idents_for_anns</span>'<span class="id">_st_valid</span> <span class="kwd">in</span> <span class="id">Hvalid</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_valid_reuse_NoDup">st_valid_reuse_NoDup</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">idents_for_anns</span>'<span class="id">_vars_perm</span> <span class="kwd">in</span> <span class="id">Hids</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hids</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_app_comm">Permutation_app_comm</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Permutation_swap">Permutation_swap</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>. <span class="tactic">intros</span> <span class="id">x</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_In">NoDup_app_In</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#not_In_app">not_In_app</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#not_In_app">not_In_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hvalid</span> <span class="kwd">as</span> (?&amp;?&amp;?); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id">idents_for_anns</span>'<span class="id">_dom</span> {<span class="id">V</span>} : <span class="kwd">forall</span> <span class="id">vars</span> <span class="id">H</span> <span class="id">H</span>' <span class="id">anns</span> <span class="id">ids</span> (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#V">V</a></span>) <span class="id">st</span> <span class="id">st</span>' <span class="id">reu</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ids">ids</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reu">reu</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">idents_for_anns</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#anns">anns</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ids">ids</a></span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H</span>' = <span class="id"><a href="Velus.Environment.html#Env.adds">Env.adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ids">ids</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id">H</span>' (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id">st</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10')">Proof with</div>
<div class="proofscript" id="proof10">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hlen</span> <span class="id">Hvalid</span> <span class="id">Hdom</span> <span class="id">Hids</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">idents_for_anns</span>'<span class="id">_vars_perm</span> <span class="kwd">in</span> <span class="id">Hids</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_adds">Env.dom_adds</a></span> <span class="kwd">with</span> (<span class="id">ids0</span>:=<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">ids</span>) (<span class="id">vs0</span>:=<span class="id">vs</span>) <span class="kwd">in</span> <span class="id">Hdom</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2:(<span class="tactic">repeat</span> <span class="id">rewrite_Forall_forall</span>; <span class="id">solve_length</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_Permutation">Env.dom_Permutation</a></span>; [|<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_app_comm">Permutation_app_comm</a></span>. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_app_head">Permutation_app_head</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_app_comm">Permutation_app_comm</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.reuse_ident_refines">reuse_ident_refines</a></span> {<span class="id">B</span> <span class="id">V</span>} : <span class="kwd">forall</span> <span class="id">vars</span> <span class="id">H</span> <span class="id">H</span>' <span class="id">a</span> <span class="id">id</span> (<span class="id">v</span> : <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#V">V</a></span>) (<span class="id">st</span> <span class="id">st</span>' : <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.fresh_st">fresh_st</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#B">B</a></span>) <span class="id">reusable</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~<span class="id"><a href="Velus.Common.CommonPS.html#PS.In">PS.In</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#id">id</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) (<span class="id"><a href="Velus.Common.CommonPS.html#PS.add">PS.add</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#id">id</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.reuse_ident">reuse_ident</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#id">id</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#a">a</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H</span>' = <span class="id"><a href="Velus.Environment.html#Env.add">Env.add</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#id">id</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id">H</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof11')">Proof with</div>
<div class="proofscript" id="proof11">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hnin</span> <span class="id">Hvalid</span> <span class="id">Hdom</span> <span class="id">Hreuse</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id">st</span>' (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id">vars</span>) <span class="id">reusable</span>) <span class="kwd">as</span> <span class="id">Hvalid</span>' <span class="tactic">by</span> <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.refines_add">Env.refines_add</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">contra</span>. <span class="id">erewrite</span> <span class="id"><a href="Velus.Environment.html#Env.dom_use">Env.dom_use</a></span> <span class="kwd">in</span> <span class="id">contra</span>; [| <span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_or">in_app_or</a></span> <span class="kwd">in</span> <span class="id">contra</span>. <span class="tactic">destruct</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.Facts.reuse_ident_In">Facts.reuse_ident_In</a></span> <span class="kwd">in</span> <span class="id">Hreuse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">id</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id">st</span>')).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span>, <span class="id"><a href="Velus.Common.Common.html#idty">idty</a></span>. <span class="tactic">repeat</span> <span class="id">simpl_In</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> (<span class="id">id</span>, <span class="id">a</span>); <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_valid_reuse_NoDup">st_valid_reuse_NoDup</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_In">NoDup_app_In</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>'; [|<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hvalid</span>', <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_or_app">in_or_app</a></span>; <span class="tactic">clear</span> <span class="id">Hvalid</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonPS.html#ps_of_list_ps_to_list">ps_of_list_ps_to_list</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.Facts.st_valid_reuse_nIn">Facts.st_valid_reuse_nIn</a></span>, <span class="id"><a href="Velus.Common.CommonPS.html#PS_For_all_add">PS_For_all_add</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span> <span class="kwd">as</span> [? <span class="id">_</span>]...<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id">idents_for_anns</span>'<span class="id">_refines</span> {<span class="id">V</span>} : <span class="kwd">forall</span> <span class="id">vars</span> <span class="id">H</span> <span class="id">H</span>' <span class="id">anns</span> <span class="id">ids</span> (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#V">V</a></span>) <span class="id">st</span> <span class="id">st</span>' <span class="id">reusable</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ids">ids</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_streams">Syn.anon_streams</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#anns">anns</a></span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_streams">Syn.anon_streams</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#anns">anns</a></span>)) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">idents_for_anns</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#anns">anns</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ids">ids</a></span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H</span>' = <span class="id"><a href="Velus.Environment.html#Env.adds">Env.adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ids">ids</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id">H</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof12')">Proof with</div>
<div class="proofscript" id="proof12">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">vars</span> <span class="id">H</span> <span class="id">H</span>' <span class="id">anns</span> <span class="id">ids</span> <span class="id">vs</span> <span class="id">st</span> <span class="id">st</span>' <span class="id">reusable</span> <span class="id">Hndup</span> <span class="id">Hlen</span> <span class="id">Hvalid</span> <span class="id">Hdom</span> <span class="id">Hids</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">id</span> =&gt; ~<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#id">id</a></span> <span class="id">vars</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">ids</span>)) <span class="kwd">as</span> <span class="id">Hnvar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id">st</span>' (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id">vars</span>) <span class="id">reusable</span>) <span class="tactic">by</span> <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">idents_for_anns</span>'<span class="id">_incl_ids</span> <span class="kwd">in</span> <span class="id">Hids</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_forall</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">i</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">ids</span>)) <span class="tactic">by</span> (<span class="id">simpl_In</span>; <span class="tactic">exists</span> (<span class="id">i</span>, (<span class="id">t</span>, (<span class="id">c</span>, <span class="id">o</span>))); <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hids</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_valid_reuse_NoDup">st_valid_reuse_NoDup</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_In">NoDup_app_In</a></span> <span class="kwd">in</span> <span class="id">H0</span>; [|<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_or_app">in_or_app</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonPS.html#ps_of_list_ps_to_list">ps_of_list_ps_to_list</a></span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heq</span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.refines_adds">Env.refines_adds</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">idents_for_anns</span>'<span class="id">_nIn</span> <span class="kwd">in</span> <span class="id">Hids</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> *. <span class="tactic">intros</span> <span class="id">x1</span> <span class="id">Hin</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="Velus.Environment.html#Env.dom_use">Env.dom_use</a></span> <span class="kwd">in</span> <span class="id">contra</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_or">in_app_or</a></span> <span class="kwd">in</span> <span class="id">contra</span>; <span class="tactic">destruct</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Hnvar</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Hids</span>...<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.fresh_ident_dom">fresh_ident_dom</a></span> {<span class="id">B</span> <span class="id">V</span>} : <span class="kwd">forall</span> <span class="id">pref</span> <span class="id">vars</span> <span class="id">H</span> <span class="id">H</span>' <span class="id">a</span> <span class="id">id</span> (<span class="id">v</span> : <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#V">V</a></span>) (<span class="id">st</span> <span class="id">st</span>' : <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.fresh_st">fresh_st</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#B">B</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.fresh_ident">fresh_ident</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#pref">pref</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#a">a</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#id">id</a></span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H</span>' = <span class="id"><a href="Velus.Environment.html#Env.add">Env.add</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#id">id</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id">H</span>' (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id">st</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof13')">Proof.</div>
<div class="proofscript" id="proof13">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hdom</span> <span class="id">Hfresh</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.Facts.fresh_ident_vars_perm">Facts.fresh_ident_vars_perm</a></span> <span class="kwd">in</span> <span class="id">Hfresh</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_add_cons">Env.dom_add_cons</a></span> <span class="kwd">with</span> (<span class="id">x</span>:=<span class="id">id</span>) (<span class="id">v0</span>:=<span class="id">v</span>) <span class="kwd">in</span> <span class="id">Hdom</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_Permutation">Env.dom_Permutation</a></span>; [| <span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_middle">Permutation_middle</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_app_head">Permutation_app_head</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.reuse_ident_dom">reuse_ident_dom</a></span> {<span class="id">B</span> <span class="id">V</span>} : <span class="kwd">forall</span> <span class="id">vars</span> <span class="id">H</span> <span class="id">H</span>' <span class="id">a</span> <span class="id">id</span> (<span class="id">v</span> : <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#V">V</a></span>) (<span class="id">st</span> <span class="id">st</span>' : <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.fresh_st">fresh_st</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#B">B</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.reuse_ident">reuse_ident</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#id">id</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#a">a</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H</span>' = <span class="id"><a href="Velus.Environment.html#Env.add">Env.add</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#id">id</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id">H</span>' (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id">st</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof14')">Proof.</div>
<div class="proofscript" id="proof14">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">vars</span> <span class="id">H</span> <span class="id">H</span>' <span class="id">a</span> <span class="id">id</span> <span class="id">v</span> <span class="id">st</span> <span class="id">st</span>' <span class="id">Hdom</span> <span class="id">Hfresh</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.Facts.reuse_ident_vars_perm">Facts.reuse_ident_vars_perm</a></span> <span class="kwd">in</span> <span class="id">Hfresh</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_add_cons">Env.dom_add_cons</a></span> <span class="kwd">with</span> (<span class="id">x</span>:=<span class="id">id</span>) (<span class="id">v0</span>:=<span class="id">v</span>) <span class="kwd">in</span> <span class="id">Hdom</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.dom_Permutation">Env.dom_Permutation</a></span>; [| <span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_middle">Permutation_middle</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_app_head">Permutation_app_head</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<h2> Conservation of sem_exp </h2>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.unnest_reset_sem">unnest_reset_sem</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">vars</span> <span class="id">b</span> <span class="id">e</span> <span class="id">H</span> <span class="id">v</span> <span class="id">e</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>' <span class="id">reusable</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#LiftO">LiftO</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span> (<span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="kwd">forall</span> <span class="id">e</span>' <span class="id">eqs</span>' <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_exp">unnest_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = ([<span class="id">e</span>'], <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id">H</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id">st</span>' (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id">H</span>' (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id">st</span>') /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id">e</span>' [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>] /\ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span>) <span class="id">eqs</span>') <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#LiftO">LiftO</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.wl_exp">wl_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#LiftO">LiftO</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span> (<span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.numstreams">numstreams</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> = 1) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#LiftO">LiftO</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span> (<span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>]) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="kwd">match</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> <span class="kwd">with</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; [] | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">e</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_in">fresh_in</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span>) <span class="kwd">end</span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_reset">unnest_reset</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_exp">unnest_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id">e</span>', <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">exists</span> <span class="id">H</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id">H</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id">st</span>' (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id">H</span>' (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id">st</span>') /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#LiftO">LiftO</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span> (<span class="kwd">fun</span> <span class="id">e</span>' =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id">e</span>' [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>]) <span class="id">e</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span>) <span class="id">eqs</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof15')">Proof with</div>
<div class="proofscript" id="proof15">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hun</span> <span class="id">Hwl</span> <span class="id">Hnum</span> <span class="id">Hsem</span> <span class="id">Hvalid</span> <span class="id">Histst</span> <span class="id">Hnorm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unnest_reset_spec</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l</span> = 1) <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_exp_length">unnest_exp_length</a></span> <span class="kwd">in</span> <span class="id">Hk0</span>; <span class="tactic">eauto</span>; <span class="tactic">congruence</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="id">singleton_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Hun</span> <span class="kwd">in</span> <span class="id">Hk0</span> <span class="kwd">as</span> [<span class="id">H</span>' [<span class="id">Href</span> [<span class="id">Hval</span> [<span class="id">Hdom</span> [<span class="id">Hsem1</span> <span class="id">Hsem2</span>]]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>'. <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">Hun</span> <span class="kwd">in</span> <span class="id">Hk0</span> <span class="kwd">as</span> [<span class="id">H</span>' [<span class="id">Href</span> [<span class="id">Hval</span> [<span class="id">Hdom</span> [<span class="id">Hsem1</span> <span class="id">Hsem2</span>]]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Href</span>':=<span class="id">Hfresh</span>); <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.fresh_ident_refines">fresh_ident_refines</a></span> <span class="kwd">in</span> <span class="id">Href</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> (<span class="id"><a href="Velus.Environment.html#Env.add">Env.add</a></span> <span class="id">x2</span> <span class="id">v</span> <span class="id">H</span>'). <span class="tactic">repeat</span> <span class="tactic">split</span>. 5:<span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etransitivity</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.fresh_ident_st_valid_reuse">fresh_ident_st_valid_reuse</a></span> <span class="kwd">in</span> <span class="id">Hfresh</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.fresh_ident_dom">fresh_ident_dom</a></span> <span class="kwd">in</span> <span class="id">Hfresh</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">repeat</span> <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">econstructor</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.add_1">Env.add_1</a></span>. 1,2:<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Seq">Seq</a></span> <span class="kwd">with</span> (<span class="id">ss</span>:=[[<span class="id">v</span>]]); <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="tactic">repeat</span> <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">econstructor</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.add_1">Env.add_1</a></span>. 1,2:<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">solve_forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation_refines">sem_equation_refines</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">exists</span> <span class="id">H</span>. <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Ltac</span> <span class="id">solve_incl</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">unfold</span> <span class="id"><a href="Velus.Common.Common.html#idty">idty</a></span>; <span class="tactic">repeat</span> <span class="tactic">unfold</span> <span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_nclock">wt_nclock</a></span> ?<span class="id">l1</span> ?<span class="id">ck</span> |- <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_nclock">wt_nclock</a></span> ?<span class="id">l2</span> ?<span class="id">ck</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_nclock_incl">wt_nclock_incl</a></span>; [| <span class="tactic">eauto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="Velus.Clocks.html#wc_clock">wc_clock</a></span> ?<span class="id">l1</span> ?<span class="id">ck</span> |- <span class="id"><a href="Velus.Clocks.html#wc_clock">wc_clock</a></span> ?<span class="id">l2</span> ?<span class="id">ck</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_clock_incl">wc_clock_incl</a></span>; [| <span class="tactic">eauto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_exp">wt_exp</a></span> ?<span class="id">G</span> ?<span class="id">l1</span> ?<span class="id">e</span> |- <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_exp">wt_exp</a></span> ?<span class="id">G</span> ?<span class="id">l2</span> ?<span class="id">e</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_exp_incl">wt_exp_incl</a></span>; [| <span class="tactic">eauto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_exp">wc_exp</a></span> ?<span class="id">G</span> ?<span class="id">l1</span> ?<span class="id">e</span> |- <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_exp">wc_exp</a></span> ?<span class="id">G</span> ?<span class="id">l2</span> ?<span class="id">e</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_exp_incl">wc_exp_incl</a></span>; [| <span class="tactic">eauto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_equation">wt_equation</a></span> ?<span class="id">G</span> ?<span class="id">l1</span> ?<span class="id">eq</span> |- <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_equation">wt_equation</a></span> ?<span class="id">G</span> ?<span class="id">l2</span> ?<span class="id">eq</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_equation_incl">wt_equation_incl</a></span>; [| <span class="tactic">eauto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_equation">wc_equation</a></span> ?<span class="id">G</span> ?<span class="id">l1</span> ?<span class="id">eq</span> |- <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_equation">wc_equation</a></span> ?<span class="id">G</span> ?<span class="id">l2</span> ?<span class="id">eq</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_equation_incl">wc_equation_incl</a></span>; [| <span class="tactic">eauto</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> ?<span class="id">l1</span> ?<span class="id">l1</span> =&gt; <span class="tactic">reflexivity</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> ?<span class="id">f</span> ?<span class="id">l1</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> ?<span class="id">f</span> ?<span class="id">l2</span>) =&gt; <span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#incl_map">incl_map</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> ?<span class="id">l1</span> (?<span class="id">l1</span> ++ ?<span class="id">l2</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_appl">incl_appl</a></span>; <span class="tactic">reflexivity</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> (?<span class="id">l1</span> ++ ?<span class="id">l2</span>) (?<span class="id">l1</span> ++ ?<span class="id">l3</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_app">incl_app</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> ?<span class="id">l1</span> (?<span class="id">l2</span> ++ ?<span class="id">l3</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_appr">incl_appr</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> ?<span class="id">l1</span> (?<span class="id">a</span>::?<span class="id">l2</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_tl">incl_tl</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_anns">st_anns</a></span> ?<span class="id">st1</span>) (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_anns">st_anns</a></span> <span class="id">_</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_follows_incl">st_follows_incl</a></span>; <span class="tactic">repeat</span> <span class="id">solve_st_follows</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_tys">st_tys</a></span> ?<span class="id">st1</span>) (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_tys">st_tys</a></span> <span class="id">_</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_follows_tys_incl">st_follows_tys_incl</a></span>; <span class="tactic">repeat</span> <span class="id">solve_st_follows</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_clocks">st_clocks</a></span> ?<span class="id">st1</span>) (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_clocks">st_clocks</a></span> <span class="id">_</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_follows_clocks_incl">st_follows_clocks_incl</a></span>; <span class="tactic">repeat</span> <span class="id">solve_st_follows</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.In_fresh_in_NoDup">In_fresh_in_NoDup</a></span> : <span class="kwd">forall</span> <span class="id">e</span> <span class="id">es</span> <span class="id">vars</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_ins">fresh_ins</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span>) ++ <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_in">fresh_in</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span>) ++ <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof16')">Proof.</div>
<div class="proofscript" id="proof16">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">es</span>; <span class="tactic">intros</span> <span class="id">vars</span> <span class="id">Hin</span> <span class="id">Hndup</span>; <span class="id">inv</span> <span class="id">Hin</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_ins">fresh_ins</a></span> <span class="kwd">in</span> <span class="id">Hndup</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hndup</span>; <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>, &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="kwd">in</span> <span class="id">Hndup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ndup_l</span> <span class="id">Hndup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">ndup_r</span> <span class="id">Hndup</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">In_fresh_in_NoDup</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.unnest_arrow_sem">unnest_arrow_sem</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">H</span> <span class="id">bs</span> <span class="id">e0s</span> <span class="id">es</span> <span class="id">anns</span> <span class="id">s0s</span> <span class="id">ss</span> <span class="id">os</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e0s">e0s</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#anns">anns</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#anns">anns</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#s">s</a></span>]) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e0s">e0s</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#s0s">s0s</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#s">s</a></span>]) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ss">ss</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#Forall3">Forall3</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.arrow">arrow</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#s0s">s0s</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ss">ss</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#os">os</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#s">s</a></span>]) (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_arrow">unnest_arrow</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e0s">e0s</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#anns">anns</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#os">os</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof17')">Proof with</div>
<div class="proofscript" id="proof17">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hlen1</span> <span class="id">Hlen2</span> <span class="id">Hsem1</span> <span class="id">Hsem2</span> <span class="id">Hfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_arrow">unnest_arrow</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">rewrite_Forall_forall</span>. 1:<span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">simpl_length</span>. <span class="tactic">repeat</span> <span class="id">simpl_nth</span>. <span class="id">Unshelve</span>. 2:<span class="tactic">exact</span> ((<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.hd_default">hd_default</a></span> [], <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.hd_default">hd_default</a></span> []), <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.default_ann">default_ann</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id">n</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#combine">combine</a></span> <span class="id">_</span> <span class="id">_</span>)) <span class="kwd">as</span> [[<span class="id">e0</span> <span class="id">e</span>] ?] <span class="id">eqn</span>:<span class="id">Hnth</span>. <span class="tactic">repeat</span> <span class="id">simpl_nth</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Sarrow">Sarrow</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="tactic">constructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="tactic">constructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">repeat</span> <span class="tactic">constructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Unshelve</span>. 1,2:<span class="tactic">exact</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.default_stream">default_stream</a></span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.unnest_fby_sem">unnest_fby_sem</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">H</span> <span class="id">bs</span> <span class="id">e0s</span> <span class="id">es</span> <span class="id">anns</span> <span class="id">s0s</span> <span class="id">ss</span> <span class="id">os</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e0s">e0s</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#anns">anns</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#anns">anns</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#s">s</a></span>]) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e0s">e0s</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#s0s">s0s</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#s">s</a></span>]) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ss">ss</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#Forall3">Forall3</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.fby">fby</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#s0s">s0s</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ss">ss</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#os">os</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#s">s</a></span>]) (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_fby">unnest_fby</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e0s">e0s</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#anns">anns</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#os">os</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof18')">Proof with</div>
<div class="proofscript" id="proof18">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hlen1</span> <span class="id">Hlen2</span> <span class="id">Hsem1</span> <span class="id">Hsem2</span> <span class="id">Hfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_fby">unnest_fby</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">rewrite_Forall_forall</span>. 1:<span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">simpl_length</span>. <span class="tactic">repeat</span> <span class="id">simpl_nth</span>. <span class="id">Unshelve</span>. 2:<span class="tactic">exact</span> ((<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.hd_default">hd_default</a></span> [], <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.hd_default">hd_default</a></span> []), <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.default_ann">default_ann</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id">n</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#combine">combine</a></span> <span class="id">_</span> <span class="id">_</span>)) <span class="kwd">as</span> [[<span class="id">e0</span> <span class="id">e</span>] ?] <span class="id">eqn</span>:<span class="id">Hnth</span>. <span class="tactic">repeat</span> <span class="id">simpl_nth</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Sfby">Sfby</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="tactic">constructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="tactic">constructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">repeat</span> <span class="tactic">constructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Unshelve</span>. 1,2:<span class="tactic">exact</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.default_stream">default_stream</a></span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.unnest_when_sem">unnest_when_sem</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">H</span> <span class="id">bs</span> <span class="id">es</span> <span class="id">tys</span> <span class="id">ckid</span> <span class="id">b</span> <span class="id">ck</span> <span class="id">s</span> <span class="id">ss</span> <span class="id">os</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#tys">tys</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#s">s</a></span>]) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ss">ss</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sem_var">sem_var</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ckid">ckid</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#s">s</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">s</span>' =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.when">when</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id">s</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#s">s</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ss">ss</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#os">os</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#s">s</a></span>]) (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_when">unnest_when</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ckid">ckid</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#tys">tys</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ck">ck</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#os">os</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof19')">Proof with</div>
<div class="proofscript" id="proof19">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hlen</span> <span class="id">Hsem</span> <span class="id">Hvar</span> <span class="id">Hwhen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_when">unnest_when</a></span>. <span class="id">simpl_forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">rewrite_Forall_forall</span>. 1:<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Swhen">Swhen</a></span> <span class="kwd">with</span> (<span class="id">ss</span>:=[[<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id">n</span> <span class="id">ss</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.default_stream">default_stream</a></span>]])...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="tactic">constructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span>... <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.unnest_merge_sem">unnest_merge_sem</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">H</span> <span class="id">bs</span> <span class="id">ets</span> <span class="id">efs</span> <span class="id">tys</span> <span class="id">ckid</span> <span class="id">ck</span> <span class="id">s</span> <span class="id">ts</span> <span class="id">fs</span> <span class="id">os</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ets">ets</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#tys">tys</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#efs">efs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#tys">tys</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#s">s</a></span>]) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ets">ets</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ts">ts</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#s">s</a></span>]) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#efs">efs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#fs">fs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sem_var">sem_var</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ckid">ckid</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#s">s</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#Forall3">Forall3</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.merge">merge</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#s">s</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ts">ts</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#fs">fs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#os">os</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#s">s</a></span>]) (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_merge">unnest_merge</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ckid">ckid</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ets">ets</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#efs">efs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#tys">tys</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ck">ck</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#os">os</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof20')">Proof with</div>
<div class="proofscript" id="proof20">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hlen1</span> <span class="id">Hlen2</span> <span class="id">Hsem1</span> <span class="id">Hsem2</span> <span class="id">Hvar</span> <span class="id">Hwhen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_merge">unnest_merge</a></span>. <span class="id">simpl_forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">rewrite_Forall_forall</span>. 1,2:<span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id">eqn</span>:<span class="id">Hnth</span>. <span class="tactic">destruct</span> <span class="id">a</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#combine_nth">combine_nth</a></span> <span class="kwd">in</span> <span class="id">Hnth</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>. <span class="id">inv</span> <span class="id">Hnth</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Smerge">Smerge</a></span> <span class="kwd">with</span> (<span class="id">ts</span>:=[[<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id">n</span> <span class="id">ts</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.default_stream">default_stream</a></span>]]) (<span class="id">fs</span>:=[[<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id">n</span> <span class="id">fs</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.default_stream">default_stream</a></span>]]); <span class="tactic">simpl</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="tactic">constructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H3</span>... <span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="tactic">constructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span>... <span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="tactic">constructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H6</span>... <span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.unnest_ite_sem">unnest_ite_sem</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">H</span> <span class="id">bs</span> <span class="id">e</span> <span class="id">ets</span> <span class="id">efs</span> <span class="id">tys</span> <span class="id">ck</span> <span class="id">s</span> <span class="id">ts</span> <span class="id">fs</span> <span class="id">os</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ets">ets</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#tys">tys</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#efs">efs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#tys">tys</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#s">s</a></span>] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#s">s</a></span>]) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ets">ets</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ts">ts</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#s">s</a></span>]) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#efs">efs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#fs">fs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#Forall3">Forall3</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.ite">ite</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#s">s</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ts">ts</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#fs">fs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#os">os</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">s</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#s">s</a></span>]) (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_ite">unnest_ite</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ets">ets</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#efs">efs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#tys">tys</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ck">ck</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#os">os</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof21')">Proof with</div>
<div class="proofscript" id="proof21">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hlen1</span> <span class="id">Hlen2</span> <span class="id">Hsem1</span> <span class="id">Hsem2</span> <span class="id">Hsem3</span> <span class="id">Hwhen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_ite">unnest_ite</a></span>. <span class="id">simpl_forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">rewrite_Forall_forall</span>. 1,2:<span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id">eqn</span>:<span class="id">Hnth</span>. <span class="tactic">destruct</span> <span class="id">a</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#combine_nth">combine_nth</a></span> <span class="kwd">in</span> <span class="id">Hnth</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>. <span class="id">inv</span> <span class="id">Hnth</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Site">Site</a></span> <span class="kwd">with</span> (<span class="id">ts</span>:=[[<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id">n</span> <span class="id">ts</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.default_stream">default_stream</a></span>]]) (<span class="id">fs</span>:=[[<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id">n</span> <span class="id">fs</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.default_stream">default_stream</a></span>]]); <span class="tactic">simpl</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="tactic">constructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H3</span>... <span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="tactic">constructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H1</span>... <span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="tactic">constructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H6</span>... <span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.sem_var_adds">sem_var_adds</a></span> : <span class="kwd">forall</span> <span class="id">H</span> <span class="id">xs</span> <span class="id">vs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#xs">xs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#xs">xs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sem_var">sem_var</a></span> (<span class="id"><a href="Velus.Environment.html#Env.adds">Env.adds</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#xs">xs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span>)) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#xs">xs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof22')">Proof.</div>
<div class="proofscript" id="proof22">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hlen</span> <span class="id">Hndup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite_Forall_forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">econstructor</span>; [|<span class="tactic">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.adds_MapsTo">Env.adds_MapsTo</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.map_bind2_sem">map_bind2_sem</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">vars</span> <span class="id">b</span> <span class="id">is_control</span> <span class="id">es</span> <span class="id">H</span> <span class="id">vs</span> <span class="id">es</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>' <span class="id">reusable</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_ins">fresh_ins</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span>)++<span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.wl_exp">wl_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_ins">fresh_ins</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span>)) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="kwd">forall</span> <span class="id">H</span> <span class="id">es</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>' <span class="id">reusable</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_in">fresh_in</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span>)++<span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.wl_exp">wl_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_in">fresh_in</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span>)) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_exp">unnest_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#is_control">is_control</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id">es</span>', <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">exists</span> <span class="id">H</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id">H</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id">st</span>' (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id">H</span>' (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id">st</span>') /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>]) <span class="id">es</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span>) <span class="id">eqs</span>')) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.map_bind2">map_bind2</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_exp">unnest_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#is_control">is_control</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id">es</span>', <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">exists</span> <span class="id">H</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id">H</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id">st</span>' (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id">H</span>' (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id">st</span>') /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">es</span> <span class="id">vs</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>]) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span>) <span class="id">es</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">eqs</span>')).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof23')">Proof with</div>
<div class="proofscript" id="proof23">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">es</span>; <span class="tactic">intros</span> * <span class="id">Hndup</span> <span class="id">Hwt</span> <span class="id">Hsem</span> <span class="id">Hvalid</span> <span class="id">Histst</span> <span class="id">Hf</span> <span class="id">Hmap</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hwt</span>; <span class="id">inv</span> <span class="id">Hsem</span>; <span class="id">inv</span> <span class="id">Hf</span>; <span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">exists</span> <span class="id">H</span>; <span class="tactic">simpl</span>. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_ins">fresh_ins</a></span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>, <span class="id"><a href="Velus.Common.CommonPS.html#ps_adds_app">ps_adds_app</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_ins">fresh_ins</a></span> <span class="id">es</span>)++<span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> <span class="id">reusable</span>)) <span class="kwd">as</span> <span class="id">Hndup2</span> <span class="tactic">by</span> <span class="id">ndup_r</span> <span class="id">Hndup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_in">fresh_in</a></span> <span class="id">a</span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_ins">fresh_ins</a></span> <span class="id">es</span>)) <span class="id">reusable</span>))) <span class="kwd">as</span> <span class="id">Hndup1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Permutation_PS_elements_ps_adds</span>'; <span class="id">ndup_simpl</span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id">H7</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hndup1</span> <span class="id">H2</span> <span class="id">H4</span> <span class="id">Hvalid</span> <span class="id">Histst</span> <span class="id">H0</span>) <span class="kwd">as</span> [<span class="id">H</span>' [<span class="id">Href1</span> [<span class="id">Hvalid1</span> [<span class="id">Histst1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1</span>']]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id">G</span> <span class="id">H</span>' <span class="id">b</span>) <span class="id">es</span> <span class="id">l</span>') <span class="kwd">as</span> <span class="id">Hsem</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">repeat</span> <span class="id">rewrite_Forall_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHes</span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">H</span>'' [<span class="id">Href2</span> [<span class="id">Hvalid2</span> [<span class="id">Histst2</span> [<span class="id">Hsem2</span> <span class="id">Hsem2</span>']]]]]...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">IHes</span> <span class="id">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>''. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etransitivity</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">constructor</span>; <span class="tactic">eauto</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x</span> = <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.numstreams">numstreams</a></span> <span class="id">a</span>) <span class="kwd">as</span> <span class="id">Hlength1</span> <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_exp_length">unnest_exp_length</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">y</span> = <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.numstreams">numstreams</a></span> <span class="id">a</span>) <span class="kwd">as</span> <span class="id">Hlength2</span> <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_numstreams">sem_exp_numstreams</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_app">Forall_app</a></span>. <span class="tactic">split</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation_refines">sem_equation_refines</a></span>...<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="CORRECTNESS.unnest_noops_exp_sem">unnest_noops_exp_sem</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">vars</span> <span class="id">b</span> <span class="id">ck</span> <span class="id">e</span> <span class="id">H</span> <span class="id">v</span> <span class="id">e</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>' <span class="id">reusable</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_noops_exp">unnest_noops_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ck">ck</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id">e</span>', <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">exists</span> <span class="id">H</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id">H</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id">st</span>' (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id">H</span>' (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id">st</span>') /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id">e</span>' [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>] /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span>) <span class="id">eqs</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof24')">Proof.</div>
<div class="proofscript" id="proof24">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_noops_exp">unnest_noops_exp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hvalid</span> <span class="id">Hdom</span> <span class="id">Hsem</span> <span class="id">Hunt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#hd">hd</a></span> <span class="id">_</span> <span class="id">_</span>) <span class="kwd">as</span> (?&amp;?&amp;?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.is_noops_exp">is_noops_exp</a></span> <span class="id">_</span> <span class="id">_</span>); <span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">exists</span> <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assert</span> (<span class="id">Hfresh</span>:=<span class="id">H0</span>). <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.fresh_ident_refines">fresh_ident_refines</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> (<span class="id"><a href="Velus.Environment.html#Env.add">Env.add</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">H</span>). <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.fresh_ident_dom">fresh_ident_dom</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">constructor</span>. <span class="tactic">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.add_1">Env.add_1</a></span>. 1,2:<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Seq">Seq</a></span> <span class="kwd">with</span> (<span class="id">ss</span>:=[[<span class="id">v</span>]]); <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">constructor</span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">constructor</span>; <span class="tactic">auto</span>. <span class="tactic">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.add_1">Env.add_1</a></span>. 1,2:<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="CORRECTNESS.unnest_noops_exps_sem">unnest_noops_exps_sem</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">vars</span> <span class="id">b</span> <span class="id">cks</span> <span class="id">es</span> <span class="id">H</span> <span class="id">vs</span> <span class="id">es</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>' <span class="id">reusable</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#cks">cks</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>]) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_noops_exps">unnest_noops_exps</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#cks">cks</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id">es</span>', <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">exists</span> <span class="id">H</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id">H</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id">st</span>' (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id">H</span>' (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id">st</span>') /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>]) <span class="id">es</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span>) <span class="id">eqs</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof25')">Proof.</div>
<div class="proofscript" id="proof25">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_noops_exps">unnest_noops_exps</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">cks</span>; <span class="tactic">intros</span> * <span class="id">Hlen</span> <span class="comment">(*&nbsp;Hnormed&nbsp;*)</span> <span class="comment">(*&nbsp;Hnum&nbsp;*)</span> <span class="id">Hvalid</span> <span class="id">Hdom</span> <span class="id">Hsem</span> <span class="id">Hunt</span>; <span class="tactic">repeat</span> <span class="id">inv_bind</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="tactic">destruct</span> <span class="id">es</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="id">inv</span> <span class="id">Hlen</span>; <span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hsem</span>. <span class="tactic">exists</span> <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_noops_exp_sem">unnest_noops_exp_sem</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> (<span class="id">H</span>'&amp;?&amp;?&amp;?&amp;?&amp;?); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id">G</span> <span class="id">H</span>' <span class="id">b</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>]) <span class="id">es</span> <span class="id">l</span>') <span class="kwd">as</span> <span class="id">Hsem</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">solve_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHcks</span> <span class="kwd">with</span> (<span class="id">st</span>:=<span class="id">x2</span>) <span class="kwd">in</span> <span class="id">Hsem</span>' <span class="kwd">as</span> (<span class="id">H</span>''&amp;?&amp;?&amp;?&amp;?&amp;?); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id">inv_bind</span>; <span class="tactic">repeat</span> <span class="tactic">eexists</span>; <span class="tactic">eauto</span>; <span class="id">inv_bind</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>''. <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etransitivity</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">constructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_app">Forall_app</a></span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation_refines">sem_equation_refines</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="kwd">Constructors</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#sem_exp">sem_exp</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.unnest_exp_sem">unnest_exp_sem</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">vars</span> <span class="id">b</span> <span class="id">e</span> <span class="id">H</span> <span class="id">vs</span> <span class="id">is_control</span> <span class="id">es</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>' <span class="id">reusable</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_in">fresh_in</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.wl_exp">wl_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_in">fresh_in</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span>)) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_exp">unnest_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#is_control">is_control</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id">es</span>', <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">exists</span> <span class="id">H</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id">H</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id">st</span>' (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id">H</span>' (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id">st</span>') /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>]) <span class="id">es</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span>) <span class="id">eqs</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof26')">Proof with</div>
<div class="proofscript" id="proof26">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">e</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.exp_ind2">exp_ind2</a></span>; <span class="tactic">intros</span> * <span class="id">Hndup</span> <span class="id">Hwl</span> <span class="id">Hsem</span> <span class="id">Hvalid</span> <span class="id">Histst</span> <span class="id">Hnorm</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hwl</span>; <span class="id">inv</span> <span class="id">Hsem</span>. 1-10:<span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;const&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;var&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;unop&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Htypeof</span>:=<span class="id">H0</span>). <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_exp_typeof">unnest_exp_typeof</a></span> <span class="kwd">in</span> <span class="id">Htypeof</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id">IHe</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hndup</span> <span class="id">H3</span> <span class="id">H8</span> <span class="id">Hvalid</span> <span class="id">Histst</span> <span class="id">H0</span>) <span class="kwd">as</span> [<span class="id">H</span>' [<span class="id">Href1</span> [<span class="id">Hvalid1</span> [<span class="id">Hdom1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1</span>']]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_exp_length">unnest_exp_length</a></span> <span class="kwd">in</span> <span class="id">H0</span>... <span class="tactic">rewrite</span> <span class="id">H5</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">singleton_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsem1</span>; <span class="tactic">clear</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>'. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">econstructor</span>... <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;binop&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>, <span class="id"><a href="Velus.Common.CommonPS.html#ps_adds_app">ps_adds_app</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Htypeof1</span>:=<span class="id">H0</span>). <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_exp_typeof">unnest_exp_typeof</a></span> <span class="kwd">in</span> <span class="id">Htypeof1</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Htypeof2</span>:=<span class="id">H1</span>). <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_exp_typeof">unnest_exp_typeof</a></span> <span class="kwd">in</span> <span class="id">Htypeof2</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_in">fresh_in</a></span> <span class="id">e1</span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_in">fresh_in</a></span> <span class="id">e2</span>)) <span class="id">reusable</span>))) <span class="kwd">as</span> <span class="id">Hndup1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Permutation_PS_elements_ps_adds</span>'. <span class="id">ndup_simpl</span>... <span class="id">ndup_r</span> <span class="id">Hndup</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHe1</span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">H</span>' [<span class="id">Href1</span> [<span class="id">Hvalid1</span> [<span class="id">Histst1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1</span>']]]]]... <span class="tactic">clear</span> <span class="id">IHe1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span> <span class="kwd">in</span> <span class="id">H12</span>; [| <span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_in">fresh_in</a></span> <span class="id">e2</span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> <span class="id">reusable</span>)) <span class="kwd">as</span> <span class="id">Hndup2</span> <span class="tactic">by</span> <span class="id">ndup_r</span> <span class="id">Hndup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHe2</span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">H</span>'' [<span class="id">Href2</span> [<span class="id">Hvalid2</span> [<span class="id">Histst2</span> [<span class="id">Hsem2</span> <span class="id">Hsem2</span>']]]]]... <span class="tactic">clear</span> <span class="id">IHe2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsem1</span>. <span class="id">inv</span> <span class="id">Hsem2</span>. <span class="id">inv</span> <span class="id">H4</span>. <span class="id">inv</span> <span class="id">H11</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>''. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etransitivity</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">repeat</span> <span class="tactic">econstructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_app">Forall_app</a></span>. <span class="tactic">split</span>; <span class="id">solve_forall</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation_refines">sem_equation_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;fby&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>, <span class="id"><a href="Velus.Common.CommonPS.html#ps_adds_app">ps_adds_app</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x2</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.annots">annots</a></span> <span class="id">e0s</span>)) <span class="kwd">as</span> <span class="id">Hlength1</span> <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.map_bind2_unnest_exp_length">map_bind2_unnest_exp_length</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x6</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.annots">annots</a></span> <span class="id">es</span>)) <span class="kwd">as</span> <span class="id">Hlength2</span> <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.map_bind2_unnest_exp_length">map_bind2_unnest_exp_length</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_ins">fresh_ins</a></span> <span class="id">es</span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> <span class="id">reusable</span>)) <span class="kwd">as</span> <span class="id">Hndup2</span> <span class="tactic">by</span> <span class="id">ndup_r</span> <span class="id">Hndup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_ins">fresh_ins</a></span> <span class="id">e0s</span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_in">fresh_in</a></span> <span class="id">es</span>))) <span class="id">reusable</span>))) <span class="kwd">as</span> <span class="id">Hndup1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Permutation_PS_elements_ps_adds</span>'; <span class="id">ndup_simpl</span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.numstreams">numstreams</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> = 1) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x2</span>)) <span class="kwd">as</span> <span class="id">Hnumstreams</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.map_bind2_unnest_exp_numstreams">map_bind2_unnest_exp_numstreams</a></span> <span class="kwd">in</span> <span class="id">H2</span>... }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">s0ss</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">e0s</span>) <span class="kwd">as</span> <span class="id">Hlen1</span> <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H12</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H2</span>':=<span class="id">H2</span>). <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.map_bind2_sem">map_bind2_sem</a></span> <span class="kwd">in</span> <span class="id">H2</span>... 2:<span class="id">solve_forall</span>. <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [<span class="id">H</span>' [<span class="id">Href1</span> [<span class="id">Histst1</span> [<span class="id">Hdom1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1</span>']]]]]. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span> <span class="kwd">in</span> <span class="id">Hsem1</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id">G</span> <span class="id">H</span>' <span class="id">b</span>) <span class="id">es</span> <span class="id">sss</span>) <span class="kwd">as</span> <span class="id">Hsem</span>' <span class="tactic">by</span> (<span class="tactic">repeat</span> <span class="id">rewrite_Forall_forall</span>; <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">sss</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">es</span>) <span class="kwd">as</span> <span class="id">Hlen2</span> <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H14</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H3</span>':=<span class="id">H3</span>). <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.map_bind2_sem">map_bind2_sem</a></span> <span class="kwd">in</span> <span class="id">H3</span>... 2:<span class="id">solve_forall</span>. <span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> [<span class="id">H</span>'' [<span class="id">Href2</span> [<span class="id">Hvalid2</span> [<span class="id">Hdom2</span> [<span class="id">Hsem2</span> <span class="id">Hsem2</span>']]]]]. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span> <span class="kwd">in</span> <span class="id">Hsem2</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> (<span class="id">e</span> : <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.exp">exp</a></span>) (<span class="id">v</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux.value">OpAux.value</a></span>) =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id">G</span> <span class="id">H</span>'' <span class="id">b</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>]) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x2</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">s0ss</span>)) <span class="kwd">as</span> <span class="id">Hsem</span>''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">repeat</span> <span class="id">rewrite_Forall_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.idents_for_anns_length">idents_for_anns_length</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H4</span>) <span class="kwd">as</span> <span class="id">Hlength</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">a</span>) <span class="kwd">as</span> <span class="id">Hlength</span>'''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall3_length">Forall3_length</a></span> <span class="kwd">in</span> <span class="id">H15</span> <span class="kwd">as</span> [<span class="id">_</span> ?]. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">Hsem2</span>. <span class="tactic">congruence</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="Velus.Environment.html#Env.adds">Env.adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">x5</span>) <span class="id">vs</span> <span class="id">H</span>'') <span class="kwd">as</span> <span class="id">H</span>'''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x5</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hlength</span>'''' <span class="tactic">by</span> (<span class="tactic">rewrite</span> <span class="id">Hlength</span>, <span class="id">Hlength</span>'''; <span class="tactic">auto</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sem_var">sem_var</a></span> <span class="id">H</span>''') (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">x5</span>) <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hsemvars</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">HeqH</span>'''. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.sem_var_adds">sem_var_adds</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.idents_for_anns_NoDupMembers">idents_for_anns_NoDupMembers</a></span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="Velus.Common.CommonList.html#fst_NoDupMembers">fst_NoDupMembers</a></span>; <span class="tactic">eauto</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id">H</span>'' <span class="id">H</span>''') <span class="kwd">as</span> <span class="id">Href4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.idents_for_anns_refines">idents_for_anns_refines</a></span> <span class="kwd">in</span> <span class="id">H4</span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id">G</span> <span class="id">H</span>''' <span class="id">b</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>]) (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_fby">unnest_fby</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x2</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x6</span>) <span class="id">a</span>) <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hsemf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_fby_sem">unnest_fby_sem</a></span>... 2:<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.map_bind2_unnest_exp_length">map_bind2_unnest_exp_length</a></span> <span class="kwd">in</span> <span class="id">H2</span>'... <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">clear</span> - <span class="id">Hsem1</span> <span class="id">Href2</span> <span class="id">Href4</span>. <span class="id">solve_forall</span>. <span class="tactic">repeat</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">clear</span> - <span class="id">Hsem2</span> <span class="id">Href2</span> <span class="id">Href4</span>. <span class="id">solve_forall</span>. <span class="tactic">repeat</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>; <span class="tactic">eauto</span>). }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>'''. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">repeat</span> (<span class="id">etransitivity</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.idents_for_anns_dom">idents_for_anns_dom</a></span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">clear</span> - <span class="id">Hsemvars</span>. <span class="id">solve_forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_app">Forall_app</a></span>. <span class="tactic">repeat</span> <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">clear</span> - <span class="id">Hsemvars</span> <span class="id">Hsemf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_fby">unnest_fby</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) <span class="kwd">as</span> <span class="id">fby</span>. <span class="tactic">clear</span> <span class="id">Heqfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">rewrite_Forall_forall</span>. 1:<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id">_</span> <span class="id">x5</span> <span class="id">_</span>) <span class="id">eqn</span>:<span class="id">Hnth1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="tactic">repeat</span> <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span>... <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="tactic">repeat</span> <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H2</span> <span class="kwd">with</span> (<span class="id">x1</span>:=(<span class="id">i</span>, <span class="id">a1</span>))...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">solve_forall</span>. <span class="tactic">repeat</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation_refines">sem_equation_refines</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">solve_forall</span>. <span class="tactic">repeat</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation_refines">sem_equation_refines</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Unshelve</span>. <span class="tactic">exact</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.default_stream">default_stream</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;arrow&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>, <span class="id"><a href="Velus.Common.CommonPS.html#ps_adds_app">ps_adds_app</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x2</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.annots">annots</a></span> <span class="id">e0s</span>)) <span class="kwd">as</span> <span class="id">Hlength1</span> <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.map_bind2_unnest_exp_length">map_bind2_unnest_exp_length</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x6</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.annots">annots</a></span> <span class="id">es</span>)) <span class="kwd">as</span> <span class="id">Hlength2</span> <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.map_bind2_unnest_exp_length">map_bind2_unnest_exp_length</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_ins">fresh_ins</a></span> <span class="id">es</span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> <span class="id">reusable</span>)) <span class="kwd">as</span> <span class="id">Hndup2</span> <span class="tactic">by</span> <span class="id">ndup_r</span> <span class="id">Hndup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_ins">fresh_ins</a></span> <span class="id">e0s</span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_in">fresh_in</a></span> <span class="id">es</span>))) <span class="id">reusable</span>))) <span class="kwd">as</span> <span class="id">Hndup1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Permutation_PS_elements_ps_adds</span>'; <span class="id">ndup_simpl</span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">e</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.numstreams">numstreams</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> = 1) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x2</span>)) <span class="kwd">as</span> <span class="id">Hnumstreams</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.map_bind2_unnest_exp_numstreams">map_bind2_unnest_exp_numstreams</a></span> <span class="kwd">in</span> <span class="id">H2</span>... }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">s0ss</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">e0s</span>) <span class="kwd">as</span> <span class="id">Hlen1</span> <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H12</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H2</span>':=<span class="id">H2</span>). <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.map_bind2_sem">map_bind2_sem</a></span> <span class="kwd">in</span> <span class="id">H2</span>... 2:<span class="id">solve_forall</span>. <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [<span class="id">H</span>' [<span class="id">Href1</span> [<span class="id">Histst1</span> [<span class="id">Hdom1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1</span>']]]]]. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span> <span class="kwd">in</span> <span class="id">Hsem1</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id">G</span> <span class="id">H</span>' <span class="id">b</span>) <span class="id">es</span> <span class="id">sss</span>) <span class="kwd">as</span> <span class="id">Hsem</span>' <span class="tactic">by</span> (<span class="tactic">repeat</span> <span class="id">rewrite_Forall_forall</span>; <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">sss</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">es</span>) <span class="kwd">as</span> <span class="id">Hlen2</span> <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H14</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H3</span>':=<span class="id">H3</span>). <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.map_bind2_sem">map_bind2_sem</a></span> <span class="kwd">in</span> <span class="id">H3</span>... 2:<span class="id">solve_forall</span>. <span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> [<span class="id">H</span>'' [<span class="id">Href2</span> [<span class="id">Hvalid2</span> [<span class="id">Hdom2</span> [<span class="id">Hsem2</span> <span class="id">Hsem2</span>']]]]]. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span> <span class="kwd">in</span> <span class="id">Hsem2</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> (<span class="id">e</span> : <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.exp">exp</a></span>) (<span class="id">v</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux.value">OpAux.value</a></span>) =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id">G</span> <span class="id">H</span>'' <span class="id">b</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>]) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x2</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">s0ss</span>)) <span class="kwd">as</span> <span class="id">Hsem</span>''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">repeat</span> <span class="id">rewrite_Forall_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.idents_for_anns_length">idents_for_anns_length</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H4</span>) <span class="kwd">as</span> <span class="id">Hlength</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">a</span>) <span class="kwd">as</span> <span class="id">Hlength</span>'''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall3_length">Forall3_length</a></span> <span class="kwd">in</span> <span class="id">H15</span> <span class="kwd">as</span> [<span class="id">_</span> ?]. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">Hsem2</span>. <span class="tactic">congruence</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="Velus.Environment.html#Env.adds">Env.adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">x5</span>) <span class="id">vs</span> <span class="id">H</span>'') <span class="kwd">as</span> <span class="id">H</span>'''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x5</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hlength</span>'''' <span class="tactic">by</span> (<span class="tactic">rewrite</span> <span class="id">Hlength</span>, <span class="id">Hlength</span>'''; <span class="tactic">auto</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sem_var">sem_var</a></span> <span class="id">H</span>''') (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">x5</span>) <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hsemvars</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">HeqH</span>'''. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.sem_var_adds">sem_var_adds</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.idents_for_anns_NoDupMembers">idents_for_anns_NoDupMembers</a></span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="Velus.Common.CommonList.html#fst_NoDupMembers">fst_NoDupMembers</a></span>; <span class="tactic">eauto</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id">H</span>'' <span class="id">H</span>''') <span class="kwd">as</span> <span class="id">Href4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.idents_for_anns_refines">idents_for_anns_refines</a></span> <span class="kwd">in</span> <span class="id">H4</span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id">G</span> <span class="id">H</span>''' <span class="id">b</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>]) (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_arrow">unnest_arrow</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x2</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x6</span>) <span class="id">a</span>) <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hsemf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_arrow_sem">unnest_arrow_sem</a></span>... 2:<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.map_bind2_unnest_exp_length">map_bind2_unnest_exp_length</a></span> <span class="kwd">in</span> <span class="id">H2</span>'... <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">clear</span> - <span class="id">Hsem1</span> <span class="id">Href2</span> <span class="id">Href4</span>. <span class="id">solve_forall</span>. <span class="tactic">repeat</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">clear</span> - <span class="id">Hsem2</span> <span class="id">Href2</span> <span class="id">Href4</span>. <span class="id">solve_forall</span>. <span class="tactic">repeat</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>; <span class="tactic">eauto</span>). }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>'''. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">repeat</span> (<span class="id">etransitivity</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.idents_for_anns_dom">idents_for_anns_dom</a></span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">clear</span> - <span class="id">Hsemvars</span>. <span class="id">solve_forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_app">Forall_app</a></span>. <span class="tactic">repeat</span> <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">clear</span> - <span class="id">Hsemvars</span> <span class="id">Hsemf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_arrow">unnest_arrow</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) <span class="kwd">as</span> <span class="id">fby</span>. <span class="tactic">clear</span> <span class="id">Heqfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">rewrite_Forall_forall</span>. 1:<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id">_</span> <span class="id">x5</span> <span class="id">_</span>) <span class="id">eqn</span>:<span class="id">Hnth1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="tactic">repeat</span> <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H0</span>... <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="tactic">repeat</span> <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H2</span> <span class="kwd">with</span> (<span class="id">x1</span>:=(<span class="id">i</span>, <span class="id">a1</span>))...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">solve_forall</span>. <span class="tactic">repeat</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation_refines">sem_equation_refines</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">solve_forall</span>. <span class="tactic">repeat</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation_refines">sem_equation_refines</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Unshelve</span>. <span class="tactic">exact</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.default_stream">default_stream</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;when&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x1</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.annots">annots</a></span> <span class="id">es</span>)) <span class="kwd">as</span> <span class="id">Hlength</span> <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.map_bind2_unnest_exp_length">map_bind2_unnest_exp_length</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">es</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">ss</span>) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H11</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.map_bind2_sem">map_bind2_sem</a></span> <span class="kwd">in</span> <span class="id">H1</span>... 2:<span class="id">solve_forall</span>. <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">H</span>' [<span class="id">Hvalid1</span> [<span class="id">Href1</span> [<span class="id">Hdom1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1</span>']]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span> <span class="kwd">in</span> <span class="id">Hsem1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>'. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_when_sem">unnest_when_sem</a></span>... <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_var_refines">sem_var_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;merge&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>, <span class="id"><a href="Velus.Common.CommonPS.html#ps_adds_app">ps_adds_app</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x3</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.annots">annots</a></span> <span class="id">ets</span>)) <span class="kwd">as</span> <span class="id">Hlength1</span> <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.map_bind2_unnest_exp_length">map_bind2_unnest_exp_length</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x6</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.annots">annots</a></span> <span class="id">efs</span>)) <span class="kwd">as</span> <span class="id">Hlength2</span> <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.map_bind2_unnest_exp_length">map_bind2_unnest_exp_length</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">ts</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.annots">annots</a></span> <span class="id">ets</span>)) <span class="kwd">as</span> <span class="id">Hlength1</span>' <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exps_numstreams">sem_exps_numstreams</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_ins">fresh_ins</a></span> <span class="id">efs</span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> <span class="id">reusable</span>)) <span class="kwd">as</span> <span class="id">Hndup2</span> <span class="tactic">by</span> <span class="id">ndup_r</span> <span class="id">Hndup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_ins">fresh_ins</a></span> <span class="id">ets</span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_in">fresh_in</a></span> <span class="id">efs</span>))) <span class="id">reusable</span>))) <span class="kwd">as</span> <span class="id">Hndup1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Permutation_PS_elements_ps_adds</span>'; <span class="id">ndup_simpl</span>... }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">ets</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">ts</span>) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H15</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.map_bind2_sem">map_bind2_sem</a></span> <span class="kwd">in</span> <span class="id">H2</span>... 2:<span class="id">solve_forall</span>. <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [<span class="id">H</span>' [<span class="id">Href1</span> [<span class="id">Hvalid1</span> [<span class="id">Histst1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1</span>']]]]]. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span> <span class="kwd">in</span> <span class="id">Hsem1</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">efs</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">fs</span>) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H16</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id">G</span> <span class="id">H</span>' <span class="id">b</span>) <span class="id">efs</span> <span class="id">fs</span>) <span class="kwd">as</span> <span class="id">Hsemf</span>' <span class="tactic">by</span> (<span class="id">solve_forall</span>; <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>; <span class="tactic">eauto</span>). <span class="tactic">clear</span> <span class="id">H16</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.map_bind2_sem">map_bind2_sem</a></span> <span class="kwd">in</span> <span class="id">H3</span>... 2:<span class="id">solve_forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> [<span class="id">H</span>'' [<span class="id">Href2</span> [<span class="id">Hvalid2</span> [<span class="id">Histst2</span> [<span class="id">Hsem2</span> <span class="id">Hsem2</span>']]]]]. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span> <span class="kwd">in</span> <span class="id">Hsem2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.annots">annots</a></span> <span class="id">ets</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.annots">annots</a></span> <span class="id">efs</span>)) <span class="kwd">as</span> <span class="id">Hlen</span>' <span class="tactic">by</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id">G</span> <span class="id">H</span>'' <span class="id">b</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_merge">unnest_merge</a></span> <span class="id">x</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x3</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x6</span>) <span class="id">tys</span> <span class="id">nck</span>) <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hsem</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_merge_sem">unnest_merge_sem</a></span>... 1,2:<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">solve_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">repeat</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_var_refines">sem_var_refines</a></span>; <span class="tactic">eauto</span>). }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">is_control</span>; <span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;control&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>''. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">etransitivity</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_app">Forall_app</a></span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation_refines">sem_equation_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;exp&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="Velus.Environment.html#Env.adds">Env.adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">x0</span>) <span class="id">vs</span> <span class="id">H</span>'') <span class="kwd">as</span> <span class="id">H</span>'''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x0</span>) <span class="kwd">as</span> <span class="id">Hlength</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.idents_for_anns_length">idents_for_anns_length</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">repeat</span> <span class="id">simpl_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall3_length">Forall3_length</a></span> <span class="kwd">in</span> <span class="id">H17</span> <span class="kwd">as</span> [? ?]; <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id">H</span>'' <span class="id">H</span>''') <span class="kwd">as</span> <span class="id">Href3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.idents_for_anns_refines">idents_for_anns_refines</a></span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sem_var">sem_var</a></span> <span class="id">H</span>''') (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">x0</span>) <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hvars</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">HeqH</span>'''. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.sem_var_adds">sem_var_adds</a></span>... 1:<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="Velus.Common.CommonList.html#fst_NoDupMembers">fst_NoDupMembers</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.idents_for_anns_NoDupMembers">idents_for_anns_NoDupMembers</a></span> <span class="kwd">in</span> <span class="id">H2</span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>'''. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">repeat</span> (<span class="id">etransitivity</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.idents_for_anns_dom">idents_for_anns_dom</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">clear</span> - <span class="id">Hvars</span>. <span class="id">solve_forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_app">Forall_app</a></span>; <span class="tactic">repeat</span> <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">remember</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_merge">unnest_merge</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) <span class="kwd">as</span> <span class="id">merge</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">merge</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x0</span>) <span class="kwd">as</span> <span class="id">Hlength</span>''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.idents_for_anns_length">idents_for_anns_length</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">clear</span> - <span class="id">Heqmerge</span> <span class="id">H17</span> <span class="id">H2</span> <span class="id">H9</span> <span class="id">Hlength1</span> <span class="id">Hlength2</span> <span class="id">Hlen</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqmerge</span>, <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_merge_length">unnest_merge_length</a></span>; <span class="id">solve_length</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hvars</span> <span class="id">Hsem</span>' <span class="id">Href3</span> <span class="id">Hlength</span>''. <span class="id">simpl_forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">x1</span> <span class="id">y</span> =&gt; <span class="tactic">exists</span> (<span class="id">v</span>:<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux.value">value</a></span>), <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id">G</span> <span class="id">H</span>''' <span class="id">b</span> (<span class="kwd">let</span> '(<span class="id">id</span>, <span class="id">_</span>) := <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#x1">x1</a></span> <span class="kwd">in</span> [<span class="id">id</span>], [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y">y</a></span>])) <span class="id">x0</span> <span class="id">merge</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall3_ignore3">Forall3_ignore3</a></span> <span class="kwd">with</span> (<span class="id">zs</span>:=<span class="id">vs</span>). <span class="id">solve_forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Seq">Seq</a></span> <span class="kwd">with</span> (<span class="id">ss</span>:=[[<span class="id">z</span>]]); <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="tactic">repeat</span> <span class="tactic">constructor</span>... <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_forall</span>. <span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [? ?]...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">solve_forall</span>. <span class="tactic">repeat</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation_refines">sem_equation_refines</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">solve_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation_refines">sem_equation_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;ite&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>, <span class="id"><a href="Velus.Common.CommonPS.html#ps_adds_app">ps_adds_app</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x</span> = 1). 2:<span class="id">singleton_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_exp_length">unnest_exp_length</a></span> <span class="kwd">in</span> <span class="id">H2</span>... <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x5</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.annots">annots</a></span> <span class="id">ets</span>)) <span class="kwd">as</span> <span class="id">Hlength1</span> <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.map_bind2_unnest_exp_length">map_bind2_unnest_exp_length</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x8</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.annots">annots</a></span> <span class="id">efs</span>)) <span class="kwd">as</span> <span class="id">Hlength2</span> <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.map_bind2_unnest_exp_length">map_bind2_unnest_exp_length</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">ts</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.annots">annots</a></span> <span class="id">ets</span>)) <span class="kwd">as</span> <span class="id">Hlength1</span>' <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exps_numstreams">sem_exps_numstreams</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_ins">fresh_ins</a></span> <span class="id">efs</span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> <span class="id">reusable</span>)) <span class="kwd">as</span> <span class="id">Hndup3</span> <span class="tactic">by</span> <span class="tactic">repeat</span> <span class="id">ndup_r</span> <span class="id">Hndup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_ins">fresh_ins</a></span> <span class="id">ets</span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_in">fresh_in</a></span> <span class="id">efs</span>))) <span class="id">reusable</span>))) <span class="kwd">as</span> <span class="id">Hndup2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Permutation_PS_elements_ps_adds</span>'; <span class="id">ndup_simpl</span>... <span class="id">ndup_r</span> <span class="id">Hndup</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_in">fresh_in</a></span> <span class="id">e</span>) ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_ins">fresh_ins</a></span> <span class="id">ets</span>)) (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_ins">fresh_ins</a></span> <span class="id">efs</span>)) <span class="id">reusable</span>)))) <span class="kwd">as</span> <span class="id">Hndup1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">Permutation_PS_elements_ps_adds</span>'; <span class="id">ndup_simpl</span>... <span class="id">ndup_r</span> <span class="id">Hndup</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">ets</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">ts</span>) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H17</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHe</span> <span class="kwd">in</span> <span class="id">H2</span>... <span class="tactic">clear</span> <span class="id">IHe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [<span class="id">H</span>' [<span class="id">Href1</span> [<span class="id">Hvalid1</span> [<span class="id">Histst1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1</span>']]]]]. <span class="id">inv</span> <span class="id">Hsem1</span>; <span class="tactic">rename</span> <span class="id">H16</span> <span class="id">into</span> <span class="id">Hsem1</span>. <span class="tactic">clear</span> <span class="id">H21</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">efs</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">fs</span>) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H18</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id">G</span> <span class="id">H</span>' <span class="id">b</span>) <span class="id">ets</span> <span class="id">ts</span>) <span class="kwd">as</span> <span class="id">Hsemt</span>' <span class="tactic">by</span> (<span class="id">solve_forall</span>; <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>; <span class="tactic">eauto</span>). <span class="tactic">clear</span> <span class="id">H17</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.map_bind2_sem">map_bind2_sem</a></span> <span class="kwd">in</span> <span class="id">H3</span>... 2:<span class="id">solve_forall</span>. <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> [<span class="id">H</span>'' [<span class="id">Href2</span> [<span class="id">Hvalid2</span> [<span class="id">Histst2</span> [<span class="id">Hsem2</span> <span class="id">Hsem2</span>']]]]]. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span> <span class="kwd">in</span> <span class="id">Hsem2</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">efs</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">fs</span>) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H18</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id">G</span> <span class="id">H</span>'' <span class="id">b</span>) <span class="id">efs</span> <span class="id">fs</span>) <span class="kwd">as</span> <span class="id">Hsemf</span>' <span class="tactic">by</span> (<span class="id">solve_forall</span>; <span class="tactic">repeat</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>; <span class="tactic">eauto</span>)). <span class="tactic">clear</span> <span class="id">H18</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.map_bind2_sem">map_bind2_sem</a></span> <span class="kwd">in</span> <span class="id">H4</span>... 2:<span class="id">solve_forall</span>. <span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H4</span> <span class="kwd">as</span> [<span class="id">H</span>''' [<span class="id">Href3</span> [<span class="id">Hvalid3</span> [<span class="id">Histst3</span> [<span class="id">Hsem3</span> <span class="id">Hsem3</span>']]]]]. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span> <span class="kwd">in</span> <span class="id">Hsem3</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id">G</span> <span class="id">H</span>''' <span class="id">b</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_ite">unnest_ite</a></span> <span class="id">e0</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x5</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x8</span>) <span class="id">tys</span> <span class="id">nck</span>) <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hsem</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_ite_sem">unnest_ite_sem</a></span>... 1,2:<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">repeat</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">solve_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">is_control</span>; <span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;control&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>'''. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">repeat</span> (<span class="id">etransitivity</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">repeat</span> (<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_app">Forall_app</a></span>; <span class="tactic">split</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="id">solve_forall</span>; <span class="tactic">repeat</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation_refines">sem_equation_refines</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;exp&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="Velus.Environment.html#Env.adds">Env.adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">x</span>) <span class="id">vs</span> <span class="id">H</span>''') <span class="kwd">as</span> <span class="id">H</span>''''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x</span>) <span class="kwd">as</span> <span class="id">Hlength</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.idents_for_anns_length">idents_for_anns_length</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">repeat</span> <span class="id">simpl_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall3_length">Forall3_length</a></span> <span class="kwd">in</span> <span class="id">H19</span> <span class="kwd">as</span> [? ?]; <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id">H</span>''' <span class="id">H</span>'''') <span class="kwd">as</span> <span class="id">Href4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.idents_for_anns_refines">idents_for_anns_refines</a></span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sem_var">sem_var</a></span> <span class="id">H</span>'''') (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">x</span>) <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hvars</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">HeqH</span>''''. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.sem_var_adds">sem_var_adds</a></span>... 1:<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="Velus.Common.CommonList.html#fst_NoDupMembers">fst_NoDupMembers</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.idents_for_anns_NoDupMembers">idents_for_anns_NoDupMembers</a></span> <span class="kwd">in</span> <span class="id">H0</span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>''''. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">repeat</span> (<span class="id">etransitivity</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.idents_for_anns_dom">idents_for_anns_dom</a></span> <span class="kwd">in</span> <span class="id">H0</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">clear</span> - <span class="id">Hvars</span>. <span class="id">solve_forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_app">Forall_app</a></span>; <span class="tactic">repeat</span> <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2,3,4: (<span class="id">solve_forall</span>; <span class="tactic">repeat</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation_refines">sem_equation_refines</a></span>; <span class="tactic">eauto</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_ite">unnest_ite</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) <span class="kwd">as</span> <span class="id">ite</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">ite</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x</span>) <span class="kwd">as</span> <span class="id">Hlength</span>''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.idents_for_anns_length">idents_for_anns_length</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">clear</span> - <span class="id">Heqite</span> <span class="id">H19</span> <span class="id">H0</span> <span class="id">Hlength1</span> <span class="id">Hlength2</span> <span class="id">H11</span> <span class="id">H12</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqite</span>, <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_ite_length">unnest_ite_length</a></span>; <span class="id">solve_length</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Hvars</span> <span class="id">Hsem</span>' <span class="id">Href4</span> <span class="id">Hlength</span>''. <span class="id">simpl_forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">x1</span> <span class="id">y</span> =&gt; <span class="tactic">exists</span> (<span class="id">v</span>:<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux.value">value</a></span>), <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id">G</span> <span class="id">H</span>'''' <span class="id">b</span> (<span class="kwd">let</span> '(<span class="id">id</span>, <span class="id">_</span>) := <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#x1">x1</a></span> <span class="kwd">in</span> [<span class="id">id</span>], [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y">y</a></span>])) <span class="id">x</span> <span class="id">ite</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall3_ignore3">Forall3_ignore3</a></span> <span class="kwd">with</span> (<span class="id">zs</span>:=<span class="id">vs</span>). <span class="id">solve_forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Seq">Seq</a></span> <span class="kwd">with</span> (<span class="id">ss</span>:=[[<span class="id">z</span>]]); <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="tactic">repeat</span> <span class="tactic">constructor</span>... <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_forall</span>. <span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [? ?]...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;app&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>, <span class="id"><a href="Velus.Common.CommonPS.html#ps_adds_app">ps_adds_app</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">a</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">x4</span>) <span class="kwd">as</span> <span class="id">Hanns</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">idents_for_anns</span>'<span class="id">_values</span> <span class="kwd">in</span> <span class="id">H4</span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id">idents_for_anns</span>'<span class="id">_length</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H4</span>) <span class="kwd">as</span> <span class="id">Hlength1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_out">n_out</a></span> <span class="id">n</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hlength2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">H14</span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H12</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H6</span> <span class="kwd">in</span> <span class="id">H8</span>; <span class="id">inv</span> <span class="id">H8</span>. <span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.idents">idents</a></span> <span class="kwd">in</span> *. <span class="id">solve_length</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">es</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">ss</span>) <span class="kwd">as</span> <span class="id">Hlength3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H13</span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x5</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="kwd">as</span> <span class="id">Hlength4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.map_bind2_unnest_exp_length">map_bind2_unnest_exp_length</a></span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">eauto</span>. <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_streams">Syn.anon_streams</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">x4</span>))++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> <span class="id">reusable</span>)) <span class="kwd">as</span> <span class="id">Hndup2</span> <span class="tactic">by</span> <span class="id">ndup_r</span> <span class="id">Hndup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_ins">fresh_ins</a></span> <span class="id">es</span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_streams">Syn.anon_streams</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">x4</span>))) <span class="id">reusable</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Permutation_PS_elements_ps_adds</span>'; <span class="id">ndup_simpl</span>... }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.map_bind2_sem">map_bind2_sem</a></span> <span class="kwd">in</span> <span class="id">H2</span>... 2:<span class="id">solve_forall</span>... <span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [<span class="id">H</span>' [<span class="id">Href1</span> [<span class="id">Hvalid1</span> [<span class="id">Histst1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1</span>']]]]].<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_noops_exps_sem">unnest_noops_exps_sem</a></span> <span class="kwd">in</span> <span class="id">H3</span> <span class="kwd">as</span> (<span class="id">H</span>''&amp;<span class="id">Href2</span>&amp;<span class="id">Hvalid2</span>&amp;<span class="id">Histst2</span>&amp;<span class="id">Hsem2</span>&amp;<span class="id">Hsem2</span>')...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3:<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.find_node_incks">find_node_incks</a></span>. <span class="tactic">rewrite</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>. <span class="tactic">auto</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id">G</span> <span class="id">H</span>'' <span class="id">b</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.Eapp">Eapp</a></span> <span class="id">f</span> <span class="id">x2</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">x4</span>)) <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hsem</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Sapp">Sapp</a></span> <span class="kwd">with</span> (<span class="id">ss</span>:=(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#x">x</a></span>]) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#x">x</a></span>) <span class="id">ss</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat_map">concat_map</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_map_2">Forall2_map_2</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#concat_map_singl2">concat_map_singl2</a></span>. <span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="Velus.Environment.html#Env.adds">Env.adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">x4</span>) <span class="id">vs</span> <span class="id">H</span>'') <span class="kwd">as</span> <span class="id">H</span>'''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x4</span>) <span class="kwd">as</span> <span class="id">Hlen</span>' <span class="tactic">by</span> <span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id">H</span>'' <span class="id">H</span>''') <span class="kwd">as</span> <span class="id">Href3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">idents_for_anns</span>'<span class="id">_refines</span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> <span class="id">x4</span>) <span class="kwd">as</span> <span class="id">Hndup</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">idents_for_anns</span>'<span class="id">_NoDupMembers</span> <span class="kwd">in</span> <span class="id">H4</span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sem_var">sem_var</a></span> <span class="id">H</span>''') (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">x4</span>) <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hvars</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">HeqH</span>'''. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.sem_var_adds">sem_var_adds</a></span>... 1:<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>... <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="Velus.Common.CommonList.html#fst_NoDupMembers">fst_NoDupMembers</a></span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>'''. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">do</span> 2 <span class="id">etransitivity</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">idents_for_anns</span>'<span class="id">_dom</span> <span class="kwd">in</span> <span class="id">H4</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">clear</span> - <span class="id">Hvars</span>. <span class="id">solve_forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>. <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Seq">Seq</a></span> <span class="kwd">with</span> (<span class="id">ss</span>:=[<span class="id">vs</span>]).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">repeat</span> <span class="tactic">constructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_app">Forall_app</a></span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="id">solve_forall</span>; <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation_refines">sem_equation_refines</a></span>; [|<span class="tactic">eauto</span>]...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">etransitivity</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;app&nbsp;(reset)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 6 <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hs</span>:=<span class="id">H4</span>). <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_reset_Some">unnest_reset_Some</a></span> <span class="kwd">in</span> <span class="id">Hs</span> <span class="kwd">as</span> [<span class="id">er</span>' ?]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>, <span class="id"><a href="Velus.Common.CommonPS.html#ps_adds_app">ps_adds_app</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">a</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">x8</span>) <span class="kwd">as</span> <span class="id">Hanns</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">idents_for_anns</span>'<span class="id">_values</span> <span class="kwd">in</span> <span class="id">H5</span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id">idents_for_anns</span>'<span class="id">_length</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H5</span>) <span class="kwd">as</span> <span class="id">Hlength1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_out">n_out</a></span> <span class="id">n</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hlength2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">specialize</span> (<span class="id">H19</span> 0). <span class="id">inv</span> <span class="id">H19</span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H16</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.idents">idents</a></span> <span class="kwd">in</span> *. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span> <span class="kwd">in</span> <span class="id">H16</span>. <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">es</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">ss</span>) <span class="kwd">as</span> <span class="id">Hlength3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H15</span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="kwd">as</span> <span class="id">Hlength4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_exps_length">unnest_exps_length</a></span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">eauto</span>. <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_streams">Syn.anon_streams</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">x8</span>))++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> <span class="id">reusable</span>)) <span class="kwd">as</span> <span class="id">Hndup2</span> <span class="tactic">by</span> <span class="tactic">repeat</span> <span class="id">ndup_r</span> <span class="id">Hndup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_in">fresh_in</a></span> <span class="id">r</span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_streams">Syn.anon_streams</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">x8</span>))) <span class="id">reusable</span>))) <span class="kwd">as</span> <span class="id">Hndup3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Permutation_PS_elements_ps_adds</span>'; <span class="id">ndup_simpl</span>... <span class="id">ndup_r</span> <span class="id">Hndup</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_ins">fresh_ins</a></span> <span class="id">es</span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_in">fresh_in</a></span> <span class="id">r</span>)) (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_streams">Syn.anon_streams</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">x8</span>))) <span class="id">reusable</span>)))) <span class="kwd">as</span> <span class="id">Hndup4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">Permutation_PS_elements_ps_adds</span>'; <span class="id">ndup_simpl</span>... <span class="id">ndup_r</span> <span class="id">Hndup</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.bind2_spec">bind2_spec</a></span> <span class="kwd">in</span> <span class="id">H2</span> <span class="kwd">as</span> [? [? [? [? <span class="id">Hret</span>]]]]. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.ret_spec">ret_spec</a></span> <span class="kwd">in</span> <span class="id">Hret</span>; <span class="id">inv</span> <span class="id">Hret</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.map_bind2_sem">map_bind2_sem</a></span> <span class="kwd">in</span> <span class="id">H2</span>... 2:<span class="id">solve_forall</span>... <span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [<span class="id">H</span>' [<span class="id">Href1</span> [<span class="id">Hvalid1</span> [<span class="id">Histst1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1</span>']]]]].<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_noops_exps_sem">unnest_noops_exps_sem</a></span> <span class="kwd">in</span> <span class="id">H3</span> <span class="kwd">as</span> (<span class="id">H</span>''&amp;<span class="id">Href2</span>&amp;<span class="id">Hvalid2</span>&amp;<span class="id">Histst2</span>&amp;<span class="id">Hsem2</span>&amp;<span class="id">Hsem2</span>')...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3:<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.find_node_incks">find_node_incks</a></span>. <span class="tactic">rewrite</span> <span class="id">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>. <span class="tactic">auto</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id">G</span> <span class="id">H</span>' <span class="id">b</span> <span class="id">r</span> [<span class="id">rs</span>]) <span class="kwd">as</span> <span class="id">Hsemr</span>' <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>; <span class="tactic">eauto</span>). <span class="tactic">clear</span> <span class="id">H17</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_reset_sem">unnest_reset_sem</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">r</span>)) <span class="kwd">with</span> (<span class="id">H0</span>:=<span class="id">H</span>'') <span class="kwd">in</span> <span class="id">H4</span>; <span class="tactic">simpl</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="tactic">clear</span> <span class="id">H4</span>. <span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">H</span>''' [? [? [? [? ?]]]]]. 2,3,5,6:<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>'''. <span class="tactic">repeat</span> <span class="tactic">split</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H4</span> <span class="kwd">as</span> [<span class="id">H</span>''' [<span class="id">Href3</span> [<span class="id">Hvalid3</span> [<span class="id">Histst3</span> [<span class="id">Hsem3</span> <span class="id">Hsem3</span>']]]]].<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id">G</span> <span class="id">H</span>''' <span class="id">b</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.Eapp">Eapp</a></span> <span class="id">f</span> <span class="id">x2</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">er</span>') (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">x8</span>)) <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hsem</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Sreset">Sreset</a></span> <span class="kwd">with</span> (<span class="id">ss</span>:=(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#x">x</a></span>]) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#x">x</a></span>) <span class="id">ss</span>)))...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat_map">concat_map</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_map_2">Forall2_map_2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">k</span>. <span class="tactic">specialize</span> (<span class="id">H19</span> <span class="id">k</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#concat_map_singl2">concat_map_singl2</a></span>. <span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="Velus.Environment.html#Env.adds">Env.adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">x8</span>) <span class="id">vs</span> <span class="id">H</span>''') <span class="kwd">as</span> <span class="id">H</span>''''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vs</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x8</span>) <span class="kwd">as</span> <span class="id">Hlen</span>' <span class="tactic">by</span> <span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id">H</span>''' <span class="id">H</span>'''') <span class="kwd">as</span> <span class="id">Href4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">idents_for_anns</span>'<span class="id">_refines</span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> <span class="id">x8</span>) <span class="kwd">as</span> <span class="id">Hndup</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">idents_for_anns</span>'<span class="id">_NoDupMembers</span> <span class="kwd">in</span> <span class="id">H5</span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sem_var">sem_var</a></span> <span class="id">H</span>'''') (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">x8</span>) <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">Hvars</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">HeqH</span>''''. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.sem_var_adds">sem_var_adds</a></span>... 1:<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>... <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="Velus.Common.CommonList.html#fst_NoDupMembers">fst_NoDupMembers</a></span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>''''. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">repeat</span> (<span class="id">etransitivity</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">idents_for_anns</span>'<span class="id">_dom</span> <span class="kwd">in</span> <span class="id">H5</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">clear</span> - <span class="id">Hvars</span>. <span class="id">solve_forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">constructor</span>; [| <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_app">Forall_app</a></span>; <span class="tactic">repeat</span> <span class="tactic">split</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Seq">Seq</a></span> <span class="kwd">with</span> (<span class="id">ss</span>:=[<span class="id">vs</span>]).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">repeat</span> <span class="tactic">constructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">solve_forall</span>. <span class="tactic">repeat</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation_refines">sem_equation_refines</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">solve_forall</span>. <span class="tactic">repeat</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation_refines">sem_equation_refines</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">solve_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation_refines">sem_equation_refines</a></span>...<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="CORRECTNESS.unnest_exps_sem">unnest_exps_sem</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">vars</span> <span class="id">b</span> <span class="id">es</span> <span class="id">H</span> <span class="id">vs</span> <span class="id">es</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>' <span class="id">reusable</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_ins">fresh_ins</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.wl_exp">wl_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_ins">fresh_ins</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span>)) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.map_bind2">map_bind2</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_exp">unnest_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id">es</span>', <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">exists</span> <span class="id">H</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id">H</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id">st</span>' (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id">H</span>' (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id">st</span>') /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> (<span class="id">es</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.exp">exp</a></span>) (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux.value">OpAux.value</a></span>)) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>]) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span>) <span class="id">es</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">eqs</span>')).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof27')">Proof.</div>
<div class="proofscript" id="proof27">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hndup</span> <span class="id">Hwt</span> <span class="id">Hsem</span> <span class="id">Hvalid</span> <span class="id">Hdom</span> <span class="id">Hnorm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.map_bind2_sem">map_bind2_sem</a></span> <span class="kwd">in</span> <span class="id">Hnorm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">rewrite_Forall_forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_In">nth_In</a></span> <span class="id">_</span> <span class="id">a</span> <span class="id">H2</span>) <span class="kwd">as</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_exp_sem">unnest_exp_sem</a></span> <span class="kwd">with</span> (<span class="id">e</span>:=(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id">n</span> <span class="id">es</span> <span class="id">a</span>)); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.unnest_rhs_sem">unnest_rhs_sem</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">vars</span> <span class="id">b</span> <span class="id">e</span> <span class="id">H</span> <span class="id">vs</span> <span class="id">es</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>' <span class="id">reusable</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_in">anon_in</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.wl_exp">wl_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_in">anon_in</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span>)) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_rhs">unnest_rhs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id">es</span>', <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">exists</span> <span class="id">H</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id">H</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id">st</span>' (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id">H</span>' (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id">st</span>') /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>]) <span class="id">es</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">e</span>', (<span class="id">es</span>' = [<span class="id">e</span>'] /\ <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id">e</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span>)) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span>) <span class="id">eqs</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof28')">Proof with</div>
<div class="proofscript" id="proof28">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hndup1</span> <span class="id">Hwt</span> <span class="id">Hsem</span> <span class="id">Hvalid</span> <span class="id">Hhistst</span> <span class="id">Hnorm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">e</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_exp_sem">unnest_exp_sem</a></span> <span class="kwd">in</span> <span class="id">Hnorm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;1,2,3,4,7,8,9: (<span class="tactic">destruct</span> <span class="id">Hnorm</span> <span class="kwd">as</span> [<span class="id">H</span>' [<span class="id">Href1</span> [<span class="id">Hvalid1</span> [<span class="id">Hhistst1</span> [<span class="id">Hsem1</span> <span class="id">Hsem2</span>]]]]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>'; <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;1,2,3:(<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_rhs">unnest_rhs</a></span> <span class="kwd">in</span> <span class="id">Hnorm</span>;<span class="id">inv</span> <span class="id">Hwt</span>; <span class="id">inv</span> <span class="id">Hsem</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;fby&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>, <span class="id"><a href="Velus.Common.CommonPS.html#ps_adds_app">ps_adds_app</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.annots">annots</a></span> <span class="id">l</span>)) <span class="kwd">as</span> <span class="id">Hlength1</span> <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_exps_length">unnest_exps_length</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.annots">annots</a></span> <span class="id">l0</span>)) <span class="kwd">as</span> <span class="id">Hlength2</span> <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_exps_length">unnest_exps_length</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_exps">unnest_exps</a></span> <span class="kwd">in</span> *. <span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_ins">fresh_ins</a></span> <span class="id">l0</span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> <span class="id">reusable</span>)) <span class="kwd">as</span> <span class="id">Hndup4</span> <span class="tactic">by</span> <span class="id">ndup_r</span> <span class="id">Hndup1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_ins">fresh_ins</a></span> <span class="id">l</span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_ins">fresh_ins</a></span> <span class="id">l0</span>)) <span class="id">reusable</span>))) <span class="kwd">as</span> <span class="id">Hndup3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Permutation_PS_elements_ps_adds</span>'; <span class="id">ndup_simpl</span>... }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_exps_sem">unnest_exps_sem</a></span> <span class="kwd">in</span> <span class="id">H0</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">H</span>' [<span class="id">Href1</span> [<span class="id">Hvalid1</span> [<span class="id">Histst1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1</span>']]]]]. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span> <span class="kwd">in</span> <span class="id">Hsem1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id">G</span> <span class="id">H</span>' <span class="id">b</span>) <span class="id">l0</span> <span class="id">sss</span>) <span class="kwd">as</span> <span class="id">Hsem</span>' <span class="tactic">by</span> (<span class="tactic">repeat</span> <span class="id">rewrite_Forall_forall</span>; <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>; <span class="tactic">eauto</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_exps_sem">unnest_exps_sem</a></span> <span class="kwd">in</span> <span class="id">H1</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">H</span>'' [<span class="id">Href2</span> [<span class="id">Hvalid2</span> [<span class="id">Histst2</span> [<span class="id">Hsem2</span> <span class="id">Hsem2</span>']]]]]. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span> <span class="kwd">in</span> <span class="id">Hsem2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> (<span class="id">e</span> : <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.exp">exp</a></span>) (<span class="id">v</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux.value">OpAux.value</a></span>) =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id">G</span> <span class="id">H</span>'' <span class="id">b</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>]) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x2</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">s0ss</span>)) <span class="kwd">as</span> <span class="id">Hsem</span>''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">repeat</span> <span class="id">rewrite_Forall_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>... }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>''. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">repeat</span> (<span class="id">etransitivity</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">left</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_fby_sem">unnest_fby_sem</a></span>... 1,2:<span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_app">Forall_app</a></span>. <span class="tactic">repeat</span> <span class="tactic">split</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation_refines">sem_equation_refines</a></span>; [| <span class="tactic">eauto</span>]. <span class="id">etransitivity</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;arrow&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>, <span class="id"><a href="Velus.Common.CommonPS.html#ps_adds_app">ps_adds_app</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.annots">annots</a></span> <span class="id">l</span>)) <span class="kwd">as</span> <span class="id">Hlength1</span> <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_exps_length">unnest_exps_length</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">x2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.annots">annots</a></span> <span class="id">l0</span>)) <span class="kwd">as</span> <span class="id">Hlength2</span> <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_exps_length">unnest_exps_length</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_exps">unnest_exps</a></span> <span class="kwd">in</span> *. <span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_ins">fresh_ins</a></span> <span class="id">l0</span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> <span class="id">reusable</span>)) <span class="kwd">as</span> <span class="id">Hndup4</span> <span class="tactic">by</span> <span class="id">ndup_r</span> <span class="id">Hndup1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_ins">fresh_ins</a></span> <span class="id">l</span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_ins">fresh_ins</a></span> <span class="id">l0</span>)) <span class="id">reusable</span>))) <span class="kwd">as</span> <span class="id">Hndup3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Permutation_PS_elements_ps_adds</span>'; <span class="id">ndup_simpl</span>... }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_exps_sem">unnest_exps_sem</a></span> <span class="kwd">in</span> <span class="id">H0</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">H</span>' [<span class="id">Href1</span> [<span class="id">Hvalid1</span> [<span class="id">Histst1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1</span>']]]]]. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span> <span class="kwd">in</span> <span class="id">Hsem1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id">G</span> <span class="id">H</span>' <span class="id">b</span>) <span class="id">l0</span> <span class="id">sss</span>) <span class="kwd">as</span> <span class="id">Hsem</span>' <span class="tactic">by</span> (<span class="tactic">repeat</span> <span class="id">rewrite_Forall_forall</span>; <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>; <span class="tactic">eauto</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_exps_sem">unnest_exps_sem</a></span> <span class="kwd">in</span> <span class="id">H1</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">H</span>'' [<span class="id">Href2</span> [<span class="id">Hvalid2</span> [<span class="id">Histst2</span> [<span class="id">Hsem2</span> <span class="id">Hsem2</span>']]]]]. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span> <span class="kwd">in</span> <span class="id">Hsem2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> (<span class="id">e</span> : <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.exp">exp</a></span>) (<span class="id">v</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux.value">OpAux.value</a></span>) =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id">G</span> <span class="id">H</span>'' <span class="id">b</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>]) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x2</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">s0ss</span>)) <span class="kwd">as</span> <span class="id">Hsem</span>''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">repeat</span> <span class="id">rewrite_Forall_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>... }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>''. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">repeat</span> (<span class="id">etransitivity</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">left</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_arrow_sem">unnest_arrow_sem</a></span>... 1,2:<span class="id">solve_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_app">Forall_app</a></span>. <span class="tactic">repeat</span> <span class="tactic">split</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation_refines">sem_equation_refines</a></span>; [| <span class="tactic">eauto</span>]. <span class="id">etransitivity</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;app&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">inv_bind</span>. <span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_exps">unnest_exps</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x4</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="kwd">as</span> <span class="id">Hlength4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.map_bind2_unnest_exp_length">map_bind2_unnest_exp_length</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">eauto</span>. <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_exps_sem">unnest_exps_sem</a></span> <span class="kwd">in</span> <span class="id">H0</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">H</span>' [<span class="id">Href1</span> [<span class="id">Hvalid1</span> [<span class="id">Histst1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1</span>']]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_noops_exps_sem">unnest_noops_exps_sem</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> (<span class="id">H</span>''&amp;<span class="id">Href2</span>&amp;<span class="id">Hvalid2</span>&amp;<span class="id">Histst2</span>&amp;<span class="id">Hsem2</span>&amp;<span class="id">Hsem2</span>')...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3:<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.find_node_incks">find_node_incks</a></span>. <span class="tactic">rewrite</span> <span class="id">H6</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>''. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">auto</span>). <span class="id">etransitivity</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">right</span>. <span class="tactic">eexists</span>; <span class="tactic">split</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Sapp">Sapp</a></span> <span class="kwd">with</span> (<span class="id">ss</span>:=(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#x">x</a></span>]) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#x">x</a></span>) <span class="id">ss</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat_map">concat_map</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_map_2">Forall2_map_2</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#concat_map_singl2">concat_map_singl2</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_app">Forall_app</a></span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation_refines">sem_equation_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;app&nbsp;(reset)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>, <span class="id"><a href="Velus.Common.CommonPS.html#ps_adds_app">ps_adds_app</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 5 <span class="id">inv_bind</span>. <span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_exps">unnest_exps</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hs</span>:=<span class="id">H2</span>). <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_reset_Some">unnest_reset_Some</a></span> <span class="kwd">in</span> <span class="id">Hs</span> <span class="kwd">as</span> [<span class="id">er</span>' ?]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.bind2_spec">bind2_spec</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> [? [? [? [? <span class="id">Hret</span>]]]]. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.ret_spec">ret_spec</a></span> <span class="kwd">in</span> <span class="id">Hret</span>; <span class="id">inv</span> <span class="id">Hret</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_in">fresh_in</a></span> <span class="id">r</span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> <span class="id">reusable</span>)) <span class="kwd">as</span> <span class="id">Hndup4</span> <span class="tactic">by</span> <span class="id">ndup_r</span> <span class="id">Hndup1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_ins">fresh_ins</a></span> <span class="id">l</span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.fresh_in">fresh_in</a></span> <span class="id">r</span>)) <span class="id">reusable</span>))) <span class="kwd">as</span> <span class="id">Hndup3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Permutation_PS_elements_ps_adds</span>'; <span class="id">ndup_simpl</span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x5</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_in">n_in</a></span> <span class="id">n</span>)) <span class="kwd">as</span> <span class="id">Hlength4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.map_bind2_unnest_exp_length">map_bind2_unnest_exp_length</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">eauto</span>. <span class="tactic">congruence</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_exps_sem">unnest_exps_sem</a></span> <span class="kwd">in</span> <span class="id">H0</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">H</span>' [<span class="id">Href1</span> [<span class="id">Hvalid1</span> [<span class="id">Histst1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1</span>']]]]].<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_noops_exps_sem">unnest_noops_exps_sem</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="kwd">as</span> (<span class="id">H</span>''&amp;<span class="id">Href2</span>&amp;<span class="id">Hvalid2</span>&amp;<span class="id">Histst2</span>&amp;<span class="id">Hsem2</span>&amp;<span class="id">Hsem2</span>')...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3:<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_concat">Forall2_concat</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.find_node_incks">find_node_incks</a></span>. <span class="tactic">rewrite</span> <span class="id">H8</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>; <span class="tactic">auto</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id">G</span> <span class="id">H</span>' <span class="id">b</span> <span class="id">r</span> [<span class="id">rs</span>]) <span class="kwd">as</span> <span class="id">Hsemr</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>; <span class="tactic">eauto</span>. } <span class="tactic">clear</span> <span class="id">H15</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_reset_sem">unnest_reset_sem</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">r</span>)) <span class="kwd">with</span> (<span class="id">H0</span>:=<span class="id">H</span>'') <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">simpl</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3:<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="tactic">clear</span> <span class="id">H2</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_exp_sem">unnest_exp_sem</a></span> <span class="kwd">with</span> (<span class="id">H</span>:=<span class="id">H</span>'') <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">H</span>''' [? [? [? [? ?]]]]]; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>. <span class="tactic">exists</span> <span class="id">H</span>'''; <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [<span class="id">H</span>'''' [<span class="id">Href3</span> [<span class="id">Hvalid3</span> [<span class="id">Histst3</span> [<span class="id">Hsem3</span> <span class="id">Hsem3</span>']]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>''''. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">repeat</span> (<span class="id">etransitivity</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">right</span>. <span class="tactic">eexists</span>; <span class="tactic">split</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Sreset">Sreset</a></span> <span class="kwd">with</span> (<span class="id">ss</span>:=(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#x">x</a></span>]) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#x">x</a></span>) <span class="id">ss</span>))) (<span class="id">rs</span>:=<span class="id">rs</span>) (<span class="id">bs</span>:=<span class="id">bs</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat_map">concat_map</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_map_2">Forall2_map_2</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_forall</span>. <span class="tactic">repeat</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#concat_map_singl2">concat_map_singl2</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_app">Forall_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="id">solve_forall</span>; (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation_refines">sem_equation_refines</a></span>; [| <span class="tactic">eauto</span>]); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">etransitivity</span>...<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="CORRECTNESS.map_bind2_unnest_rhs_sem">map_bind2_unnest_rhs_sem</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">vars</span> <span class="id">b</span> <span class="id">es</span> <span class="id">H</span> <span class="id">vs</span> <span class="id">es</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>' <span class="id">reusable</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_ins">anon_ins</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.wl_exp">wl_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_ins">anon_ins</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span>)) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.map_bind2">map_bind2</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_rhs">unnest_rhs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id">es</span>', <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">exists</span> <span class="id">H</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id">H</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id">st</span>' (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id">H</span>' (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id">st</span>') /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">es</span>' <span class="id">vs</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">e</span> <span class="id">v</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>]) <span class="id">es</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">e</span>', (<span class="id">es</span>' = [<span class="id">e</span>'] /\ <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id">e</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span>)) <span class="id">es</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">eqs</span>')).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof29')">Proof with</div>
<div class="proofscript" id="proof29">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">es</span>; <span class="tactic">intros</span> * <span class="id">Hndup</span> <span class="id">Hwt</span> <span class="id">Hsem</span> <span class="id">Hvalid</span> <span class="id">Histst</span> <span class="id">Hmap</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">exists</span> <span class="id">H</span>; <span class="tactic">simpl</span>. <span class="id">inv</span> <span class="id">Hsem</span>. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hwt</span>. <span class="id">inv</span> <span class="id">Hsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_ins">anon_ins</a></span> <span class="kwd">in</span> *. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>, <span class="id"><a href="Velus.Common.CommonPS.html#ps_adds_app">ps_adds_app</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_ins">anon_ins</a></span> <span class="id">es</span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> <span class="id">reusable</span>)) <span class="kwd">as</span> <span class="id">Hndup4</span> <span class="tactic">by</span> <span class="id">ndup_r</span> <span class="id">Hndup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_in">anon_in</a></span> <span class="id">a</span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_ins">anon_ins</a></span> <span class="id">es</span>)) <span class="id">reusable</span>))) <span class="kwd">as</span> <span class="id">Hndup3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Permutation_PS_elements_ps_adds</span>'; <span class="id">ndup_simpl</span>... }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_follows">st_follows</a></span> <span class="id">st</span> <span class="id">x1</span>) <span class="kwd">as</span> <span class="id">Hfollows1</span> <span class="tactic">by</span> <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_rhs_sem">unnest_rhs_sem</a></span> <span class="kwd">in</span> <span class="id">H0</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">H</span>' [<span class="id">Href1</span> [<span class="id">Hvalid1</span> [<span class="id">Histst1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1</span>']]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id">G</span> <span class="id">H</span>' <span class="id">b</span>) <span class="id">es</span> <span class="id">l</span>') <span class="kwd">as</span> <span class="id">Hsem</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">repeat</span> <span class="id">rewrite_Forall_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>... }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHes</span> <span class="kwd">in</span> <span class="id">H1</span>... <span class="tactic">clear</span> <span class="id">IHes</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">H</span>'' [<span class="id">Href2</span> [<span class="id">Hvalid2</span> [<span class="id">Histst2</span> [<span class="id">Hsem2</span> <span class="id">Hsem2</span>']]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>''. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">auto</span>); <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etransitivity</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">constructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hsem1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">left</span>. <span class="tactic">repeat</span> <span class="id">rewrite_Forall_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">right</span>. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">e</span>' [? <span class="id">H0</span>]]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">e</span>'. <span class="tactic">split</span>... <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_app">Forall_app</a></span>. <span class="tactic">split</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation_refines">sem_equation_refines</a></span>...<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="CORRECTNESS.unnest_rhss_sem">unnest_rhss_sem</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">vars</span> <span class="id">b</span> <span class="id">es</span> <span class="id">H</span> <span class="id">vs</span> <span class="id">es</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>' <span class="id">reusable</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_ins">anon_ins</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_exp">wt_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_tys">st_tys</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>)) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>)) (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_ins">anon_ins</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span>)) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_rhss">unnest_rhss</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id">es</span>', <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">exists</span> <span class="id">H</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id">H</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id">st</span>' (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>)) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id">H</span>' (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id">st</span>') /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> '(<span class="id">e</span>, <span class="id">v</span>) =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.combine_for_numstreams">combine_for_numstreams</a></span> <span class="id">es</span>' (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span>)) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span>) <span class="id">eqs</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof30')">Proof with</div>
<div class="proofscript" id="proof30">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hndup</span> <span class="id">Hwt</span> <span class="id">Hsem</span> <span class="id">Hvalid</span> <span class="id">Histst</span> <span class="id">Hnorm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_exp">wt_exp</a></span> <span class="id">G</span> (<span class="id">vars</span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_tys">st_tys</a></span> <span class="id">st</span>')) <span class="id">es</span>') <span class="kwd">as</span> <span class="id">Hwt</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_rhss_wt">unnest_rhss_wt</a></span> <span class="kwd">in</span> <span class="id">Hnorm</span> <span class="kwd">as</span> [? ?]... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_rhss">unnest_rhss</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.map_bind2_unnest_rhs_sem">map_bind2_unnest_rhs_sem</a></span> <span class="kwd">in</span> <span class="id">H0</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">H</span>' [<span class="id">Href1</span> [<span class="id">Hvalid1</span> [<span class="id">Histst1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1</span>']]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>'. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hsem</span>. <span class="tactic">induction</span> <span class="id">Hsem1</span>; <span class="tactic">simpl</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">induction</span> <span class="id">H0</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hwt</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.numstreams">numstreams</a></span> <span class="id">x</span> = 1) <span class="kwd">as</span> <span class="id">Hnumstreams</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_numstreams">sem_exp_numstreams</a></span> <span class="kwd">in</span> <span class="id">H0</span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">Hnumstreams</span>; <span class="tactic">simpl</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">Hnumstreams</span>; <span class="tactic">simpl</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [? [? <span class="id">H0</span>]]; <span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hwt</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.numstreams">numstreams</a></span> <span class="id">x1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">y</span>) <span class="kwd">as</span> <span class="id">Hnumstreams</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_numstreams">sem_exp_numstreams</a></span> <span class="kwd">in</span> <span class="id">H0</span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#firstn_app">firstn_app</a></span>, <span class="id">Hnumstreams</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#firstn_all">firstn_all</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.sub_diag">Nat.sub_diag</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#firstn_O">firstn_O</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#skipn_app">skipn_app</a></span>...<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.combine_for_numstreams_length">combine_for_numstreams_length</a></span> {<span class="id">V</span>} : <span class="kwd">forall</span> <span class="id">es</span> (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#V">V</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.combine_for_numstreams">combine_for_numstreams</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof31')">Proof.</div>
<div class="proofscript" id="proof31">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">es</span>; <span class="tactic">intros</span> <span class="id">vs</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.combine_for_numstreams_fst_split">combine_for_numstreams_fst_split</a></span> {<span class="id">V</span>} : <span class="kwd">forall</span> <span class="id">es</span> (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#V">V</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="tactic">split</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.combine_for_numstreams">combine_for_numstreams</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span>)) = <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof32')">Proof.</div>
<div class="proofscript" id="proof32">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">es</span>; <span class="tactic">intros</span> <span class="id">vs</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="tactic">split</span> <span class="id">_</span>) <span class="id">eqn</span>:<span class="id">Hsplit</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id">l</span>, <span class="id">l0</span>) = <span class="id">es</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> &lt;- <span class="id">Hsplit</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">f_equal</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.combine_for_numstreams_numstreams">combine_for_numstreams_numstreams</a></span> {<span class="id">V</span>} : <span class="kwd">forall</span> <span class="id">es</span> (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#V">V</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.annots">annots</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> '(<span class="id">e</span>, <span class="id">v</span>) =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.numstreams">numstreams</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>) (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.combine_for_numstreams">combine_for_numstreams</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof33')">Proof with</div>
<div class="proofscript" id="proof33">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">es</span>; <span class="tactic">intros</span> <span class="id">vs</span> <span class="id">Hlen</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_length">app_length</a></span> <span class="kwd">in</span> <span class="id">Hlen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.length_annot_numstreams">length_annot_numstreams</a></span> <span class="kwd">in</span> <span class="id">Hlen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">constructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#firstn_length">firstn_length</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.min_l">Nat.min_l</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">IHes</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#skipn_length">skipn_length</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.combine_for_numstreams_nth_2">combine_for_numstreams_nth_2</a></span> {<span class="id">V1</span> <span class="id">V2</span>} : <span class="kwd">forall</span> <span class="id">es</span> (<span class="id">v1s</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#V1">V1</a></span>) (<span class="id">v2s</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#V2">V2</a></span>) <span class="id">n</span> <span class="id">n0</span> <span class="id">e</span> <span class="id">v1</span> <span class="id">v2</span> <span class="id">d1</span> <span class="id">d2</span> <span class="id">de1</span> <span class="id">de2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v1s">v1s</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.annots">annots</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v2s">v2s</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.annots">annots</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span> &lt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n0">n0</a></span> &lt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v1">v1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.combine_for_numstreams">combine_for_numstreams</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v1s">v1s</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#de1">de1</a></span> = (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v1">v1</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.combine_for_numstreams">combine_for_numstreams</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#es">es</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v2s">v2s</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#de2">de2</a></span> = (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v2">v2</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">n</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">n</span>' &lt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v1s">v1s</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id">n</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v1s">v1s</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#d1">d1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n0">n0</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v1">v1</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#d1">d1</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id">n</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v2s">v2s</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#d2">d2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n0">n0</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v2">v2</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#d2">d2</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof34')">Proof with</div>
<div class="proofscript" id="proof34">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">es</span>; <span class="tactic">intros</span> <span class="id">v1s</span> <span class="id">v2s</span> <span class="id">n</span> <span class="id">n0</span> <span class="id">e</span> <span class="id">v1</span> <span class="id">v2</span> <span class="id">d1</span> <span class="id">d2</span> <span class="id">de1</span> <span class="id">de2</span> <span class="id">Hlen1</span> <span class="id">Hlen2</span> <span class="id">Hn</span> <span class="id">Hn0</span> <span class="id">Hnth1</span> <span class="id">Hnth2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_length">app_length</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.length_annot_numstreams">length_annot_numstreams</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hnth1</span>; <span class="id">inv</span> <span class="id">Hnth2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#firstn_length">firstn_length</a></span> <span class="kwd">in</span> <span class="id">Hn0</span>; <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.min_glb_lt_iff">Nat.min_glb_lt_iff</a></span> <span class="kwd">in</span> <span class="id">Hn0</span>; <span class="tactic">destruct</span> <span class="id">Hn0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">n0</span>. <span class="tactic">repeat</span> <span class="tactic">split</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#nth_firstn_1">nth_firstn_1</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#nth_firstn_1">nth_firstn_1</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Lt.html#lt_S_n">lt_S_n</a></span> <span class="kwd">in</span> <span class="id">Hn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHes</span> <span class="kwd">in</span> <span class="id">Hn</span>. 4,5,6:<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">Hn</span> <span class="kwd">as</span> [<span class="id">n</span>' [<span class="id">Hlen</span>' [<span class="id">Hnth1</span>' <span class="id">Hnth2</span>']]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> (<span class="id">n</span>'+(<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.numstreams">numstreams</a></span> <span class="id">a</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#skipn_length">skipn_length</a></span> <span class="kwd">in</span> <span class="id">Hlen</span>'. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#nth_skipn">nth_skipn</a></span> <span class="kwd">in</span> <span class="id">Hnth1</span>'...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#nth_skipn">nth_skipn</a></span> <span class="kwd">in</span> <span class="id">Hnth2</span>'...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#skipn_length">skipn_length</a></span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#skipn_length">skipn_length</a></span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.unnest_equation_sem">unnest_equation_sem</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">vars</span> <span class="id">H</span> <span class="id">b</span> <span class="id">equ</span> <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>' <span class="id">reusable</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_in_eq">anon_in_eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#equ">equ</a></span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_equation">wt_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_tys">st_tys</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#equ">equ</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#equ">equ</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>)) (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_in_eq">anon_in_eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#equ">equ</a></span>)) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_equation">unnest_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#equ">equ</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">exists</span> <span class="id">H</span>', <span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id">H</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id">st</span>' (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>)) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id">H</span>' (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id">st</span>') /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span>) <span class="id">eqs</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof35')">Proof with</div>
<div class="proofscript" id="proof35">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hndup</span> <span class="id">Hwt</span> <span class="id">Hsem</span> <span class="id">Hvalid</span> <span class="id">Histst</span> <span class="id">Hnorm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_equation">unnest_equation</a></span> <span class="kwd">in</span> <span class="id">Hnorm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">equ</span> <span class="kwd">as</span> [<span class="id">xs</span> <span class="id">es</span>]. <span class="id">inv</span> <span class="id">Hwt</span>. <span class="id">inv</span> <span class="id">Hsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.typesof">typesof</a></span> <span class="id">x</span> = <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.typesof">typesof</a></span> <span class="id">es</span>) <span class="kwd">as</span> <span class="id">Hannots</span> <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_rhss_typesof">unnest_rhss_typesof</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_rhss_sem">unnest_rhss_sem</a></span> <span class="kwd">in</span> <span class="id">H2</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [<span class="id">H</span>' [<span class="id">Href1</span> [<span class="id">Hvalid1</span> [<span class="id">Histst1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1</span>']]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>'. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_app">Forall_app</a></span>. <span class="tactic">split</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hsem1</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">rewrite_Forall_forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x1</span>. <span class="tactic">repeat</span> <span class="id">simpl_In</span>. <span class="id">inv</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">HIn</span> := <span class="id">H8</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In_nth">In_nth</a></span> <span class="kwd">with</span> (<span class="id">d</span>:=(<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.hd_default">hd_default</a></span> [], [])) <span class="kwd">in</span> <span class="id">H8</span>. <span class="tactic">destruct</span> <span class="id">H8</span> <span class="kwd">as</span> [<span class="id">n</span> [<span class="id">Hn</span> <span class="id">Hnth</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.combine_for_numstreams_length">combine_for_numstreams_length</a></span> <span class="kwd">in</span> <span class="id">Hn</span>. <span class="tactic">rewrite</span> &lt;- (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.combine_for_numstreams_length">combine_for_numstreams_length</a></span> <span class="id">_</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">ss</span>)) <span class="kwd">in</span> <span class="id">Hn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">HIn</span>' := <span class="id">Hn</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_In">nth_In</a></span> <span class="kwd">with</span> (<span class="id">d</span>:=(<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.hd_default">hd_default</a></span> [], [])) <span class="kwd">in</span> <span class="id">HIn</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id">Hsem1</span> <span class="id">_</span> <span class="id">HIn</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) <span class="id">eqn</span>:<span class="id">Hnth</span>' <span class="kwd">in</span> <span class="id">Hsem1</span>. <span class="tactic">rewrite</span> <span class="id">Hnth</span>' <span class="kwd">in</span> <span class="id">HIn</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">e</span> = <span class="id">e0</span>) <span class="kwd">as</span> <span class="id">Hee0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#split_nth">split_nth</a></span> <span class="kwd">in</span> <span class="id">Hnth</span>; <span class="id">inv</span> <span class="id">Hnth</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#split_nth">split_nth</a></span> <span class="kwd">in</span> <span class="id">Hnth</span>'; <span class="id">inv</span> <span class="id">Hnth</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.combine_for_numstreams_fst_split">combine_for_numstreams_fst_split</a></span>. <span class="tactic">reflexivity</span>. } <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Seq">Seq</a></span> <span class="kwd">with</span> (<span class="id">ss</span>:=[<span class="id">l0</span>]).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">repeat</span> <span class="tactic">constructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">rewrite_Forall_forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> &lt;- <span class="id">Hannots</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.typesof_annots">typesof_annots</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l</span>) <span class="kwd">with</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.numstreams">numstreams</a></span> <span class="id">e0</span>). <span class="tactic">replace</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l0</span>) <span class="kwd">with</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.numstreams">numstreams</a></span> <span class="id">e0</span>). <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.combine_for_numstreams_numstreams">combine_for_numstreams_numstreams</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">apply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">HIn</span>'... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.combine_for_numstreams_numstreams">combine_for_numstreams_numstreams</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">apply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">HIn</span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_var_refines">sem_var_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.combine_for_numstreams_nth_2">combine_for_numstreams_nth_2</a></span> <span class="id">x</span> <span class="id">xs</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">ss</span>) <span class="id">n</span> <span class="id">n0</span> <span class="id">e0</span> <span class="id">l</span> <span class="id">l0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">a</span> <span class="id">b0</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.hd_default">hd_default</a></span> [], []) (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.hd_default">hd_default</a></span> [], [])) <span class="kwd">as</span> <span class="id">Hcomb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hcomb</span> <span class="kwd">in</span> <span class="id">H7</span>. <span class="tactic">clear</span> <span class="id">Hcomb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2,3:(<span class="tactic">rewrite</span> &lt;- <span class="id">Hannots</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.typesof_annots">typesof_annots</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span> <span class="kwd">in</span> <span class="id">H1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="tactic">eapply</span> <span class="id">H1</span>. 2:(<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eapply</span> <span class="id">H1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3,4:<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:(<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.combine_for_numstreams_length">combine_for_numstreams_length</a></span> <span class="kwd">in</span> <span class="id">Hn</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H7</span> <span class="kwd">as</span> [<span class="id">n</span>' [<span class="id">Hlen</span>' [<span class="id">Hnth1</span>' <span class="id">Hnth2</span>']]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H3</span>...<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="CORRECTNESS.unnest_equations_sem">unnest_equations_sem</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">vars</span> <span class="id">b</span> <span class="id">eqs</span> <span class="id">H</span> <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>' <span class="id">reusable</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_in_eqs">anon_in_eqs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#eqs">eqs</a></span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_equation">wt_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span> ++ <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_tys">st_tys</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>)) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#eqs">eqs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#eqs">eqs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.st_valid_reuse">st_valid_reuse</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>)) (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_in_eqs">anon_in_eqs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#eqs">eqs</a></span>)) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#reusable">reusable</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_equations">unnest_equations</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#eqs">eqs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">exists</span> <span class="id">H</span>', <span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id">H</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span>) <span class="id">eqs</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof36')">Proof with</div>
<div class="proofscript" id="proof36">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">eqs</span>; <span class="tactic">intros</span> * <span class="id">Hndup</span> <span class="id">Hwt</span> <span class="id">Hsem</span> <span class="id">Hvalid</span> <span class="id">Hdome</span> <span class="id">Hnorm</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_equations">unnest_equations</a></span> <span class="kwd">in</span> *; <span class="id">inv</span> <span class="id">Hwt</span>; <span class="id">inv</span> <span class="id">Hsem</span>; <span class="tactic">repeat</span> <span class="id">inv_bind</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">exists</span> <span class="id">H</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_in_eqs">anon_in_eqs</a></span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>, <span class="id"><a href="Velus.Common.CommonPS.html#ps_adds_app">ps_adds_app</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_in_eqs">anon_in_eqs</a></span> <span class="id">eqs</span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> <span class="id">reusable</span>)) <span class="kwd">as</span> <span class="id">Hndup4</span> <span class="tactic">by</span> <span class="id">ndup_r</span> <span class="id">Hndup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_in_eq">anon_in_eq</a></span> <span class="id">a</span>) ++ <span class="id"><a href="Velus.Common.CommonPS.html#PS.elements">PS.elements</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_in_eqs">anon_in_eqs</a></span> <span class="id">eqs</span>)) <span class="id">reusable</span>))) <span class="kwd">as</span> <span class="id">Hndup3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Permutation_PS_elements_ps_adds</span>'; <span class="id">ndup_simpl</span>... }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_equation">wt_equation</a></span> <span class="id">G</span> (<span class="id">vars</span> ++ <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_tys">st_tys</a></span> <span class="id">x1</span>)) <span class="id">eqs</span>) <span class="kwd">as</span> <span class="id">Hwt</span>' <span class="tactic">by</span> (<span class="id">solve_forall</span>; <span class="tactic">repeat</span> <span class="id">solve_incl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_equation_sem">unnest_equation_sem</a></span> <span class="kwd">in</span> <span class="id">H0</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">H</span>' [<span class="id">Href1</span> [<span class="id">Hvalid1</span> [<span class="id">Histst1</span> <span class="id">Hsem1</span>]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id">G</span> <span class="id">H</span>' <span class="id">b</span>) <span class="id">eqs</span>) <span class="tactic">by</span> (<span class="id">solve_forall</span>; <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation_refines">sem_equation_refines</a></span>; <span class="tactic">eauto</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_equations">unnest_equations</a></span> <span class="id">G</span> <span class="id">eqs</span> <span class="id">x1</span> = (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x2</span>, <span class="id">st</span>')) <span class="kwd">as</span> <span class="id">Hnorm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_equations">unnest_equations</a></span>; <span class="tactic">repeat</span> <span class="id">inv_bind</span>. <span class="tactic">repeat</span> <span class="tactic">eexists</span>; <span class="tactic">eauto</span>. <span class="id">inv_bind</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHeqs</span> <span class="kwd">in</span> <span class="id">Hnorm</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hnorm</span> <span class="kwd">as</span> [<span class="id">H</span>'' [<span class="id">Href</span> <span class="id">Hsem2</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>''. <span class="tactic">repeat</span> <span class="tactic">split</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etransitivity</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_app">Forall_app</a></span>. <span class="tactic">split</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation_refines">sem_equation_refines</a></span>...<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<h3> Preservation of sem_node </h3>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.unnest_node_sem_equation">unnest_node_sem_equation</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">H</span> <span class="id">n</span> <span class="id">Hwl</span> <span class="id">Hpref</span> <span class="id">ins</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_node">wt_node</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_in">n_in</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span> ++ <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_vars">n_vars</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span> ++ <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_out">n_out</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sem_var">sem_var</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span>) (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_in">n_in</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span>)) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ins">ins</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.clocks_of">clocks_of</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ins">ins</a></span>)) (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_eqs">n_eqs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>', <span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id">H</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.clocks_of">clocks_of</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ins">ins</a></span>)) (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_eqs">n_eqs</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_node">unnest_node</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hwl">Hwl</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hpref">Hpref</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof37')">Proof with</div>
<div class="proofscript" id="proof37">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hwt</span> <span class="id">Hdom</span> <span class="id">Hins</span> <span class="id">Hsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_nodup">n_nodup</a></span> <span class="id">n</span>) <span class="kwd">as</span> <span class="id">Hndup</span>; <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#fst_NoDupMembers">fst_NoDupMembers</a></span> <span class="kwd">in</span> <span class="id">Hndup</span>; <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span> <span class="kwd">in</span> <span class="id">Hndup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_equations_sem">unnest_equations_sem</a></span> <span class="kwd">with</span> (<span class="id">eqs</span>:=<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_eqs">n_eqs</a></span> <span class="id">n</span>) (<span class="id">st</span>:=<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.init_st">init_st</a></span>)...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;5: <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#surjective_pairing">surjective_pairing</a></span>; <span class="tactic">subst</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonPS.html#PSP.elements_empty">PSP.elements_empty</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">ndup_r</span> <span class="id">Hndup</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_tys">st_tys</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.init_st_anns">init_st_anns</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hwt</span> <span class="kwd">as</span> [<span class="id">_</span> [<span class="id">_</span> [<span class="id">_</span> <span class="id">Hwt</span>]]]; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#map_fst_idty">map_fst_idty</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.init_st_valid_reuse">init_st_valid_reuse</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">replace</span> (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Common.CommonPS.html#PS.empty">PS.empty</a></span>) <span class="kwd">with</span> (<span class="id"><a href="Velus.Common.CommonPS.html#ps_from_list">ps_from_list</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_in_eqs">anon_in_eqs</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_eqs">n_eqs</a></span> <span class="id">n</span>)))); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonPS.html#ps_from_list_ps_of_list">ps_from_list_ps_of_list</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonPS.html#ps_of_list_ps_to_list_Perm">ps_of_list_ps_to_list_Perm</a></span>; <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>; <span class="tactic">repeat</span> <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="kwd">in</span> *; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">ndup_r</span> <span class="id">Hndup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="kwd">in</span> <span class="id">Hndup</span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_l">NoDup_app_l</a></span> <span class="kwd">in</span> <span class="id">Hndup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="kwd">in</span> <span class="id">Hndup</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.norm1_not_in_elab_prefs">norm1_not_in_elab_prefs</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="Velus.Common.CommonPS.html#ps_from_list_ps_of_list">ps_from_list_ps_of_list</a></span>, <span class="id">PS_For_all_Forall</span>', &lt;- <span class="id">Hpref</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">pose</span> <span class="id">proof</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_good">n_good</a></span> <span class="id">n</span>) <span class="kwd">as</span> (<span class="id">Good</span>&amp;<span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_incl">Forall_incl</a></span>; [<span class="tactic">eauto</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_tl">incl_tl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_appl">incl_appl</a></span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">replace</span> (<span class="id"><a href="Velus.Common.CommonPS.html#ps_adds">ps_adds</a></span> <span class="id">_</span> <span class="id"><a href="Velus.Common.CommonPS.html#PS.empty">PS.empty</a></span>) <span class="kwd">with</span> (<span class="id"><a href="Velus.Common.CommonPS.html#ps_from_list">ps_from_list</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.anon_in_eqs">anon_in_eqs</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_eqs">n_eqs</a></span> <span class="id">n</span>)))); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">PS_For_all_Forall</span>', &lt;- <span class="id">Hpref</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">pose</span> <span class="id">proof</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_good">n_good</a></span> <span class="id">n</span>) <span class="kwd">as</span> (<span class="id">Good</span>&amp;<span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_incl">Forall_incl</a></span>; [<span class="tactic">eauto</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_tl">incl_tl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_appr">incl_appr</a></span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.init_st_anns">init_st_anns</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>, <span class="id"><a href="Velus.Common.Common.html#map_fst_idty">map_fst_idty</a></span>...<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="CORRECTNESS.unnest_node_eq">unnest_node_eq</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">G</span>' <span class="id">f</span> <span class="id">n</span> <span class="id">Hwl</span> <span class="id">Hpref</span> <span class="id">ins</span> <span class="id">outs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">n</span> <span class="id">n</span>' =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_name">n_name</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span> = <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_name">n_name</a></span> <span class="id">n</span>') <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">G</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.global_iface_eq">global_iface_eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">G</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.global_sem_refines">global_sem_refines</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">G</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_global">wt_global</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span>::<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_global">wc_global</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span>::<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ord.Ordered_nodes">Ordered_nodes</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span>::<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ord.Ordered_nodes">Ordered_nodes</a></span> ((<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_node">unnest_node</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hwl">Hwl</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hpref">Hpref</a></span>)::<span class="id">G</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_node">sem_node</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span>::<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#f">f</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ins">ins</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#outs">outs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_node">sem_node</a></span> ((<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_node">unnest_node</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hwl">Hwl</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hpref">Hpref</a></span>)::<span class="id">G</span>') <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#f">f</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ins">ins</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#outs">outs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof38')">Proof with</div>
<div class="proofscript" id="proof38">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hnames</span> <span class="id">Hiface</span> <span class="id">Href</span> <span class="id">HwtG</span> <span class="id">HwcG</span> <span class="id">Hord1</span> <span class="id">Hord2</span> <span class="id">Hsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">n</span>' =&gt; <span class="tactic">exists</span> <span class="id">v</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span> <span class="id">G</span> /\ <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_name">n_name</a></span> <span class="id">n</span> &lt;&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_name">n_name</a></span> <span class="id">n</span>') <span class="id">G</span>') <span class="kwd">as</span> <span class="id">Hnames</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">G</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">G</span>') <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">Hnames</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">HwtG</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore1">Forall2_ignore1</a></span>. <span class="id">solve_forall</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ord.Ordered_nodes">Ordered_nodes</a></span> (<span class="id">n</span> :: <span class="id">G</span>')) <span class="kwd">as</span> <span class="id">Hord</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">Hord2</span>. <span class="tactic">constructor</span>... <span class="tactic">clear</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hord1</span>. <span class="tactic">intros</span> ? <span class="id">Hisin</span>. <span class="tactic">apply</span> <span class="id">H4</span> <span class="kwd">in</span> <span class="id">Hisin</span> <span class="kwd">as</span> [<span class="id">Hneq</span> <span class="id">Hname</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">clear</span> - <span class="id">Hnames</span> <span class="id">Hname</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hnames</span>; <span class="id">inv</span> <span class="id">Hname</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">left</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">right</span>; <span class="tactic">auto</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsem</span>; <span class="tactic">assert</span> (<span class="id">Hfind</span>:=<span class="id">H0</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> (<span class="id"><a href="Velus.Common.CommonPS.html#ident_eqb">ident_eqb</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_name">n_name</a></span> <span class="id">n</span>) <span class="id">f</span>) <span class="id">eqn</span>:<span class="id">Hident</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">HwcG</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*The&nbsp;semantics&nbsp;of&nbsp;equations&nbsp;can&nbsp;be&nbsp;given&nbsp;according&nbsp;to&nbsp;G&nbsp;only&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Forall_sem_equation_global_tl">Forall_sem_equation_global_tl</a></span> <span class="kwd">in</span> <span class="id">H3</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">inv</span> <span class="id">Hord1</span>. <span class="tactic">intro</span> <span class="id">contra</span>. <span class="tactic">apply</span> <span class="id">H9</span> <span class="kwd">in</span> <span class="id">contra</span> <span class="kwd">as</span> [? <span class="id">_</span>]; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;New&nbsp;env&nbsp;H'&nbsp;(restrict&nbsp;H)&nbsp;and&nbsp;its&nbsp;properties&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_node_restrict">LCS.sem_node_restrict</a></span> <span class="kwd">in</span> <span class="id">H3</span> <span class="kwd">as</span> (<span class="id">Hdom</span>&amp;<span class="id">Hins</span>'&amp;<span class="id">Houts</span>'&amp;<span class="id">Heqs</span>'); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="tactic">destruct</span> <span class="id">H6</span> <span class="kwd">as</span> (?&amp;?&amp;?&amp;?); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="Velus.Environment.html#Env.restrict">Env.restrict</a></span> <span class="id">H</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_in">n_in</a></span> <span class="id">n0</span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_vars">n_vars</a></span> <span class="id">n0</span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_out">n_out</a></span> <span class="id">n0</span>))) <span class="kwd">as</span> <span class="id">H</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">HeqH</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion_clear</span> <span class="id">HwtG</span>. <span class="tactic">rename</span> <span class="id">H0</span> <span class="id">into</span> <span class="id">Hwt</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_node_sem_equation">unnest_node_sem_equation</a></span> <span class="kwd">in</span> <span class="id">Heqs</span>' <span class="kwd">as</span> (<span class="id">H</span>''&amp;<span class="id">Href</span>'&amp;<span class="id">Heqs</span>'')...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Snode">Snode</a></span> <span class="kwd">with</span> (<span class="id">H</span>:=<span class="id">H</span>''); <span class="tactic">simpl</span>. 5:<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">Hident</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span>. <span class="tactic">repeat</span> <span class="id">rewrite_Forall_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_var_refines">sem_var_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span>. <span class="tactic">repeat</span> <span class="id">rewrite_Forall_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_var_refines">sem_var_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">clear</span> <span class="id">Hins</span>' <span class="id">Houts</span>' <span class="id">Hdom</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Forall_sem_equation_global_tl</span>'...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ord.find_node_not_Is_node_in">find_node_not_Is_node_in</a></span> <span class="kwd">in</span> <span class="id">Hord2</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#ident_eqb_refl">ident_eqb_refl</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="tactic">eauto</span>]. <span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_ref_sem_equation">sem_ref_sem_equation</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">specialize</span> (<span class="id">Href</span> <span class="id">f</span> <span class="id">ins</span> <span class="id">outs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#ident_eqb_neq">ident_eqb_neq</a></span> <span class="kwd">in</span> <span class="id">Hident</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">sem_node_cons</span>'...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Href</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">econstructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_impl_In">Forall_impl_In</a></span>; [| <span class="tactic">eauto</span>]. <span class="tactic">intros</span> <span class="id">eq</span> <span class="id">Hin</span> <span class="id">Hsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation_global_tl">sem_equation_global_tl</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ord.find_node_later_not_Is_node_in">find_node_later_not_Is_node_in</a></span> <span class="kwd">in</span> <span class="id">Hord1</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hisin</span>. <span class="tactic">apply</span> <span class="id">Hord1</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ord.Is_node_in_Exists">Is_node_in_Exists</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eexists</span>...<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id">unnest_global_names</span>' : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">Hwl</span> <span class="id">Hpref</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">n</span> <span class="id">n</span>' =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_name">n_name</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span> = <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_name">n_name</a></span> <span class="id">n</span>') <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_global">unnest_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hwl">Hwl</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hpref">Hpref</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof39')">Proof.</div>
<div class="proofscript" id="proof39">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">G</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.wt_global_Ordered_nodes">wt_global_Ordered_nodes</a></span> : <span class="kwd">forall</span> <span class="id">G</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_global">wt_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ord.Ordered_nodes">Ordered_nodes</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof40')">Proof.</div>
<div class="proofscript" id="proof40">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">G</span> <span class="id">Hwt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ord.wl_global_Ordered_nodes">wl_global_Ordered_nodes</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_global_NoDup">wt_global_NoDup</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">wt_global_Ordered_nodes</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="CORRECTNESS.unnest_global_refines">unnest_global_refines</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">Hwl</span> <span class="id">Hpref</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_global">wt_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_global">wc_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.global_sem_refines">global_sem_refines</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_global">unnest_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hwl">Hwl</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hpref">Hpref</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof41')">Proof with</div>
<div class="proofscript" id="proof41">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">G</span>; <span class="tactic">intros</span> * <span class="id">Hwt</span> <span class="id">Hwc</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.global_sem_ref_nil">global_sem_ref_nil</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assert</span> (<span class="id">Hwt</span>':=<span class="id">Hwt</span>). <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_global_wt">unnest_global_wt</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.wt_global_Ordered_nodes">wt_global_Ordered_nodes</a></span> <span class="kwd">in</span> <span class="id">Hwt</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.global_sem_ref_cons">global_sem_ref_cons</a></span> <span class="kwd">with</span> (<span class="id">f</span>:=<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_name">n_name</a></span> <span class="id">a</span>)...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">Hwt</span>. <span class="id">inv</span> <span class="id">Hwc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHG</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">ins</span> <span class="id">outs</span> <span class="id">Hsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_node_eq">unnest_node_eq</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">unnest_global_names</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_global_eq">unnest_global_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">inv</span> <span class="id">Hwt</span>. <span class="id">inv</span> <span class="id">Hwc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHG</span>...<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="CORRECTNESS.unnest_global_sem">unnest_global_sem</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">Hwl</span> <span class="id">Hprefs</span> <span class="id">f</span> <span class="id">ins</span> <span class="id">outs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_global">wt_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_global">wc_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_node">sem_node</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#f">f</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ins">ins</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#outs">outs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_node">sem_node</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_global">unnest_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hwl">Hwl</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hprefs">Hprefs</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#f">f</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ins">ins</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#outs">outs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof42')">Proof.</div>
<div class="proofscript" id="proof42">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_global_refines">unnest_global_refines</a></span> <span class="kwd">with</span> (<span class="id">Hwl</span>:=<span class="id">Hwl</span>) <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id">H</span> <span class="id">f</span> <span class="id">ins</span> <span class="id">outs</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="CORRECTNESS.unnest_global_sem_clock_inputs">unnest_global_sem_clock_inputs</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">Hwl</span> <span class="id">Hprefs</span> <span class="id">f</span> <span class="id">ins</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_clock_inputs">LCS.sem_clock_inputs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#f">f</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ins">ins</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_clock_inputs">LCS.sem_clock_inputs</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_global">unnest_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hwl">Hwl</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hprefs">Hprefs</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#f">f</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ins">ins</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof43')">Proof.</div>
<div class="proofscript" id="proof43">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnest_global_eq">unnest_global_eq</a></span> <span class="id">G</span> <span class="id">Hwl</span> <span class="id">Hprefs</span>) <span class="kwd">as</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">H</span> [<span class="id">n</span>' [<span class="id">Hfind</span> [<span class="id">Hvars</span> <span class="id">Hsem</span>]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.global_iface_eq_find">global_iface_eq_find</a></span> <span class="kwd">in</span> <span class="id">Heq</span> <span class="kwd">as</span> [? [? [<span class="id">Hname</span> [<span class="id">_</span> [<span class="id">Hin</span> <span class="id">Hout</span>]]]]]; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>. <span class="tactic">exists</span> <span class="id">x</span>. <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<h2> Preservation of the semantics through the second pass </h2>
<br/>
<h3> Manipulation of initialization streams </h3>
<br/>
<div class="doc">We want to specify the semantics of the init equations created during the normalization
      with idents stored in the env </div>
<br/>
&nbsp;&nbsp;<span class="kwd">CoFixpoint</span> <span class="id"><a name="CORRECTNESS.const_val">const_val</a></span> (<span class="id">b</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>) (<span class="id">v</span> : <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op.val">Op.val</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux.value">value</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">if</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#hd">Streams.hd</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux.present">present</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span> <span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux.absent">absent</a></span>) ⋅ (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#const_val">const_val</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#tl">Streams.tl</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.const_val_Cons">const_val_Cons</a></span> : <span class="kwd">forall</span> <span class="id">b</span> <span class="id">bs</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.const_val">const_val</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> ⋅ <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">if</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="kwd">then</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux.present">present</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span> <span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux.absent">absent</a></span>) ⋅ (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.const_val">const_val</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof44')">Proof.</div>
<div class="proofscript" id="proof44">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">b</span> <span class="id">bs</span> <span class="id">v</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#unfold_Stream">unfold_Stream</a></span> <span class="tactic">at</span> 1; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.const_val_const">const_val_const</a></span> : <span class="kwd">forall</span> <span class="id">b</span> <span class="id">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.const">const</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#c">c</a></span> ≡ <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.const_val">const_val</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op.sem_const">Op.sem_const</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#c">c</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof45')">Proof.</div>
<div class="proofscript" id="proof45">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">const_val_const</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">b0</span> <span class="id">b</span>] <span class="id">c</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="CORRECTNESS.sfby_const">sfby_const</a></span> : <span class="kwd">forall</span> <span class="id">bs</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sfby">sfby</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.const_val">const_val</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>) ≡ (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.const_val">const_val</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof46')">Proof.</div>
<div class="proofscript" id="proof46">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">CoFix</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">b</span> <span class="id">bs</span>] <span class="id">v</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.const_val_Cons">const_val_Cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b</span>; <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sfby_Cons">sfby_Cons</a></span>; <span class="tactic">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="CORRECTNESS.ite_false">ite_false</a></span> : <span class="kwd">forall</span> <span class="id">bs</span> <span class="id">xs</span> <span class="id">ys</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.aligned">aligned</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#xs">xs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.aligned">aligned</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ys">ys</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.ite">ite</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.const_val">const_val</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op.false_val">false_val</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#xs">xs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ys">ys</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ys">ys</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof47')">Proof.</div>
<div class="proofscript" id="proof47">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">CoFix</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">b</span> <span class="id">bs</span>] <span class="id">xs</span> <span class="id">ys</span> <span class="id">Hsync1</span> <span class="id">Hsync2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.const_val_Cons">const_val_Cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsync1</span>; <span class="id">inv</span> <span class="id">Hsync2</span>; <span class="tactic">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="CORRECTNESS.sfby_fby1">sfby_fby1</a></span> : <span class="kwd">forall</span> <span class="id">bs</span> <span class="id">v</span> <span class="id">y</span> <span class="id">ys</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.aligned">aligned</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ys">ys</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.fby1">fby1</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y">y</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.const_val">const_val</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ys">ys</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sfby">sfby</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y">y</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ys">ys</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof48')">Proof with</div>
<div class="proofscript" id="proof48">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">sfby_fby1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">b</span> <span class="id">bs</span>] <span class="id">v</span> <span class="id">y</span> <span class="id">ys</span> <span class="id">Hsync</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id">sfby_fby1</span> <span class="id">bs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsync</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.const_val_Cons">const_val_Cons</a></span>; <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#unfold_Stream">unfold_Stream</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">constructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">constructor</span>...<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">sfby_fby1</span>' : <span class="kwd">forall</span> <span class="id">y</span> <span class="id">y0s</span> <span class="id">ys</span> <span class="id">zs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.fby1">fby1</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y">y</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y0s">y0s</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ys">ys</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#zs">zs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#zs">zs</a></span> ≡ (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sfby">sfby</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y">y</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ys">ys</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof49')">Proof.</div>
<div class="proofscript" id="proof49">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">CoFix</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">y</span> <span class="id">y0s</span> <span class="id">ys</span> <span class="id">zs</span> <span class="id">Hfby1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hfby1</span>; <span class="tactic">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="CORRECTNESS.sfby_fby">sfby_fby</a></span> : <span class="kwd">forall</span> <span class="id">b</span> <span class="id">v</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.aligned">aligned</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y">y</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.fby">fby</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.const_val">const_val</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y">y</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sfby">sfby</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y">y</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof50')">Proof with</div>
<div class="proofscript" id="proof50">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">sfby_fby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">b</span> <span class="id">bs</span>] <span class="id">v</span> <span class="id">y</span> <span class="id">Hsync</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.const_val_Cons">const_val_Cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#unfold_Stream">unfold_Stream</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b</span>; <span class="tactic">simpl</span>; <span class="id">inv</span> <span class="id">Hsync</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">econstructor</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.sfby_fby1">sfby_fby1</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">econstructor</span>; <span class="tactic">simpl</span>...<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="CORRECTNESS.init_stream">init_stream</a></span> <span class="id">bs</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sfby">sfby</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op.true_val">true_val</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.const">const</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op.false_const">false_const</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Instance</span> <span class="id"><a name="CORRECTNESS.init_stream_Proper">init_stream_Proper</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.Morphisms.html#Proper">Proper</a></span> (@<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> ==&gt; @<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#EqSt">EqSt</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux.value">value</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.init_stream">init_stream</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof51')">Proof.</div>
<div class="proofscript" id="proof51">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">bs</span> <span class="id">bs</span>' <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.init_stream">init_stream</a></span>. <span class="tactic">rewrite</span> <span class="id">Heq</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="CORRECTNESS.fby_ite">fby_ite</a></span> : <span class="kwd">forall</span> <span class="id">bs</span> <span class="id">v</span> <span class="id">y0s</span> <span class="id">ys</span> <span class="id">zs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.aligned">aligned</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y0s">y0s</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> \/ <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.aligned">aligned</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ys">ys</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> \/ <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.aligned">aligned</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#zs">zs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.fby">fby</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y0s">y0s</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ys">ys</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#zs">zs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.ite">ite</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sfby">sfby</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op.true_val">true_val</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.const_val">const_val</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op.false_val">false_val</a></span>)) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y0s">y0s</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sfby">sfby</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ys">ys</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#zs">zs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof52')">Proof with</div>
<div class="proofscript" id="proof52">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">fby_init_stream_ite</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">b</span> <span class="id">bs</span>] <span class="id">v</span> <span class="id">y0s</span> <span class="id">ys</span> <span class="id">zs</span> <span class="id">Hsync</span> <span class="id">Hfby1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.fby_aligned">LCS.fby_aligned</a></span> <span class="kwd">in</span> <span class="id">Hsync</span> <span class="kwd">as</span> [<span class="id">Hsync1</span> [<span class="id">Hsync2</span> <span class="id">Hsync3</span>]]; [|<span class="tactic">auto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b</span>; <span class="id">inv</span> <span class="id">Hsync1</span>; <span class="id">inv</span> <span class="id">Hsync2</span>; <span class="id">inv</span> <span class="id">Hsync3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.const_val_Cons">const_val_Cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hfby1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sfby_Cons">sfby_Cons</a></span>. <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.sfby_const">sfby_const</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">sfby_fby1</span>'...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.ite_false">ite_false</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.const_val_Cons">const_val_Cons</a></span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sfby_Cons">sfby_Cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hfby1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="CORRECTNESS.fby_init_stream_ite">fby_init_stream_ite</a></span> : <span class="kwd">forall</span> <span class="id">bs</span> <span class="id">v</span> <span class="id">y0s</span> <span class="id">ys</span> <span class="id">zs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.aligned">aligned</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y0s">y0s</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> \/ <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.aligned">aligned</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ys">ys</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> \/ <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.aligned">aligned</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#zs">zs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.fby">fby</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y0s">y0s</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ys">ys</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#zs">zs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.ite">ite</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.init_stream">init_stream</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y0s">y0s</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sfby">sfby</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ys">ys</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#zs">zs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof53')">Proof.</div>
<div class="proofscript" id="proof53">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hsync</span> <span class="id">Hfby1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.fby_ite">fby_ite</a></span> <span class="kwd">in</span> <span class="id">Hfby1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.init_stream">init_stream</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.const_val_const">const_val_const</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op.sem_false_const">sem_false_const</a></span>. <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="CORRECTNESS.arrow_ite">arrow_ite</a></span> : <span class="kwd">forall</span> <span class="id">bs</span> <span class="id">y0s</span> <span class="id">ys</span> <span class="id">zs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.aligned">aligned</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y0s">y0s</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> \/ <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.aligned">aligned</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ys">ys</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> \/ <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.aligned">aligned</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#zs">zs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.arrow">arrow</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y0s">y0s</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ys">ys</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#zs">zs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.ite">ite</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sfby">sfby</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op.true_val">true_val</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.const_val">const_val</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op.false_val">false_val</a></span>)) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y0s">y0s</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ys">ys</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#zs">zs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof54')">Proof.</div>
<div class="proofscript" id="proof54">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">CoFix</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">b</span> <span class="id">bs</span>] <span class="id">y0s</span> <span class="id">ys</span> <span class="id">zs</span> <span class="id">Hsync</span> <span class="id">Harrow</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.arrow_aligned">LCS.arrow_aligned</a></span> <span class="kwd">in</span> <span class="id">Hsync</span> <span class="kwd">as</span> [<span class="id">Hsync1</span> [<span class="id">Hsync2</span> <span class="id">Hsync3</span>]]; [|<span class="tactic">auto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b</span>; <span class="id">inv</span> <span class="id">Hsync1</span>; <span class="id">inv</span> <span class="id">Hsync2</span>; <span class="id">inv</span> <span class="id">Hsync3</span>; <span class="id">inv</span> <span class="id">Harrow</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.const_val_Cons">const_val_Cons</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sfby_Cons">sfby_Cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.sfby_const">sfby_const</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">H0</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">H3</span>. <span class="id">revert</span> <span class="id">bs</span> <span class="id">vs</span> <span class="id">vs0</span> <span class="id">vs1</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">H3</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">CoFix</span>. <span class="tactic">intros</span> * <span class="id">Hsync1</span> <span class="id">Hsync2</span> <span class="id">Hsync3</span> <span class="id">Harrow</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bs</span> <span class="kwd">as</span> [[|] <span class="id">bs</span>]; <span class="id">inv</span> <span class="id">Hsync1</span>; <span class="id">inv</span> <span class="id">Hsync2</span>; <span class="id">inv</span> <span class="id">Hsync3</span>; <span class="id">inv</span> <span class="id">Harrow</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.const_val_Cons">const_val_Cons</a></span>; <span class="tactic">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.const_val_Cons">const_val_Cons</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sfby_Cons">sfby_Cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="CORRECTNESS.arrow_init_stream_ite">arrow_init_stream_ite</a></span> : <span class="kwd">forall</span> <span class="id">bs</span> <span class="id">y0s</span> <span class="id">ys</span> <span class="id">zs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.aligned">aligned</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y0s">y0s</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> \/ <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.aligned">aligned</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ys">ys</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> \/ <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.aligned">aligned</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#zs">zs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.arrow">arrow</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y0s">y0s</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ys">ys</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#zs">zs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.ite">ite</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.init_stream">init_stream</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y0s">y0s</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ys">ys</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#zs">zs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof55')">Proof.</div>
<div class="proofscript" id="proof55">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hsync</span> <span class="id">Harrow</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.arrow_ite">arrow_ite</a></span> <span class="kwd">in</span> <span class="id">Harrow</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.init_stream">init_stream</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.const_val_const">const_val_const</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op.sem_false_const">sem_false_const</a></span>. <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="CORRECTNESS.ac_sfby">ac_sfby</a></span> : <span class="kwd">forall</span> <span class="id">c</span> <span class="id">vs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.abstract_clock">abstract_clock</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sfby">sfby</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#c">c</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span>) ≡ <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.abstract_clock">abstract_clock</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof56')">Proof.</div>
<div class="proofscript" id="proof56">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">cofix</span> <span class="id">CoFix</span>. <span class="tactic">intros</span> <span class="id">c</span> [<span class="id">v</span> <span class="id">vs</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sfby_Cons">sfby_Cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v</span>; <span class="tactic">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="CORRECTNESS.init_stream_ac">init_stream_ac</a></span> : <span class="kwd">forall</span> <span class="id">bs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.abstract_clock">abstract_clock</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.init_stream">init_stream</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span>) ≡ <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof57')">Proof.</div>
<div class="proofscript" id="proof57">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">bs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.init_stream">init_stream</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.ac_sfby">ac_sfby</a></span>, &lt;- <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.ac_const">ac_const</a></span>. 1,2:<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<h3> Additional stuff </h3>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="CORRECTNESS.st_vars">st_vars</a></span> (<span class="id">st</span> : <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.fresh_st">fresh_st</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op.type">type</a></span> * <span class="id"><a href="Velus.ClockDefs.html#clock">clock</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>)) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.ClockDefs.html#ident">ident</a></span> * (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op.type">type</a></span> * <span class="id"><a href="Velus.ClockDefs.html#clock">clock</a></span>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.Common.html#idty">idty</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_anns">st_anns</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.st_ids_st_vars">st_ids_st_vars</a></span> : <span class="kwd">forall</span> <span class="id">st</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_vars">st_vars</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof58')">Proof.</div>
<div class="proofscript" id="proof58">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_vars">st_vars</a></span>, <span class="id"><a href="Velus.Common.Common.html#idty">idty</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_map">map_map</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_ext">map_ext</a></span>. <span class="tactic">intros</span> [? [[? ?] ?]]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id">st_tys</span>'<span class="id">_st_vars</span> : <span class="kwd">forall</span> <span class="id">st</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">st_tys</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = <span class="id"><a href="Velus.Common.Common.html#idty">idty</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_vars">st_vars</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof59')">Proof.</div>
<div class="proofscript" id="proof59">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">st_tys</span>', <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_vars">st_vars</a></span>, <span class="id"><a href="Velus.Common.Common.html#idty">idty</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_map">map_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_ext">map_ext</a></span>. <span class="tactic">intros</span> [? [[? ?] ?]]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id">st_clocks</span>'<span class="id">_st_vars</span> : <span class="kwd">forall</span> <span class="id">st</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">st_clocks</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = <span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_vars">st_vars</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof60')">Proof.</div>
<div class="proofscript" id="proof60">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">st_clocks</span>', <span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_vars">st_vars</a></span>, <span class="id"><a href="Velus.Common.Common.html#idty">idty</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_map">map_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_ext">map_ext</a></span>. <span class="tactic">intros</span> [? [[? ?] ?]]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.st_follows_vars_incl">st_follows_vars_incl</a></span> : <span class="kwd">forall</span> <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_follows">st_follows</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> <span class="id">st</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_vars">st_vars</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_vars">st_vars</a></span> <span class="id">st</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof61')">Proof.</div>
<div class="proofscript" id="proof61">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_vars">st_vars</a></span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#incl_map">incl_map</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_follows_incl">st_follows_incl</a></span>, <span class="id">H</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Import</span> <span class="id">NormFby</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.st_valid_after_NoDupMembers">st_valid_after_NoDupMembers</a></span> : <span class="kwd">forall</span> <span class="id">st</span> <span class="id">vars</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.st_valid_after">st_valid_after</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_vars">st_vars</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof62')">Proof.</div>
<div class="proofscript" id="proof62">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hndup</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.Facts.st_valid_after_NoDupMembers">Facts.st_valid_after_NoDupMembers</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#fst_NoDupMembers">fst_NoDupMembers</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>, &lt;- <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_ids_st_vars">st_ids_st_vars</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id">fresh_ident_refines</span>' {<span class="id">B</span> <span class="id">V</span>} : <span class="kwd">forall</span> <span class="id">vars</span> <span class="id">H</span> <span class="id">H</span>' <span class="id">a</span> <span class="id">id</span> (<span class="id">v</span> : <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#V">V</a></span>) (<span class="id">st</span> <span class="id">st</span>' : <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.fresh_st">fresh_st</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#B">B</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.st_valid_after">st_valid_after</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.fresh_ident">fresh_ident</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ids.norm2">norm2</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#a">a</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#id">id</a></span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H</span>' = <span class="id"><a href="Velus.Environment.html#Env.add">Env.add</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#id">id</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id">H</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof63')">Proof with</div>
<div class="proofscript" id="proof63">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hvalid</span> <span class="id">Hdom</span> <span class="id">Hfresh</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.st_valid_after">st_valid_after</a></span> <span class="id">st</span>' (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id">vars</span>)) <span class="kwd">as</span> <span class="id">Hvalid</span>' <span class="tactic">by</span> <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.refines_add">Env.refines_add</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">contra</span>. <span class="id">erewrite</span> <span class="id"><a href="Velus.Environment.html#Env.dom_use">Env.dom_use</a></span> <span class="kwd">in</span> <span class="id">contra</span>; [| <span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_or">in_app_or</a></span> <span class="kwd">in</span> <span class="id">contra</span>. <span class="tactic">destruct</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.Facts.fresh_ident_In">Facts.fresh_ident_In</a></span> <span class="kwd">in</span> <span class="id">Hfresh</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">id</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id">st</span>')).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span>, <span class="id"><a href="Velus.Common.Common.html#idty">idty</a></span>. <span class="tactic">repeat</span> <span class="id">simpl_In</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> (<span class="id">id</span>, <span class="id">a</span>); <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_valid_NoDup">st_valid_NoDup</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_In">NoDup_app_In</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>'; [|<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hvalid</span>'; <span class="tactic">clear</span> <span class="id">Hvalid</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonPS.html#ps_of_list_ps_to_list">ps_of_list_ps_to_list</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.Facts.fresh_ident_nIn">Facts.fresh_ident_nIn</a></span> <span class="kwd">in</span> <span class="id">Hfresh</span>...<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<h3> Relation between state and history </h3>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="CORRECTNESS.init_eqs_valids">init_eqs_valids</a></span> <span class="id">bs</span> <span class="id">H</span> (<span class="id">st</span> : <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.fresh_st">fresh_st</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op.type">Op.type</a></span> * <span class="id"><a href="Velus.ClockDefs.html#clock">clock</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> '(<span class="id">id</span>, <span class="id">ck</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">exists</span> <span class="id">bs</span>', <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sem_clock">sem_clock</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ck">ck</a></span> <span class="id">bs</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sem_var">sem_var</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#id">id</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.init_stream">init_stream</a></span> <span class="id">bs</span>'))) (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_inits">st_inits</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="CORRECTNESS.hist_st">hist_st</a></span> (<span class="id">vars</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Velus.ClockDefs.html#ident">ident</a></span> * <span class="id"><a href="Velus.ClockDefs.html#clock">clock</a></span>)) <span class="id">b</span> <span class="id">H</span> <span class="id">st</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.init_eqs_valids">init_eqs_valids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">LCS.sc_var_inv</span>' (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id">st_clocks</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.fresh_ident_init_eqs">fresh_ident_init_eqs</a></span> : <span class="kwd">forall</span> <span class="id">vars</span> <span class="id">b</span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">id</span> <span class="id">v</span> <span class="id">H</span> <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.st_valid_after">st_valid_after</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span> ++ <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.fresh_ident">fresh_ident</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ids.norm2">norm2</a></span> ((<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ty">ty</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ck">ck</a></span>), <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#id">id</a></span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.init_eqs_valids">init_eqs_valids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.init_eqs_valids">init_eqs_valids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> (<span class="id"><a href="Velus.Environment.html#Env.add">Env.add</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#id">id</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span>) <span class="id">st</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof64')">Proof with</div>
<div class="proofscript" id="proof64">
 <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hvalid</span> <span class="id">Hdom</span> <span class="id">Hfresh</span> <span class="id">Hinits</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (~<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">id</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id">st</span>)) <span class="kwd">as</span> <span class="id">Hnin</span> <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.Facts.fresh_ident_nIn">Facts.fresh_ident_nIn</a></span> <span class="kwd">in</span> <span class="id">Hfresh</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id">H</span> (<span class="id"><a href="Velus.Environment.html#Env.add">Env.add</a></span> <span class="id">id</span> <span class="id">v</span> <span class="id">H</span>)) <span class="kwd">as</span> <span class="id">Href</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">fresh_ident_refines</span>' <span class="kwd">in</span> <span class="id">Hfresh</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.fresh_ident_false_st_inits">fresh_ident_false_st_inits</a></span> <span class="kwd">in</span> <span class="id">Hfresh</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.init_eqs_valids">init_eqs_valids</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">Hfresh</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_forall</span>. <span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">bs</span>' [? ?]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">bs</span>'; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_clock_refines">LCS.sem_clock_refines</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_var_refines">sem_var_refines</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.fresh_ident_hist_st">fresh_ident_hist_st</a></span> : <span class="kwd">forall</span> <span class="id">vars</span> <span class="id">b</span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">id</span> <span class="id">v</span> <span class="id">H</span> <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.st_valid_after">st_valid_after</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sem_clock">sem_clock</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ck">ck</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.abstract_clock">abstract_clock</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.fresh_ident">fresh_ident</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ids.norm2">norm2</a></span> ((<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ty">ty</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ck">ck</a></span>), <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#id">id</a></span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> (<span class="id"><a href="Velus.Environment.html#Env.add">Env.add</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#id">id</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span>) <span class="id">st</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof65')">Proof with</div>
<div class="proofscript" id="proof65">
 <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hvalid</span> <span class="id">Hsem</span> <span class="id">Hfresh</span> [<span class="id">H1</span> [<span class="id">H2</span> <span class="id">H3</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (~<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">id</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span> <span class="id">st</span>)) <span class="kwd">as</span> <span class="id">Hnin</span> <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.Facts.fresh_ident_nIn">Facts.fresh_ident_nIn</a></span> <span class="kwd">in</span> <span class="id">Hfresh</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.st_valid_after">st_valid_after</a></span> <span class="id">st</span>' (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">vars</span>))) <span class="kwd">as</span> <span class="id">Hvalid2</span> <span class="tactic">by</span> <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hfresh</span>':=<span class="id">Hfresh</span>). <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.fresh_ident_anns">fresh_ident_anns</a></span> <span class="kwd">in</span> <span class="id">Hfresh</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id">H</span> (<span class="id"><a href="Velus.Environment.html#Env.add">Env.add</a></span> <span class="id">id</span> <span class="id">v</span> <span class="id">H</span>)) <span class="kwd">as</span> <span class="id">Href</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">fresh_ident_refines</span>' <span class="kwd">in</span> <span class="id">Hfresh</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.fresh_ident_dom">fresh_ident_dom</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.fresh_ident_init_eqs">fresh_ident_init_eqs</a></span> <span class="kwd">in</span> <span class="id">Hfresh</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">st_clocks</span>', <span class="id">LCS.sc_var_inv</span>' <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hfresh</span>'; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_middle">Permutation_middle</a></span>. <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">exists</span> <span class="id">v</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">econstructor</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.add_1">Env.add_1</a></span>. 1,2:<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_clock_refines">LCS.sem_clock_refines</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">LCS.sc_var_inv</span>'<span class="id">_refines</span> <span class="kwd">with</span> (<span class="id">H</span>:=<span class="id">H</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Module</span> <span class="kwd">Import</span> <span class="id"><a name="CORRECTNESS.CIStr">CIStr</a></span> := <span class="id"><a href="Velus.CoindIndexed.html#CoindIndexedFun">CoindIndexedFun</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr">CStr</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#IStr">IStr</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.sem_clock_when">sem_clock_when</a></span> : <span class="kwd">forall</span> <span class="id">H</span> <span class="id">bs</span> <span class="id">bs</span>' <span class="id">bs</span>'' <span class="id">cs</span> <span class="id">ck</span> <span class="id">id</span> <span class="id">ckb</span> <span class="id">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sem_clock">sem_clock</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ck">ck</a></span> <span class="id">bs</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sem_clock">sem_clock</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> (<span class="id"><a href="Velus.ClockDefs.html#Con">Con</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ck">ck</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#id">id</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ckb">ckb</a></span>) <span class="id">bs</span>'' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sem_var">sem_var</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#id">id</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#cs">cs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.when">when</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ckb">ckb</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.const">const</a></span> <span class="id">bs</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#c">c</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#cs">cs</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.const">const</a></span> <span class="id">bs</span>'' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#c">c</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof66')">Proof.</div>
<div class="proofscript" id="proof66">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hcl1</span> <span class="id">Hcl2</span> <span class="id">Hvar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.when_spec">when_spec</a></span>. <span class="tactic">intros</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.sem_clock_equiv">sem_clock_equiv</a></span> <span class="kwd">in</span> <span class="id">Hcl1</span>, <span class="id">Hcl2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.sem_var_impl">CIStr.sem_var_impl</a></span> <span class="kwd">in</span> <span class="id">Hvar</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id">Hcl1</span> <span class="id">n</span>). <span class="tactic">specialize</span> (<span class="id">Hcl2</span> <span class="id">n</span>). <span class="tactic">specialize</span> (<span class="id">Hvar</span> <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.tr_Stream">tr_Stream</a></span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hcl2</span>; (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#IStr.sem_var_instant_det">IStr.sem_var_instant_det</a></span> <span class="kwd">in</span> <span class="id">Hvar</span>; <span class="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#IStr.sem_clock_instant_det">IStr.sem_clock_instant_det</a></span> <span class="kwd">in</span> <span class="id">Hcl1</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">right</span>. <span class="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op.sem_const">sem_const</a></span> <span class="id">c</span>). <span class="tactic">exists</span> <span class="id">c0</span>. <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.const_true">const_true</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.const_false">const_false</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">right</span>. <span class="tactic">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op.sem_const">sem_const</a></span> <span class="id">c</span>). <span class="tactic">exists</span> <span class="id">c0</span>. <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.const_true">const_true</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.const_false">const_false</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="CORRECTNESS.add_whens_sem_exp">add_whens_sem_exp</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">H</span> <span class="id">b</span> <span class="id">ck</span> <span class="id">ty</span> <span class="id">b</span>' <span class="id">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sem_clock">sem_clock</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ck">ck</a></span> <span class="id">b</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.add_whens">add_whens</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.Econst">Econst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#c">c</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ty">ty</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ck">ck</a></span>) [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.const">const</a></span> <span class="id">b</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#c">c</a></span>].<br/>
<div class="toggleproof" onclick="toggleDisplay('proof67')">Proof.</div>
<div class="proofscript" id="proof67">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">ck</span>; <span class="tactic">intros</span> * <span class="id">Hsem</span>; <span class="tactic">assert</span> (<span class="id">Hsem</span>':=<span class="id">Hsem</span>); <span class="id">inv</span> <span class="id">Hsem</span>'; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">constructor</span>. <span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;1,2,3: (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Swhen">Swhen</a></span>; <span class="tactic">eauto</span>; <span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">constructor</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.sem_clock_when">sem_clock_when</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.init_var_for_clock_sem">init_var_for_clock_sem</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">vars</span> <span class="id">bs</span> <span class="id">H</span> <span class="id">ck</span> <span class="id">bs</span>' <span class="id">x</span> <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sem_clock">sem_clock</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ck">ck</a></span> <span class="id">bs</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.st_valid_after">st_valid_after</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.init_var_for_clock">init_var_for_clock</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ck">ck</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#x">x</a></span>, <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">exists</span> <span class="id">H</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id">H</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.st_valid_after">st_valid_after</a></span> <span class="id">st</span>' (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>)) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.hist_st">hist_st</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id">H</span>' <span class="id">st</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sem_var">sem_var</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#x">x</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.init_stream">init_stream</a></span> <span class="id">bs</span>') /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span>) <span class="id">eqs</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof68')">Proof with</div>
<div class="proofscript" id="proof68">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hsemc</span> <span class="id">Hvalid</span> <span class="id">Histst</span> <span class="id">Hinit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.init_var_for_clock">init_var_for_clock</a></span> <span class="kwd">in</span> <span class="id">Hinit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#find">find</a></span> <span class="id">eqn</span>:<span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;We&nbsp;already&nbsp;introduced&nbsp;such&nbsp;an&nbsp;equation&nbsp;previously.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;will&nbsp;use&nbsp;the&nbsp;hist_st&nbsp;invariant&nbsp;to&nbsp;get&nbsp;some&nbsp;information&nbsp;back&nbsp;about&nbsp;it&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span>; <span class="id">inv</span> <span class="id">Hinit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Histst</span> <span class="kwd">as</span> [<span class="id">_</span> [<span class="id">Hvalids</span> <span class="id">_</span>]]. <span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.init_eqs_valids">init_eqs_valids</a></span> <span class="kwd">in</span> <span class="id">Hvalids</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hvalids</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#find_some">find_some</a></span> <span class="kwd">in</span> <span class="id">Hfind</span>. <span class="tactic">destruct</span> <span class="id">p</span> <span class="kwd">as</span> [[<span class="id">ty</span>' <span class="id">ck</span>'] <span class="id">isinit</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">Bool.andb_true_iff</a></span> <span class="kwd">in</span> <span class="id">Hfind</span>. <span class="tactic">destruct</span> <span class="id">Hfind</span> <span class="kwd">as</span> [<span class="id">Hin</span> [[<span class="id">Hisinit</span> <span class="id">Hcl</span>] <span class="id">Hty</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux.type_eqb_eq">OpAux.type_eqb_eq</a></span> <span class="kwd">in</span> <span class="id">Hty</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Clocks.html#clock_eqb_eq">Clocks.clock_eqb_eq</a></span> <span class="kwd">in</span> <span class="id">Hcl</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id">x</span>, <span class="id">ck</span>) (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_inits">st_inits</a></span> <span class="id">st</span>')) <span class="kwd">as</span> <span class="id">Hin</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_inits">st_inits</a></span>. <span class="id">simpl_In</span>. <span class="tactic">exists</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op.bool_type">bool_type</a></span>. <span class="id">simpl_In</span>. <span class="tactic">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#equiv_decb_refl">equiv_decb_refl</a></span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hvalids</span> <span class="kwd">in</span> <span class="id">Hin</span>' <span class="kwd">as</span> [<span class="id">bs</span>'' [? ?]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sem_clock_det">sem_clock_det</a></span> <span class="kwd">in</span> <span class="id">Hsemc</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">Hsemc</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;We&nbsp;need&nbsp;to&nbsp;introduce&nbsp;a&nbsp;new&nbsp;init&nbsp;equation&nbsp;to&nbsp;the&nbsp;history&nbsp;and&nbsp;state,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;prove&nbsp;its&nbsp;properties&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.fresh_ident">fresh_ident</a></span> <span class="id">_</span> <span class="id">_</span>) <span class="id">eqn</span>:<span class="id">Hident</span>. <span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.st_valid_after">st_valid_after</a></span> <span class="id">st</span>' (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">vars</span>))) <span class="kwd">as</span> <span class="id">Hvalid1</span> <span class="tactic">by</span> <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="Velus.Environment.html#Env.add">Env.add</a></span> <span class="id">x</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.init_stream">init_stream</a></span> <span class="id">bs</span>') <span class="id">H</span>) <span class="kwd">as</span> <span class="id">H</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id">H</span> <span class="id">H</span>') <span class="kwd">as</span> <span class="id">Href1</span> <span class="tactic">by</span> (<span class="tactic">destruct</span> <span class="id">Histst</span>; <span class="tactic">eapply</span> <span class="id">fresh_ident_refines</span>' <span class="kwd">in</span> <span class="id">Hident</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.hist_st">hist_st</a></span> <span class="id">vars</span> <span class="id">bs</span> <span class="id">H</span>' <span class="id">st</span>') <span class="kwd">as</span> <span class="id">Histst1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">Histst</span> <span class="kwd">as</span> [<span class="id">H1</span> [<span class="id">H2</span> <span class="id">H3</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.fresh_ident_dom">fresh_ident_dom</a></span> <span class="kwd">in</span> <span class="id">Hident</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.init_eqs_valids">init_eqs_valids</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.fresh_ident_true_st_inits">fresh_ident_true_st_inits</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">exists</span> <span class="id">bs</span>'. <span class="tactic">split</span>; [<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_clock_refines">LCS.sem_clock_refines</a></span>|]; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">HeqH</span>'. <span class="tactic">econstructor</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.add_1">Env.add_1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">solve_forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [<span class="id">bs</span>'' [? ?]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">bs</span>''. <span class="tactic">split</span>; [<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_clock_refines">LCS.sem_clock_refines</a></span>|<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_var_refines">sem_var_refines</a></span>]; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">st_clocks</span>', <span class="id">LCS.sc_var_inv</span>' <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.fresh_ident_anns">fresh_ident_anns</a></span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_middle">Permutation_middle</a></span>; <span class="tactic">constructor</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">exists</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.init_stream">init_stream</a></span> <span class="id">bs</span>'). <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">HeqH</span>'. <span class="tactic">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.add_1">Env.add_1</a></span>. 1,2:<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.init_stream_ac">init_stream_ac</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_clock_refines">LCS.sem_clock_refines</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [? ?] [<span class="id">ss</span> [? ?]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">ss</span>. <span class="tactic">split</span>; [<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_var_refines">sem_var_refines</a></span>|<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_clock_refines">LCS.sem_clock_refines</a></span>]; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.st_valid_after">st_valid_after</a></span> <span class="id">st</span>' (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">vars</span>))) <span class="kwd">as</span> <span class="id">Hvalid2</span> <span class="tactic">by</span> <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>'. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">HeqH</span>'. <span class="tactic">econstructor</span>. 2:<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.add_1">Env.add_1</a></span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">repeat</span> <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Seq">Seq</a></span> <span class="kwd">with</span> (<span class="id">ss</span>:=[[(<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.init_stream">init_stream</a></span> <span class="id">bs</span>')]]); <span class="tactic">simpl</span>; <span class="tactic">repeat</span> <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Sfby">Sfby</a></span> <span class="kwd">with</span> (<span class="id">s0ss</span>:=[[(<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.const">const</a></span> <span class="id">bs</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op.true_const">true_const</a></span>)]]) (<span class="id">sss</span>:=[[(<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.const">const</a></span> <span class="id">bs</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op.false_const">false_const</a></span>)]]); <span class="tactic">repeat</span> <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.add_whens_sem_exp">add_whens_sem_exp</a></span>. <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_clock_refines">LCS.sem_clock_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.add_whens_sem_exp">add_whens_sem_exp</a></span>. <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_clock_refines">LCS.sem_clock_refines</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.init_stream">init_stream</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.const_val_const">const_val_const</a></span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op.sem_true_const">sem_true_const</a></span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.sfby_fby">sfby_fby</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.const_val_const">const_val_const</a></span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.const_aligned">const_aligned</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">econstructor</span>. 2:<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">HeqH</span>'. <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.add_1">Env.add_1</a></span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="kwd">Constructors</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_exp_anon">LCS.sem_exp_anon</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="CORRECTNESS.normalized_lexp_sem_sem_anon">normalized_lexp_sem_sem_anon</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">H</span> <span class="id">b</span> <span class="id">e</span> <span class="id">vs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.normalized_lexp">normalized_lexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_exp_anon">LCS.sem_exp_anon</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof69')">Proof.</div>
<div class="proofscript" id="proof69">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hnormed</span> <span class="id">Hsem</span>. <span class="id">revert</span> <span class="id">vs</span> <span class="id">Hsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hnormed</span>; <span class="tactic">intros</span>; <span class="id">inv</span> <span class="id">Hsem</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H8</span>; <span class="id">inv</span> <span class="id">H4</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="CORRECTNESS.normalized_cexp_sem_sem_anon">normalized_cexp_sem_sem_anon</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">H</span> <span class="id">b</span> <span class="id">e</span> <span class="id">vs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.normalized_cexp">normalized_cexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_exp_anon">LCS.sem_exp_anon</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof70')">Proof.</div>
<div class="proofscript" id="proof70">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hnormed</span> <span class="id">Hsem</span>. <span class="id">revert</span> <span class="id">vs</span> <span class="id">Hsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hnormed</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hsem</span>. <span class="id">inv</span> <span class="id">H9</span>; <span class="id">inv</span> <span class="id">H4</span>. <span class="id">inv</span> <span class="id">H10</span>; <span class="id">inv</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hsem</span>. <span class="id">inv</span> <span class="id">H10</span>; <span class="id">inv</span> <span class="id">H5</span>. <span class="id">inv</span> <span class="id">H11</span>; <span class="id">inv</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.normalized_lexp_sem_sem_anon">normalized_lexp_sem_sem_anon</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.normalized_lexp_sem_sem_anon">normalized_lexp_sem_sem_anon</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="CORRECTNESS.unnested_equation_sem_sem_anon">unnested_equation_sem_sem_anon</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">env</span> <span class="id">H</span> <span class="id">b</span> <span class="id">equ</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnested_equation">unnested_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#equ">equ</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_equation">wc_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#env">env</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#equ">equ</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#equ">equ</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_equation_anon">LCS.sem_equation_anon</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#equ">equ</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof71')">Proof.</div>
<div class="proofscript" id="proof71">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hnormed</span> <span class="id">Hwc</span> <span class="id">Hsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hnormed</span>; <span class="id">inv</span> <span class="id">Hsem</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">H8</span>; <span class="id">inv</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">econstructor</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_impl_In">Forall2_impl_In</a></span>; [|<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.normalized_lexp_sem_sem_anon">normalized_lexp_sem_sem_anon</a></span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">Hwc</span> <span class="kwd">as</span> (<span class="id">_</span>&amp;<span class="id">Hcks</span>&amp;<span class="id">_</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_map_2">Forall2_map_2</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_swap_args">Forall2_swap_args</a></span> <span class="kwd">in</span> <span class="id">Hcks</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_trans_ex">Forall2_trans_ex</a></span> <span class="kwd">in</span> <span class="id">H9</span>; [|<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_impl_In">Forall2_impl_In</a></span>; [|<span class="tactic">eauto</span>]. <span class="tactic">intros</span> (?&amp;?&amp;?) ? ? ? (?&amp;?&amp;?&amp;?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">H8</span>; <span class="id">inv</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 (<span class="tactic">econstructor</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_impl_In">Forall2_impl_In</a></span>; [|<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.normalized_lexp_sem_sem_anon">normalized_lexp_sem_sem_anon</a></span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.normalized_lexp_sem_sem_anon">normalized_lexp_sem_sem_anon</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">Hwc</span> <span class="kwd">as</span> (<span class="id">_</span>&amp;<span class="id">Hcks</span>&amp;<span class="id">_</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_map_2">Forall2_map_2</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_swap_args">Forall2_swap_args</a></span> <span class="kwd">in</span> <span class="id">Hcks</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_trans_ex">Forall2_trans_ex</a></span> <span class="kwd">in</span> <span class="id">H9</span>; [|<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_impl_In">Forall2_impl_In</a></span>; [|<span class="tactic">eauto</span>]. <span class="tactic">intros</span> (?&amp;?&amp;?) ? ? ? (?&amp;?&amp;?&amp;?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">H7</span>; <span class="id">inv</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H4</span>. <span class="id">inv</span> <span class="id">H10</span>; <span class="id">inv</span> <span class="id">H6</span>. <span class="id">inv</span> <span class="id">H12</span>; <span class="id">inv</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.normalized_lexp_sem_sem_anon">normalized_lexp_sem_sem_anon</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">H7</span>; <span class="id">inv</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H4</span>. <span class="id">inv</span> <span class="id">H10</span>; <span class="id">inv</span> <span class="id">H6</span>. <span class="id">inv</span> <span class="id">H12</span>; <span class="id">inv</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.normalized_lexp_sem_sem_anon">normalized_lexp_sem_sem_anon</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">H6</span>; <span class="id">inv</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.normalized_cexp_sem_sem_anon">normalized_cexp_sem_sem_anon</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="CORRECTNESS.normalized_equation_sem_sem_anon">normalized_equation_sem_sem_anon</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">env</span> <span class="id">H</span> <span class="id">b</span> <span class="id">equ</span> <span class="id">out</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.normalized_equation">normalized_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#out">out</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#equ">equ</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_equation">wc_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#env">env</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#equ">equ</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#equ">equ</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_equation_anon">LCS.sem_equation_anon</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#equ">equ</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof72')">Proof.</div>
<div class="proofscript" id="proof72">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnested_equation_sem_sem_anon">unnested_equation_sem_sem_anon</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.normalized_eq_unnested_eq">normalized_eq_unnested_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="CORRECTNESS.sc_lexp">sc_lexp</a></span> :  <span class="kwd">forall</span> <span class="id">G</span> <span class="id">H</span> <span class="id">bs</span> <span class="id">env</span> <span class="id">e</span> <span class="id">s</span> <span class="id">ck</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_global">wc_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sc_nodes">LCS.sc_nodes</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#env">env</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Clocks.html#wc_env">wc_env</a></span> (<span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#env">env</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">LCS.sc_var_inv</span>' (<span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#env">env</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.normalized_lexp">normalized_lexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.clockof">clockof</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> = [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ck">ck</a></span>] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_exp">wt_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> (<span class="id"><a href="Velus.Common.Common.html#idty">idty</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#env">env</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> (<span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#env">env</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#s">s</a></span>] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sem_clock">sem_clock</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ck">ck</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.abstract_clock">abstract_clock</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#s">s</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof73')">Proof.</div>
<div class="proofscript" id="proof73">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * ? ? ? ? ? <span class="id">Hnormed</span> <span class="id">Hck</span> ? ? <span class="id">Hsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.normalized_lexp_sem_sem_anon">normalized_lexp_sem_sem_anon</a></span> <span class="kwd">in</span> <span class="id">Hsem</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sc_exp">LCS.sc_exp</a></span> <span class="kwd">in</span> <span class="id">Hsem</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#NoDupMembers_idck">NoDupMembers_idck</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hck</span> <span class="kwd">in</span> <span class="id">Hsem</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsem</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="CORRECTNESS.sc_cexp">sc_cexp</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">env</span> <span class="id">H</span> <span class="id">b</span> <span class="id">e</span> <span class="id">vs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_global">wc_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sc_nodes">LCS.sc_nodes</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#env">env</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">LCS.sc_var_inv</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#env">env</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.normalized_cexp">normalized_cexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#env">env</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sem_clock">sem_clock</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span>) (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.clockof">clockof</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.abstract_clock">abstract_clock</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof74')">Proof.</div>
<div class="proofscript" id="proof74">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">HwcG</span> <span class="id">Hsc</span> <span class="id">Hnd</span> <span class="id">Hinv</span> <span class="id">Hnormed</span> <span class="id">Hwc</span> <span class="id">Hsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sc_exp">LCS.sc_exp</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.normalized_cexp_sem_sem_anon">normalized_cexp_sem_sem_anon</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.fby_iteexp_sem">fby_iteexp_sem</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">vars</span> <span class="id">bs</span> <span class="id">H</span> <span class="id">e0</span> <span class="id">e</span> <span class="id">ty</span> <span class="id">nck</span> <span class="id">y0</span> <span class="id">y</span> <span class="id">z</span> <span class="id">e</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_global">wc_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sc_nodes">LCS.sc_nodes</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Clocks.html#wc_env">wc_env</a></span> (<span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id">st_clocks</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.normalized_lexp">normalized_lexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e0">e0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.clockof">clockof</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e0">e0</a></span> = [<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#nck">nck</a></span>] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_exp">wt_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> (<span class="id"><a href="Velus.Common.Common.html#idty">idty</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id">st_tys</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e0">e0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> (<span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id">st_clocks</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e0">e0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e0">e0</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y0">y0</a></span>] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y">y</a></span>] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.fby">fby</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y0">y0</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y">y</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#z">z</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.st_valid_after">st_valid_after</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.hist_st">hist_st</a></span> (<span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.fby_iteexp">fby_iteexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e0">e0</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ty">ty</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#nck">nck</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id">e</span>', <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">exists</span> <span class="id">H</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id">H</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.st_valid_after">st_valid_after</a></span> <span class="id">st</span>' (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>)) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.hist_st">hist_st</a></span> (<span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id">H</span>' <span class="id">st</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id">e</span>' [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#z">z</a></span>] /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span>) <span class="id">eqs</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof75')">Proof with</div>
<div class="proofscript" id="proof75">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">HwcG</span> <span class="id">Hsc</span> <span class="id">Hndup</span> <span class="id">Hwenv</span> <span class="id">Hnormed</span> <span class="id">Hck</span> <span class="id">Hwt</span> <span class="id">Hwc</span> <span class="id">Hsem0</span> <span class="id">Hsem</span> <span class="id">Hfby</span> <span class="id">Hvalid</span> <span class="id">Histst</span> <span class="id">Hiteexp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">nck</span> <span class="kwd">as</span> [<span class="id">ck</span> ?]; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.fby_iteexp">fby_iteexp</a></span> <span class="kwd">in</span> <span class="id">Hiteexp</span>; <span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.sc_lexp">sc_lexp</a></span> <span class="kwd">with</span> (<span class="id">env</span>:=<span class="id">vars</span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_vars">st_vars</a></span> <span class="id">st</span>) <span class="kwd">in</span> <span class="id">Hnormed</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;3,6:<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#idck_app">idck_app</a></span>... 4:<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#idty_app">idty_app</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_valid_after_NoDupMembers">st_valid_after_NoDupMembers</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="tactic">destruct</span> <span class="id">Histst</span> <span class="kwd">as</span> [<span class="id">_</span> [<span class="id">_</span> ?]]. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#idck_app">idck_app</a></span>, &lt;- <span class="id">st_clocks</span>'<span class="id">_st_vars</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.init_var_for_clock_sem">init_var_for_clock_sem</a></span> <span class="kwd">with</span> (<span class="id">G</span>:=<span class="id">G</span>) <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">H</span>' [<span class="id">Href1</span> [<span class="id">Hvalid1</span> [<span class="id">Histst1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1</span>']]]]]...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2: <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#map_fst_idck">map_fst_idck</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.abstract_clock">abstract_clock</a></span> <span class="id">y0</span>) <span class="kwd">as</span> <span class="id">bs</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sfby">sfby</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op.sem_const">Op.sem_const</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op.init_type">Op.init_type</a></span> <span class="id">ty</span>)) <span class="id">y</span>) <span class="kwd">as</span> <span class="id">y</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="Velus.Environment.html#Env.add">Env.add</a></span> <span class="id">x2</span> <span class="id">y</span>' <span class="id">H</span>') <span class="kwd">as</span> <span class="id">H</span>''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id">H</span>' <span class="id">H</span>'') <span class="tactic">by</span> (<span class="tactic">destruct</span> <span class="id">Histst1</span>; <span class="tactic">eapply</span> <span class="id">fresh_ident_refines</span>' <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.hist_st">hist_st</a></span> (<span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span> <span class="id">vars</span>) <span class="id">bs</span> <span class="id">H</span>'' <span class="id">st</span>') <span class="kwd">as</span> <span class="id">Histst2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.fresh_ident_hist_st">fresh_ident_hist_st</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">HeqH</span>''...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqy</span>', <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.ac_sfby">ac_sfby</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1: <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_clock_refines">LCS.sem_clock_refines</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.ac_fby2">LCS.ac_fby2</a></span>, &lt;- <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.ac_fby1">LCS.ac_fby1</a></span>, &lt;- <span class="id">Heqbs</span>'; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>''. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>); <span class="tactic">try</span> <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etransitivity</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#map_fst_idck">map_fst_idck</a></span> <span class="kwd">in</span> <span class="id">Hvalid1</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Site">Site</a></span> <span class="kwd">with</span> (<span class="id">s</span>:=(<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.init_stream">init_stream</a></span> <span class="id">bs</span>')) (<span class="id">ts</span>:=[[<span class="id">y0</span>]]) (<span class="id">fs</span>:=[[<span class="id">y</span>']]); <span class="tactic">repeat</span> <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_var_refines">sem_var_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>; [| <span class="tactic">eauto</span>]. <span class="id">etransitivity</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">HeqH</span>''. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.add_1">Env.add_1</a></span>. 1,2:<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.fby_init_stream_ite">fby_init_stream_ite</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">left</span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.ac_aligned">ac_aligned</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Seq">Seq</a></span> <span class="kwd">with</span> (<span class="id">ss</span>:=[[<span class="id">y</span>']]); <span class="tactic">repeat</span> <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Sfby">Sfby</a></span> <span class="kwd">with</span> (<span class="id">s0ss</span>:=[[<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.const">const</a></span> <span class="id">bs</span>' (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op.init_type">init_type</a></span> <span class="id">ty</span>)]]) (<span class="id">sss</span>:=[[<span class="id">y</span>]]); <span class="tactic">repeat</span> <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.add_whens_sem_exp">add_whens_sem_exp</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_clock_refines">LCS.sem_clock_refines</a></span>; [|<span class="tactic">eauto</span>]. <span class="id">etransitivity</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>; [| <span class="tactic">eauto</span>]. <span class="id">etransitivity</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">rewrite</span> <span class="id">Heqy</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.const_val_const">const_val_const</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.sfby_fby">sfby_fby</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.fby_aligned">LCS.fby_aligned</a></span> <span class="kwd">in</span> <span class="id">Hfby</span> <span class="kwd">as</span> [<span class="id">_</span> [? <span class="id">_</span>]]; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">left</span>. <span class="tactic">rewrite</span> <span class="id">Heqbs</span>'. <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.ac_aligned">ac_aligned</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">HeqH</span>''. <span class="tactic">apply</span> <span class="id"><a href="Velus.Environment.html#Env.add_1">Env.add_1</a></span>. 1,2:<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">solve_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation_refines">sem_equation_refines</a></span>...<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.arrow_iteexp_sem">arrow_iteexp_sem</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">vars</span> <span class="id">bs</span> <span class="id">H</span> <span class="id">e0</span> <span class="id">e</span> <span class="id">ty</span> <span class="id">nck</span> <span class="id">y0</span> <span class="id">y</span> <span class="id">z</span> <span class="id">e</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_global">wc_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sc_nodes">LCS.sc_nodes</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Clocks.html#wc_env">wc_env</a></span> (<span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id">st_clocks</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.normalized_lexp">normalized_lexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e0">e0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.clockof">clockof</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e0">e0</a></span> = [<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#nck">nck</a></span>] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_exp">wt_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> (<span class="id"><a href="Velus.Common.Common.html#idty">idty</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id">st_tys</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e0">e0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> (<span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id">st_clocks</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e0">e0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e0">e0</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y0">y0</a></span>] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y">y</a></span>] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.arrow">arrow</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y0">y0</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#y">y</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#z">z</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.st_valid_after">st_valid_after</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.hist_st">hist_st</a></span> (<span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.arrow_iteexp">arrow_iteexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e0">e0</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e">e</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ty">ty</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#nck">nck</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id">e</span>', <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">exists</span> <span class="id">H</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id">H</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.st_valid_after">st_valid_after</a></span> <span class="id">st</span>' (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>)) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.hist_st">hist_st</a></span> (<span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id">H</span>' <span class="id">st</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id">e</span>' [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#z">z</a></span>] /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span>) <span class="id">eqs</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof76')">Proof with</div>
<div class="proofscript" id="proof76">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">HwcG</span> <span class="id">Hsc</span> <span class="id">Hndup</span> <span class="id">Hwenv</span> <span class="id">Hnormed1</span> <span class="id">Hck</span> <span class="id">Hwt</span> <span class="id">Hwc</span> <span class="id">Hsem0</span> <span class="id">Hsem</span> <span class="id">Harrow</span> <span class="id">Hvalid</span> <span class="id">Histst</span> <span class="id">Hiteexp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">nck</span> <span class="kwd">as</span> [<span class="id">ck</span> ?]; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.arrow_iteexp">arrow_iteexp</a></span> <span class="kwd">in</span> <span class="id">Hiteexp</span>. <span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.sc_lexp">sc_lexp</a></span> <span class="kwd">with</span> (<span class="id">env</span>:=<span class="id">vars</span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_vars">st_vars</a></span> <span class="id">st</span>) <span class="kwd">in</span> <span class="id">Hnormed1</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;3,6:<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#idck_app">idck_app</a></span>... 4:<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#idty_app">idty_app</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_valid_after_NoDupMembers">st_valid_after_NoDupMembers</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="tactic">destruct</span> <span class="id">Histst</span> <span class="kwd">as</span> [<span class="id">_</span> [<span class="id">_</span> ?]]. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#idck_app">idck_app</a></span>, &lt;- <span class="id">st_clocks</span>'<span class="id">_st_vars</span>; <span class="tactic">auto</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.init_var_for_clock_sem">init_var_for_clock_sem</a></span> <span class="kwd">with</span> (<span class="id">G</span>:=<span class="id">G</span>) <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">H</span>' [<span class="id">Href1</span> [<span class="id">Hvalid1</span> [<span class="id">Histst1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1</span>']]]]]...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2: <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#map_fst_idck">map_fst_idck</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.abstract_clock">abstract_clock</a></span> <span class="id">y0</span>) <span class="kwd">as</span> <span class="id">bs</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>'. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#map_fst_idck">map_fst_idck</a></span> <span class="kwd">in</span> <span class="id">Hvalid1</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Site">Site</a></span> <span class="kwd">with</span> (<span class="id">s</span>:=(<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.init_stream">init_stream</a></span> <span class="id">bs</span>')) (<span class="id">ts</span>:=[[<span class="id">y0</span>]]) (<span class="id">fs</span>:=[[<span class="id">y</span>]]); <span class="tactic">repeat</span> <span class="tactic">constructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.arrow_init_stream_ite">arrow_init_stream_ite</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">left</span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.ac_aligned">ac_aligned</a></span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.fby_equation_sc_exp">fby_equation_sc_exp</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">H</span> <span class="id">vars</span> <span class="id">bs</span> <span class="id">e0</span> <span class="id">ck</span> <span class="id">s0s</span> <span class="id">ss</span> <span class="id">vs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_global">wc_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sc_nodes">LCS.sc_nodes</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Clocks.html#wc_env">wc_env</a></span> (<span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.normalized_lexp">normalized_lexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e0">e0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_exp">wt_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> (<span class="id"><a href="Velus.Common.Common.html#idty">idty</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e0">e0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_exp">wc_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> (<span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e0">e0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.clockof">clockof</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e0">e0</a></span> = [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ck">ck</a></span>] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp">sem_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#e0">e0</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#s0s">s0s</a></span>] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.fby">fby</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#s0s">s0s</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ss">ss</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">LCS.sc_var_inv</span>' (<span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sem_clock">sem_clock</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ck">ck</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.abstract_clock">abstract_clock</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vs">vs</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof77')">Proof with</div>
<div class="proofscript" id="proof77">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">HwG</span> <span class="id">Hsc</span> <span class="id">Hndup</span> <span class="id">Hwenv</span> <span class="id">Hnormed</span> <span class="id">Hwt</span> <span class="id">Hwc</span> <span class="id">Hck</span> <span class="id">Hsem</span> <span class="id">Hfby</span> <span class="id">Hinv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.sc_lexp">sc_lexp</a></span> <span class="kwd">in</span> <span class="id">Hnormed</span>. 2-10:<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.ac_fby1">LCS.ac_fby1</a></span> <span class="kwd">in</span> <span class="id">Hnormed</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.fby_equation_sem">fby_equation_sem</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">vars</span> <span class="id">bs</span> <span class="id">H</span> <span class="id">to_cut</span> <span class="id">equ</span> <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_global">wc_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sc_nodes">LCS.sc_nodes</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Clocks.html#wc_env">wc_env</a></span> (<span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id">st_clocks</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnested_equation">unnested_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#equ">equ</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_equation">wt_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> (<span class="id"><a href="Velus.Common.Common.html#idty">idty</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id">st_tys</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#equ">equ</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_equation">wc_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> (<span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id">st_clocks</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#equ">equ</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#equ">equ</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.st_valid_after">st_valid_after</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.hist_st">hist_st</a></span> (<span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.fby_equation">fby_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#to_cut">to_cut</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#equ">equ</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">exists</span> <span class="id">H</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id">H</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.st_valid_after">st_valid_after</a></span> <span class="id">st</span>' (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>)) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.hist_st">hist_st</a></span> (<span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id">H</span>' <span class="id">st</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span>) <span class="id">eqs</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof78')">Proof with</div>
<div class="proofscript" id="proof78">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">HwcG</span> <span class="id">Hsc</span> <span class="id">Hndup</span> <span class="id">Hwcenv</span> <span class="id">Hunt</span> <span class="id">Hwt</span> <span class="id">Hwc</span> <span class="id">Hsem</span> <span class="id">Hvalid</span> <span class="id">Hhistst</span> <span class="id">Hfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv_fby_equation</span> <span class="id">Hfby</span> <span class="id">to_cut</span> <span class="id">equ</span>; <span class="tactic">try</span> <span class="tactic">destruct</span> <span class="id">x2</span> <span class="kwd">as</span> (<span class="id">ty</span>&amp;<span class="id">ck</span>&amp;<span class="id">name</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;constant&nbsp;fby&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Velus.Common.CommonPS.html#PS.mem">PS.mem</a></span>; <span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">Hsem</span>. <span class="id">inv</span> <span class="id">H6</span>; <span class="id">inv</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H7</span>; <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span> <span class="kwd">in</span> <span class="id">H7</span>. <span class="id">inv</span> <span class="id">H7</span>; <span class="id">inv</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span>(<span class="id">Hsem</span>':=<span class="id">H3</span>). <span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H9</span>; <span class="id">inv</span> <span class="id">H6</span>. <span class="id">inv</span> <span class="id">H11</span>; <span class="id">inv</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H12</span>; <span class="id">inv</span> <span class="id">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hwt</span> <span class="kwd">as</span> [<span class="id">Hwt</span> <span class="id">_</span>]. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_singl">Forall_singl</a></span> <span class="kwd">in</span> <span class="id">Hwt</span>. <span class="id">inv</span> <span class="id">Hwt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_singl">Forall_singl</a></span> <span class="kwd">in</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hwc</span> <span class="kwd">as</span> [<span class="id">Hwc</span> <span class="id">_</span>]. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_singl">Forall_singl</a></span> <span class="kwd">in</span> <span class="id">Hwc</span>; <span class="id">inv</span> <span class="id">Hwc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_singl">Forall_singl</a></span> <span class="kwd">in</span> <span class="id">H13</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_eq">Forall2_eq</a></span> <span class="kwd">in</span> <span class="id">H15</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H15</span>; <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span> <span class="kwd">in</span> <span class="id">H15</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="Velus.Environment.html#Env.add">Env.add</a></span> <span class="id">x2</span> <span class="id">y0</span> <span class="id">H</span>) <span class="kwd">as</span> <span class="id">H</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id">H</span> <span class="id">H</span>') <span class="kwd">as</span> <span class="id">Href</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">Hhistst</span> <span class="kwd">as</span> [<span class="id">Hdom</span> <span class="id">_</span>]; <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#map_fst_idck">map_fst_idck</a></span> <span class="kwd">in</span> <span class="id">Hdom</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">fresh_ident_refines</span>' <span class="kwd">in</span> <span class="id">H0</span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.hist_st">hist_st</a></span> (<span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span> <span class="id">vars</span>) <span class="id">bs</span> <span class="id">H</span>' <span class="id">st</span>') <span class="kwd">as</span> <span class="id">Histst1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.fresh_ident_hist_st">fresh_ident_hist_st</a></span> <span class="kwd">in</span> <span class="id">H0</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">HeqH</span>'...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#map_fst_idck">map_fst_idck</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.fby_equation_sc_exp">fby_equation_sc_exp</a></span> <span class="kwd">with</span> (<span class="id">vars</span>:=<span class="id">vars</span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_vars">st_vars</a></span> <span class="id">st</span>) (<span class="id">e0</span>:=<span class="id">x0</span>)...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_valid_after_NoDupMembers">st_valid_after_NoDupMembers</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#idck_app">idck_app</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">clear</span> - <span class="id">Hunt</span>. <span class="id">inv</span> <span class="id">Hunt</span>; <span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#idty_app">idty_app</a></span>. <span class="tactic">rewrite</span> <span class="id">st_tys</span>'<span class="id">_st_vars</span> <span class="kwd">in</span> *. <span class="tactic">repeat</span> <span class="id">solve_incl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#idck_app">idck_app</a></span>. <span class="tactic">rewrite</span> <span class="id">st_clocks</span>'<span class="id">_st_vars</span> <span class="kwd">in</span> *. <span class="tactic">repeat</span> <span class="id">solve_incl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> <span class="id">Hhistst</span> <span class="kwd">as</span> [<span class="id">_</span> [<span class="id">_</span> ?]]. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#idck_app">idck_app</a></span>, &lt;- <span class="id">st_clocks</span>'<span class="id">_st_vars</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>'. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Seq">Seq</a></span> <span class="kwd">with</span> (<span class="id">ss</span>:=[[<span class="id">y0</span>]]); <span class="tactic">simpl</span>; <span class="tactic">repeat</span> <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_var_refines">sem_var_refines</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">HeqH</span>'. <span class="tactic">econstructor</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.add_1">Env.add_1</a></span>. 1,2:<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Seq">Seq</a></span> <span class="kwd">with</span> (<span class="id">ss</span>:=[[<span class="id">y0</span>]]); <span class="tactic">simpl</span>; <span class="tactic">repeat</span> <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_exp_refines">sem_exp_refines</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">HeqH</span>'. <span class="tactic">econstructor</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Environment.html#Env.add_1">Env.add_1</a></span>. 1,2:<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">exists</span> <span class="id">H</span>. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;fby&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hwt</span> <span class="kwd">as</span> [<span class="id">Hwt</span> <span class="id">_</span>]. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_singl">Forall_singl</a></span> <span class="kwd">in</span> <span class="id">Hwt</span>; <span class="id">inv</span> <span class="id">Hwt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_singl">Forall_singl</a></span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hwc</span> <span class="kwd">as</span> [<span class="id">Hwc</span> <span class="id">_</span>]. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_singl">Forall_singl</a></span> <span class="kwd">in</span> <span class="id">Hwc</span>; <span class="id">inv</span> <span class="id">Hwc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_singl">Forall_singl</a></span> <span class="kwd">in</span> <span class="id">H9</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_eq">Forall2_eq</a></span> <span class="kwd">in</span> <span class="id">H11</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H11</span>; <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span> <span class="kwd">in</span> <span class="id">H11</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsem</span>. <span class="id">inv</span> <span class="id">H16</span>; <span class="id">inv</span> <span class="id">H15</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H17</span>; <span class="id">inv</span> <span class="id">H16</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>. <span class="id">inv</span> <span class="id">H19</span>; <span class="id">inv</span> <span class="id">H16</span>. <span class="id">inv</span> <span class="id">H21</span>; <span class="id">inv</span> <span class="id">H17</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H22</span>; <span class="id">inv</span> <span class="id">H19</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.normalized_lexp">normalized_lexp</a></span> <span class="id">x0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">clear</span> - <span class="id">Hunt</span>. <span class="id">inv</span> <span class="id">Hunt</span>; <span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.fby_iteexp_sem">fby_iteexp_sem</a></span> <span class="kwd">with</span> (<span class="id">nck</span>:=(<span class="id">ck</span>, <span class="id">name</span>)) <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">H</span>' [<span class="id">Href1</span> [<span class="id">Hvalid1</span> [<span class="id">Hhistst1</span> [<span class="id">Hsem</span>' <span class="id">Hsem</span>'']]]]]...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>'. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Seq">Seq</a></span> <span class="kwd">with</span> (<span class="id">ss</span>:=[[<span class="id">y0</span>]]); <span class="tactic">simpl</span>; <span class="tactic">repeat</span> <span class="tactic">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_var_refines">sem_var_refines</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;arrow&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hwt</span> <span class="kwd">as</span> [<span class="id">Hwt</span> <span class="id">_</span>]. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_singl">Forall_singl</a></span> <span class="kwd">in</span> <span class="id">Hwt</span>; <span class="id">inv</span> <span class="id">Hwt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_singl">Forall_singl</a></span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hwc</span> <span class="kwd">as</span> [<span class="id">Hwc</span> <span class="id">_</span>]. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_singl">Forall_singl</a></span> <span class="kwd">in</span> <span class="id">Hwc</span>; <span class="id">inv</span> <span class="id">Hwc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_singl">Forall_singl</a></span> <span class="kwd">in</span> <span class="id">H9</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall2_eq">Forall2_eq</a></span> <span class="kwd">in</span> <span class="id">H11</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsem</span>. <span class="id">inv</span> <span class="id">H16</span>; <span class="id">inv</span> <span class="id">H15</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H3</span>. <span class="id">inv</span> <span class="id">H19</span>; <span class="id">inv</span> <span class="id">H15</span>. <span class="id">inv</span> <span class="id">H21</span>; <span class="id">inv</span> <span class="id">H16</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">H17</span>; <span class="id">inv</span> <span class="id">H18</span>. <span class="id">inv</span> <span class="id">H22</span>; <span class="id">inv</span> <span class="id">H19</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hunt</span>. 2:(<span class="id">inv</span> <span class="id">H2</span>; <span class="id">inv</span> <span class="id">H1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.arrow_iteexp_sem">arrow_iteexp_sem</a></span> <span class="kwd">with</span> (<span class="id">nck</span>:=(<span class="id">ck</span>, <span class="id">name</span>)) <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">H</span>' [<span class="id">Href</span> [<span class="id">Hvalid1</span> [<span class="id">Hhistst1</span> [<span class="id">Hsem1</span> <span class="id">Hsem1</span>']]]]]; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>'. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">constructor</span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_var_refines">sem_var_refines</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;other&nbsp;*)</span> <span class="tactic">exists</span> <span class="id">H</span>. <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.fby_equations_sem">fby_equations_sem</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">vars</span> <span class="id">bs</span> <span class="id">to_cut</span> <span class="id">eqs</span> <span class="id">eqs</span>' <span class="id">H</span> <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_global">wc_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sc_nodes">LCS.sc_nodes</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonList.html#NoDupMembers">NoDupMembers</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Clocks.html#wc_env">wc_env</a></span> (<span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id">st_clocks</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnested_equation">unnested_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#eqs">eqs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_equation">wt_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> (<span class="id"><a href="Velus.Common.Common.html#idty">idty</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id">st_tys</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>)) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#eqs">eqs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_equation">wc_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> (<span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>++<span class="id">st_clocks</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span>)) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#eqs">eqs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#eqs">eqs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.st_valid_after">st_valid_after</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.hist_st">hist_st</a></span> (<span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#vars">vars</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.fby_equations">fby_equations</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#to_cut">to_cut</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#eqs">eqs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#st">st</a></span> = (<span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">exists</span> <span class="id">H</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id">H</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#bs">bs</a></span>) <span class="id">eqs</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof79')">Proof with</div>
<div class="proofscript" id="proof79">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">eqs</span>; <span class="tactic">intros</span> * <span class="id">HwcG</span> <span class="id">Hsc</span> <span class="id">Hndup</span> <span class="id">Hwcenv</span> <span class="id">Hunt</span> <span class="id">Hwt</span> <span class="id">Hwc</span> <span class="id">Hsem</span> <span class="id">Hvalid</span> <span class="id">Hhistst</span> <span class="id">Hfby</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.fby_equations">fby_equations</a></span> <span class="kwd">in</span> <span class="id">Hfby</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">exists</span> <span class="id">H</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.fby_equations">fby_equations</a></span> <span class="id">to_cut</span> <span class="id">eqs</span> <span class="id">x1</span> = (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x2</span>, <span class="id">st</span>')) <span class="kwd">as</span> <span class="id">Hnorm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.fby_equations">fby_equations</a></span>; <span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">eexists</span>; <span class="tactic">eauto</span>. <span class="tactic">repeat</span> <span class="id">inv_bind</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hunt</span>. <span class="id">inv</span> <span class="id">Hwt</span>. <span class="id">inv</span> <span class="id">Hwc</span>. <span class="id">inv</span> <span class="id">Hsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_follows">st_follows</a></span> <span class="id">st</span> <span class="id">x1</span>) <span class="kwd">as</span> <span class="id">Hfollows</span> <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.fby_equation_st_follows">fby_equation_st_follows</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Clocks.html#wc_env">wc_env</a></span> (<span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span> <span class="id">vars</span> ++ <span class="id">st_clocks</span>' <span class="id">x1</span>)) <span class="kwd">as</span> <span class="id">Hwenv1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.fby_equation_wc_eq">fby_equation_wc_eq</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">_</span> ?]... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.fby_equation_sem">fby_equation_sem</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">H</span>' [<span class="id">Href1</span> [<span class="id">Hvalid1</span> [<span class="id">Hhistst1</span> <span class="id">Hsem1</span>]]]]. 2-11:<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id">G</span> <span class="id">H</span>' <span class="id">bs</span>) <span class="id">eqs</span>) <span class="kwd">as</span> <span class="id">Hsem</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">solve_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation_refines">sem_equation_refines</a></span>... } <span class="tactic">clear</span> <span class="id">H11</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHeqs</span> <span class="kwd">in</span> <span class="id">Hnorm</span> <span class="kwd">as</span> [<span class="id">H</span>'' [<span class="id">Href</span> <span class="id">Hsem2</span>]]. 2-11:<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2,3:<span class="id">solve_forall</span>; <span class="tactic">repeat</span> <span class="id">solve_incl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">exists</span> <span class="id">H</span>''. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">etransitivity</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_app">Forall_app</a></span>; <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation_refines">sem_equation_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">st_tys</span>'<span class="id">_st_vars</span>. <span class="id">solve_incl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_follows_vars_incl">st_follows_vars_incl</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">st_clocks</span>'<span class="id">_st_vars</span>. <span class="id">solve_incl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_follows_vars_incl">st_follows_vars_incl</a></span>...<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.init_st_hist_st">init_st_hist_st</a></span> : <span class="kwd">forall</span> <span class="id">b</span> <span class="id">H</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_in">n_in</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_vars">n_vars</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_out">n_out</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">LCS.sc_var_inv</span>' (<span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_in">n_in</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_vars">n_vars</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_out">n_out</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span>)) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.hist_st">hist_st</a></span> (<span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_in">n_in</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_vars">n_vars</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_out">n_out</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span>)) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#b">b</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.init_st">init_st</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof80')">Proof.</div>
<div class="proofscript" id="proof80">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">b</span> <span class="id">H</span> <span class="id">n</span> <span class="id">Hdom</span> <span class="id">Hinv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.st_ids">st_ids</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.init_st_anns">init_st_anns</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>, <span class="id"><a href="Velus.Common.Common.html#map_fst_idck">map_fst_idck</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.init_eqs_valids">init_eqs_valids</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_inits">st_inits</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.init_st_anns">init_st_anns</a></span>. <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">st_clocks</span>'. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.init_st_anns">init_st_anns</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.normfby_node_sem_equation">normfby_node_sem_equation</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">H</span> <span class="id">to_cut</span> <span class="id">n</span> <span class="id">Hwl</span> <span class="id">Hpref</span> <span class="id">ins</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_global">wc_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sc_nodes">LCS.sc_nodes</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnested_node">unnested_node</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_node">wt_node</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_node">wc_node</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCA.node_causal">LCA.node_causal</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.dom">Env.dom</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_in">n_in</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span> ++ <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_vars">n_vars</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span> ++ <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_out">n_out</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sem_var">sem_var</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span>) (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_in">n_in</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span>)) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ins">ins</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">xc</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sem_clock">sem_clock</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.clocks_of">clocks_of</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ins">ins</a></span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#xc">xc</a></span>)) (<span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_in">n_in</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span>)) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.abstract_clock">abstract_clock</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ins">ins</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.clocks_of">clocks_of</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ins">ins</a></span>)) (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_eqs">n_eqs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>' : <span class="id"><a href="Velus.Environment.html#Env.t">Env.t</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux.value">value</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Environment.html#Env.refines">Env.refines</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#H">H</a></span> <span class="id">H</span>' /\ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation">sem_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">H</span>' (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.clocks_of">clocks_of</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ins">ins</a></span>)) (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_eqs">n_eqs</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.normfby_node">normfby_node</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#to_cut">to_cut</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hwl">Hwl</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hpref">Hpref</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof81')">Proof with</div>
<div class="proofscript" id="proof81">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">HwcG</span> <span class="id">HscG</span> <span class="id">Hunt</span> <span class="id">Hwt</span> <span class="id">Hwc</span> <span class="id">Hcaus</span> <span class="id">Hdom</span> <span class="id">Hvars</span> <span class="id">Hsemclock</span> <span class="id">Hsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_in">n_in</a></span> <span class="id">n</span> ++ <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_vars">n_vars</a></span> <span class="id">n</span> ++ <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_out">n_out</a></span> <span class="id">n</span>))) <span class="kwd">as</span> <span class="id">Hndup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">specialize</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_nodup">n_nodup</a></span> <span class="id">n</span>) <span class="kwd">as</span> <span class="id">Hndup</span>; <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#fst_NoDupMembers">fst_NoDupMembers</a></span> <span class="kwd">in</span> <span class="id">Hndup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span> <span class="kwd">in</span> <span class="id">Hndup</span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="kwd">in</span> <span class="id">Hndup</span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#NoDup_app_l">NoDup_app_l</a></span> <span class="kwd">in</span> <span class="id">Hndup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="kwd">in</span> <span class="id">Hndup</span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span> <span class="kwd">in</span> <span class="id">Hndup</span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.fby_equations_sem">fby_equations_sem</a></span> <span class="kwd">with</span> (<span class="id">vars</span>:=(<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_in">n_in</a></span> <span class="id">n</span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_vars">n_vars</a></span> <span class="id">n</span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)) (<span class="id">eqs</span>:=<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_eqs">n_eqs</a></span> <span class="id">n</span>) (<span class="id">st</span>:=<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.init_st">init_st</a></span>)...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;7: <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#surjective_pairing">surjective_pairing</a></span>; <span class="tactic">subst</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;3:<span class="tactic">rewrite</span> <span class="id">st_tys</span>'<span class="id">_st_vars</span>. 2,4:<span class="tactic">rewrite</span> <span class="id">st_clocks</span>'<span class="id">_st_vars</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2,3,4:<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.st_vars">st_vars</a></span>; <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.init_st_anns">init_st_anns</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#fst_NoDupMembers">fst_NoDupMembers</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">Hwc</span> <span class="kwd">as</span> [<span class="id">_</span> [<span class="id">_</span> [? <span class="id">_</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_app_comm">Permutation_app_comm</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_vars">n_vars</a></span> <span class="id">_</span>))...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">Hwc</span> <span class="kwd">as</span> [<span class="id">_</span> [<span class="id">_</span> [<span class="id">_</span> ?]]]...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">Hwt</span> <span class="kwd">as</span> [<span class="id">_</span> [<span class="id">_</span> [<span class="id">_</span> ?]]]...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.Fresh.init_st_valid">init_st_valid</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.norm2_not_in_norm1_prefs">norm2_not_in_norm1_prefs</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonPS.html#PS_For_all_Forall">PS_For_all_Forall</a></span>, <span class="id"><a href="Velus.Common.CommonPS.html#ps_of_list_ps_to_list_Perm">ps_of_list_ps_to_list_Perm</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">pose</span> <span class="id">proof</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_good">n_good</a></span> <span class="id">n</span>) <span class="kwd">as</span> (<span class="id">Good</span>&amp;<span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hpref</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_incl">Forall_incl</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#incl_map">incl_map</a></span>, <span class="id">incl_appr</span>', <span class="id">incl_appr</span>', <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_appl">incl_appl</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.init_st_hist_st">init_st_hist_st</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">LCS.sc_node_sc_var_inv</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_impl_In">Forall_impl_In</a></span>; [|<span class="tactic">eauto</span>]. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.Unnesting.unnested_node">unnested_node</a></span> <span class="kwd">in</span> <span class="id">Hunt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hwc</span> <span class="kwd">as</span> (<span class="id">_</span>&amp;<span class="id">_</span>&amp;<span class="id">_</span>&amp;<span class="id">Hwc</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnested_equation_sem_sem_anon">unnested_equation_sem_sem_anon</a></span>; <span class="tactic">eauto</span>. 1,2:<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="CORRECTNESS.normfby_node_eq">normfby_node_eq</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">G</span>' <span class="id">f</span> <span class="id">n</span> <span class="id">Hwl</span> <span class="id">Hpref</span> <span class="id">ins</span> <span class="id">outs</span> <span class="id">to_cut</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">n</span> <span class="id">n</span>' =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_name">n_name</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span> = <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_name">n_name</a></span> <span class="id">n</span>') <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">G</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.global_iface_eq">global_iface_eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">G</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.global_sc_refines">LCS.global_sc_refines</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">G</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_global">wt_global</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span>::<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_global">wc_global</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span>::<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_global">wt_global</a></span> <span class="id">G</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_global">wc_global</a></span> <span class="id">G</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ord.Ordered_nodes">Ordered_nodes</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span>::<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ord.Ordered_nodes">Ordered_nodes</a></span> ((<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.normfby_node">normfby_node</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#to_cut">to_cut</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hwl">Hwl</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hpref">Hpref</a></span>)::<span class="id">G</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCA.node_causal">LCA.node_causal</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span>::<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCA.node_causal">LCA.node_causal</a></span> <span class="id">G</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_node">sem_node</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span>::<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#f">f</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ins">ins</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#outs">outs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_clock_inputs">LCS.sem_clock_inputs</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span>::<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#f">f</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ins">ins</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_node">sem_node</a></span> ((<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.normfby_node">normfby_node</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#to_cut">to_cut</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hwl">Hwl</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hpref">Hpref</a></span>)::<span class="id">G</span>') <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#f">f</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ins">ins</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#outs">outs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof82')">Proof with</div>
<div class="proofscript" id="proof82">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hnames</span> <span class="id">Hiface</span> <span class="id">Href</span> <span class="id">HwtG</span> <span class="id">HwcG</span> <span class="id">HwtG</span>' <span class="id">HwcG</span>' <span class="id">Hord1</span> <span class="id">Hord2</span> <span class="id">Hcaus1</span> <span class="id">Hcaus2</span> <span class="id">Hsem</span> <span class="id">Hinputs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sc_nodes">LCS.sc_nodes</a></span> <span class="id">G</span>) <span class="kwd">as</span> <span class="id">HscG</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">HwtG</span>. <span class="id">inv</span> <span class="id">HwcG</span>. <span class="id">inv</span> <span class="id">Hord1</span>. <span class="id">inv</span> <span class="id">Hcaus1</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.l_sem_node_clock">LCS.l_sem_node_clock</a></span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">n</span>' =&gt; <span class="tactic">exists</span> <span class="id">v</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#v">v</a></span> <span class="id">G</span> /\ <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_name">n_name</a></span> <span class="id">n</span> &lt;&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_name">n_name</a></span> <span class="id">n</span>') <span class="id">G</span>') <span class="kwd">as</span> <span class="id">Hnames</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">G</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">G</span>') <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">Hnames</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">HwtG</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall2_ignore1">Forall2_ignore1</a></span>. <span class="id">solve_forall</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_global">wt_global</a></span> (<span class="id">n</span>::<span class="id">G</span>')) <span class="kwd">as</span> <span class="id">HwtG</span>''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">constructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">HwtG</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.iface_eq_wt_node">iface_eq_wt_node</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">solve_forall</span>. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [? [<span class="id">_</span> ?]]... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_global">wc_global</a></span> (<span class="id">n</span>::<span class="id">G</span>')) <span class="kwd">as</span> <span class="id">HwcG</span>''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">constructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">HwcG</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.iface_eq_wc_node">iface_eq_wc_node</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">solve_forall</span>. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [? [<span class="id">_</span> ?]]... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ord.Ordered_nodes">Ordered_nodes</a></span> (<span class="id">n</span> :: <span class="id">G</span>')) <span class="kwd">as</span> <span class="id">Hord</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">Hord2</span>. <span class="tactic">constructor</span>... <span class="tactic">clear</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hord1</span>. <span class="tactic">intros</span> ? <span class="id">Hisin</span>. <span class="tactic">apply</span> <span class="id">H4</span> <span class="kwd">in</span> <span class="id">Hisin</span> <span class="kwd">as</span> [<span class="id">Hneq</span> <span class="id">Hname</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">clear</span> - <span class="id">Hnames</span> <span class="id">Hname</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hnames</span>; <span class="id">inv</span> <span class="id">Hname</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">left</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">right</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sc_nodes">LCS.sc_nodes</a></span> <span class="id">G</span>') <span class="kwd">as</span> <span class="id">HscG</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">inv</span> <span class="id">HwtG</span>''. <span class="id">inv</span> <span class="id">HwcG</span>''. <span class="id">inv</span> <span class="id">Hord2</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.l_sem_node_clock">LCS.l_sem_node_clock</a></span>... }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsem</span>; <span class="tactic">assert</span> (<span class="id">Hfind</span>:=<span class="id">H0</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> (<span class="id"><a href="Velus.Common.CommonPS.html#ident_eqb">ident_eqb</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_name">n_name</a></span> <span class="id">n</span>) <span class="id">f</span>) <span class="id">eqn</span>:<span class="id">Hident</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">HwcG</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*The&nbsp;semantics&nbsp;of&nbsp;equations&nbsp;can&nbsp;be&nbsp;given&nbsp;according&nbsp;to&nbsp;G&nbsp;only&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Forall_sem_equation_global_tl">Forall_sem_equation_global_tl</a></span> <span class="kwd">in</span> <span class="id">H3</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id">inv</span> <span class="id">Hord1</span>. <span class="tactic">intro</span> <span class="id">contra</span>. <span class="tactic">apply</span> <span class="id">H9</span> <span class="kwd">in</span> <span class="id">contra</span> <span class="kwd">as</span> [? <span class="id">_</span>]; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;New&nbsp;env&nbsp;H'&nbsp;(restrict&nbsp;H)&nbsp;and&nbsp;its&nbsp;properties&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_node_restrict">LCS.sem_node_restrict</a></span> <span class="kwd">in</span> <span class="id">H3</span> <span class="kwd">as</span> (<span class="id">Hdom</span>&amp;<span class="id">Hins</span>'&amp;<span class="id">Houts</span>'&amp;<span class="id">Heqs</span>'); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="tactic">destruct</span> <span class="id">H6</span> <span class="kwd">as</span> (?&amp;?&amp;?&amp;?); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="Velus.Environment.html#Env.restrict">Env.restrict</a></span> <span class="id">H</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_in">n_in</a></span> <span class="id">n0</span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_vars">n_vars</a></span> <span class="id">n0</span>++<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_out">n_out</a></span> <span class="id">n0</span>))) <span class="kwd">as</span> <span class="id">H</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">HeqH</span>'.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion_clear</span> <span class="id">HwtG</span>. <span class="tactic">rename</span> <span class="id">H0</span> <span class="id">into</span> <span class="id">Hwt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hcaus1</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.normfby_node_sem_equation">normfby_node_sem_equation</a></span> <span class="kwd">with</span> (<span class="id">to_cut</span>:=<span class="id">to_cut</span>) (<span class="id">Hwl</span>:=<span class="id">Hwl</span>) <span class="kwd">in</span> <span class="id">Heqs</span>' <span class="kwd">as</span> (<span class="id">H</span>''&amp;<span class="id">Hre</span>'&amp;<span class="id">Heqs</span>'')...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.sem_var">sem_var</a></span> <span class="id">H</span>'') (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.idents">idents</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_in">n_in</a></span> <span class="id">n0</span>)) <span class="id">ins</span>) <span class="kwd">as</span> <span class="id">Hins</span>''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">repeat</span> <span class="id">rewrite_Forall_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_var_refines">sem_var_refines</a></span>... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.Snode">Snode</a></span> <span class="kwd">with</span> (<span class="id">H</span>:=<span class="id">H</span>''); <span class="tactic">simpl</span>. 5:<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">Hident</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span>. <span class="tactic">repeat</span> <span class="id">rewrite_Forall_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_var_refines">sem_var_refines</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">clear</span> <span class="id">Hins</span>' <span class="id">Houts</span>' <span class="id">Hdom</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Forall_sem_equation_global_tl</span>'...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ord.find_node_not_Is_node_in">find_node_not_Is_node_in</a></span> <span class="kwd">in</span> <span class="id">Hord2</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#ident_eqb_refl">ident_eqb_refl</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.normalized_node">normalized_node</a></span> <span class="id">G</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.normfby_node">normfby_node</a></span> <span class="id">G</span> <span class="id">to_cut</span> <span class="id">n0</span> <span class="id">Hwl</span> <span class="id">Hpref</span>)) <span class="kwd">as</span> <span class="id">Hunt</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.normfby_node_normalized_node">normfby_node_normalized_node</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_node">wc_node</a></span> <span class="id">G</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.normfby_node">normfby_node</a></span> <span class="id">G</span> <span class="id">to_cut</span> <span class="id">n0</span> <span class="id">Hwl</span> <span class="id">Hpref</span>)) <span class="kwd">as</span> <span class="id">Hwc</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.normfby_node_wc">normfby_node_wc</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_equation_anon">LCS.sem_equation_anon</a></span> <span class="id">G</span> <span class="id">H</span>'' (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.clocks_of">clocks_of</a></span> <span class="id">ins</span>)) (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_eqs">n_eqs</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.normfby_node">normfby_node</a></span> <span class="id">G</span> <span class="id">to_cut</span> <span class="id">n0</span> <span class="id">Hwl</span> <span class="id">Hpref</span>))) <span class="kwd">as</span> <span class="id">Heqs</span>'''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_impl_In">Forall_impl_In</a></span>; [|<span class="tactic">eapply</span> <span class="id">Heqs</span>''].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.normalized_equation_sem_sem_anon">normalized_equation_sem_sem_anon</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hunt</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hwc</span>' <span class="kwd">as</span> (<span class="id">_</span>&amp;<span class="id">_</span>&amp;<span class="id">_</span>&amp;<span class="id">Hwc</span>'). <span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hwc</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <span class="tactic">clear</span> <span class="id">Heqs</span>''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">LCS.sc_var_inv</span>' (<span class="id"><a href="Velus.Common.Common.html#idck">idck</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_in">n_in</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.normfby_node">normfby_node</a></span> <span class="id">G</span> <span class="id">to_cut</span> <span class="id">n0</span> <span class="id">Hwl</span> <span class="id">Hpref</span>) ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_vars">n_vars</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.normfby_node">normfby_node</a></span> <span class="id">G</span> <span class="id">to_cut</span> <span class="id">n0</span> <span class="id">Hwl</span> <span class="id">Hpref</span>) ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_out">n_out</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.normfby_node">normfby_node</a></span> <span class="id">G</span> <span class="id">to_cut</span> <span class="id">n0</span> <span class="id">Hwl</span> <span class="id">Hpref</span>))) <span class="id">H</span>'' (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr.clocks_of">clocks_of</a></span> <span class="id">ins</span>)) <span class="kwd">as</span> <span class="id">Hinv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">Hinputs</span> <span class="kwd">as</span> (<span class="id">H</span>'''&amp;?&amp;<span class="id">Hfind</span>'&amp;?&amp;<span class="id">Hcks</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hfind</span> <span class="kwd">in</span> <span class="id">Hfind</span>'; <span class="id">inv</span> <span class="id">Hfind</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">LCS.sc_node_sc_var_inv</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.normfby_node_causal">normfby_node_causal</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">LCS.sem_clocks_det</span>' <span class="kwd">in</span> <span class="id">Hcks</span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> <span class="id">H6</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_impl_In">Forall_impl_In</a></span>; [|<span class="tactic">eauto</span>]. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sc_ref_sem_equation">LCS.sc_ref_sem_equation</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_equation_anon_sem_equation">LCS.sem_equation_anon_sem_equation</a></span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="tactic">destruct</span> <span class="id">Hwc</span>' <span class="kwd">as</span> (<span class="id">_</span>&amp;<span class="id">_</span>&amp;<span class="id">_</span>&amp;<span class="id">Hwc</span>'); <span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hwc</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#NoDupMembers_idck">NoDupMembers_idck</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#fst_NoDupMembers">fst_NoDupMembers</a></span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.node_NoDup">node_NoDup</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">Hinputs</span> <span class="kwd">as</span> (<span class="id">H</span>''&amp;?&amp;?&amp;?&amp;?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">Hfind</span>. <span class="id">inv</span> <span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H6</span> <span class="kwd">as</span> (?&amp;<span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">LCS.sem_clocks_det</span>' <span class="kwd">in</span> <span class="id">H8</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">specialize</span> (<span class="id">Href</span> <span class="id">f</span> <span class="id">ins</span> <span class="id">outs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#ident_eqb_neq">ident_eqb_neq</a></span> <span class="kwd">in</span> <span class="id">Hident</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">sem_node_cons</span>'...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Href</span>. <span class="tactic">split</span>. 1:<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_clock_inputs_cons">LCS.sem_clock_inputs_cons</a></span> <span class="kwd">in</span> <span class="id">Hinputs</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">econstructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_impl_In">Forall_impl_In</a></span>; [| <span class="tactic">eauto</span>]. <span class="tactic">intros</span> <span class="id">eq</span> <span class="id">Hin</span> <span class="id">Hsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_equation_global_tl">sem_equation_global_tl</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ord.find_node_later_not_Is_node_in">find_node_later_not_Is_node_in</a></span> <span class="kwd">in</span> <span class="id">Hord1</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hisin</span>. <span class="tactic">apply</span> <span class="id">Hord1</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ord.Is_node_in_Exists">Is_node_in_Exists</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eexists</span>...<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="CORRECTNESS.iface_eq_sem_clocks_input">iface_eq_sem_clocks_input</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">G</span>' <span class="id">f</span> <span class="id">ins</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.global_iface_eq">global_iface_eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id">G</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_clock_inputs">LCS.sem_clock_inputs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#f">f</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ins">ins</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_clock_inputs">LCS.sem_clock_inputs</a></span> <span class="id">G</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#f">f</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ins">ins</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof83')">Proof.</div>
<div class="proofscript" id="proof83">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hglob</span> [<span class="id">H</span> [<span class="id">n</span> [<span class="id">Hfind</span> [<span class="id">Hinputs</span> <span class="id">Hsem</span>]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id">Hglob</span> <span class="id">f</span>). <span class="tactic">rewrite</span> <span class="id">Hfind</span> <span class="kwd">in</span> <span class="id">Hglob</span>; <span class="id">inv</span> <span class="id">Hglob</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> (<span class="id">Hname</span>&amp;<span class="id">_</span>&amp;<span class="id">Hins</span>&amp;<span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>. <span class="tactic">exists</span> <span class="id">sy</span>. <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">auto</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id">normfby_global_names</span>' : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">Hwl</span> <span class="id">Hprefs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">n</span> <span class="id">n</span>' =&gt; <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_name">n_name</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#n">n</a></span> = <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_name">n_name</a></span> <span class="id">n</span>') <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.normfby_global">normfby_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hwl">Hwl</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hprefs">Hprefs</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof84')">Proof.</div>
<div class="proofscript" id="proof84">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">G</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="CORRECTNESS.normfby_global_refines">normfby_global_refines</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">Hunt</span> <span class="id">Hprefs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_global">wt_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_global">wc_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCA.node_causal">LCA.node_causal</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.global_sc_refines">LCS.global_sc_refines</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.normfby_global">normfby_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hunt">Hunt</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hprefs">Hprefs</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof85')">Proof with</div>
<div class="proofscript" id="proof85">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">G</span> <span class="id">Hunt</span>. <span class="tactic">specialize</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.normfby_global_eq">normfby_global_eq</a></span> <span class="id">G</span> <span class="id">Hunt</span>) <span class="kwd">as</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">G</span>; <span class="tactic">intros</span> * <span class="id">Hwt</span> <span class="id">Hwc</span> <span class="id">Hcaus</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.global_sc_ref_nil">LCS.global_sc_ref_nil</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.global_sc_ref_cons">LCS.global_sc_ref_cons</a></span> <span class="kwd">with</span> (<span class="id">f</span>:=<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.n_name">n_name</a></span> <span class="id">a</span>)...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.wt_global_Ordered_nodes">wt_global_Ordered_nodes</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.normfby_global_wt">Typing.normfby_global_wt</a></span> <span class="kwd">in</span> <span class="id">Hwt</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">Hwt</span>; <span class="id">inv</span> <span class="id">Hwc</span>; <span class="id">inv</span> <span class="id">Hcaus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHG</span>... <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.normfby_global_eq">normfby_global_eq</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">ins</span> <span class="id">outs</span> <span class="id">Hsem</span>. <span class="tactic">destruct</span> <span class="id">Hsem</span> <span class="kwd">as</span> [<span class="id">Hinputs</span> <span class="id">Hsem</span>]. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.iface_eq_sem_clocks_input">iface_eq_sem_clocks_input</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.normfby_node_eq">normfby_node_eq</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">apply</span> <span class="id">normfby_global_names</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.normfby_global_eq">normfby_global_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">inv</span> <span class="id">Hwt</span>; <span class="id">inv</span> <span class="id">Hwc</span>; <span class="id">inv</span> <span class="id">Hcaus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHG</span>... <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.normfby_global_eq">normfby_global_eq</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">inv</span> <span class="id">Hwt</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.normfby_global_wt">normfby_global_wt</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">inv</span> <span class="id">Hwc</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.normfby_global_wc">normfby_global_wc</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.wt_global_Ordered_nodes">wt_global_Ordered_nodes</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.normfby_global_wt">normfby_global_wt</a></span> <span class="kwd">in</span> <span class="id">Hwt</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">inv</span> <span class="id">Hwc</span>. <span class="id">inv</span> <span class="id">Hcaus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.normfby_global_causal">normfby_global_causal</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="CORRECTNESS.normfby_global_sem">normfby_global_sem</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">Hunt</span> <span class="id">Hprefs</span> <span class="id">f</span> <span class="id">ins</span> <span class="id">outs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_global">wt_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_global">wc_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ord.Ordered_nodes">Ordered_nodes</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCA.node_causal">LCA.node_causal</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_node">sem_node</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#f">f</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ins">ins</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#outs">outs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_clock_inputs">LCS.sem_clock_inputs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#f">f</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ins">ins</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_node">sem_node</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.normfby_global">normfby_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hunt">Hunt</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hprefs">Hprefs</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#f">f</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ins">ins</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#outs">outs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof86')">Proof.</div>
<div class="proofscript" id="proof86">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.normfby_global_refines">normfby_global_refines</a></span> <span class="kwd">with</span> (<span class="id">Hunt</span>:=<span class="id">Hunt</span>) <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id">H</span> <span class="id">f</span> <span class="id">ins</span> <span class="id">outs</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span> <span class="id">H4</span> <span class="id">H3</span>)) <span class="kwd">as</span> [<span class="id">_</span> ?]; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="CORRECTNESS.normfby_global_sem_clock_inputs">normfby_global_sem_clock_inputs</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">Hwl</span> <span class="id">Hprefs</span> <span class="id">f</span> <span class="id">ins</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_clock_inputs">LCS.sem_clock_inputs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#f">f</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ins">ins</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_clock_inputs">LCS.sem_clock_inputs</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.normfby_global">normfby_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hwl">Hwl</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hprefs">Hprefs</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#f">f</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ins">ins</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof87')">Proof.</div>
<div class="proofscript" id="proof87">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.NormFby.normfby_global_eq">normfby_global_eq</a></span> <span class="id">G</span> <span class="id">Hwl</span> <span class="id">Hprefs</span>) <span class="kwd">as</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">H</span> [<span class="id">n</span>' [<span class="id">Hfind</span> [<span class="id">Hvars</span> <span class="id">Hsem</span>]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn.global_iface_eq_find">global_iface_eq_find</a></span> <span class="kwd">in</span> <span class="id">Heq</span> <span class="kwd">as</span> [? [? [<span class="id">Hname</span> [<span class="id">_</span> [<span class="id">Hin</span> <span class="id">Hout</span>]]]]]; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> <span class="id">H</span>. <span class="tactic">exists</span> <span class="id">x</span>. <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<h2> Conclusion </h2>
<br/>
&nbsp;&nbsp;<span class="kwd">Theorem</span> <span class="id"><a name="CORRECTNESS.normalize_global_sem">normalize_global_sem</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">Hwl</span> <span class="id">Hprefs</span> <span class="id">G</span>' <span class="id">f</span> <span class="id">ins</span> <span class="id">outs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_global">wt_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_global">wc_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_node">sem_node</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#f">f</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ins">ins</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#outs">outs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_clock_inputs">LCS.sem_clock_inputs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#f">f</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ins">ins</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.normalize_global">normalize_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hwl">Hwl</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hprefs">Hprefs</a></span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">Errors.OK</a></span> <span class="id">G</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem.sem_node">sem_node</a></span> <span class="id">G</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#f">f</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ins">ins</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#outs">outs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof88')">Proof with</div>
<div class="proofscript" id="proof88">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>  * <span class="id">Hwt</span> <span class="id">Hwc</span> <span class="id">Hsem</span> <span class="id">Hclocks</span> <span class="id">Hnorm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.normalize_global">normalize_global</a></span> <span class="kwd">in</span> <span class="id">Hnorm</span>. <span class="tactic">destruct</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCA.check_causality">LCA.check_causality</a></span> <span class="id">_</span>) <span class="id">eqn</span>:<span class="id">Hcaus</span>; <span class="id">inv</span> <span class="id">Hnorm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.normfby_global_sem">normfby_global_sem</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_global_wt">unnest_global_wt</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_global_wc">unnest_global_wc</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.wt_global_Ordered_nodes">wt_global_Ordered_nodes</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_global_wt">unnest_global_wt</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCA.check_causality_correct">LCA.check_causality_correct</a></span> <span class="kwd">in</span> <span class="id">Hcaus</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty.wt_global_wl_global">wt_global_wl_global</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_global_wt">unnest_global_wt</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_global_sem">unnest_global_sem</a></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_global_sem_clock_inputs">unnest_global_sem_clock_inputs</a></span>...<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="CORRECTNESS.normalize_global_sem_clock_inputs">normalize_global_sem_clock_inputs</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">G</span>' <span class="id">Hwl</span> <span class="id">Hprefs</span> <span class="id">f</span> <span class="id">ins</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_clock_inputs">LCS.sem_clock_inputs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#f">f</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ins">ins</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.normalize_global">normalize_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hwl">Hwl</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hprefs">Hprefs</a></span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">Errors.OK</a></span> <span class="id">G</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCS.sem_clock_inputs">LCS.sem_clock_inputs</a></span> <span class="id">G</span>' <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#f">f</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#ins">ins</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof89')">Proof.</div>
<div class="proofscript" id="proof89">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hsc</span> <span class="id">Hnorm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.normalize_global">normalize_global</a></span> <span class="kwd">in</span> <span class="id">Hnorm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCA.check_causality">LCA.check_causality</a></span> <span class="id">_</span>) <span class="id">eqn</span>:<span class="id">Hcheck</span>; <span class="id">inv</span> <span class="id">Hnorm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.normfby_global_sem_clock_inputs">normfby_global_sem_clock_inputs</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_global_sem_clock_inputs">unnest_global_sem_clock_inputs</a></span>, <span class="id">Hsc</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<h2> In addition : normalization only produces causal programs </h2>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="CORRECTNESS.normalize_global_causal">normalize_global_causal</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">G</span>' <span class="id">Hwl</span> <span class="id">Hprefs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Cl.wc_global">wc_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.normalize_global">normalize_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hwl">Hwl</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Hprefs">Hprefs</a></span> = <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#OK">Errors.OK</a></span> <span class="id">G</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCA.node_causal">LCA.node_causal</a></span> <span class="id">G</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof90')">Proof.</div>
<div class="proofscript" id="proof90">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hwc</span> <span class="id">Hnorm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm.normalize_global">normalize_global</a></span> <span class="kwd">in</span> <span class="id">Hnorm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="../../CompCert/doc/html/compcert.common.Errors.html#bind_inversion">Errors.bind_inversion</a></span> <span class="kwd">in</span> <span class="id">Hnorm</span> <span class="kwd">as</span> [? [<span class="id">H1</span> <span class="id">H2</span>]]. <span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.normfby_global_causal">normfby_global_causal</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCA.check_causality_correct">LCA.check_causality_correct</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS.unnest_global_wc">unnest_global_wc</a></span> <span class="kwd">in</span> <span class="id">Hwc</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS">CORRECTNESS</a></span>.<br/>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="CorrectnessFun">CorrectnessFun</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ids</span> : <span class="id"><a href="Velus.Common.Common.html#IDS">IDS</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Op</span> : <span class="id"><a href="Velus.Operators.html#OPERATORS">OPERATORS</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">OpAux</span> : <span class="id"><a href="Velus.Operators.html#OPERATORS_AUX">OPERATORS_AUX</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op">Op</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">CStr</span> : <span class="id"><a href="Velus.CoindStreams.html#COINDSTREAMS">COINDSTREAMS</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux">OpAux</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">IStr</span> : <span class="id"><a href="Velus.IndexedStreams.html#INDEXEDSTREAMS">INDEXEDSTREAMS</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux">OpAux</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Syn</span> : <span class="id"><a href="Velus.Lustre.LSyntax.html#LSYNTAX">LSYNTAX</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op">Op</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">LCA</span> : <span class="id"><a href="Velus.Lustre.LCausality.html#LCAUSALITY">LCAUSALITY</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn">Syn</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ty</span> : <span class="id"><a href="Velus.Lustre.LTyping.html#LTYPING">LTYPING</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn">Syn</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Clo</span> : <span class="id"><a href="Velus.Lustre.LClocking.html#LCLOCKING">LCLOCKING</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn">Syn</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Lord</span> : <span class="id"><a href="Velus.Lustre.LOrdered.html#LORDERED">LORDERED</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn">Syn</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Sem</span> : <span class="id"><a href="Velus.Lustre.LSemantics.html#LSEMANTICS">LSEMANTICS</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn">Syn</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Lord">Lord</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr">CStr</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">LClockSem</span> : <span class="id"><a href="Velus.Lustre.LClockSemantics.html#LCLOCKSEMANTICS">LCLOCKSEMANTICS</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn">Syn</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Clo">Clo</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCA">LCA</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Lord">Lord</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr">CStr</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#IStr">IStr</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem">Sem</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Norm</span> : <span class="id"><a href="Velus.Lustre.Normalization.Normalization.html#NORMALIZATION">NORMALIZATION</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn">Syn</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCA">LCA</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;: <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS">CORRECTNESS</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr">CStr</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#IStr">IStr</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn">Syn</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCA">LCA</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty">Ty</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Clo">Clo</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Lord">Lord</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem">Sem</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LClockSem">LClockSem</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm">Norm</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Include</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CORRECTNESS">CORRECTNESS</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CStr">CStr</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#IStr">IStr</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Syn">Syn</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LCA">LCA</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Ty">Ty</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Clo">Clo</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Lord">Lord</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Sem">Sem</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#LClockSem">LClockSem</a></span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#Norm">Norm</a></span>.<br/>
<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.Normalization.Correctness.html#CorrectnessFun">CorrectnessFun</a></span>.<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
