
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module NormFby</title>
<meta name="description" content="Documentation of Coq module NormFby" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module NormFby</h1>
<div class="coq">
<span class="kwd">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html">List</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html">Sorting.Permutation</a></span>.<br/>
<span class="kwd">Import</span> <span class="id">List.ListNotations</span>.<br/>
<span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">list_scope</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.omega.Omega.html">Omega</a></span>.<br/>
<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Common.Common.html">Common</a></span> <span class="id"><a href="Velus.Environment.html">Environment</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Operators.html">Operators</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Lustre.LSyntax.html">Lustre.LSyntax</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="id"><a href="Velus.Lustre.Normalization.Fresh.html">Lustre.Normalization.Fresh</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Velus</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Velus.Lustre.Normalization.Unnesting.html">Lustre.Normalization.Unnesting</a></span>.<br/>
<br/>
<h1> Putting FBYs into normalized form </h1>
<br/>
<span class="kwd">Module</span> <span class="kwd">Type</span> <span class="id"><a name="NORMFBY">NORMFBY</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Ids</span> : <span class="id"><a href="Velus.Common.Common.html#IDS">IDS</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Op</span> : <span class="id"><a href="Velus.Operators.html#OPERATORS">OPERATORS</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">OpAux</span> : <span class="id"><a href="Velus.Operators.html#OPERATORS_AUX">OPERATORS_AUX</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Op">Op</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Syn</span> : <span class="id"><a href="Velus.Lustre.LSyntax.html#LSYNTAX">LSYNTAX</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Op">Op</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">Import</span> <span class="id">Unt</span> : <span class="id"><a href="Velus.Lustre.Normalization.Unnesting.html#UNNESTING">UNNESTING</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn">Syn</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Import</span> <span class="id">Fresh</span> <span class="id">Fresh.Notations</span> <span class="id">Facts</span> <span class="id">Tactics</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">fresh_monad_scope</span>.<br/>
<br/>
<div class="doc">Fresh ident generation keeping type annotations;
      also retaining if the var is an init var or not </div>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="NORMFBY.FreshAnn">FreshAnn</a></span> <span class="id">A</span> := <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.Fresh">Fresh</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#A">A</a></span> ((<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Op.type">type</a></span> * <span class="id"><a href="Velus.ClockDefs.html#clock">clock</a></span>) * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>).<br/>
<br/>
<div class="doc">Add some whens on top of an expression </div>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="NORMFBY.add_whens">add_whens</a></span> (<span class="id">e</span> : <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.exp">exp</a></span>) (<span class="id">ty</span> : <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Op.type">type</a></span>) (<span class="id">cl</span> : <span class="id"><a href="Velus.ClockDefs.html#clock">clock</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#cl">cl</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.ClockDefs.html#Cbase">Cbase</a></span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.ClockDefs.html#Con">Con</a></span> <span class="id">cl</span>' <span class="id">clid</span> <span class="id">b</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.Ewhen">Ewhen</a></span> [(<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#add_whens">add_whens</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ty">ty</a></span> <span class="id">cl</span>')] <span class="id">clid</span> <span class="id">b</span> ([<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ty">ty</a></span>], (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#cl">cl</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">bool_scope</span>.<br/>
<br/>
<div class="doc">Generate an init equation for a given clock `cl`; if the init equation for `cl` already exists,
      just return the variable </div>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="NORMFBY.init_var_for_clock">init_var_for_clock</a></span> (<span class="id">cl</span> : <span class="id"><a href="Velus.ClockDefs.html#clock">clock</a></span>) : <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.FreshAnn">FreshAnn</a></span> (<span class="id"><a href="Velus.ClockDefs.html#ident">ident</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.equation">equation</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">st</span> =&gt; <span class="kwd">match</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#find">find</a></span> (<span class="kwd">fun</span> '(<span class="id">_</span>, ((<span class="id">ty</span>, <span class="id">cl</span>'), <span class="id">isinit</span>)) =&gt; <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#isinit">isinit</a></span> &amp;&amp; (<span class="id">cl</span>' ==<span class="id">b</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#cl">cl</a></span>) &amp;&amp; (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ty">ty</a></span> ==<span class="id">b</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Op.bool_type">Op.bool_type</a></span>)) (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.st_anns">st_anns</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span>)) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">x</span>, <span class="id">_</span>) =&gt; ((<span class="id">x</span>, []), <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="kwd">let</span> (<span class="id">x</span>, <span class="id">st</span>') := <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.fresh_ident">fresh_ident</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Ids.norm2">norm2</a></span> ((<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Op.bool_type">bool_type</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#cl">cl</a></span>), <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#x">x</a></span>, [([<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#x">x</a></span>], [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.Efby">Efby</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.add_whens">add_whens</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.Econst">Econst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Op.true_const">true_const</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Op.bool_type">bool_type</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#cl">cl</a></span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.add_whens">add_whens</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.Econst">Econst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Op.false_const">false_const</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Op.bool_type">bool_type</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#cl">cl</a></span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[(<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Op.bool_type">bool_type</a></span>, (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#cl">cl</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>))]])]), <span class="id">st</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="NORMFBY.is_constant">is_constant</a></span> (<span class="id">e</span> : <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.exp">exp</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.Econst">Econst</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.Ewhen">Ewhen</a></span> [<span class="id">e</span>] <span class="id">_</span> <span class="id">_</span> ([<span class="id">ty</span>], <span class="id">_</span>) =&gt; <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#is_constant">is_constant</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Generate a if-then-else equation for (0 fby e), and return an expression using it </div>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="NORMFBY.fby_iteexp">fby_iteexp</a></span> (<span class="id">e0</span> : <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.exp">exp</a></span>) (<span class="id">e</span> : <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.exp">exp</a></span>) (<span class="id">ann</span> : <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.ann">ann</a></span>) : <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.FreshAnn">FreshAnn</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.exp">exp</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.equation">equation</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '(<span class="id">ty</span>, (<span class="id">ck</span>, <span class="id">name</span>)) := <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ann">ann</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">initid</span>, <span class="id">eqs</span>) &lt;- <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.init_var_for_clock">init_var_for_clock</a></span> <span class="id">ck</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">px</span> &lt;- <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.fresh_ident">fresh_ident</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Ids.norm2">norm2</a></span> ((<span class="id">ty</span>, <span class="id">ck</span>), <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.Eite">Eite</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.Evar">Evar</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#initid">initid</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Op.bool_type">bool_type</a></span>, (<span class="id">ck</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#initid">initid</a></span>))) [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.Evar">Evar</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#px">px</a></span> (<span class="id">ty</span>, (<span class="id">ck</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#px">px</a></span>))] ([<span class="id">ty</span>], (<span class="id">ck</span>, <span class="id">name</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;([<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#px">px</a></span>], [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.Efby">Efby</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.add_whens">add_whens</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.Econst">Econst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Op.init_type">init_type</a></span> <span class="id">ty</span>)) <span class="id">ty</span> <span class="id">ck</span>] [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span>] [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ann">ann</a></span>]])::<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eqs">eqs</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="NORMFBY.arrow_iteexp">arrow_iteexp</a></span> (<span class="id">e0</span> : <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.exp">exp</a></span>) (<span class="id">e</span> : <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.exp">exp</a></span>) (<span class="id">ann</span> : <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.ann">ann</a></span>) : <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.FreshAnn">FreshAnn</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.exp">exp</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.equation">equation</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '(<span class="id">ty</span>, (<span class="id">ck</span>, <span class="id">name</span>)) := <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ann">ann</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">initid</span>, <span class="id">eqs</span>) &lt;- <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.init_var_for_clock">init_var_for_clock</a></span> <span class="id">ck</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.ret">ret</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.Eite">Eite</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.Evar">Evar</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#initid">initid</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Op.bool_type">bool_type</a></span>, (<span class="id">ck</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#initid">initid</a></span>))) [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span>] [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;([<span class="id">ty</span>], (<span class="id">ck</span>, <span class="id">name</span>)), <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eqs">eqs</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="NORMFBY.fby_equation">fby_equation</a></span> (<span class="id">to_cut</span> : <span class="id"><a href="Velus.Common.CommonPS.html#PS.t">PS.t</a></span>) (<span class="id">eq</span> : <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.equation">equation</a></span>) : <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.FreshAnn">FreshAnn</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.equation">equation</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eq">eq</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| ([<span class="id">x</span>], [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.Efby">Efby</a></span> [<span class="id">e0</span>] [<span class="id">e</span>] [<span class="id">ann</span>]]) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '(<span class="id">ty</span>, (<span class="id">ck</span>, <span class="id">_</span>)) := <span class="id">ann</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.is_constant">is_constant</a></span> <span class="id">e0</span> <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Velus.Common.CommonPS.html#PS.mem">PS.mem</a></span> <span class="id">x</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#to_cut">to_cut</a></span> <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x</span>' &lt;- <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.fresh_ident">fresh_ident</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Ids.norm2">norm2</a></span> ((<span class="id">ty</span>, <span class="id">ck</span>), <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.ret">ret</a></span> [([<span class="id">x</span>], [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.Evar">Evar</a></span> <span class="id">x</span>' <span class="id">ann</span>]); ([<span class="id">x</span>'], [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.Efby">Efby</a></span> [<span class="id">e0</span>] [<span class="id">e</span>] [<span class="id">ann</span>]])]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.ret">ret</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eq">eq</a></span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">fby</span>, <span class="id">eqs</span>) &lt;- <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_iteexp">fby_iteexp</a></span> <span class="id">e0</span> <span class="id">e</span> <span class="id">ann</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.ret">ret</a></span> (([<span class="id">x</span>], [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#fby">fby</a></span>])::<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eqs">eqs</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| ([<span class="id">x</span>], [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.Earrow">Earrow</a></span> [<span class="id">e0</span>] [<span class="id">e</span>] [<span class="id">ann</span>]]) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> (<span class="id">ite</span>, <span class="id">eqs</span>) &lt;- <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.arrow_iteexp">arrow_iteexp</a></span> <span class="id">e0</span> <span class="id">e</span> <span class="id">ann</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.ret">ret</a></span> (([<span class="id">x</span>], [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ite">ite</a></span>])::<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eqs">eqs</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.ret">ret</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eq">eq</a></span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="NORMFBY.fby_equations">fby_equations</a></span> (<span class="id">to_cut</span> : <span class="id"><a href="Velus.Common.CommonPS.html#PS.t">PS.t</a></span>) (<span class="id">eqs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.equation">equation</a></span>) : <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.FreshAnn">FreshAnn</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.equation">equation</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">eqs</span>' &lt;- <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.map_bind">map_bind</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equation">fby_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#to_cut">to_cut</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eqs">eqs</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.ret">ret</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">eqs</span>').<br/>
<br/>
<div class="doc">Some initial properties </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Local</span> <span class="kwd">Ltac</span> <span class="id">destruct_to_singl</span> <span class="id">l</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>; [|<span class="tactic">destruct</span> <span class="id">l</span>]; <span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.fby_equation_spec">fby_equation_spec</a></span> : <span class="kwd">forall</span> <span class="id">to_cut</span> <span class="id">xs</span> <span class="id">es</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">exists</span> <span class="id">x</span> <span class="id">e0</span> <span class="id">e</span> <span class="id">ann</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#xs">xs</a></span> = [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#x">x</a></span>] /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#es">es</a></span> = [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.Efby">Efby</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span>] [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span>] [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ann">ann</a></span>]] /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.is_constant">is_constant</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equation">fby_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#to_cut">to_cut</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#xs">xs</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#es">es</a></span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">let</span> '(<span class="id">ty</span>, (<span class="id">ck</span>, <span class="id">_</span>)) := <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ann">ann</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Velus.Common.CommonPS.html#PS.mem">PS.mem</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#x">x</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#to_cut">to_cut</a></span> <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> <span class="id">x</span>' &lt;- <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.fresh_ident">fresh_ident</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Ids.norm2">norm2</a></span> ((<span class="id">ty</span>, <span class="id">ck</span>), <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.ret">ret</a></span> [([<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#x">x</a></span>], [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.Evar">Evar</a></span> <span class="id">x</span>' <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ann">ann</a></span>]); ([<span class="id">x</span>'], <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#es">es</a></span>)]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.ret">ret</a></span> [(<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#xs">xs</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#es">es</a></span>)]))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/ (<span class="tactic">exists</span> <span class="id">x</span> <span class="id">e0</span> <span class="id">e</span> <span class="id">ann</span> ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#xs">xs</a></span> = [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#x">x</a></span>] /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#es">es</a></span> = [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.Efby">Efby</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span>] [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span>] [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ann">ann</a></span>]] /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.is_constant">is_constant</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equation">fby_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#to_cut">to_cut</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#xs">xs</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#es">es</a></span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">do</span> (<span class="id">fby</span>, <span class="id">eqs</span>) &lt;- <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_iteexp">fby_iteexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ann">ann</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.ret">ret</a></span> (([<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#x">x</a></span>], [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#fby">fby</a></span>])::<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eqs">eqs</a></span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/ (<span class="tactic">exists</span> <span class="id">x</span> <span class="id">e0</span> <span class="id">e</span> <span class="id">ann</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#xs">xs</a></span> = [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#x">x</a></span>] /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#es">es</a></span> = [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.Earrow">Earrow</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span>] [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span>] [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ann">ann</a></span>]] /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equation">fby_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#to_cut">to_cut</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#xs">xs</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#es">es</a></span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">do</span> (<span class="id">ite</span>, <span class="id">eqs</span>) &lt;- <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.arrow_iteexp">arrow_iteexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ann">ann</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.ret">ret</a></span> (([<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#x">x</a></span>], [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ite">ite</a></span>])::<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eqs">eqs</a></span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/ <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equation">fby_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#to_cut">to_cut</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#xs">xs</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#es">es</a></span>) = (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.ret">ret</a></span> [(<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#xs">xs</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#es">es</a></span>)]).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1')">Proof.</div>
<div class="proofscript" id="proof1">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct_to_singl</span> <span class="id">xs</span>. <span class="id">destruct_to_singl</span> <span class="id">es</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2: { <span class="tactic">repeat</span> <span class="tactic">right</span>; <span class="tactic">simpl</span>. <span class="tactic">destruct</span> <span class="id">e</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:(<span class="id">destruct_to_singl</span> <span class="id">l</span>; <span class="id">destruct_to_singl</span> <span class="id">l0</span>; <span class="id">destruct_to_singl</span> <span class="id">l1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">e</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="id">destruct_to_singl</span> <span class="id">l</span>; <span class="id">destruct_to_singl</span> <span class="id">l0</span>; <span class="id">destruct_to_singl</span> <span class="id">l1</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;left.&nbsp;2:right;left.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;1,2:repeat&nbsp;eexists;&nbsp;eauto.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;1,2:destruct_to_singl&nbsp;l;&nbsp;destruct_to_singl&nbsp;l0;&nbsp;destruct_to_singl&nbsp;l1;&nbsp;simpl.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;2,4:(repeat&nbsp;right;&nbsp;destruct&nbsp;o;&nbsp;auto;&nbsp;destruct&nbsp;e1;&nbsp;auto;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;destruct&nbsp;a&nbsp;as&nbsp;(?&amp;?&amp;?);&nbsp;try&nbsp;destruct&nbsp;a1&nbsp;as&nbsp;(?&amp;?&amp;?);&nbsp;auto).&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;fby&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span> <span class="kwd">as</span> [<span class="id">ty</span> [<span class="id">ck</span> <span class="id">name</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.is_constant">is_constant</a></span> <span class="id">e</span>) <span class="id">eqn</span>:<span class="id">Hconst</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">left</span>. <span class="tactic">rewrite</span> <span class="id">Hconst</span>. <span class="tactic">repeat</span> <span class="tactic">eexists</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">right</span>. <span class="tactic">left</span>. <span class="tactic">rewrite</span> <span class="id">Hconst</span>. <span class="tactic">repeat</span> <span class="tactic">eexists</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;arrow&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span> <span class="kwd">as</span> [<span class="id">ty</span> [<span class="id">ck</span> <span class="id">name</span>]]. <span class="tactic">right</span>. <span class="tactic">right</span>. <span class="tactic">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">eexists</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Ltac</span> <span class="id">inv_fby_equation</span> <span class="id">Hfby</span> <span class="id">to_cut</span> <span class="id">eq</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Hspec</span> := <span class="tactic">fresh</span> "<span class="id">Hspec</span>" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Hconst</span> := <span class="tactic">fresh</span> "<span class="id">Hconst</span>" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Hr</span> := <span class="tactic">fresh</span> "<span class="id">Hr</span>" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">eq</span> <span class="kwd">as</span> [<span class="id">xs</span> <span class="id">es</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equation_spec">fby_equation_spec</a></span> <span class="id">to_cut</span> <span class="id">xs</span> <span class="id">es</span>) <span class="kwd">as</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[(?&amp;?&amp;?&amp;?&amp;?&amp;?&amp;<span class="id">Hconst</span>&amp;<span class="id">Hspec</span>)|[(?&amp;?&amp;?&amp;?&amp;?&amp;?&amp;<span class="id">Hconst</span>&amp;<span class="id">Hspec</span>)|[(?&amp;?&amp;?&amp;?&amp;?&amp;?&amp;<span class="id">Hspec</span>)|<span class="id">Hspec</span>]]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">rewrite</span> <span class="id">Hspec</span> <span class="kwd">in</span> <span class="id">Hfby</span>; <span class="tactic">clear</span> <span class="id">Hspec</span>; <span class="tactic">repeat</span> <span class="id">inv_bind</span>; <span class="tactic">auto</span>.<br/>
<br/>
<h3> Preservation of st_valid </h3>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="NORMFBY.st_valid_after">st_valid_after</a></span> {<span class="id">B</span>} <span class="id">st</span> <span class="id">aft</span> := @<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.st_valid_after">st_valid_after</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#B">B</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Ids.norm2">norm2</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#aft">aft</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="kwd">Unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.st_valid_after">st_valid_after</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.init_var_for_clock_st_valid">init_var_for_clock_st_valid</a></span> : <span class="kwd">forall</span> <span class="id">cl</span> <span class="id">res</span> <span class="id">st</span> <span class="id">st</span>' <span class="id">aft</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.init_var_for_clock">init_var_for_clock</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#cl">cl</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#res">res</a></span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.st_valid_after">st_valid_after</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#aft">aft</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.st_valid_after">st_valid_after</a></span> <span class="id">st</span>' <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#aft">aft</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2')">Proof.</div>
<div class="proofscript" id="proof2">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hinit</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.init_var_for_clock">init_var_for_clock</a></span> <span class="kwd">in</span> <span class="id">Hinit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#find">find</a></span> <span class="id">_</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">p</span>. <span class="id">inv</span> <span class="id">Hinit</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.fresh_ident">fresh_ident</a></span> <span class="id">_</span> <span class="id">_</span>) <span class="id">eqn</span>:<span class="id">Hfresh</span>. <span class="id">inv</span> <span class="id">Hinit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.fresh_ident_st_valid">fresh_ident_st_valid</a></span> <span class="kwd">in</span> <span class="id">Hfresh</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">init_var_for_clock_st_valid</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.fby_iteexp_st_valid">fby_iteexp_st_valid</a></span> : <span class="kwd">forall</span> <span class="id">e0</span> <span class="id">e</span> <span class="id">a</span> <span class="id">e</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>' <span class="id">aft</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_iteexp">fby_iteexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#a">a</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id">e</span>', <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.st_valid_after">st_valid_after</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#aft">aft</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.st_valid_after">st_valid_after</a></span> <span class="id">st</span>' <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#aft">aft</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3')">Proof with</div>
<div class="proofscript" id="proof3">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">e0</span> <span class="id">e</span> [<span class="id">ty</span> [<span class="id">ck</span> <span class="id">name</span>]] <span class="id">e</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>' <span class="id">aft</span> <span class="id">Hfby</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_iteexp">fby_iteexp</a></span> <span class="kwd">in</span> <span class="id">Hfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.is_constant">is_constant</a></span> <span class="id">e0</span>); <span class="tactic">repeat</span> <span class="id">inv_bind</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.fresh_ident_st_valid">fresh_ident_st_valid</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.init_var_for_clock_st_valid">init_var_for_clock_st_valid</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">fby_iteexp_st_valid</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.arrow_iteexp_st_valid">arrow_iteexp_st_valid</a></span> : <span class="kwd">forall</span> <span class="id">e0</span> <span class="id">e</span> <span class="id">a</span> <span class="id">e</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>' <span class="id">aft</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.arrow_iteexp">arrow_iteexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#a">a</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id">e</span>', <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.st_valid_after">st_valid_after</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#aft">aft</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.st_valid_after">st_valid_after</a></span> <span class="id">st</span>' <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#aft">aft</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4')">Proof with</div>
<div class="proofscript" id="proof4">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">e0</span> <span class="id">e</span> [<span class="id">ty</span> [<span class="id">ck</span> <span class="id">name</span>]] <span class="id">e</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>' <span class="id">aft</span> <span class="id">Hfby</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.arrow_iteexp">arrow_iteexp</a></span> <span class="kwd">in</span> <span class="id">Hfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">inv_bind</span>...<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">arrow_iteexp_st_valid</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.fby_equation_st_valid">fby_equation_st_valid</a></span> : <span class="kwd">forall</span> <span class="id">to_cut</span> <span class="id">eq</span> <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>' <span class="id">aft</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equation">fby_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#to_cut">to_cut</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.st_valid_after">st_valid_after</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#aft">aft</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.st_valid_after">st_valid_after</a></span> <span class="id">st</span>' <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#aft">aft</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5')">Proof.</div>
<div class="proofscript" id="proof5">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hfby</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv_fby_equation</span> <span class="id">Hfby</span> <span class="id">to_cut</span> <span class="id">eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">x2</span> <span class="kwd">as</span> (?&amp;?&amp;?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Common.CommonPS.html#PS.mem">PS.mem</a></span> <span class="id">_</span> <span class="id">_</span>); <span class="tactic">repeat</span> <span class="id">inv_bind</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.fresh_ident_st_valid">fresh_ident_st_valid</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_iteexp_st_valid">fby_iteexp_st_valid</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.arrow_iteexp_st_valid">arrow_iteexp_st_valid</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.fby_equations_st_valid">fby_equations_st_valid</a></span> : <span class="kwd">forall</span> <span class="id">to_cut</span> <span class="id">eqs</span> <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>' <span class="id">aft</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equations">fby_equations</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#to_cut">to_cut</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eqs">eqs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.st_valid_after">st_valid_after</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#aft">aft</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.st_valid_after">st_valid_after</a></span> <span class="id">st</span>' <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#aft">aft</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof6')">Proof.</div>
<div class="proofscript" id="proof6">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hfby</span> <span class="id">Hst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equations">fby_equations</a></span> <span class="kwd">in</span> <span class="id">Hfby</span>; <span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.map_bind_st_valid">map_bind_st_valid</a></span> <span class="kwd">in</span> <span class="id">Hst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equation_st_valid">fby_equation_st_valid</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<h3> Preservation of st_follows </h3>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.init_var_for_clock_st_follows">init_var_for_clock_st_follows</a></span> : <span class="kwd">forall</span> <span class="id">cl</span> <span class="id">res</span> <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.init_var_for_clock">init_var_for_clock</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#cl">cl</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#res">res</a></span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.st_follows">st_follows</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> <span class="id">st</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7')">Proof.</div>
<div class="proofscript" id="proof7">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">cl</span> <span class="id">res</span> <span class="id">st</span> <span class="id">st</span>' <span class="id">Hinit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.init_var_for_clock">init_var_for_clock</a></span> <span class="kwd">in</span> <span class="id">Hinit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#find">find</a></span> <span class="id">_</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">p</span>. <span class="id">inv</span> <span class="id">Hinit</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.fresh_ident">fresh_ident</a></span> <span class="id">_</span> <span class="id">_</span>) <span class="id">eqn</span>:<span class="id">Hfresh</span>. <span class="id">inv</span> <span class="id">Hinit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.fresh_ident_st_follows">fresh_ident_st_follows</a></span> <span class="kwd">in</span> <span class="id">Hfresh</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">init_var_for_clock_st_follows</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.fby_iteexp_st_follows">fby_iteexp_st_follows</a></span> : <span class="kwd">forall</span> <span class="id">e0</span> <span class="id">e</span> <span class="id">ann</span> <span class="id">res</span> <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_iteexp">fby_iteexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ann">ann</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#res">res</a></span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.st_follows">st_follows</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> <span class="id">st</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof8')">Proof.</div>
<div class="proofscript" id="proof8">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">e0</span> <span class="id">e</span> [<span class="id">ty</span> [<span class="id">ck</span> <span class="id">name</span>]] <span class="id">res</span> <span class="id">st</span> <span class="id">st</span>' <span class="id">Hfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_iteexp">fby_iteexp</a></span> <span class="kwd">in</span> <span class="id">Hfby</span>; <span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">etransitivity</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">fby_iteexp_st_follows</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.arrow_iteexp_st_follows">arrow_iteexp_st_follows</a></span> : <span class="kwd">forall</span> <span class="id">e0</span> <span class="id">e</span> <span class="id">ann</span> <span class="id">res</span> <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.arrow_iteexp">arrow_iteexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ann">ann</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#res">res</a></span>, <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.st_follows">st_follows</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> <span class="id">st</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9')">Proof.</div>
<div class="proofscript" id="proof9">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">e0</span> <span class="id">e</span> [<span class="id">ty</span> [<span class="id">ck</span> <span class="id">name</span>]] <span class="id">res</span> <span class="id">st</span> <span class="id">st</span>' <span class="id">Hfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.arrow_iteexp">arrow_iteexp</a></span> <span class="kwd">in</span> <span class="id">Hfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">inv_bind</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">arrow_iteexp_st_follows</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.fby_equation_st_follows">fby_equation_st_follows</a></span> : <span class="kwd">forall</span> <span class="id">to_cut</span> <span class="id">eq</span> <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equation">fby_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#to_cut">to_cut</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.st_follows">st_follows</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> <span class="id">st</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10')">Proof.</div>
<div class="proofscript" id="proof10">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv_fby_equation</span> <span class="id">Hfby</span> <span class="id">to_cut</span> <span class="id">eq</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">x2</span> <span class="kwd">as</span> (?&amp;?&amp;?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Velus.Common.CommonPS.html#PS.mem">PS.mem</a></span>; <span class="tactic">repeat</span> <span class="id">inv_bind</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">fby_equation_st_follows</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.fby_equations_st_follows">fby_equations_st_follows</a></span> : <span class="kwd">forall</span> <span class="id">to_cut</span> <span class="id">eqs</span> <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equations">fby_equations</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#to_cut">to_cut</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eqs">eqs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.st_follows">st_follows</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> <span class="id">st</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof11')">Proof.</div>
<div class="proofscript" id="proof11">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hfby</span>. <span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equations">fby_equations</a></span> <span class="kwd">in</span> *; <span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.map_bind_st_follows">map_bind_st_follows</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_forall</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<h3> The variables generated are a permutation of the ones contained in the state </h3>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.init_var_for_clock_vars_perm">init_var_for_clock_vars_perm</a></span> : <span class="kwd">forall</span> <span class="id">cl</span> <span class="id">id</span> <span class="id">eqs</span> <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.init_var_for_clock">init_var_for_clock</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#cl">cl</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = ((<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#id">id</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eqs">eqs</a></span>), <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation">Permutation</a></span> ((<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.vars_defined">vars_defined</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eqs">eqs</a></span>)++(<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span>)) (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.st_ids">st_ids</a></span> <span class="id">st</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof12')">Proof.</div>
<div class="proofscript" id="proof12">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">cl</span> <span class="id">id</span> <span class="id">eqs</span> <span class="id">st</span> <span class="id">st</span>' <span class="id">Hinit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.init_var_for_clock">init_var_for_clock</a></span> <span class="kwd">in</span> <span class="id">Hinit</span>. <span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#find">find</a></span> <span class="id">_</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">p</span>. <span class="id">inv</span> <span class="id">Hinit</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.fresh_ident">fresh_ident</a></span> <span class="id">_</span> <span class="id">_</span>) <span class="id">eqn</span>:<span class="id">Hfresh</span>. <span class="id">inv</span> <span class="id">Hinit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.Facts.fresh_ident_vars_perm">fresh_ident_vars_perm</a></span> <span class="kwd">in</span> <span class="id">Hfresh</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.fby_iteexp_vars_perm">fby_iteexp_vars_perm</a></span> : <span class="kwd">forall</span> <span class="id">e0</span> <span class="id">e</span> <span class="id">ann</span> <span class="id">e</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_iteexp">fby_iteexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ann">ann</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id">e</span>', <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation">Permutation</a></span> ((<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.vars_defined">vars_defined</a></span> <span class="id">eqs</span>')++(<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span>)) (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.st_ids">st_ids</a></span> <span class="id">st</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof13')">Proof.</div>
<div class="proofscript" id="proof13">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> ? ? [<span class="id">ty</span> [<span class="id">ck</span> <span class="id">name</span>]] ? ? ? ? <span class="id">Hfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_iteexp">fby_iteexp</a></span> <span class="kwd">in</span> <span class="id">Hfby</span>. <span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.init_var_for_clock_vars_perm">init_var_for_clock_vars_perm</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.Facts.fresh_ident_vars_perm">fresh_ident_vars_perm</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#perm_skip">perm_skip</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.arrow_iteexp_vars_perm">arrow_iteexp_vars_perm</a></span> : <span class="kwd">forall</span> <span class="id">e0</span> <span class="id">e</span> <span class="id">ann</span> <span class="id">e</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.arrow_iteexp">arrow_iteexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ann">ann</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id">e</span>', <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation">Permutation</a></span> ((<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.vars_defined">vars_defined</a></span> <span class="id">eqs</span>')++(<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span>)) (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.st_ids">st_ids</a></span> <span class="id">st</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof14')">Proof.</div>
<div class="proofscript" id="proof14">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> ? ? [<span class="id">ty</span> [<span class="id">ck</span> <span class="id">name</span>]] ? ? ? ? <span class="id">Hfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.arrow_iteexp">arrow_iteexp</a></span> <span class="kwd">in</span> <span class="id">Hfby</span>. <span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.init_var_for_clock_vars_perm">init_var_for_clock_vars_perm</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.fby_equation_vars_perm">fby_equation_vars_perm</a></span> : <span class="kwd">forall</span> <span class="id">to_cut</span> <span class="id">eq</span> <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equation">fby_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#to_cut">to_cut</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation">Permutation</a></span> ((<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.vars_defined">vars_defined</a></span> <span class="id">eqs</span>')++(<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span>)) ((<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.vars_defined">vars_defined</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eq">eq</a></span>])++(<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.st_ids">st_ids</a></span> <span class="id">st</span>')).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof15')">Proof.</div>
<div class="proofscript" id="proof15">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv_fby_equation</span> <span class="id">Hfby</span> <span class="id">to_cut</span> <span class="id">eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">x2</span> <span class="kwd">as</span> (?&amp;?&amp;?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Velus.Common.CommonPS.html#PS.mem">PS.mem</a></span>; <span class="tactic">repeat</span> <span class="id">inv_bind</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#perm_skip">perm_skip</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.Facts.fresh_ident_vars_perm">fresh_ident_vars_perm</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#perm_skip">perm_skip</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_iteexp_vars_perm">fby_iteexp_vars_perm</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#perm_skip">perm_skip</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.arrow_iteexp_vars_perm">arrow_iteexp_vars_perm</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.fby_equations_vars_perm">fby_equations_vars_perm</a></span> : <span class="kwd">forall</span> <span class="id">to_cut</span> <span class="id">eqs</span> <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equations">fby_equations</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#to_cut">to_cut</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eqs">eqs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation">Permutation</a></span> ((<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.vars_defined">vars_defined</a></span> <span class="id">eqs</span>')++(<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.st_ids">st_ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span>)) ((<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.vars_defined">vars_defined</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eqs">eqs</a></span>)++(<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.st_ids">st_ids</a></span> <span class="id">st</span>')).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof16')">Proof.</div>
<div class="proofscript" id="proof16">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">eqs</span>; <span class="tactic">intros</span> * <span class="id">Hnorm</span>; <span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equations">fby_equations</a></span> <span class="kwd">in</span> <span class="id">Hnorm</span>; <span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equations">fby_equations</a></span> <span class="id">to_cut</span> <span class="id">eqs</span> <span class="id">x1</span> = (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#concat">concat</a></span> <span class="id">x2</span>, <span class="id">st</span>')) <span class="kwd">as</span> <span class="id">Hnorm</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equations">fby_equations</a></span>. <span class="tactic">repeat</span> <span class="id">inv_bind</span>. <span class="tactic">repeat</span> <span class="tactic">eexists</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv_bind</span>; <span class="tactic">eauto</span>. } <span class="tactic">eapply</span> <span class="id">IHeqs</span> <span class="kwd">in</span> <span class="id">Hnorm</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equation_vars_perm">fby_equation_vars_perm</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">simpl_list</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonList.html#Permutation_swap">Permutation_swap</a></span>, <span class="id">H</span>, <span class="id"><a href="Velus.Common.CommonList.html#Permutation_swap">Permutation_swap</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_app_head">Permutation_app_head</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<h3> Preservation of annotations </h3>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.fby_iteexp_annot">fby_iteexp_annot</a></span> : <span class="kwd">forall</span> <span class="id">e0</span> <span class="id">e</span> <span class="id">ann</span> <span class="id">es</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_iteexp">fby_iteexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ann">ann</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id">es</span>', <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.annot">annot</a></span> <span class="id">es</span>' = [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ann">ann</a></span>].<br/>
<div class="toggleproof" onclick="toggleDisplay('proof17')">Proof.</div>
<div class="proofscript" id="proof17">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">e0</span> <span class="id">e</span> [<span class="id">ty</span> [<span class="id">cl</span> <span class="id">n</span>]] <span class="id">es</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>' <span class="id">Hfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_iteexp">fby_iteexp</a></span> <span class="kwd">in</span> <span class="id">Hfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">inv_bind</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.arrow_iteexp_annot">arrow_iteexp_annot</a></span> : <span class="kwd">forall</span> <span class="id">e0</span> <span class="id">e</span> <span class="id">ann</span> <span class="id">es</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.arrow_iteexp">arrow_iteexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ann">ann</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id">es</span>', <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.annot">annot</a></span> <span class="id">es</span>' = [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ann">ann</a></span>].<br/>
<div class="toggleproof" onclick="toggleDisplay('proof18')">Proof.</div>
<div class="proofscript" id="proof18">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">e0</span> <span class="id">e</span> [<span class="id">ty</span> [<span class="id">cl</span> <span class="id">n</span>]] <span class="id">es</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>' <span class="id">Hfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.arrow_iteexp">arrow_iteexp</a></span> <span class="kwd">in</span> <span class="id">Hfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">inv_bind</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<h3> Additional props </h3>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.init_var_for_clock_In">init_var_for_clock_In</a></span> : <span class="kwd">forall</span> <span class="id">cl</span> <span class="id">id</span> <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.init_var_for_clock">init_var_for_clock</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#cl">cl</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#id">id</a></span>, <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#id">id</a></span>, (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Op.bool_type">Op.bool_type</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#cl">cl</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>)) (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.st_anns">st_anns</a></span> <span class="id">st</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof19')">Proof.</div>
<div class="proofscript" id="proof19">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">cl</span> <span class="id">id</span> <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>' <span class="id">Hinit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.init_var_for_clock">init_var_for_clock</a></span> <span class="kwd">in</span> <span class="id">Hinit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#find">find</a></span> <span class="id">_</span> <span class="id">_</span>) <span class="id">eqn</span>:<span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">p</span>; <span class="id">inv</span> <span class="id">Hinit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#find_some">find_some</a></span> <span class="kwd">in</span> <span class="id">Hfind</span>. <span class="tactic">destruct</span> <span class="id">Hfind</span> <span class="kwd">as</span> [<span class="id">Hin</span> <span class="id">H</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span> <span class="kwd">as</span> [[? ?] ?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">Bool.andb_true_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [[<span class="id">Hb</span> <span class="id">Hcl</span>] <span class="id">Hty</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#OpAux.type_eqb_eq">OpAux.type_eqb_eq</a></span> <span class="kwd">in</span> <span class="id">Hty</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Clocks.html#clock_eqb_eq">Clocks.clock_eqb_eq</a></span> <span class="kwd">in</span> <span class="id">Hcl</span>. <span class="tactic">subst</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.fresh_ident">fresh_ident</a></span> <span class="id">_</span> <span class="id">_</span>) <span class="id">eqn</span>:<span class="id">Hfresh</span>. <span class="id">inv</span> <span class="id">Hinit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.Facts.fresh_ident_In">fresh_ident_In</a></span> <span class="kwd">in</span> <span class="id">Hfresh</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<h2> Specification of a normalized node </h2>
<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="NORMFBY.normalized_constant">normalized_constant</a></span> : <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.exp">exp</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="NORMFBY.constant_Econst">constant_Econst</a></span> : <span class="kwd">forall</span> <span class="id">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#normalized_constant">normalized_constant</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.Econst">Econst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#c">c</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="NORMFBY.constant_Ewhen">constant_Ewhen</a></span> : <span class="kwd">forall</span> <span class="id">e</span> <span class="id">x</span> <span class="id">b</span> <span class="id">ty</span> <span class="id">cl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#normalized_constant">normalized_constant</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#normalized_constant">normalized_constant</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.Ewhen">Ewhen</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span>] <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#x">x</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#b">b</a></span> ([<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ty">ty</a></span>], <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#cl">cl</a></span>)).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="NORMFBY.normalized_equation">normalized_equation</a></span> <span class="id">G</span> : <span class="id"><a href="Velus.Common.CommonPS.html#PS.t">PS.t</a></span> -&gt; <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.equation">equation</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="NORMFBY.normalized_eq_Eapp">normalized_eq_Eapp</a></span> : <span class="kwd">forall</span> <span class="id">out</span> <span class="id">xs</span> <span class="id">f</span> <span class="id">n</span> <span class="id">es</span> <span class="id">lann</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.normalized_lexp">normalized_lexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#es">es</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.find_node">find_node</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#f">f</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#n">n</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.noops_exp">noops_exp</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> '(<span class="id">_</span>, (<span class="id">_</span>, <span class="id">ck</span>)) =&gt; <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ck">ck</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#n">n</a></span>.(<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_in">n_in</a></span>)) <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#es">es</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#normalized_equation">normalized_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#out">out</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#xs">xs</a></span>, [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.Eapp">Eapp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#f">f</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#es">es</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#lann">lann</a></span>])<br/>
&nbsp;&nbsp;| <span class="id"><a name="NORMFBY.normalized_eq_Eapp_reset">normalized_eq_Eapp_reset</a></span> : <span class="kwd">forall</span> <span class="id">out</span> <span class="id">xs</span> <span class="id">f</span> <span class="id">n</span> <span class="id">es</span> <span class="id">x</span> <span class="id">ty</span> <span class="id">cl</span> <span class="id">lann</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.normalized_lexp">normalized_lexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#es">es</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.find_node">find_node</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#f">f</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#n">n</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.noops_exp">noops_exp</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> '(<span class="id">_</span>, (<span class="id">_</span>, <span class="id">ck</span>)) =&gt; <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ck">ck</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#n">n</a></span>.(<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_in">n_in</a></span>)) <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#es">es</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#normalized_equation">normalized_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#out">out</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#xs">xs</a></span>, [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.Eapp">Eapp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#f">f</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#es">es</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.Evar">Evar</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#x">x</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ty">ty</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#cl">cl</a></span>))) <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#lann">lann</a></span>])<br/>
&nbsp;&nbsp;| <span class="id"><a name="NORMFBY.normalized_eq_Efby">normalized_eq_Efby</a></span> : <span class="kwd">forall</span> <span class="id">out</span> <span class="id">x</span> <span class="id">e0</span> <span class="id">e</span> <span class="id">ann</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~<span class="id"><a href="Velus.Common.CommonPS.html#PS.In">PS.In</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#x">x</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#out">out</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normalized_constant">normalized_constant</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.normalized_lexp">normalized_lexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#normalized_equation">normalized_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#out">out</a></span> ([<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#x">x</a></span>], [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.Efby">Efby</a></span> [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span>] [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span>] [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ann">ann</a></span>]])<br/>
&nbsp;&nbsp;| <span class="id"><a name="NORMFBY.normalized_eq_cexp">normalized_eq_cexp</a></span> : <span class="kwd">forall</span> <span class="id">out</span> <span class="id">x</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.normalized_cexp">normalized_cexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#normalized_equation">normalized_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#out">out</a></span> ([<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#x">x</a></span>], [<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span>]).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="NORMFBY.normalized_node">normalized_node</a></span> <span class="id">G</span> (<span class="id">n</span> : <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.node">node</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normalized_equation">normalized_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#ps_from_list">ps_from_list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_out">n_out</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#n">n</a></span>)))) (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_eqs">n_eqs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#n">n</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="NORMFBY.normalized_global">normalized_global</a></span> (<span class="id">G</span> : <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.global">global</a></span>) := <span class="id"><a href="Velus.Common.CommonList.html#ForallTail">ForallTail</a></span> (<span class="kwd">fun</span> <span class="id">n</span> <span class="id">G</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normalized_node">normalized_node</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#n">n</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="kwd">Constructors</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#normalized_constant">normalized_constant</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#normalized_equation">normalized_equation</a></span>.<br/>
<br/>
<h3> normalized_node implies unnested_node </h3>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.constant_normalized_lexp">constant_normalized_lexp</a></span> : <span class="kwd">forall</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normalized_constant">normalized_constant</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.normalized_lexp">normalized_lexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof20')">Proof.</div>
<div class="proofscript" id="proof20">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">e</span> <span class="id">Hconst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hconst</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.normalized_eq_unnested_eq">normalized_eq_unnested_eq</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">to_cut</span> <span class="id">eq</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normalized_equation">normalized_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#to_cut">to_cut</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eq">eq</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.unnested_equation">unnested_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eq">eq</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof21')">Proof.</div>
<div class="proofscript" id="proof21">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hnormed</span>. <span class="id">inv</span> <span class="id">Hnormed</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.constant_normalized_lexp">constant_normalized_lexp</a></span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.normalized_node_unnested_node">normalized_node_unnested_node</a></span>: <span class="kwd">forall</span> <span class="id">G</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normalized_node">normalized_node</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#n">n</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.unnested_node">unnested_node</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#n">n</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof22')">Proof.</div>
<div class="proofscript" id="proof22">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hnormed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normalized_node">normalized_node</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.unnested_node">unnested_node</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normalized_eq_unnested_eq">normalized_eq_unnested_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.normalized_global_unnested_global">normalized_global_unnested_global</a></span> : <span class="kwd">forall</span> <span class="id">G</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normalized_global">normalized_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.unnested_global">unnested_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof23')">Proof.</div>
<div class="proofscript" id="proof23">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hnormed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hnormed</span>; <span class="tactic">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normalized_node_unnested_node">normalized_node_unnested_node</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<h3> Preservation of wl property </h3>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.add_whens_numstreams">add_whens_numstreams</a></span> : <span class="kwd">forall</span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.numstreams">numstreams</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> = 1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.numstreams">numstreams</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.add_whens">add_whens</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ty">ty</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ck">ck</a></span>) = 1.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof24')">Proof.</div>
<div class="proofscript" id="proof24">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">ck</span>; <span class="tactic">intros</span> *; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.add_whens_wl">add_whens_wl</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">ty</span> <span class="id">ck</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.numstreams">numstreams</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> = 1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.wl_exp">wl_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.wl_exp">wl_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.add_whens">add_whens</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ty">ty</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ck">ck</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof25')">Proof.</div>
<div class="proofscript" id="proof25">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">ck</span>; <span class="tactic">intros</span> * <span class="id">Hlen</span> <span class="id">Hwl</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.length_annot_numstreams">length_annot_numstreams</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.add_whens_numstreams">add_whens_numstreams</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="kwd">Constructors</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#wl_exp">wl_exp</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.init_var_for_clock_wl">init_var_for_clock_wl</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">ck</span> <span class="id">id</span> <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.init_var_for_clock">init_var_for_clock</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ck">ck</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#id">id</a></span>, <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.wl_equation">wl_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span>) <span class="id">eqs</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof26')">Proof.</div>
<div class="proofscript" id="proof26">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hinit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.init_var_for_clock">init_var_for_clock</a></span> <span class="kwd">in</span> <span class="id">Hinit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#find">find</a></span> <span class="id">_</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">p</span>; <span class="id">inv</span> <span class="id">Hinit</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.fresh_ident">fresh_ident</a></span> <span class="id">_</span> <span class="id">_</span>). <span class="id">inv</span> <span class="id">Hinit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">constructor</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.add_whens_wl">add_whens_wl</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.length_annot_numstreams">length_annot_numstreams</a></span>; <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.add_whens_numstreams">add_whens_numstreams</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.fby_iteexp_numstreams">fby_iteexp_numstreams</a></span> : <span class="kwd">forall</span> <span class="id">e0</span> <span class="id">e</span> <span class="id">a</span> <span class="id">e</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_iteexp">fby_iteexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#a">a</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id">e</span>', <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.numstreams">numstreams</a></span> <span class="id">e</span>' = 1.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof27')">Proof.</div>
<div class="proofscript" id="proof27">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hfby</span>. <span class="tactic">destruct</span> <span class="id">a</span> <span class="kwd">as</span> [<span class="id">ty</span> [<span class="id">ck</span> <span class="id">name</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_iteexp">fby_iteexp</a></span> <span class="kwd">in</span> <span class="id">Hfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">inv_bind</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.fby_iteexp_wl_exp">fby_iteexp_wl_exp</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">e0</span> <span class="id">e</span> <span class="id">a</span> <span class="id">e</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.wl_exp">wl_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.wl_exp">wl_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.numstreams">numstreams</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> = 1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.numstreams">numstreams</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> = 1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_iteexp">fby_iteexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#a">a</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id">e</span>', <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.wl_exp">wl_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id">e</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof28')">Proof.</div>
<div class="proofscript" id="proof28">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hwl1</span> <span class="id">Hwl2</span> <span class="id">Hn1</span> <span class="id">Hn2</span> <span class="id">Hfby</span>. <span class="tactic">destruct</span> <span class="id">a</span> <span class="kwd">as</span> [<span class="id">ty</span> [<span class="id">ck</span> <span class="id">name</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_iteexp">fby_iteexp</a></span> <span class="kwd">in</span> <span class="id">Hfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">constructor</span>; <span class="tactic">auto</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.length_annot_numstreams">length_annot_numstreams</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.fby_iteexp_wl_eq">fby_iteexp_wl_eq</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">e0</span> <span class="id">e</span> <span class="id">a</span> <span class="id">e</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.wl_exp">wl_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.wl_exp">wl_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.numstreams">numstreams</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> = 1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.numstreams">numstreams</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> = 1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_iteexp">fby_iteexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#a">a</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id">e</span>', <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.wl_equation">wl_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span>) <span class="id">eqs</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof29')">Proof.</div>
<div class="proofscript" id="proof29">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hwl1</span> <span class="id">Hwl2</span> <span class="id">Hn1</span> <span class="id">Hn2</span> <span class="id">Hfby</span>. <span class="tactic">destruct</span> <span class="id">a</span> <span class="kwd">as</span> [<span class="id">ty</span> [<span class="id">ck</span> <span class="id">name</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_iteexp">fby_iteexp</a></span> <span class="kwd">in</span> <span class="id">Hfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">inv_bind</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.add_whens_wl">add_whens_wl</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.length_annot_numstreams">length_annot_numstreams</a></span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.add_whens_numstreams">add_whens_numstreams</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.length_annot_numstreams">length_annot_numstreams</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.init_var_for_clock_wl">init_var_for_clock_wl</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.arrow_iteexp_numstreams">arrow_iteexp_numstreams</a></span> : <span class="kwd">forall</span> <span class="id">e0</span> <span class="id">e</span> <span class="id">a</span> <span class="id">e</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.arrow_iteexp">arrow_iteexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#a">a</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id">e</span>', <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.numstreams">numstreams</a></span> <span class="id">e</span>' = 1.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof30')">Proof.</div>
<div class="proofscript" id="proof30">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hfby</span>. <span class="tactic">destruct</span> <span class="id">a</span> <span class="kwd">as</span> [<span class="id">ty</span> [<span class="id">ck</span> <span class="id">name</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.arrow_iteexp">arrow_iteexp</a></span> <span class="kwd">in</span> <span class="id">Hfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">inv_bind</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.arrow_iteexp_wl_exp">arrow_iteexp_wl_exp</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">e0</span> <span class="id">e</span> <span class="id">a</span> <span class="id">e</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.wl_exp">wl_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.wl_exp">wl_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.numstreams">numstreams</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> = 1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.numstreams">numstreams</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> = 1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.arrow_iteexp">arrow_iteexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#a">a</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id">e</span>', <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.wl_exp">wl_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id">e</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof31')">Proof.</div>
<div class="proofscript" id="proof31">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hwl1</span> <span class="id">Hwl2</span> <span class="id">Hn1</span> <span class="id">Hn2</span> <span class="id">Hfby</span>. <span class="tactic">destruct</span> <span class="id">a</span> <span class="kwd">as</span> [<span class="id">ty</span> [<span class="id">ck</span> <span class="id">name</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.arrow_iteexp">arrow_iteexp</a></span> <span class="kwd">in</span> <span class="id">Hfby</span>; <span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">constructor</span>; <span class="tactic">auto</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.length_annot_numstreams">length_annot_numstreams</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.arrow_iteexp_wl_eq">arrow_iteexp_wl_eq</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">e0</span> <span class="id">e</span> <span class="id">a</span> <span class="id">e</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.wl_exp">wl_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.wl_exp">wl_exp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.numstreams">numstreams</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> = 1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.numstreams">numstreams</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> = 1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.arrow_iteexp">arrow_iteexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#a">a</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id">e</span>', <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.wl_equation">wl_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span>) <span class="id">eqs</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof32')">Proof.</div>
<div class="proofscript" id="proof32">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hwl1</span> <span class="id">Hwl2</span> <span class="id">Hn1</span> <span class="id">Hn2</span> <span class="id">Hfby</span>. <span class="tactic">destruct</span> <span class="id">a</span> <span class="kwd">as</span> [<span class="id">ty</span> [<span class="id">ck</span> <span class="id">name</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.arrow_iteexp">arrow_iteexp</a></span> <span class="kwd">in</span> <span class="id">Hfby</span>; <span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.init_var_for_clock_wl">init_var_for_clock_wl</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.fby_equation_wl">fby_equation_wl</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">to_cut</span> <span class="id">eq</span> <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.wl_equation">wl_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eq">eq</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equation">fby_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#to_cut">to_cut</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.wl_equation">wl_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span>) <span class="id">eqs</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof33')">Proof.</div>
<div class="proofscript" id="proof33">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hwl</span> <span class="id">Hfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv_fby_equation</span> <span class="id">Hfby</span> <span class="id">to_cut</span> <span class="id">eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">x2</span> <span class="kwd">as</span> (?&amp;?&amp;?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Velus.Common.CommonPS.html#PS.mem">PS.mem</a></span>; <span class="tactic">repeat</span> <span class="id">inv_bind</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hwl</span> <span class="kwd">as</span> [<span class="id">Hwl</span> <span class="id">_</span>]; <span class="id">inv</span> <span class="id">Hwl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">constructor</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">Hwl</span> <span class="kwd">as</span> [<span class="id">Hwl</span> <span class="id">_</span>]. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_singl">Forall_singl</a></span> <span class="kwd">in</span> <span class="id">Hwl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hwl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_singl">Forall_singl</a></span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_singl">Forall_singl</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.length_annot_numstreams">length_annot_numstreams</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_iteexp_wl_exp">fby_iteexp_wl_exp</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_iteexp_annot">fby_iteexp_annot</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_iteexp_wl_eq">fby_iteexp_wl_eq</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">Hwl</span> <span class="kwd">as</span> [<span class="id">Hwl</span> <span class="id">_</span>]. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_singl">Forall_singl</a></span> <span class="kwd">in</span> <span class="id">Hwl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hwl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_singl">Forall_singl</a></span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_singl">Forall_singl</a></span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.length_annot_numstreams">length_annot_numstreams</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.arrow_iteexp_wl_exp">arrow_iteexp_wl_exp</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.arrow_iteexp_annot">arrow_iteexp_annot</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.arrow_iteexp_wl_eq">arrow_iteexp_wl_eq</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<h2> After normalization, equations and expressions are normalized </h2>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.add_whens_is_constant">add_whens_is_constant</a></span> : <span class="kwd">forall</span> <span class="id">ty</span> <span class="id">cl</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normalized_constant">normalized_constant</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normalized_constant">normalized_constant</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.add_whens">add_whens</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ty">ty</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#cl">cl</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof34')">Proof.</div>
<div class="proofscript" id="proof34">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">cl</span>; <span class="tactic">intros</span> <span class="id">e</span> <span class="id">Hcons</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">constructor</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.add_whens_normalized_lexp">add_whens_normalized_lexp</a></span> : <span class="kwd">forall</span> <span class="id">ty</span> <span class="id">cl</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.normalized_lexp">normalized_lexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.normalized_lexp">normalized_lexp</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.add_whens">add_whens</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ty">ty</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#cl">cl</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof35')">Proof.</div>
<div class="proofscript" id="proof35">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">cl</span>; <span class="tactic">intros</span> <span class="id">e</span> <span class="id">Hadd</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hadd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">constructor</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.is_constant_normalized_constant">is_constant_normalized_constant</a></span> : <span class="kwd">forall</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.is_constant">is_constant</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normalized_constant">normalized_constant</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof36')">Proof with</div>
<div class="proofscript" id="proof36">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">e</span>. <span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">Hconst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">induction</span> <span class="id">e</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.exp_ind2">exp_ind2</a></span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hconst</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">repeat</span> (<span class="tactic">destruct</span> <span class="id">es</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H</span>; <span class="id">inv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">destruct</span> <span class="id">l</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">constructor</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">induction</span> <span class="id">Hconst</span>...<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.init_var_for_clock_unnested_eq">init_var_for_clock_unnested_eq</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">ck</span> <span class="id">id</span> <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.init_var_for_clock">init_var_for_clock</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#ck">ck</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#id">id</a></span>, <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.unnested_equation">unnested_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span>) <span class="id">eqs</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof37')">Proof.</div>
<div class="proofscript" id="proof37">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hinit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.init_var_for_clock">init_var_for_clock</a></span> <span class="kwd">in</span> <span class="id">Hinit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#find">find</a></span> <span class="id">_</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">p</span>. <span class="id">inv</span> <span class="id">Hinit</span>. <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.fresh_ident">fresh_ident</a></span> <span class="id">_</span> <span class="id">_</span>) <span class="id">eqn</span>:<span class="id">Hfresh</span>. <span class="id">inv</span> <span class="id">Hinit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.add_whens_normalized_lexp">add_whens_normalized_lexp</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.init_var_for_clock_normalized_eq">init_var_for_clock_normalized_eq</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">cl</span> <span class="id">id</span> <span class="id">eqs</span>' <span class="id">out</span> <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.st_valid_after">st_valid_after</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#out">out</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.init_var_for_clock">init_var_for_clock</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#cl">cl</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#id">id</a></span>, <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normalized_equation">normalized_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#out">out</a></span>) <span class="id">eqs</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof38')">Proof.</div>
<div class="proofscript" id="proof38">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hvalid</span> <span class="id">Hinit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.init_var_for_clock">init_var_for_clock</a></span> <span class="kwd">in</span> <span class="id">Hinit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#find">find</a></span> <span class="id">_</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">p</span>. <span class="id">inv</span> <span class="id">Hinit</span>. <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.fresh_ident">fresh_ident</a></span> <span class="id">_</span> <span class="id">_</span>) <span class="id">eqn</span>:<span class="id">Hfresh</span>. <span class="id">inv</span> <span class="id">Hinit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">fresh_ident_nIn</span>' <span class="kwd">in</span> <span class="id">Hfresh</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.add_whens_is_constant">add_whens_is_constant</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.add_whens_normalized_lexp">add_whens_normalized_lexp</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.fby_iteexp_unnested_eq">fby_iteexp_unnested_eq</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">e0</span> <span class="id">e</span> <span class="id">a</span> <span class="id">e</span>' <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.normalized_lexp">normalized_lexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.normalized_lexp">normalized_lexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_iteexp">fby_iteexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#a">a</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id">e</span>', <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.unnested_equation">unnested_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span>) <span class="id">eqs</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof39')">Proof.</div>
<div class="proofscript" id="proof39">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hnormed1</span> <span class="id">Hnormed2</span> <span class="id">Hfby</span>. <span class="tactic">destruct</span> <span class="id">a</span> <span class="kwd">as</span> [<span class="id">ty</span> [<span class="id">ck</span> <span class="id">name</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_iteexp">fby_iteexp</a></span> <span class="kwd">in</span> <span class="id">Hfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">inv_bind</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.add_whens_normalized_lexp">add_whens_normalized_lexp</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.init_var_for_clock_unnested_eq">init_var_for_clock_unnested_eq</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.fby_iteexp_normalized_eq">fby_iteexp_normalized_eq</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">e0</span> <span class="id">e</span> <span class="id">a</span> <span class="id">e</span>' <span class="id">eqs</span>' <span class="id">out</span> <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.st_valid_after">st_valid_after</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#out">out</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.normalized_lexp">normalized_lexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_iteexp">fby_iteexp</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e0">e0</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#a">a</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id">e</span>', <span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normalized_equation">normalized_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#out">out</a></span>) <span class="id">eqs</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof40')">Proof.</div>
<div class="proofscript" id="proof40">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">G</span> <span class="id">e0</span> <span class="id">e</span> [<span class="id">ty</span> [<span class="id">ck</span> <span class="id">name</span>]] <span class="id">e</span>' <span class="id">eqs</span>' <span class="id">out</span> <span class="id">st</span> <span class="id">st</span>' <span class="id">Hvalid</span> <span class="id">He</span> <span class="id">Hfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_iteexp">fby_iteexp</a></span> <span class="kwd">in</span> <span class="id">Hfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">inv_bind</span>; <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.st_valid_after">st_valid_after</a></span> <span class="id">x1</span> <span class="id">out</span>) <span class="kwd">as</span> <span class="id">Hvalid</span>' <span class="tactic">by</span> <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">fresh_ident_nIn</span>' <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.add_whens_is_constant">add_whens_is_constant</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.init_var_for_clock_normalized_eq">init_var_for_clock_normalized_eq</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.fby_equation_unnested_eq">fby_equation_unnested_eq</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">to_cut</span> <span class="id">eq</span> <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.unnested_equation">unnested_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eq">eq</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equation">fby_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#to_cut">to_cut</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.unnested_equation">unnested_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span>) <span class="id">eqs</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof41')">Proof.</div>
<div class="proofscript" id="proof41">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hunt</span> <span class="id">Hfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv_fby_equation</span> <span class="id">Hfby</span> <span class="id">to_cut</span> <span class="id">eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">x2</span> <span class="kwd">as</span> (?&amp;?&amp;?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Velus.Common.CommonPS.html#PS.mem">PS.mem</a></span>; <span class="tactic">repeat</span> <span class="id">inv_bind</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">constructor</span>; <span class="tactic">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hunt</span>; <span class="tactic">constructor</span>; <span class="tactic">auto</span>. 1,2:<span class="id">inv</span> <span class="id">H1</span>; <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hunt</span>. 2:<span class="id">inv</span> <span class="id">H1</span>; <span class="id">inv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H</span>':=<span class="id">H</span>). <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_iteexp_unnested_eq">fby_iteexp_unnested_eq</a></span> <span class="kwd">in</span> <span class="id">H</span>'; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">constructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x2</span> <span class="kwd">as</span> (?&amp;?&amp;?). <span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">constructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">x2</span> <span class="kwd">as</span> (?&amp;?&amp;?). <span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3:<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.init_var_for_clock_unnested_eq">init_var_for_clock_unnested_eq</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1-2:(<span class="tactic">clear</span> - <span class="id">Hunt</span>; <span class="id">inv</span> <span class="id">Hunt</span>; <span class="tactic">auto</span>; <span class="id">inv</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.fby_equation_normalized_eq">fby_equation_normalized_eq</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">out</span> <span class="id">to_cut</span> <span class="id">eq</span> <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.st_valid_after">st_valid_after</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#out">out</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.unnested_equation">unnested_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eq">eq</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonPS.html#PS.Subset">PS.Subset</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#out">out</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#to_cut">to_cut</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equation">fby_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#to_cut">to_cut</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eq">eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normalized_equation">normalized_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#out">out</a></span>) <span class="id">eqs</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof42')">Proof.</div>
<div class="proofscript" id="proof42">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hvalid</span> <span class="id">Hunt</span> <span class="id">Hsub</span> <span class="id">Hfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hunt</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">repeat</span> <span class="id">inv_bind</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="id">destruct_to_singl</span> <span class="id">xs</span>; <span class="tactic">repeat</span> <span class="id">inv_bind</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;fby&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">ann0</span> <span class="kwd">as</span> (?&amp;?&amp;?); <span class="tactic">destruct</span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.is_constant">is_constant</a></span> <span class="id">e0</span>) <span class="id">eqn</span>:<span class="id">Hconst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.is_constant_normalized_constant">is_constant_normalized_constant</a></span> <span class="kwd">in</span> <span class="id">Hconst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="Velus.Common.CommonPS.html#PS.mem">PS.mem</a></span> <span class="id">eqn</span>:<span class="id">Hmem</span>; [|<span class="tactic">apply</span> <span class="id"><a href="Velus.Common.CommonPS.html#PSE.mem_4">PSE.mem_4</a></span> <span class="kwd">in</span> <span class="id">Hmem</span>]|]; <span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1-3:<span class="tactic">repeat</span> <span class="tactic">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3:<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.add_whens_is_constant">add_whens_is_constant</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3:<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.init_var_for_clock_normalized_eq">init_var_for_clock_normalized_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">fresh_ident_nIn</span>'; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">fresh_ident_nIn</span>' <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.init_var_for_clock_st_valid">init_var_for_clock_st_valid</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;arrow&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ann0</span> <span class="kwd">as</span> (?&amp;?&amp;?); <span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.init_var_for_clock_normalized_eq">init_var_for_clock_normalized_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">H</span>; <span class="tactic">repeat</span> <span class="id">inv_bind</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">repeat</span> <span class="id">inv_bind</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.fby_equations_normalized_eq">fby_equations_normalized_eq</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">out</span> <span class="id">to_cut</span> <span class="id">eqs</span> <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.st_valid_after">st_valid_after</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#out">out</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.unnested_equation">unnested_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eqs">eqs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonPS.html#PS.Subset">PS.Subset</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#out">out</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#to_cut">to_cut</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equations">fby_equations</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#to_cut">to_cut</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eqs">eqs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normalized_equation">normalized_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#out">out</a></span>) <span class="id">eqs</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof43')">Proof.</div>
<div class="proofscript" id="proof43">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">eqs</span>; <span class="tactic">intros</span> * <span class="id">Hvalid</span> <span class="id">Hunt</span> <span class="id">Hsub</span> <span class="id">Hfby</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equations">fby_equations</a></span> <span class="kwd">in</span> <span class="id">Hfby</span>; <span class="tactic">repeat</span> <span class="id">inv_bind</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hunt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_app">Forall_app</a></span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equation_normalized_eq">fby_equation_normalized_eq</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">IHeqs</span> <span class="kwd">with</span> (<span class="id">st</span>:=<span class="id">x1</span>) (<span class="id">st</span>':=<span class="id">st</span>'); <span class="tactic">eauto</span>. 1:<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equation_st_valid">fby_equation_st_valid</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equations">fby_equations</a></span>; <span class="tactic">repeat</span> <span class="id">inv_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">eexists</span>; <span class="tactic">eauto</span>. <span class="id">inv_bind</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<h2> No anonymous names in a normalized node </h2>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.is_constant_no_fresh">is_constant_no_fresh</a></span> : <span class="kwd">forall</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normalized_constant">normalized_constant</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.fresh_in">fresh_in</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#e">e</a></span> = [].<br/>
<div class="toggleproof" onclick="toggleDisplay('proof44')">Proof with</div>
<div class="proofscript" id="proof44">
 <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">e</span> <span class="id">Hconst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hconst</span>; <span class="tactic">simpl</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHHconst</span>...<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="NORMFBY.fby_equations_no_anon">fby_equations_no_anon</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">out</span> <span class="id">to_cut</span> <span class="id">eqs</span> <span class="id">eqs</span>' <span class="id">st</span> <span class="id">st</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.st_valid_after">st_valid_after</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#out">out</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.unnested_equation">unnested_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eqs">eqs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Common.CommonPS.html#PS.Subset">PS.Subset</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#out">out</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#to_cut">to_cut</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equations">fby_equations</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#to_cut">to_cut</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eqs">eqs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#st">st</a></span> = (<span class="id">eqs</span>', <span class="id">st</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.anon_in_eqs">anon_in_eqs</a></span> <span class="id">eqs</span>' = [].<br/>
<div class="toggleproof" onclick="toggleDisplay('proof45')">Proof.</div>
<div class="proofscript" id="proof45">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hweak</span> <span class="id">Hunt</span> <span class="id">Hsub</span> <span class="id">Hfby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equations_normalized_eq">fby_equations_normalized_eq</a></span> <span class="kwd">in</span> <span class="id">Hfby</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.unnested_equations_no_anon">unnested_equations_no_anon</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">solve_forall</span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normalized_eq_unnested_eq">normalized_eq_unnested_eq</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<h2> Normalization of a full node </h2>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="NORMFBY.norm1_prefs">norm1_prefs</a></span> := <span class="id"><a href="Velus.Common.CommonPS.html#PS.add">PS.add</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Ids.norm1">norm1</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.elab_prefs">elab_prefs</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="NORMFBY.norm2_not_in_norm1_prefs">norm2_not_in_norm1_prefs</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~<span class="id"><a href="Velus.Common.CommonPS.html#PS.In">PS.In</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Ids.norm2">norm2</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.norm1_prefs">norm1_prefs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof46')">Proof.</div>
<div class="proofscript" id="proof46">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.norm1_prefs">norm1_prefs</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.elab_prefs">elab_prefs</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonPS.html#PSF.add_iff">PSF.add_iff</a></span>, <span class="id"><a href="Velus.Common.CommonPS.html#PSF.singleton_iff">PSF.singleton_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">pose</span> <span class="id">proof</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Ids.gensym_prefs_NoDup">gensym_prefs_NoDup</a></span> <span class="kwd">as</span> <span class="id">Hnd</span>. <span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Ids.gensym_prefs">gensym_prefs</a></span> <span class="kwd">in</span> <span class="id">Hnd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup_cons_iff">NoDup_cons_iff</a></span> <span class="kwd">in</span> <span class="id">Hnd</span>. <span class="tactic">destruct</span> <span class="id">Hnd</span> <span class="kwd">as</span> (<span class="id">Hnin1</span>&amp;<span class="id">Hnin2</span>&amp;<span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">contra</span> <span class="kwd">as</span> [<span class="id">contra</span>|<span class="id">contra</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;1,2:<span class="tactic">rewrite</span> <span class="id">contra</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Hnin2</span>; <span class="tactic">left</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Hnin1</span>; <span class="tactic">right</span>; <span class="tactic">left</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="NORMFBY.normfby_node">normfby_node</a></span> <span class="id">G</span> (<span class="id">to_cut</span> : <span class="id"><a href="Velus.Common.CommonPS.html#PS.t">PS.t</a></span>) (<span class="id">n</span> : <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.node">node</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hunt</span> : <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.unnested_node">unnested_node</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#n">n</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hpref</span> : <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_prefixes">n_prefixes</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#n">n</a></span> = <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.norm1_prefs">norm1_prefs</a></span>) : <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.node">node</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">eqs</span> := <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equations">fby_equations</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#PS.union">PS.union</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#to_cut">to_cut</a></span> (<span class="id"><a href="Velus.Common.CommonPS.html#ps_from_list">ps_from_list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_out">n_out</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#n">n</a></span>)))) (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_eqs">n_eqs</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#n">n</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.init_st">init_st</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">nvars</span> := <span class="id"><a href="Velus.Common.Common.html#idty">idty</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.st_anns">st_anns</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eqs">eqs</a></span>)) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.mk_node">n_name</a></span> := <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_name">n_name</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#n">n</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">n_hasstate</span> := <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_hasstate">n_hasstate</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#n">n</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">n_in</span> := <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_in">n_in</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#n">n</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">n_out</span> := <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_out">n_out</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#n">n</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">n_vars</span> := (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_vars">n_vars</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#n">n</a></span>)++<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#nvars">nvars</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">n_prefixes</span> := <span class="id"><a href="Velus.Common.CommonPS.html#PS.add">PS.add</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Ids.norm2">norm2</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_prefixes">n_prefixes</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#n">n</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">n_eqs</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eqs">eqs</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">n_ingt0</span> := <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_ingt0">n_ingt0</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#n">n</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">n_outgt0</span> := <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_outgt0">n_outgt0</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#n">n</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof47')">Next Obligation.</div>
<div class="proofscript" id="proof47">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equations">fby_equations</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) <span class="kwd">as</span> <span class="id">eqs</span>. <span class="tactic">destruct</span> <span class="id">eqs</span> <span class="kwd">as</span> [<span class="id">eqs</span> <span class="id">st</span>']. <span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">Heqeqs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_defd">n_defd</a></span> <span class="id">n</span>) <span class="kwd">as</span> <span class="id">Hperm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equations_vars_perm">fby_equations_vars_perm</a></span> <span class="kwd">in</span> <span class="id">Heqeqs</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_app_comm">Permutation_app_comm</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>, (<span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_app_comm">Permutation_app_comm</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)), &lt;- <span class="id">Hperm</span>, <span class="id"><a href="Velus.Common.Common.html#map_fst_idty">map_fst_idty</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Heqeqs</span>. <span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.st_ids">st_ids</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.init_st_anns">init_st_anns</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof48')">Next Obligation.</div>
<div class="proofscript" id="proof48">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equations">fby_equations</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) <span class="kwd">as</span> (<span class="id">eqs</span>, <span class="id">st</span>') <span class="id">eqn</span>:<span class="id">Heqeqs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">pose</span> <span class="id">proof</span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.node_NoDup">node_NoDup</a></span> <span class="id">n</span>) <span class="kwd">as</span> <span class="id">Hndup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">pose</span> <span class="id">proof</span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_good">n_good</a></span> <span class="id">n</span>) <span class="kwd">as</span> (<span class="id">Good</span>&amp;<span class="id">_</span>). <span class="tactic">rewrite</span> <span class="id">Hpref</span> <span class="kwd">in</span> <span class="id">Good</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">erewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equations_no_anon">fby_equations_no_anon</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>. 2,3,5:<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;3:<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonPS.html#ps_from_list_ps_of_list">ps_from_list_ps_of_list</a></span>; <span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonPS.html#PSP.union_subset_2">PSP.union_subset_2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equations_st_valid">fby_equations_st_valid</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.st_valid_NoDup">st_valid_NoDup</a></span> <span class="kwd">in</span> <span class="id">Heqeqs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.init_st_valid">init_st_valid</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.norm2_not_in_norm1_prefs">norm2_not_in_norm1_prefs</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonPS.html#PS_For_all_Forall">PS_For_all_Forall</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_incl">Forall_incl</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> ? <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonPS.html#ps_of_list_ps_to_list">ps_of_list_ps_to_list</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#incl_map">incl_map</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">incl_appr</span>', <span class="id">incl_appr</span>', <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_appl">incl_appl</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#incl_refl">incl_refl</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonPS.html#ps_of_list_ps_to_list_Perm">ps_of_list_ps_to_list_Perm</a></span> <span class="kwd">in</span> <span class="id">Heqeqs</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#fst_NoDupMembers">fst_NoDupMembers</a></span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.st_ids">st_ids</a></span> <span class="kwd">in</span> <span class="id">Heqeqs</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.Common.html#map_fst_idty">map_fst_idty</a></span>, (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id">_</span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_vars">n_vars</a></span> <span class="id">_</span>))), (<span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_app_comm">Permutation_app_comm</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id">_</span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_vars">n_vars</a></span> <span class="id">_</span>))),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>, (<span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_app_comm">Permutation_app_comm</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id">_</span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_in">n_in</a></span> <span class="id">_</span>))), &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.init_st_valid">init_st_valid</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.norm2_not_in_norm1_prefs">norm2_not_in_norm1_prefs</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonPS.html#PS_For_all_Forall">PS_For_all_Forall</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_incl">Forall_incl</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> ? <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonPS.html#ps_of_list_ps_to_list">ps_of_list_ps_to_list</a></span> <span class="kwd">in</span> <span class="id">Hin</span>. <span class="tactic">repeat</span> <span class="id">simpl_In</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> (<span class="id">i</span>, (<span class="id">t</span>, <span class="id">c</span>)); <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span> <span class="kwd">in</span> *; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof49')">Next Obligation.</div>
<div class="proofscript" id="proof49">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">specialize</span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_good">n_good</a></span> <span class="id">n</span>) <span class="kwd">as</span> (<span class="id">Hgood</span>&amp;<span class="id">Hname</span>). <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall_app">Forall_app</a></span> <span class="kwd">in</span> <span class="id">Hgood</span>. <span class="tactic">destruct</span> <span class="id">Hgood</span> <span class="kwd">as</span> (?&amp;?&amp;?&amp;?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equations">fby_equations</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) <span class="kwd">as</span> (<span class="id">eqs</span>, <span class="id">st</span>') <span class="id">eqn</span>:<span class="id">Heqeqs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">pose</span> <span class="id">proof</span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.node_NoDup">node_NoDup</a></span> <span class="id">n</span>) <span class="kwd">as</span> <span class="id">Hndup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">pose</span> <span class="id">proof</span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_good">n_good</a></span> <span class="id">n</span>) <span class="kwd">as</span> (<span class="id">Good</span>&amp;<span class="id">_</span>). <span class="tactic">rewrite</span> <span class="id">Hpref</span> <span class="kwd">in</span> <span class="id">Good</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.st_valid_after">st_valid_after</a></span> <span class="id">st</span>' (<span class="id"><a href="Velus.Common.CommonPS.html#PSP.of_list">PSP.of_list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_in">n_in</a></span> <span class="id">n</span> ++ <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_vars">n_vars</a></span> <span class="id">n</span> ++ <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_out">n_out</a></span> <span class="id">n</span>)))) <span class="kwd">as</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equations_st_valid">fby_equations_st_valid</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.init_st_valid">init_st_valid</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.norm2_not_in_norm1_prefs">norm2_not_in_norm1_prefs</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonPS.html#PS_For_all_Forall">PS_For_all_Forall</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_incl">Forall_incl</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> ? <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonPS.html#ps_of_list_ps_to_list">ps_of_list_ps_to_list</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#incl_map">incl_map</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">incl_appr</span>', <span class="id">incl_appr</span>', <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_appl">incl_appl</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#incl_refl">incl_refl</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equations_no_anon">fby_equations_no_anon</a></span>. 3,5:<span class="tactic">eauto</span>. 3:<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonPS.html#ps_from_list_ps_of_list">ps_from_list_ps_of_list</a></span>; <span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonPS.html#PSP.union_subset_2">PSP.union_subset_2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.init_st_valid">init_st_valid</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.norm2_not_in_norm1_prefs">norm2_not_in_norm1_prefs</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonPS.html#PS_For_all_Forall">PS_For_all_Forall</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_incl">Forall_incl</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> ? <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonPS.html#ps_of_list_ps_to_list">ps_of_list_ps_to_list</a></span> <span class="kwd">in</span> <span class="id">Hin</span>. <span class="tactic">repeat</span> <span class="id">simpl_In</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> (<span class="id">i</span>, (<span class="id">t</span>, <span class="id">c</span>)); <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span> <span class="kwd">in</span> *; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>, <span class="id"><a href="Velus.Common.CommonList.html#Forall_app">Forall_app</a></span> <span class="kwd">in</span> *. <span class="tactic">destruct</span> <span class="id">Good</span> <span class="kwd">as</span> (?&amp;?&amp;?&amp;<span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.AtomOrGensym_add">AtomOrGensym_add</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.st_valid_prefixed">st_valid_prefixed</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hpref</span>, <span class="id"><a href="Velus.Common.Common.html#map_fst_idty">map_fst_idty</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="tactic">eauto</span>]. <span class="tactic">intros</span> ? (?&amp;?); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">right</span>. <span class="tactic">exists</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Ids.norm2">norm2</a></span>. <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="Velus.Common.CommonPS.html#PSF.add_1">PSF.add_1</a></span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="NORMFBY.normfby_global">normfby_global</a></span> (<span class="id">G</span> : <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.global">global</a></span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.unnested_global">unnested_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">n</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_prefixes">n_prefixes</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#n">n</a></span> = <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.norm1_prefs">norm1_prefs</a></span>) <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.global">global</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof50')">Proof.</div>
<div class="proofscript" id="proof50">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">G</span> <span class="kwd">as</span> [|<span class="id">hd</span> <span class="id">tl</span>]; <span class="tactic">intros</span> <span class="id">Hunt</span> <span class="id">Hprefs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">exact</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">refine</span> ((<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normfby_node">normfby_node</a></span> <span class="id">tl</span> <span class="id"><a href="Velus.Common.CommonPS.html#PS.empty">PS.empty</a></span> <span class="id">hd</span> <span class="id">_</span> <span class="id">_</span>)::(<span class="id">normfby_global</span> <span class="id">tl</span> <span class="id">_</span> <span class="id">_</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">Hunt</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">Hprefs</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">Hunt</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">Hprefs</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Defined.</div>
<br/>
<h3> normfby_global produces an equivalent global </h3>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.normfby_global_eq">normfby_global_eq</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">Hunt</span> <span class="id">Hprefs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.global_iface_eq">global_iface_eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normfby_global">normfby_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Hunt">Hunt</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Hprefs">Hprefs</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof51')">Proof.</div>
<div class="proofscript" id="proof51">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">G</span>; <span class="tactic">intros</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.global_iface_eq_cons">global_iface_eq_cons</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.normfby_global_names">normfby_global_names</a></span> : <span class="kwd">forall</span> <span class="id">a</span> <span class="id">G</span> <span class="id">Hunt</span> <span class="id">Hprefs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">n</span> =&gt; (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_name">n_name</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#a">a</a></span> &lt;&gt; <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_name">n_name</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#n">n</a></span>)%<span class="id">type</span>) <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">n</span> =&gt; (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_name">n_name</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#a">a</a></span> &lt;&gt; <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_name">n_name</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#n">n</a></span>)%<span class="id">type</span>) (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normfby_global">normfby_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Hunt">Hunt</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Hprefs">Hprefs</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof52')">Proof.</div>
<div class="proofscript" id="proof52">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">G</span>; <span class="tactic">intros</span> * <span class="id">Hnames</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hnames</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">constructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<h3> After normalization, a global is normalized </h3>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="NORMFBY.iface_eq_normalized_equation">iface_eq_normalized_equation</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">G</span>' <span class="id">to_cut</span> <span class="id">eq</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.global_iface_eq">global_iface_eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id">G</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normalized_equation">normalized_equation</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#to_cut">to_cut</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eq">eq</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normalized_equation">normalized_equation</a></span> <span class="id">G</span>' <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#to_cut">to_cut</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#eq">eq</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof53')">Proof.</div>
<div class="proofscript" id="proof53">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Heq</span> <span class="id">Hunt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hunt</span>; <span class="tactic">try</span> <span class="tactic">constructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">specialize</span> (<span class="id">Heq</span> <span class="id">f</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">Heq</span>. <span class="id">inv</span> <span class="id">Heq</span>. <span class="tactic">destruct</span> <span class="id">H4</span> <span class="kwd">as</span> (<span class="id">_</span>&amp;<span class="id">_</span>&amp;?&amp;<span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">specialize</span> (<span class="id">Heq</span> <span class="id">f</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">Heq</span>. <span class="id">inv</span> <span class="id">Heq</span>. <span class="tactic">destruct</span> <span class="id">H4</span> <span class="kwd">as</span> (<span class="id">_</span>&amp;<span class="id">_</span>&amp;?&amp;<span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Corollary</span> <span class="id"><a name="NORMFBY.iface_eq_normalized_node">iface_eq_normalized_node</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">G</span>' <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.global_iface_eq">global_iface_eq</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id">G</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normalized_node">normalized_node</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#n">n</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normalized_node">normalized_node</a></span> <span class="id">G</span>' <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#n">n</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof54')">Proof.</div>
<div class="proofscript" id="proof54">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> * <span class="id">Hglob</span> <span class="id">Hunt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normalized_node">normalized_node</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="tactic">eauto</span>]. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.iface_eq_normalized_equation">iface_eq_normalized_equation</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.normfby_node_normalized_node">normfby_node_normalized_node</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">n</span> <span class="id">to_cut</span> <span class="id">Hunt</span> <span class="id">Hpref</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normalized_node">normalized_node</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normfby_node">normfby_node</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#to_cut">to_cut</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#n">n</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Hunt">Hunt</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Hpref">Hpref</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof55')">Proof.</div>
<div class="proofscript" id="proof55">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normfby_node">normfby_node</a></span>, <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normalized_node">normalized_node</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">pose</span> <span class="id">proof</span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_good">n_good</a></span> <span class="id">n</span>) <span class="kwd">as</span> (<span class="id">Good</span>&amp;<span class="id">_</span>). <span class="tactic">rewrite</span> <span class="id">Hpref</span> <span class="kwd">in</span> <span class="id">Good</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equations">fby_equations</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) <span class="kwd">as</span> <span class="id">eqs</span>. <span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">Heqeqs</span>. <span class="tactic">destruct</span> <span class="id">eqs</span> <span class="kwd">as</span> [<span class="id">eqs</span> <span class="id">st</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.fby_equations_normalized_eq">fby_equations_normalized_eq</a></span> <span class="kwd">in</span> <span class="id">Heqeqs</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonPS.html#ps_from_list_ps_of_list">ps_from_list_ps_of_list</a></span>; <span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonPS.html#PSP.union_subset_2">PSP.union_subset_2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt.Fresh.init_st_valid">init_st_valid</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.norm2_not_in_norm1_prefs">norm2_not_in_norm1_prefs</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonPS.html#PS_For_all_Forall">PS_For_all_Forall</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Common.CommonList.html#Forall_incl">Forall_incl</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> ? <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Velus.Common.CommonPS.html#ps_from_list_ps_of_list">ps_from_list_ps_of_list</a></span>, <span class="id"><a href="Velus.Common.CommonPS.html#ps_of_list_ps_to_list">ps_of_list_ps_to_list</a></span> <span class="kwd">in</span> <span class="id">Hin</span>. <span class="tactic">repeat</span> <span class="id">simpl_In</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exists</span> (<span class="id">i</span>, (<span class="id">t</span>, <span class="id">c</span>)); <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span> <span class="kwd">in</span> *; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fact</span> <span class="id"><a name="NORMFBY.normfby_global_normalized_global">normfby_global_normalized_global</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">Hunt</span> <span class="id">Hprefs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normalized_global">normalized_global</a></span> (<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normfby_global">normfby_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Hunt">Hunt</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Hprefs">Hprefs</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof56')">Proof.</div>
<div class="proofscript" id="proof56">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">G</span>; <span class="tactic">intros</span>; <span class="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.iface_eq_normalized_node">iface_eq_normalized_node</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normfby_global_eq">normfby_global_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normfby_node_normalized_node">normfby_node_normalized_node</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">IHG</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<h3> normfby_global produces a global with the correct prefixes </h3>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="NORMFBY.normfby_global_prefixes">normfby_global_prefixes</a></span> : <span class="kwd">forall</span> <span class="id">G</span> <span class="id">G</span>' <span class="id">Hunt</span> <span class="id">Hprefs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.normfby_global">normfby_global</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#G">G</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Hunt">Hunt</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Hprefs">Hprefs</a></span> = <span class="id">G</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">n</span> =&gt; <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn.n_prefixes">n_prefixes</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#n">n</a></span> = <span class="id"><a href="Velus.Common.CommonPS.html#PS.add">PS.add</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Ids.norm2">norm2</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY.norm1_prefs">norm1_prefs</a></span>) <span class="id">G</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof57')">Proof.</div>
<div class="proofscript" id="proof57">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">G</span>; <span class="tactic">intros</span> * <span class="id">Hnorm</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="id">inv</span> <span class="id">Hnorm</span>; <span class="tactic">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hprefs</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY">NORMFBY</a></span>.<br/>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="NormFbyFun">NormFbyFun</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ids</span> : <span class="id"><a href="Velus.Common.Common.html#IDS">IDS</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Op</span> : <span class="id"><a href="Velus.Operators.html#OPERATORS">OPERATORS</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">OpAux</span> : <span class="id"><a href="Velus.Operators.html#OPERATORS_AUX">OPERATORS_AUX</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Op">Op</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Syn</span> : <span class="id"><a href="Velus.Lustre.LSyntax.html#LSYNTAX">LSYNTAX</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Op">Op</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Unt</span> : <span class="id"><a href="Velus.Lustre.Normalization.Unnesting.html#UNNESTING">UNNESTING</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn">Syn</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;: <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY">NORMFBY</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn">Syn</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt">Unt</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Include</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NORMFBY">NORMFBY</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Ids">Ids</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Op">Op</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#OpAux">OpAux</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Syn">Syn</a></span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#Unt">Unt</a></span>.<br/>
<span class="kwd">End</span> <span class="id"><a href="Velus.Lustre.Normalization.NormFby.html#NormFbyFun">NormFbyFun</a></span>.<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
